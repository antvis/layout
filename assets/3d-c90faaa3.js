import{_ as zn,e as ru,f as Ut,u as Dd,C as We,F as bd,h as wd,a as Bd,d as Fd,b as Ud,T as pn,l as kd,c as Hu}from"./datasets-7baa990c.js";var Ld=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Fe=1e-6,Qe=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)});function Kf(){var e=new Qe(9);return Qe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function Wd(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[4],e[4]=n[5],e[5]=n[6],e[6]=n[8],e[7]=n[9],e[8]=n[10],e}function Hd(e,n,i,t,r,a,o,s,u){var l=new Qe(9);return l[0]=e,l[1]=n,l[2]=i,l[3]=t,l[4]=r,l[5]=a,l[6]=o,l[7]=s,l[8]=u,l}function Te(){var e=new Qe(16);return Qe!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function $f(e){var n=new Qe(16);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n[3]=e[3],n[4]=e[4],n[5]=e[5],n[6]=e[6],n[7]=e[7],n[8]=e[8],n[9]=e[9],n[10]=e[10],n[11]=e[11],n[12]=e[12],n[13]=e[13],n[14]=e[14],n[15]=e[15],n}function Ar(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function nu(e,n,i,t,r,a,o,s,u,l,f,c,h,p,g,_){var E=new Qe(16);return E[0]=e,E[1]=n,E[2]=i,E[3]=t,E[4]=r,E[5]=a,E[6]=o,E[7]=s,E[8]=u,E[9]=l,E[10]=f,E[11]=c,E[12]=h,E[13]=p,E[14]=g,E[15]=_,E}function Qo(e,n,i,t,r,a,o,s,u,l,f,c,h,p,g,_,E){return e[0]=n,e[1]=i,e[2]=t,e[3]=r,e[4]=a,e[5]=o,e[6]=s,e[7]=u,e[8]=l,e[9]=f,e[10]=c,e[11]=h,e[12]=p,e[13]=g,e[14]=_,e[15]=E,e}function Xi(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function iu(e,n){if(e===n){var i=n[1],t=n[2],r=n[3],a=n[6],o=n[7],s=n[11];e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=i,e[6]=n[9],e[7]=n[13],e[8]=t,e[9]=a,e[11]=n[14],e[12]=r,e[13]=o,e[14]=s}else e[0]=n[0],e[1]=n[4],e[2]=n[8],e[3]=n[12],e[4]=n[1],e[5]=n[5],e[6]=n[9],e[7]=n[13],e[8]=n[2],e[9]=n[6],e[10]=n[10],e[11]=n[14],e[12]=n[3],e[13]=n[7],e[14]=n[11],e[15]=n[15];return e}function Rr(e,n){var i=n[0],t=n[1],r=n[2],a=n[3],o=n[4],s=n[5],u=n[6],l=n[7],f=n[8],c=n[9],h=n[10],p=n[11],g=n[12],_=n[13],E=n[14],y=n[15],R=i*s-t*o,A=i*u-r*o,M=i*l-a*o,x=t*u-r*s,P=t*l-a*s,C=r*l-a*u,O=f*_-c*g,D=f*E-h*g,F=f*y-p*g,k=c*E-h*_,d=c*y-p*_,v=h*y-p*E,m=R*v-A*d+M*k+x*F-P*D+C*O;return m?(m=1/m,e[0]=(s*v-u*d+l*k)*m,e[1]=(r*d-t*v-a*k)*m,e[2]=(_*C-E*P+y*x)*m,e[3]=(h*P-c*C-p*x)*m,e[4]=(u*F-o*v-l*D)*m,e[5]=(i*v-r*F+a*D)*m,e[6]=(E*M-g*C-y*A)*m,e[7]=(f*C-h*M+p*A)*m,e[8]=(o*d-s*F+l*O)*m,e[9]=(t*F-i*d-a*O)*m,e[10]=(g*P-_*M+y*R)*m,e[11]=(c*M-f*P-p*R)*m,e[12]=(s*D-o*k-u*O)*m,e[13]=(i*k-t*D+r*O)*m,e[14]=(_*A-g*x-E*R)*m,e[15]=(f*x-c*A+h*R)*m,e):null}function Xd(e,n){var i=n[0],t=n[1],r=n[2],a=n[3],o=n[4],s=n[5],u=n[6],l=n[7],f=n[8],c=n[9],h=n[10],p=n[11],g=n[12],_=n[13],E=n[14],y=n[15];return e[0]=s*(h*y-p*E)-c*(u*y-l*E)+_*(u*p-l*h),e[1]=-(t*(h*y-p*E)-c*(r*y-a*E)+_*(r*p-a*h)),e[2]=t*(u*y-l*E)-s*(r*y-a*E)+_*(r*l-a*u),e[3]=-(t*(u*p-l*h)-s*(r*p-a*h)+c*(r*l-a*u)),e[4]=-(o*(h*y-p*E)-f*(u*y-l*E)+g*(u*p-l*h)),e[5]=i*(h*y-p*E)-f*(r*y-a*E)+g*(r*p-a*h),e[6]=-(i*(u*y-l*E)-o*(r*y-a*E)+g*(r*l-a*u)),e[7]=i*(u*p-l*h)-o*(r*p-a*h)+f*(r*l-a*u),e[8]=o*(c*y-p*_)-f*(s*y-l*_)+g*(s*p-l*c),e[9]=-(i*(c*y-p*_)-f*(t*y-a*_)+g*(t*p-a*c)),e[10]=i*(s*y-l*_)-o*(t*y-a*_)+g*(t*l-a*s),e[11]=-(i*(s*p-l*c)-o*(t*p-a*c)+f*(t*l-a*s)),e[12]=-(o*(c*E-h*_)-f*(s*E-u*_)+g*(s*h-u*c)),e[13]=i*(c*E-h*_)-f*(t*E-r*_)+g*(t*h-r*c),e[14]=-(i*(s*E-u*_)-o*(t*E-r*_)+g*(t*u-r*s)),e[15]=i*(s*h-u*c)-o*(t*h-r*c)+f*(t*u-r*s),e}function qf(e){var n=e[0],i=e[1],t=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=e[8],f=e[9],c=e[10],h=e[11],p=e[12],g=e[13],_=e[14],E=e[15],y=n*o-i*a,R=n*s-t*a,A=n*u-r*a,M=i*s-t*o,x=i*u-r*o,P=t*u-r*s,C=l*g-f*p,O=l*_-c*p,D=l*E-h*p,F=f*_-c*g,k=f*E-h*g,d=c*E-h*_;return y*d-R*k+A*F+M*D-x*O+P*C}function nr(e,n,i){var t=n[0],r=n[1],a=n[2],o=n[3],s=n[4],u=n[5],l=n[6],f=n[7],c=n[8],h=n[9],p=n[10],g=n[11],_=n[12],E=n[13],y=n[14],R=n[15],A=i[0],M=i[1],x=i[2],P=i[3];return e[0]=A*t+M*s+x*c+P*_,e[1]=A*r+M*u+x*h+P*E,e[2]=A*a+M*l+x*p+P*y,e[3]=A*o+M*f+x*g+P*R,A=i[4],M=i[5],x=i[6],P=i[7],e[4]=A*t+M*s+x*c+P*_,e[5]=A*r+M*u+x*h+P*E,e[6]=A*a+M*l+x*p+P*y,e[7]=A*o+M*f+x*g+P*R,A=i[8],M=i[9],x=i[10],P=i[11],e[8]=A*t+M*s+x*c+P*_,e[9]=A*r+M*u+x*h+P*E,e[10]=A*a+M*l+x*p+P*y,e[11]=A*o+M*f+x*g+P*R,A=i[12],M=i[13],x=i[14],P=i[15],e[12]=A*t+M*s+x*c+P*_,e[13]=A*r+M*u+x*h+P*E,e[14]=A*a+M*l+x*p+P*y,e[15]=A*o+M*f+x*g+P*R,e}function Ln(e,n,i){var t=i[0],r=i[1],a=i[2],o,s,u,l,f,c,h,p,g,_,E,y;return n===e?(e[12]=n[0]*t+n[4]*r+n[8]*a+n[12],e[13]=n[1]*t+n[5]*r+n[9]*a+n[13],e[14]=n[2]*t+n[6]*r+n[10]*a+n[14],e[15]=n[3]*t+n[7]*r+n[11]*a+n[15]):(o=n[0],s=n[1],u=n[2],l=n[3],f=n[4],c=n[5],h=n[6],p=n[7],g=n[8],_=n[9],E=n[10],y=n[11],e[0]=o,e[1]=s,e[2]=u,e[3]=l,e[4]=f,e[5]=c,e[6]=h,e[7]=p,e[8]=g,e[9]=_,e[10]=E,e[11]=y,e[12]=o*t+f*r+g*a+n[12],e[13]=s*t+c*r+_*a+n[13],e[14]=u*t+h*r+E*a+n[14],e[15]=l*t+p*r+y*a+n[15]),e}function Jo(e,n,i){var t=i[0],r=i[1],a=i[2];return e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t,e[3]=n[3]*t,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=n[11]*a,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}function Vd(e,n,i,t){var r=t[0],a=t[1],o=t[2],s=Math.hypot(r,a,o),u,l,f,c,h,p,g,_,E,y,R,A,M,x,P,C,O,D,F,k,d,v,m,S;return s<Fe?null:(s=1/s,r*=s,a*=s,o*=s,u=Math.sin(i),l=Math.cos(i),f=1-l,c=n[0],h=n[1],p=n[2],g=n[3],_=n[4],E=n[5],y=n[6],R=n[7],A=n[8],M=n[9],x=n[10],P=n[11],C=r*r*f+l,O=a*r*f+o*u,D=o*r*f-a*u,F=r*a*f-o*u,k=a*a*f+l,d=o*a*f+r*u,v=r*o*f+a*u,m=a*o*f-r*u,S=o*o*f+l,e[0]=c*C+_*O+A*D,e[1]=h*C+E*O+M*D,e[2]=p*C+y*O+x*D,e[3]=g*C+R*O+P*D,e[4]=c*F+_*k+A*d,e[5]=h*F+E*k+M*d,e[6]=p*F+y*k+x*d,e[7]=g*F+R*k+P*d,e[8]=c*v+_*m+A*S,e[9]=h*v+E*m+M*S,e[10]=p*v+y*m+x*S,e[11]=g*v+R*m+P*S,n!==e&&(e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e)}function Zf(e,n,i){var t=Math.sin(i),r=Math.cos(i),a=n[4],o=n[5],s=n[6],u=n[7],l=n[8],f=n[9],c=n[10],h=n[11];return n!==e&&(e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[4]=a*r+l*t,e[5]=o*r+f*t,e[6]=s*r+c*t,e[7]=u*r+h*t,e[8]=l*r-a*t,e[9]=f*r-o*t,e[10]=c*r-s*t,e[11]=h*r-u*t,e}function Qf(e,n,i){var t=Math.sin(i),r=Math.cos(i),a=n[0],o=n[1],s=n[2],u=n[3],l=n[8],f=n[9],c=n[10],h=n[11];return n!==e&&(e[4]=n[4],e[5]=n[5],e[6]=n[6],e[7]=n[7],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=a*r-l*t,e[1]=o*r-f*t,e[2]=s*r-c*t,e[3]=u*r-h*t,e[8]=a*t+l*r,e[9]=o*t+f*r,e[10]=s*t+c*r,e[11]=u*t+h*r,e}function Yd(e,n,i){var t=Math.sin(i),r=Math.cos(i),a=n[0],o=n[1],s=n[2],u=n[3],l=n[4],f=n[5],c=n[6],h=n[7];return n!==e&&(e[8]=n[8],e[9]=n[9],e[10]=n[10],e[11]=n[11],e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15]),e[0]=a*r+l*t,e[1]=o*r+f*t,e[2]=s*r+c*t,e[3]=u*r+h*t,e[4]=l*r-a*t,e[5]=f*r-o*t,e[6]=c*r-s*t,e[7]=h*r-u*t,e}function Gn(e,n){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Jf(e,n){return e[0]=n[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=n[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zd(e,n,i){var t=i[0],r=i[1],a=i[2],o=Math.hypot(t,r,a),s,u,l;return o<Fe?null:(o=1/o,t*=o,r*=o,a*=o,s=Math.sin(n),u=Math.cos(n),l=1-u,e[0]=t*t*l+u,e[1]=r*t*l+a*s,e[2]=a*t*l-r*s,e[3]=0,e[4]=t*r*l-a*s,e[5]=r*r*l+u,e[6]=a*r*l+t*s,e[7]=0,e[8]=t*a*l+r*s,e[9]=r*a*l-t*s,e[10]=a*a*l+u,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Gd(e,n){var i=Math.sin(n),t=Math.cos(n);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=i,e[7]=0,e[8]=0,e[9]=-i,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kd(e,n){var i=Math.sin(n),t=Math.cos(n);return e[0]=t,e[1]=0,e[2]=-i,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=i,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function $d(e,n){var i=Math.sin(n),t=Math.cos(n);return e[0]=t,e[1]=i,e[2]=0,e[3]=0,e[4]=-i,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function jf(e,n,i){var t=n[0],r=n[1],a=n[2],o=n[3],s=t+t,u=r+r,l=a+a,f=t*s,c=t*u,h=t*l,p=r*u,g=r*l,_=a*l,E=o*s,y=o*u,R=o*l;return e[0]=1-(p+_),e[1]=c+R,e[2]=h-y,e[3]=0,e[4]=c-R,e[5]=1-(f+_),e[6]=g+E,e[7]=0,e[8]=h+y,e[9]=g-E,e[10]=1-(f+p),e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function qd(e,n){var i=new Qe(3),t=-n[0],r=-n[1],a=-n[2],o=n[3],s=n[4],u=n[5],l=n[6],f=n[7],c=t*t+r*r+a*a+o*o;return c>0?(i[0]=(s*o+f*t+u*a-l*r)*2/c,i[1]=(u*o+f*r+l*t-s*a)*2/c,i[2]=(l*o+f*a+s*r-u*t)*2/c):(i[0]=(s*o+f*t+u*a-l*r)*2,i[1]=(u*o+f*r+l*t-s*a)*2,i[2]=(l*o+f*a+s*r-u*t)*2),jf(e,n,i),e}function wa(e,n){return e[0]=n[12],e[1]=n[13],e[2]=n[14],e}function Kn(e,n){var i=n[0],t=n[1],r=n[2],a=n[4],o=n[5],s=n[6],u=n[8],l=n[9],f=n[10];return e[0]=Math.hypot(i,t,r),e[1]=Math.hypot(a,o,s),e[2]=Math.hypot(u,l,f),e}function Ba(e,n){var i=new Qe(3);Kn(i,n);var t=1/i[0],r=1/i[1],a=1/i[2],o=n[0]*t,s=n[1]*r,u=n[2]*a,l=n[4]*t,f=n[5]*r,c=n[6]*a,h=n[8]*t,p=n[9]*r,g=n[10]*a,_=o+f+g,E=0;return _>0?(E=Math.sqrt(_+1)*2,e[3]=.25*E,e[0]=(c-p)/E,e[1]=(h-u)/E,e[2]=(s-l)/E):o>f&&o>g?(E=Math.sqrt(1+o-f-g)*2,e[3]=(c-p)/E,e[0]=.25*E,e[1]=(s+l)/E,e[2]=(h+u)/E):f>g?(E=Math.sqrt(1+f-o-g)*2,e[3]=(h-u)/E,e[0]=(s+l)/E,e[1]=.25*E,e[2]=(c+p)/E):(E=Math.sqrt(1+g-o-f)*2,e[3]=(s-l)/E,e[0]=(h+u)/E,e[1]=(c+p)/E,e[2]=.25*E),e}function Zd(e,n,i,t){var r=n[0],a=n[1],o=n[2],s=n[3],u=r+r,l=a+a,f=o+o,c=r*u,h=r*l,p=r*f,g=a*l,_=a*f,E=o*f,y=s*u,R=s*l,A=s*f,M=t[0],x=t[1],P=t[2];return e[0]=(1-(g+E))*M,e[1]=(h+A)*M,e[2]=(p-R)*M,e[3]=0,e[4]=(h-A)*x,e[5]=(1-(c+E))*x,e[6]=(_+y)*x,e[7]=0,e[8]=(p+R)*P,e[9]=(_-y)*P,e[10]=(1-(c+g))*P,e[11]=0,e[12]=i[0],e[13]=i[1],e[14]=i[2],e[15]=1,e}function Si(e,n,i,t,r){var a=n[0],o=n[1],s=n[2],u=n[3],l=a+a,f=o+o,c=s+s,h=a*l,p=a*f,g=a*c,_=o*f,E=o*c,y=s*c,R=u*l,A=u*f,M=u*c,x=t[0],P=t[1],C=t[2],O=r[0],D=r[1],F=r[2],k=(1-(_+y))*x,d=(p+M)*x,v=(g-A)*x,m=(p-M)*P,S=(1-(h+y))*P,T=(E+R)*P,N=(g+A)*C,B=(E-R)*C,w=(1-(h+_))*C;return e[0]=k,e[1]=d,e[2]=v,e[3]=0,e[4]=m,e[5]=S,e[6]=T,e[7]=0,e[8]=N,e[9]=B,e[10]=w,e[11]=0,e[12]=i[0]+O-(k*O+m*D+N*F),e[13]=i[1]+D-(d*O+S*D+B*F),e[14]=i[2]+F-(v*O+T*D+w*F),e[15]=1,e}function au(e,n){var i=n[0],t=n[1],r=n[2],a=n[3],o=i+i,s=t+t,u=r+r,l=i*o,f=t*o,c=t*s,h=r*o,p=r*s,g=r*u,_=a*o,E=a*s,y=a*u;return e[0]=1-c-g,e[1]=f+y,e[2]=h-E,e[3]=0,e[4]=f-y,e[5]=1-l-g,e[6]=p+_,e[7]=0,e[8]=h+E,e[9]=p-_,e[10]=1-l-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Qd(e,n,i,t,r,a,o){var s=1/(i-n),u=1/(r-t),l=1/(a-o);return e[0]=a*2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a*2*u,e[6]=0,e[7]=0,e[8]=(i+n)*s,e[9]=(r+t)*u,e[10]=(o+a)*l,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*a*2*l,e[15]=0,e}function ec(e,n,i,t,r){var a=1/Math.tan(n/2),o;return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0?(o=1/(t-r),e[10]=(r+t)*o,e[14]=2*r*t*o):(e[10]=-1,e[14]=-2*t),e}var Jd=ec;function jd(e,n,i,t,r){var a=1/Math.tan(n/2),o;return e[0]=a/i,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=a,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,r!=null&&r!==1/0?(o=1/(t-r),e[10]=r*o,e[14]=r*t*o):(e[10]=-1,e[14]=-t),e}function ev(e,n,i,t){var r=Math.tan(n.upDegrees*Math.PI/180),a=Math.tan(n.downDegrees*Math.PI/180),o=Math.tan(n.leftDegrees*Math.PI/180),s=Math.tan(n.rightDegrees*Math.PI/180),u=2/(o+s),l=2/(r+a);return e[0]=u,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=l,e[6]=0,e[7]=0,e[8]=-((o-s)*u*.5),e[9]=(r-a)*l*.5,e[10]=t/(i-t),e[11]=-1,e[12]=0,e[13]=0,e[14]=t*i/(i-t),e[15]=0,e}function tc(e,n,i,t,r,a,o){var s=1/(n-i),u=1/(t-r),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*l,e[11]=0,e[12]=(n+i)*s,e[13]=(r+t)*u,e[14]=(o+a)*l,e[15]=1,e}var rc=tc;function tv(e,n,i,t,r,a,o){var s=1/(n-i),u=1/(t-r),l=1/(a-o);return e[0]=-2*s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*u,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=l,e[11]=0,e[12]=(n+i)*s,e[13]=(r+t)*u,e[14]=a*l,e[15]=1,e}function nc(e,n,i,t){var r,a,o,s,u,l,f,c,h,p,g=n[0],_=n[1],E=n[2],y=t[0],R=t[1],A=t[2],M=i[0],x=i[1],P=i[2];return Math.abs(g-M)<Fe&&Math.abs(_-x)<Fe&&Math.abs(E-P)<Fe?Xi(e):(f=g-M,c=_-x,h=E-P,p=1/Math.hypot(f,c,h),f*=p,c*=p,h*=p,r=R*h-A*c,a=A*f-y*h,o=y*c-R*f,p=Math.hypot(r,a,o),p?(p=1/p,r*=p,a*=p,o*=p):(r=0,a=0,o=0),s=c*o-h*a,u=h*r-f*o,l=f*a-c*r,p=Math.hypot(s,u,l),p?(p=1/p,s*=p,u*=p,l*=p):(s=0,u=0,l=0),e[0]=r,e[1]=s,e[2]=f,e[3]=0,e[4]=a,e[5]=u,e[6]=c,e[7]=0,e[8]=o,e[9]=l,e[10]=h,e[11]=0,e[12]=-(r*g+a*_+o*E),e[13]=-(s*g+u*_+l*E),e[14]=-(f*g+c*_+h*E),e[15]=1,e)}function rv(e,n,i,t){var r=n[0],a=n[1],o=n[2],s=t[0],u=t[1],l=t[2],f=r-i[0],c=a-i[1],h=o-i[2],p=f*f+c*c+h*h;p>0&&(p=1/Math.sqrt(p),f*=p,c*=p,h*=p);var g=u*h-l*c,_=l*f-s*h,E=s*c-u*f;return p=g*g+_*_+E*E,p>0&&(p=1/Math.sqrt(p),g*=p,_*=p,E*=p),e[0]=g,e[1]=_,e[2]=E,e[3]=0,e[4]=c*E-h*_,e[5]=h*g-f*E,e[6]=f*_-c*g,e[7]=0,e[8]=f,e[9]=c,e[10]=h,e[11]=0,e[12]=r,e[13]=a,e[14]=o,e[15]=1,e}function nv(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function iv(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function av(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e[3]=n[3]+i[3],e[4]=n[4]+i[4],e[5]=n[5]+i[5],e[6]=n[6]+i[6],e[7]=n[7]+i[7],e[8]=n[8]+i[8],e[9]=n[9]+i[9],e[10]=n[10]+i[10],e[11]=n[11]+i[11],e[12]=n[12]+i[12],e[13]=n[13]+i[13],e[14]=n[14]+i[14],e[15]=n[15]+i[15],e}function ic(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e[3]=n[3]-i[3],e[4]=n[4]-i[4],e[5]=n[5]-i[5],e[6]=n[6]-i[6],e[7]=n[7]-i[7],e[8]=n[8]-i[8],e[9]=n[9]-i[9],e[10]=n[10]-i[10],e[11]=n[11]-i[11],e[12]=n[12]-i[12],e[13]=n[13]-i[13],e[14]=n[14]-i[14],e[15]=n[15]-i[15],e}function ov(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e[3]=n[3]*i,e[4]=n[4]*i,e[5]=n[5]*i,e[6]=n[6]*i,e[7]=n[7]*i,e[8]=n[8]*i,e[9]=n[9]*i,e[10]=n[10]*i,e[11]=n[11]*i,e[12]=n[12]*i,e[13]=n[13]*i,e[14]=n[14]*i,e[15]=n[15]*i,e}function sv(e,n,i,t){return e[0]=n[0]+i[0]*t,e[1]=n[1]+i[1]*t,e[2]=n[2]+i[2]*t,e[3]=n[3]+i[3]*t,e[4]=n[4]+i[4]*t,e[5]=n[5]+i[5]*t,e[6]=n[6]+i[6]*t,e[7]=n[7]+i[7]*t,e[8]=n[8]+i[8]*t,e[9]=n[9]+i[9]*t,e[10]=n[10]+i[10]*t,e[11]=n[11]+i[11]*t,e[12]=n[12]+i[12]*t,e[13]=n[13]+i[13]*t,e[14]=n[14]+i[14]*t,e[15]=n[15]+i[15]*t,e}function uv(e,n){return e[0]===n[0]&&e[1]===n[1]&&e[2]===n[2]&&e[3]===n[3]&&e[4]===n[4]&&e[5]===n[5]&&e[6]===n[6]&&e[7]===n[7]&&e[8]===n[8]&&e[9]===n[9]&&e[10]===n[10]&&e[11]===n[11]&&e[12]===n[12]&&e[13]===n[13]&&e[14]===n[14]&&e[15]===n[15]}function lv(e,n){var i=e[0],t=e[1],r=e[2],a=e[3],o=e[4],s=e[5],u=e[6],l=e[7],f=e[8],c=e[9],h=e[10],p=e[11],g=e[12],_=e[13],E=e[14],y=e[15],R=n[0],A=n[1],M=n[2],x=n[3],P=n[4],C=n[5],O=n[6],D=n[7],F=n[8],k=n[9],d=n[10],v=n[11],m=n[12],S=n[13],T=n[14],N=n[15];return Math.abs(i-R)<=Fe*Math.max(1,Math.abs(i),Math.abs(R))&&Math.abs(t-A)<=Fe*Math.max(1,Math.abs(t),Math.abs(A))&&Math.abs(r-M)<=Fe*Math.max(1,Math.abs(r),Math.abs(M))&&Math.abs(a-x)<=Fe*Math.max(1,Math.abs(a),Math.abs(x))&&Math.abs(o-P)<=Fe*Math.max(1,Math.abs(o),Math.abs(P))&&Math.abs(s-C)<=Fe*Math.max(1,Math.abs(s),Math.abs(C))&&Math.abs(u-O)<=Fe*Math.max(1,Math.abs(u),Math.abs(O))&&Math.abs(l-D)<=Fe*Math.max(1,Math.abs(l),Math.abs(D))&&Math.abs(f-F)<=Fe*Math.max(1,Math.abs(f),Math.abs(F))&&Math.abs(c-k)<=Fe*Math.max(1,Math.abs(c),Math.abs(k))&&Math.abs(h-d)<=Fe*Math.max(1,Math.abs(h),Math.abs(d))&&Math.abs(p-v)<=Fe*Math.max(1,Math.abs(p),Math.abs(v))&&Math.abs(g-m)<=Fe*Math.max(1,Math.abs(g),Math.abs(m))&&Math.abs(_-S)<=Fe*Math.max(1,Math.abs(_),Math.abs(S))&&Math.abs(E-T)<=Fe*Math.max(1,Math.abs(E),Math.abs(T))&&Math.abs(y-N)<=Fe*Math.max(1,Math.abs(y),Math.abs(N))}var yn=nr,fv=ic;const cv=Object.freeze(Object.defineProperty({__proto__:null,add:av,adjoint:Xd,clone:$f,copy:Ar,create:Te,determinant:qf,equals:lv,exactEquals:uv,frob:iv,fromQuat:au,fromQuat2:qd,fromRotation:zd,fromRotationTranslation:jf,fromRotationTranslationScale:Zd,fromRotationTranslationScaleOrigin:Si,fromScaling:Jf,fromTranslation:Gn,fromValues:nu,fromXRotation:Gd,fromYRotation:Kd,fromZRotation:$d,frustum:Qd,getRotation:Ba,getScaling:Kn,getTranslation:wa,identity:Xi,invert:Rr,lookAt:nc,mul:yn,multiply:nr,multiplyScalar:ov,multiplyScalarAndAdd:sv,ortho:rc,orthoNO:tc,orthoZO:tv,perspective:Jd,perspectiveFromFieldOfView:ev,perspectiveNO:ec,perspectiveZO:jd,rotate:Vd,rotateX:Zf,rotateY:Qf,rotateZ:Yd,scale:Jo,set:Qo,str:nv,sub:fv,subtract:ic,targetTo:rv,translate:Ln,transpose:iu},Symbol.toStringTag,{value:"Module"}));function Re(){var e=new Qe(3);return Qe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function wr(e){var n=new Qe(3);return n[0]=e[0],n[1]=e[1],n[2]=e[2],n}function Ur(e){var n=e[0],i=e[1],t=e[2];return Math.hypot(n,i,t)}function me(e,n,i){var t=new Qe(3);return t[0]=e,t[1]=n,t[2]=i,t}function Dt(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function Br(e,n,i,t){return e[0]=n,e[1]=i,e[2]=t,e}function Wn(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function Xu(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e}function hv(e,n,i){return e[0]=n[0]*i[0],e[1]=n[1]*i[1],e[2]=n[2]*i[2],e}function jo(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e}function dv(e,n){var i=n[0]-e[0],t=n[1]-e[1],r=n[2]-e[2];return Math.hypot(i,t,r)}function En(e,n){var i=n[0],t=n[1],r=n[2],a=i*i+t*t+r*r;return a>0&&(a=1/Math.sqrt(a)),e[0]=n[0]*a,e[1]=n[1]*a,e[2]=n[2]*a,e}function Sr(e,n){return e[0]*n[0]+e[1]*n[1]+e[2]*n[2]}function Ca(e,n,i){var t=n[0],r=n[1],a=n[2],o=i[0],s=i[1],u=i[2];return e[0]=r*u-a*s,e[1]=a*o-t*u,e[2]=t*s-r*o,e}function es(e,n,i,t){var r=n[0],a=n[1],o=n[2];return e[0]=r+t*(i[0]-r),e[1]=a+t*(i[1]-a),e[2]=o+t*(i[2]-o),e}function It(e,n,i){var t=n[0],r=n[1],a=n[2],o=i[3]*t+i[7]*r+i[11]*a+i[15];return o=o||1,e[0]=(i[0]*t+i[4]*r+i[8]*a+i[12])/o,e[1]=(i[1]*t+i[5]*r+i[9]*a+i[13])/o,e[2]=(i[2]*t+i[6]*r+i[10]*a+i[14])/o,e}function vv(e,n,i){var t=n[0],r=n[1],a=n[2];return e[0]=t*i[0]+r*i[3]+a*i[6],e[1]=t*i[1]+r*i[4]+a*i[7],e[2]=t*i[2]+r*i[5]+a*i[8],e}function pv(e,n,i){var t=i[0],r=i[1],a=i[2],o=i[3],s=n[0],u=n[1],l=n[2],f=r*l-a*u,c=a*s-t*l,h=t*u-r*s,p=r*h-a*c,g=a*f-t*h,_=t*c-r*f,E=o*2;return f*=E,c*=E,h*=E,p*=2,g*=2,_*=2,e[0]=s+f+p,e[1]=u+c+g,e[2]=l+h+_,e}function fi(e,n){var i=e[0],t=e[1],r=e[2],a=n[0],o=n[1],s=n[2];return Math.abs(i-a)<=Fe*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(t-o)<=Fe*Math.max(1,Math.abs(t),Math.abs(o))&&Math.abs(r-s)<=Fe*Math.max(1,Math.abs(r),Math.abs(s))}var Vu=dv,ac=Ur;(function(){var e=Re();return function(n,i,t,r,a,o){var s,u;for(i||(i=3),t||(t=0),r?u=Math.min(r*i+t,n.length):u=n.length,s=t;s<u;s+=i)e[0]=n[s],e[1]=n[s+1],e[2]=n[s+2],a(e,e,o),n[s]=e[0],n[s+1]=e[1],n[s+2]=e[2];return n}})();function Jr(){var e=new Qe(4);return Qe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function gv(e,n,i,t){var r=new Qe(4);return r[0]=e,r[1]=n,r[2]=i,r[3]=t,r}function mv(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e[3]=n[3],e}function _v(e,n){var i=n[0],t=n[1],r=n[2],a=n[3],o=i*i+t*t+r*r+a*a;return o>0&&(o=1/Math.sqrt(o)),e[0]=i*o,e[1]=t*o,e[2]=r*o,e[3]=a*o,e}function gn(e,n,i){var t=n[0],r=n[1],a=n[2],o=n[3];return e[0]=i[0]*t+i[4]*r+i[8]*a+i[12]*o,e[1]=i[1]*t+i[5]*r+i[9]*a+i[13]*o,e[2]=i[2]*t+i[6]*r+i[10]*a+i[14]*o,e[3]=i[3]*t+i[7]*r+i[11]*a+i[15]*o,e}(function(){var e=Jr();return function(n,i,t,r,a,o){var s,u;for(i||(i=4),t||(t=0),r?u=Math.min(r*i+t,n.length):u=n.length,s=t;s<u;s+=i)e[0]=n[s],e[1]=n[s+1],e[2]=n[s+2],e[3]=n[s+3],a(e,e,o),n[s]=e[0],n[s+1]=e[1],n[s+2]=e[2],n[s+3]=e[3];return n}})();function qe(){var e=new Qe(4);return Qe!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function jr(e,n,i){i=i*.5;var t=Math.sin(i);return e[0]=t*n[0],e[1]=t*n[1],e[2]=t*n[2],e[3]=Math.cos(i),e}function tn(e,n,i){var t=n[0],r=n[1],a=n[2],o=n[3],s=i[0],u=i[1],l=i[2],f=i[3];return e[0]=t*f+o*s+r*l-a*u,e[1]=r*f+o*u+a*s-t*l,e[2]=a*f+o*l+t*u-r*s,e[3]=o*f-t*s-r*u-a*l,e}function Po(e,n,i,t){var r=n[0],a=n[1],o=n[2],s=n[3],u=i[0],l=i[1],f=i[2],c=i[3],h,p,g,_,E;return p=r*u+a*l+o*f+s*c,p<0&&(p=-p,u=-u,l=-l,f=-f,c=-c),1-p>Fe?(h=Math.acos(p),g=Math.sin(h),_=Math.sin((1-t)*h)/g,E=Math.sin(t*h)/g):(_=1-t,E=t),e[0]=_*r+E*u,e[1]=_*a+E*l,e[2]=_*o+E*f,e[3]=_*s+E*c,e}function xo(e,n){var i=n[0],t=n[1],r=n[2],a=n[3],o=i*i+t*t+r*r+a*a,s=o?1/o:0;return e[0]=-i*s,e[1]=-t*s,e[2]=-r*s,e[3]=a*s,e}function Ev(e,n){var i=n[0]+n[4]+n[8],t;if(i>0)t=Math.sqrt(i+1),e[3]=.5*t,t=.5/t,e[0]=(n[5]-n[7])*t,e[1]=(n[6]-n[2])*t,e[2]=(n[1]-n[3])*t;else{var r=0;n[4]>n[0]&&(r=1),n[8]>n[r*3+r]&&(r=2);var a=(r+1)%3,o=(r+2)%3;t=Math.sqrt(n[r*3+r]-n[a*3+a]-n[o*3+o]+1),e[r]=.5*t,t=.5/t,e[3]=(n[a*3+o]-n[o*3+a])*t,e[a]=(n[a*3+r]+n[r*3+a])*t,e[o]=(n[o*3+r]+n[r*3+o])*t}return e}function ta(e,n,i,t){var r=.5*Math.PI/180;n*=r,i*=r,t*=r;var a=Math.sin(n),o=Math.cos(n),s=Math.sin(i),u=Math.cos(i),l=Math.sin(t),f=Math.cos(t);return e[0]=a*u*f-o*s*l,e[1]=o*s*f+a*u*l,e[2]=o*u*l-a*s*f,e[3]=o*u*f+a*s*l,e}var Mo=gv,ra=mv,Yu=tn,Fa=_v;(function(){var e=Re(),n=me(1,0,0),i=me(0,1,0);return function(t,r,a){var o=Sr(r,a);return o<-.999999?(Ca(e,n,r),ac(e)<1e-6&&Ca(e,i,r),En(e,e),jr(t,e,Math.PI),t):o>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Ca(e,r,a),t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=1+o,Fa(t,t))}})();(function(){var e=qe(),n=qe();return function(i,t,r,a,o,s){return Po(e,t,o,s),Po(n,r,a,s),Po(i,e,n,2*s*(1-s)),i}})();(function(){var e=Kf();return function(n,i,t,r){return e[0]=t[0],e[3]=t[1],e[6]=t[2],e[1]=r[0],e[4]=r[1],e[7]=r[2],e[2]=-i[0],e[5]=-i[1],e[8]=-i[2],Fa(n,Ev(n,e))}})();function yv(){var e=new Qe(2);return Qe!=Float32Array&&(e[0]=0,e[1]=0),e}function Tv(e,n){var i=new Qe(2);return i[0]=e,i[1]=n,i}function Rv(e,n){return e[0]=n[0],e[1]=n[1],e}function oc(e,n){var i=n[0],t=n[1],r=i*i+t*t;return r>0&&(r=1/Math.sqrt(r)),e[0]=n[0]*r,e[1]=n[1]*r,e}function sc(e,n){return e[0]*n[0]+e[1]*n[1]}function uc(e,n){return e[0]===n[0]&&e[1]===n[1]}(function(){var e=yv();return function(n,i,t,r,a,o){var s,u;for(i||(i=2),t||(t=0),r?u=Math.min(r*i+t,n.length):u=n.length,s=t;s<u;s+=i)e[0]=n[s],e[1]=n[s+1],a(e,e,o),n[s]=e[0],n[s+1]=e[1];return n}})();function Vi(e){return e.map(function(n){return Array.isArray(n)?[].concat(n):n})}var lc={x1:0,y1:0,x2:0,y2:0,x:0,y:0,qx:null,qy:null};function Sv(e,n,i){if(e[i].length>7){e[i].shift();for(var t=e[i],r=i;t.length;)n[i]="A",e.splice(r+=1,0,["C"].concat(t.splice(0,6)));e.splice(i,1)}}var Ai={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0};function fc(e){return Array.isArray(e)&&e.every(function(n){var i=n[0].toLowerCase();return Ai[i]===n.length-1&&"achlmqstvz".includes(i)})}function cc(e){return fc(e)&&e.every(function(n){var i=n[0];return i===i.toUpperCase()})}function hc(e){return cc(e)&&e.every(function(n){var i=n[0];return"ACLMQZ".includes(i)})}function zu(e){for(var n=e.pathValue[e.segmentStart],i=n.toLowerCase(),t=e.data;t.length>=Ai[i]&&(i==="m"&&t.length>2?(e.segments.push([n].concat(t.splice(0,2))),i="l",n=n==="m"?"l":"L"):e.segments.push([n].concat(t.splice(0,Ai[i]))),!!Ai[i]););}function Av(e){var n=e.index,i=e.pathValue,t=i.charCodeAt(n);if(t===48){e.param=0,e.index+=1;return}if(t===49){e.param=1,e.index+=1;return}e.err='[path-util]: invalid Arc flag "'+i[n]+'", expecting 0 or 1 at index '+n}function Pv(e){return e>=48&&e<=57||e===43||e===45||e===46}function Nn(e){return e>=48&&e<=57}function xv(e){var n=e.max,i=e.pathValue,t=e.index,r=t,a=!1,o=!1,s=!1,u=!1,l;if(r>=n){e.err="[path-util]: Invalid path value at index "+r+', "pathValue" is missing param';return}if(l=i.charCodeAt(r),(l===43||l===45)&&(r+=1,l=i.charCodeAt(r)),!Nn(l)&&l!==46){e.err="[path-util]: Invalid path value at index "+r+', "'+i[r]+'" is not a number';return}if(l!==46){if(a=l===48,r+=1,l=i.charCodeAt(r),a&&r<n&&l&&Nn(l)){e.err="[path-util]: Invalid path value at index "+t+', "'+i[t]+'" illegal number';return}for(;r<n&&Nn(i.charCodeAt(r));)r+=1,o=!0;l=i.charCodeAt(r)}if(l===46){for(u=!0,r+=1;Nn(i.charCodeAt(r));)r+=1,s=!0;l=i.charCodeAt(r)}if(l===101||l===69){if(u&&!o&&!s){e.err="[path-util]: Invalid path value at index "+r+', "'+i[r]+'" invalid float exponent';return}if(r+=1,l=i.charCodeAt(r),(l===43||l===45)&&(r+=1),r<n&&Nn(i.charCodeAt(r)))for(;r<n&&Nn(i.charCodeAt(r));)r+=1;else{e.err="[path-util]: Invalid path value at index "+r+', "'+i[r]+'" invalid integer exponent';return}}e.index=r,e.param=+e.pathValue.slice(t,r)}function Mv(e){var n=[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279];return e===10||e===13||e===8232||e===8233||e===32||e===9||e===11||e===12||e===160||e>=5760&&n.includes(e)}function Oa(e){for(var n=e.pathValue,i=e.max;e.index<i&&Mv(n.charCodeAt(e.index));)e.index+=1}function Cv(e){switch(e|32){case 109:case 122:case 108:case 104:case 118:case 99:case 115:case 113:case 116:case 97:return!0;default:return!1}}function Ov(e){return(e|32)===97}function Nv(e){var n=e.max,i=e.pathValue,t=e.index,r=i.charCodeAt(t),a=Ai[i[t].toLowerCase()];if(e.segmentStart=t,!Cv(r)){e.err='[path-util]: Invalid path value "'+i[t]+'" is not a path command';return}if(e.index+=1,Oa(e),e.data=[],!a){zu(e);return}for(;;){for(var o=a;o>0;o-=1){if(Ov(r)&&(o===3||o===4)?Av(e):xv(e),e.err.length)return;e.data.push(e.param),Oa(e),e.index<n&&i.charCodeAt(e.index)===44&&(e.index+=1,Oa(e))}if(e.index>=e.max||!Pv(i.charCodeAt(e.index)))break}zu(e)}var Iv=function(){function e(n){this.pathValue=n,this.segments=[],this.max=n.length,this.index=0,this.param=0,this.segmentStart=0,this.data=[],this.err=""}return e}();function Dv(e){if(fc(e))return Vi(e);var n=new Iv(e);for(Oa(n);n.index<n.max&&!n.err.length;)Nv(n);return n.err?n.err:n.segments}function bv(e){if(cc(e))return Vi(e);var n=Dv(e),i=0,t=0,r=0,a=0;return n.map(function(o){var s=o.slice(1).map(Number),u=o[0],l=u.toUpperCase();if(u==="M")return i=s[0],t=s[1],r=i,a=t,["M",i,t];var f;if(u!==l)switch(l){case"A":f=[l,s[0],s[1],s[2],s[3],s[4],s[5]+i,s[6]+t];break;case"V":f=[l,s[0]+t];break;case"H":f=[l,s[0]+i];break;default:{var c=s.map(function(p,g){return p+(g%2?t:i)});f=[l].concat(c)}}else f=[l].concat(s);var h=f.length;switch(l){case"Z":i=r,t=a;break;case"H":i=f[1];break;case"V":t=f[1];break;default:i=f[h-2],t=f[h-1],l==="M"&&(r=i,a=t)}return f})}function wv(e,n){var i=e[0],t=n.x1,r=n.y1,a=n.x2,o=n.y2,s=e.slice(1).map(Number),u=e;if("TQ".includes(i)||(n.qx=null,n.qy=null),i==="H")u=["L",e[1],r];else if(i==="V")u=["L",t,e[1]];else if(i==="S"){var l=t*2-a,f=r*2-o;n.x1=l,n.y1=f,u=["C",l,f].concat(s)}else if(i==="T"){var c=t*2-n.qx,h=r*2-n.qy;n.qx=c,n.qy=h,u=["Q",c,h].concat(s)}else if(i==="Q"){var p=s[0],g=s[1];n.qx=p,n.qy=g}return u}function Ua(e){if(hc(e))return Vi(e);for(var n=bv(e),i=zn({},lc),t=0;t<n.length;t+=1){n[t]=wv(n[t],i);var r=n[t],a=r.length;i.x1=+r[a-2],i.y1=+r[a-1],i.x2=+r[a-4]||i.x1,i.y2=+r[a-3]||i.y1}return n}function Bv(e){return hc(e)&&e.every(function(n){var i=n[0];return"MC".includes(i)})}function na(e,n,i){var t=e*Math.cos(i)-n*Math.sin(i),r=e*Math.sin(i)+n*Math.cos(i);return{x:t,y:r}}function ou(e,n,i,t,r,a,o,s,u,l){var f=e,c=n,h=i,p=t,g=s,_=u,E=Math.PI*120/180,y=Math.PI/180*(+r||0),R=[],A,M,x,P,C;if(l)M=l[0],x=l[1],P=l[2],C=l[3];else{A=na(f,c,-y),f=A.x,c=A.y,A=na(g,_,-y),g=A.x,_=A.y;var O=(f-g)/2,D=(c-_)/2,F=O*O/(h*h)+D*D/(p*p);F>1&&(F=Math.sqrt(F),h*=F,p*=F);var k=h*h,d=p*p,v=(a===o?-1:1)*Math.sqrt(Math.abs((k*d-k*D*D-d*O*O)/(k*D*D+d*O*O)));P=v*h*D/p+(f+g)/2,C=v*-p*O/h+(c+_)/2,M=Math.asin(((c-C)/p*Math.pow(10,9)>>0)/Math.pow(10,9)),x=Math.asin(((_-C)/p*Math.pow(10,9)>>0)/Math.pow(10,9)),M=f<P?Math.PI-M:M,x=g<P?Math.PI-x:x,M<0&&(M=Math.PI*2+M),x<0&&(x=Math.PI*2+x),o&&M>x&&(M-=Math.PI*2),!o&&x>M&&(x-=Math.PI*2)}var m=x-M;if(Math.abs(m)>E){var S=x,T=g,N=_;x=M+E*(o&&x>M?1:-1),g=P+h*Math.cos(x),_=C+p*Math.sin(x),R=ou(g,_,h,p,r,0,o,T,N,[x,S,P,C])}m=x-M;var B=Math.cos(M),w=Math.sin(M),U=Math.cos(x),V=Math.sin(x),K=Math.tan(m/4),z=4/3*h*K,le=4/3*p*K,Se=[f,c],Ae=[f+z*w,c-le*B],ge=[g+z*V,_-le*U],ye=[g,_];if(Ae[0]=2*Se[0]-Ae[0],Ae[1]=2*Se[1]-Ae[1],l)return Ae.concat(ge,ye,R);R=Ae.concat(ge,ye,R);for(var ve=[],ie=0,we=R.length;ie<we;ie+=1)ve[ie]=ie%2?na(R[ie-1],R[ie],y).y:na(R[ie],R[ie+1],y).x;return ve}function Fv(e,n,i,t,r,a){var o=.3333333333333333,s=2/3;return[o*e+s*i,o*n+s*t,o*r+s*i,o*a+s*t,r,a]}function rr(e,n,i){var t=e[0],r=e[1],a=n[0],o=n[1];return[t+(a-t)*i,r+(o-r)*i]}function Xt(e,n){return Math.sqrt((e[0]-n[0])*(e[0]-n[0])+(e[1]-n[1])*(e[1]-n[1]))}function Ci(e,n,i,t,r){var a=Xt([e,n],[i,t]),o={x:0,y:0};if(typeof r=="number")if(r<=0)o={x:e,y:n};else if(r>=a)o={x:i,y:t};else{var s=rr([e,n],[i,t],r/a),u=s[0],l=s[1];o={x:u,y:l}}return{length:a,point:o,min:{x:Math.min(e,i),y:Math.min(n,t)},max:{x:Math.max(e,i),y:Math.max(n,t)}}}function Gu(e,n,i,t){var r=.5,a=[e,n],o=[i,t],s=rr(a,o,r),u=rr(o,s,r),l=rr(s,u,r),f=rr(u,l,r),c=rr(l,f,r),h=Ci(a[0],a[1],s[0],s[1],l[0]).point,p=Ci(c[0],c[1],f[0],f[1],u[0]).point;return[h.x,h.y,p.x,p.y,i,t]}function Uv(e,n){var i=e[0],t=e.slice(1).map(Number),r=t[0],a=t[1],o,s=n.x1,u=n.y1,l=n.x,f=n.y;switch("TQ".includes(i)||(n.qx=null,n.qy=null),i){case"M":return n.x=r,n.y=a,e;case"A":return o=[s,u].concat(t),["C"].concat(ou(o[0],o[1],o[2],o[3],o[4],o[5],o[6],o[7],o[8],o[9]));case"Q":return n.qx=r,n.qy=a,o=[s,u].concat(t),["C"].concat(Fv(o[0],o[1],o[2],o[3],o[4],o[5]));case"L":return["C"].concat(Gu(s,u,r,a));case"Z":return s===l&&u===f?["C",s,u,l,f,l,f]:["C"].concat(Gu(s,u,l,f))}return e}function ts(e,n){if(n===void 0&&(n=!1),Bv(e)){var i=Vi(e);return n?[i,[]]:i}for(var t=Ua(e),r=zn({},lc),a=[],o="",s=t.length,u,l,f=[],c=0;c<s;c+=1){t[c]&&(o=t[c][0]),a[c]=o;var h=Uv(t[c],r);t[c]=h,Sv(t,a,c),s=t.length,o==="Z"&&f.push(c),u=t[c],l=u.length,r.x1=+u[l-2],r.y1=+u[l-1],r.x2=+u[l-4]||r.x1,r.y2=+u[l-3]||r.y1}return n?[t,f]:t}function kv(e){var n=e.slice(1).map(function(i,t,r){return t?r[t-1].slice(-2).concat(i.slice(1)):e[0].slice(1).concat(i.slice(1))}).map(function(i){return i.map(function(t,r){return i[i.length-r-2*(1-r%2)]})}).reverse();return[["M"].concat(n[0].slice(0,2))].concat(n.map(function(i){return["C"].concat(i.slice(2))}))}function Ku(e,n){var i=e.x,t=e.y,r=n.x,a=n.y,o=i*r+t*a,s=Math.sqrt((Math.pow(i,2)+Math.pow(t,2))*(Math.pow(r,2)+Math.pow(a,2))),u=i*a-t*r<0?-1:1,l=u*Math.acos(o/s);return l}function Lv(e,n,i,t,r,a,o,s,u,l){var f=Math.abs,c=Math.sin,h=Math.cos,p=Math.sqrt,g=Math.PI,_=f(i),E=f(t),y=(r%360+360)%360,R=y*(g/180);if(e===s&&n===u)return{x:e,y:n};if(_===0||E===0)return Ci(e,n,s,u,l).point;var A=(e-s)/2,M=(n-u)/2,x={x:h(R)*A+c(R)*M,y:-c(R)*A+h(R)*M},P=Math.pow(x.x,2)/Math.pow(_,2)+Math.pow(x.y,2)/Math.pow(E,2);P>1&&(_*=p(P),E*=p(P));var C=Math.pow(_,2)*Math.pow(E,2)-Math.pow(_,2)*Math.pow(x.y,2)-Math.pow(E,2)*Math.pow(x.x,2),O=Math.pow(_,2)*Math.pow(x.y,2)+Math.pow(E,2)*Math.pow(x.x,2),D=C/O;D=D<0?0:D;var F=(a!==o?1:-1)*p(D),k={x:F*(_*x.y/E),y:F*(-(E*x.x)/_)},d={x:h(R)*k.x-c(R)*k.y+(e+s)/2,y:c(R)*k.x+h(R)*k.y+(n+u)/2},v={x:(x.x-k.x)/_,y:(x.y-k.y)/E},m=Ku({x:1,y:0},v),S={x:(-x.x-k.x)/_,y:(-x.y-k.y)/E},T=Ku(v,S);!o&&T>0?T-=2*g:o&&T<0&&(T+=2*g),T%=2*g;var N=m+T*l,B=_*h(N),w=E*c(N),U={x:h(R)*B-c(R)*w+d.x,y:c(R)*B+h(R)*w+d.y};return U}function Wv(e,n,i,t,r,a,o,s,u,l,f){var c,h=f.bbox,p=h===void 0?!0:h,g=f.length,_=g===void 0?!0:g,E=f.sampleSize,y=E===void 0?30:E,R=typeof l=="number",A=e,M=n,x=0,P=[A,M,x],C=[A,M],O=0,D={x:0,y:0},F=[{x:A,y:M}];R&&l<=0&&(D={x:A,y:M});for(var k=0;k<=y;k+=1){if(O=k/y,c=Lv(e,n,i,t,r,a,o,s,u,O),A=c.x,M=c.y,p&&F.push({x:A,y:M}),_&&(x+=Xt(C,[A,M])),C=[A,M],R&&x>=l&&l>P[2]){var d=(x-l)/(x-P[2]);D={x:C[0]*(1-d)+P[0]*d,y:C[1]*(1-d)+P[1]*d}}P=[A,M,x]}return R&&l>=x&&(D={x:s,y:u}),{length:x,point:D,min:{x:Math.min.apply(null,F.map(function(v){return v.x})),y:Math.min.apply(null,F.map(function(v){return v.y}))},max:{x:Math.max.apply(null,F.map(function(v){return v.x})),y:Math.max.apply(null,F.map(function(v){return v.y}))}}}function Hv(e,n,i,t,r,a,o,s,u){var l=1-u;return{x:Math.pow(l,3)*e+3*Math.pow(l,2)*u*i+3*l*Math.pow(u,2)*r+Math.pow(u,3)*o,y:Math.pow(l,3)*n+3*Math.pow(l,2)*u*t+3*l*Math.pow(u,2)*a+Math.pow(u,3)*s}}function dc(e,n,i,t,r,a,o,s,u,l){var f,c=l.bbox,h=c===void 0?!0:c,p=l.length,g=p===void 0?!0:p,_=l.sampleSize,E=_===void 0?10:_,y=typeof u=="number",R=e,A=n,M=0,x=[R,A,M],P=[R,A],C=0,O={x:0,y:0},D=[{x:R,y:A}];y&&u<=0&&(O={x:R,y:A});for(var F=0;F<=E;F+=1){if(C=F/E,f=Hv(e,n,i,t,r,a,o,s,C),R=f.x,A=f.y,h&&D.push({x:R,y:A}),g&&(M+=Xt(P,[R,A])),P=[R,A],y&&M>=u&&u>x[2]){var k=(M-u)/(M-x[2]);O={x:P[0]*(1-k)+x[0]*k,y:P[1]*(1-k)+x[1]*k}}x=[R,A,M]}return y&&u>=M&&(O={x:o,y:s}),{length:M,point:O,min:{x:Math.min.apply(null,D.map(function(d){return d.x})),y:Math.min.apply(null,D.map(function(d){return d.y}))},max:{x:Math.max.apply(null,D.map(function(d){return d.x})),y:Math.max.apply(null,D.map(function(d){return d.y}))}}}function Xv(e,n,i,t,r,a,o){var s=1-o;return{x:Math.pow(s,2)*e+2*s*o*i+Math.pow(o,2)*r,y:Math.pow(s,2)*n+2*s*o*t+Math.pow(o,2)*a}}function Vv(e,n,i,t,r,a,o,s){var u,l=s.bbox,f=l===void 0?!0:l,c=s.length,h=c===void 0?!0:c,p=s.sampleSize,g=p===void 0?10:p,_=typeof o=="number",E=e,y=n,R=0,A=[E,y,R],M=[E,y],x=0,P={x:0,y:0},C=[{x:E,y}];_&&o<=0&&(P={x:E,y});for(var O=0;O<=g;O+=1){if(x=O/g,u=Xv(e,n,i,t,r,a,x),E=u.x,y=u.y,f&&C.push({x:E,y}),h&&(R+=Xt(M,[E,y])),M=[E,y],_&&R>=o&&o>A[2]){var D=(R-o)/(R-A[2]);P={x:M[0]*(1-D)+A[0]*D,y:M[1]*(1-D)+A[1]*D}}A=[E,y,R]}return _&&o>=R&&(P={x:r,y:a}),{length:R,point:P,min:{x:Math.min.apply(null,C.map(function(F){return F.x})),y:Math.min.apply(null,C.map(function(F){return F.y}))},max:{x:Math.max.apply(null,C.map(function(F){return F.x})),y:Math.max.apply(null,C.map(function(F){return F.y}))}}}function vc(e,n,i){for(var t,r,a,o,s,u,l=Ua(e),f=typeof n=="number",c,h=[],p,g=0,_=0,E=0,y=0,R,A=[],M=[],x=0,P={x:0,y:0},C=P,O=P,D=P,F=0,k=0,d=l.length;k<d;k+=1)R=l[k],p=R[0],c=p==="M",h=c?h:[g,_].concat(R.slice(1)),c?(E=R[1],y=R[2],P={x:E,y},C=P,x=0,f&&n<.001&&(D=P)):p==="L"?(t=Ci(h[0],h[1],h[2],h[3],(n||0)-F),x=t.length,P=t.min,C=t.max,O=t.point):p==="A"?(r=Wv(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],h[8],(n||0)-F,i||{}),x=r.length,P=r.min,C=r.max,O=r.point):p==="C"?(a=dc(h[0],h[1],h[2],h[3],h[4],h[5],h[6],h[7],(n||0)-F,i||{}),x=a.length,P=a.min,C=a.max,O=a.point):p==="Q"?(o=Vv(h[0],h[1],h[2],h[3],h[4],h[5],(n||0)-F,i||{}),x=o.length,P=o.min,C=o.max,O=o.point):p==="Z"&&(h=[g,_,E,y],s=Ci(h[0],h[1],h[2],h[3],(n||0)-F),x=s.length,P=s.min,C=s.max,O=s.point),f&&F<n&&F+x>=n&&(D=O),M.push(C),A.push(P),F+=x,u=p!=="Z"?R.slice(-2):[E,y],g=u[0],_=u[1];return f&&n>=F&&(D={x:g,y:_}),{length:F,point:D,min:{x:Math.min.apply(null,A.map(function(v){return v.x})),y:Math.min.apply(null,A.map(function(v){return v.y}))},max:{x:Math.max.apply(null,M.map(function(v){return v.x})),y:Math.max.apply(null,M.map(function(v){return v.y}))}}}function Yv(e,n){return vc(e,void 0,zn(zn({},n),{bbox:!1,length:!0})).length}function zv(e){var n=e.length,i=n-1;return e.map(function(t,r){return e.map(function(a,o){var s=r+o,u;return o===0||e[s]&&e[s][0]==="M"?(u=e[s],["M"].concat(u.slice(-2))):(s>=n&&(s-=i),e[s])})})}function Gv(e,n){var i=e.length-1,t=[],r=0,a=0,o=zv(e);return o.forEach(function(s,u){e.slice(1).forEach(function(l,f){a+=Xt(e[(u+f)%i].slice(-2),n[f%i].slice(-2))}),t[u]=a,a=0}),r=t.indexOf(Math.min.apply(null,t)),o[r]}function Kv(e,n,i,t,r,a,o,s){return 3*((s-n)*(i+r)-(o-e)*(t+a)+t*(e-r)-i*(n-a)+s*(r+e/3)-o*(a+n/3))/20}function $v(e){var n=0,i=0,t=0;return ts(e).map(function(r){var a;switch(r[0]){case"M":return n=r[1],i=r[2],0;default:var o=r.slice(1),s=o[0],u=o[1],l=o[2],f=o[3],c=o[4],h=o[5];return t=Kv(n,i,s,u,l,f,c,h),a=r.slice(-2),n=a[0],i=a[1],t}}).reduce(function(r,a){return r+a},0)}function $u(e){return $v(e)>=0}function qv(e,n,i){return vc(e,n,zn(zn({},i),{bbox:!1,length:!0})).point}function Zv(e,n){n===void 0&&(n=.5);var i=e.slice(0,2),t=e.slice(2,4),r=e.slice(4,6),a=e.slice(6,8),o=rr(i,t,n),s=rr(t,r,n),u=rr(r,a,n),l=rr(o,s,n),f=rr(s,u,n),c=rr(l,f,n);return[["C"].concat(o,l,c),["C"].concat(f,u,a)]}function qu(e){return e.map(function(n,i,t){var r=i&&t[i-1].slice(-2).concat(n.slice(1)),a=i?dc(r[0],r[1],r[2],r[3],r[4],r[5],r[6],r[7],r[8],{bbox:!1}).length:0,o;return i?o=a?Zv(r):[n,n]:o=[n],{s:n,ss:o,l:a}})}function pc(e,n,i){var t=qu(e),r=qu(n),a=t.length,o=r.length,s=t.filter(function(E){return E.l}).length,u=r.filter(function(E){return E.l}).length,l=t.filter(function(E){return E.l}).reduce(function(E,y){var R=y.l;return E+R},0)/s||0,f=r.filter(function(E){return E.l}).reduce(function(E,y){var R=y.l;return E+R},0)/u||0,c=i||Math.max(a,o),h=[l,f],p=[c-a,c-o],g=0,_=[t,r].map(function(E,y){return E.l===c?E.map(function(R){return R.s}):E.map(function(R,A){return g=A&&p[y]&&R.l>=h[y],p[y]-=g?1:0,g?R.ss:[R.s]}).flat()});return _[0].length===_[1].length?_:pc(_[0],_[1],c)}var Qv=function(e){return e==null};const ae=Qv,gc=function(e){return Array.isArray?Array.isArray(e):ru(e,"Array")},Na=function(e){var n=typeof e;return e!==null&&n==="object"||n==="function"},Zu=function(e){if(gc(e))return e.reduce(function(n,i){return Math.max(n,i)},e[0])},Qu=function(e){if(gc(e))return e.reduce(function(n,i){return Math.min(n,i)},e[0])},vt=function(e){return ru(e,"String")};var Jv=function(e,n,i){return e<n?n:e>i?i:e};const dt=Jv;var jv=1e-5;function ep(e,n,i){return i===void 0&&(i=jv),Math.abs(e-n)<i}var tp=function(e,n){return(e%n+n)%n};const mc=tp;var rp=function(e){return ru(e,"Boolean")};const Ju=rp;var np=function(e){return e===void 0};const Xe=np;var rs={},ip={get exports(){return rs},set exports(e){rs=e}};(function(e,n){(function(i,t){e.exports=t()})(Ld,function(){function i(x,P,C,O,D){t(x,P,C||0,O||x.length-1,D||a)}function t(x,P,C,O,D){for(;O>C;){if(O-C>600){var F=O-C+1,k=P-C+1,d=Math.log(F),v=.5*Math.exp(2*d/3),m=.5*Math.sqrt(d*v*(F-v)/F)*(k-F/2<0?-1:1),S=Math.max(C,Math.floor(P-k*v/F+m)),T=Math.min(O,Math.floor(P+(F-k)*v/F+m));t(x,P,S,T,D)}var N=x[P],B=C,w=O;for(r(x,C,P),D(x[O],N)>0&&r(x,C,O);B<w;){for(r(x,B,w),B++,w--;D(x[B],N)<0;)B++;for(;D(x[w],N)>0;)w--}D(x[C],N)===0?r(x,C,w):(w++,r(x,w,O)),w<=P&&(C=w+1),P<=w&&(O=w-1)}}function r(x,P,C){var O=x[P];x[P]=x[C],x[C]=O}function a(x,P){return x<P?-1:x>P?1:0}var o=function(P){P===void 0&&(P=9),this._maxEntries=Math.max(4,P),this._minEntries=Math.max(2,Math.ceil(this._maxEntries*.4)),this.clear()};o.prototype.all=function(){return this._all(this.data,[])},o.prototype.search=function(P){var C=this.data,O=[];if(!R(P,C))return O;for(var D=this.toBBox,F=[];C;){for(var k=0;k<C.children.length;k++){var d=C.children[k],v=C.leaf?D(d):d;R(P,v)&&(C.leaf?O.push(d):y(P,v)?this._all(d,O):F.push(d))}C=F.pop()}return O},o.prototype.collides=function(P){var C=this.data;if(!R(P,C))return!1;for(var O=[];C;){for(var D=0;D<C.children.length;D++){var F=C.children[D],k=C.leaf?this.toBBox(F):F;if(R(P,k)){if(C.leaf||y(P,k))return!0;O.push(F)}}C=O.pop()}return!1},o.prototype.load=function(P){if(!(P&&P.length))return this;if(P.length<this._minEntries){for(var C=0;C<P.length;C++)this.insert(P[C]);return this}var O=this._build(P.slice(),0,P.length-1,0);if(!this.data.children.length)this.data=O;else if(this.data.height===O.height)this._splitRoot(this.data,O);else{if(this.data.height<O.height){var D=this.data;this.data=O,O=D}this._insert(O,this.data.height-O.height-1,!0)}return this},o.prototype.insert=function(P){return P&&this._insert(P,this.data.height-1),this},o.prototype.clear=function(){return this.data=A([]),this},o.prototype.remove=function(P,C){if(!P)return this;for(var O=this.data,D=this.toBBox(P),F=[],k=[],d,v,m;O||F.length;){if(O||(O=F.pop(),v=F[F.length-1],d=k.pop(),m=!0),O.leaf){var S=s(P,O.children,C);if(S!==-1)return O.children.splice(S,1),F.push(O),this._condense(F),this}!m&&!O.leaf&&y(O,D)?(F.push(O),k.push(d),d=0,v=O,O=O.children[0]):v?(d++,O=v.children[d],m=!1):O=null}return this},o.prototype.toBBox=function(P){return P},o.prototype.compareMinX=function(P,C){return P.minX-C.minX},o.prototype.compareMinY=function(P,C){return P.minY-C.minY},o.prototype.toJSON=function(){return this.data},o.prototype.fromJSON=function(P){return this.data=P,this},o.prototype._all=function(P,C){for(var O=[];P;)P.leaf?C.push.apply(C,P.children):O.push.apply(O,P.children),P=O.pop();return C},o.prototype._build=function(P,C,O,D){var F=O-C+1,k=this._maxEntries,d;if(F<=k)return d=A(P.slice(C,O+1)),u(d,this.toBBox),d;D||(D=Math.ceil(Math.log(F)/Math.log(k)),k=Math.ceil(F/Math.pow(k,D-1))),d=A([]),d.leaf=!1,d.height=D;var v=Math.ceil(F/k),m=v*Math.ceil(Math.sqrt(k));M(P,C,O,m,this.compareMinX);for(var S=C;S<=O;S+=m){var T=Math.min(S+m-1,O);M(P,S,T,v,this.compareMinY);for(var N=S;N<=T;N+=v){var B=Math.min(N+v-1,T);d.children.push(this._build(P,N,B,D-1))}}return u(d,this.toBBox),d},o.prototype._chooseSubtree=function(P,C,O,D){for(;D.push(C),!(C.leaf||D.length-1===O);){for(var F=1/0,k=1/0,d=void 0,v=0;v<C.children.length;v++){var m=C.children[v],S=p(m),T=_(P,m)-S;T<k?(k=T,F=S<F?S:F,d=m):T===k&&S<F&&(F=S,d=m)}C=d||C.children[0]}return C},o.prototype._insert=function(P,C,O){var D=O?P:this.toBBox(P),F=[],k=this._chooseSubtree(D,this.data,C,F);for(k.children.push(P),f(k,D);C>=0&&F[C].children.length>this._maxEntries;)this._split(F,C),C--;this._adjustParentBBoxes(D,F,C)},o.prototype._split=function(P,C){var O=P[C],D=O.children.length,F=this._minEntries;this._chooseSplitAxis(O,F,D);var k=this._chooseSplitIndex(O,F,D),d=A(O.children.splice(k,O.children.length-k));d.height=O.height,d.leaf=O.leaf,u(O,this.toBBox),u(d,this.toBBox),C?P[C-1].children.push(d):this._splitRoot(O,d)},o.prototype._splitRoot=function(P,C){this.data=A([P,C]),this.data.height=P.height+1,this.data.leaf=!1,u(this.data,this.toBBox)},o.prototype._chooseSplitIndex=function(P,C,O){for(var D,F=1/0,k=1/0,d=C;d<=O-C;d++){var v=l(P,0,d,this.toBBox),m=l(P,d,O,this.toBBox),S=E(v,m),T=p(v)+p(m);S<F?(F=S,D=d,k=T<k?T:k):S===F&&T<k&&(k=T,D=d)}return D||O-C},o.prototype._chooseSplitAxis=function(P,C,O){var D=P.leaf?this.compareMinX:c,F=P.leaf?this.compareMinY:h,k=this._allDistMargin(P,C,O,D),d=this._allDistMargin(P,C,O,F);k<d&&P.children.sort(D)},o.prototype._allDistMargin=function(P,C,O,D){P.children.sort(D);for(var F=this.toBBox,k=l(P,0,C,F),d=l(P,O-C,O,F),v=g(k)+g(d),m=C;m<O-C;m++){var S=P.children[m];f(k,P.leaf?F(S):S),v+=g(k)}for(var T=O-C-1;T>=C;T--){var N=P.children[T];f(d,P.leaf?F(N):N),v+=g(d)}return v},o.prototype._adjustParentBBoxes=function(P,C,O){for(var D=O;D>=0;D--)f(C[D],P)},o.prototype._condense=function(P){for(var C=P.length-1,O=void 0;C>=0;C--)P[C].children.length===0?C>0?(O=P[C-1].children,O.splice(O.indexOf(P[C]),1)):this.clear():u(P[C],this.toBBox)};function s(x,P,C){if(!C)return P.indexOf(x);for(var O=0;O<P.length;O++)if(C(x,P[O]))return O;return-1}function u(x,P){l(x,0,x.children.length,P,x)}function l(x,P,C,O,D){D||(D=A(null)),D.minX=1/0,D.minY=1/0,D.maxX=-1/0,D.maxY=-1/0;for(var F=P;F<C;F++){var k=x.children[F];f(D,x.leaf?O(k):k)}return D}function f(x,P){return x.minX=Math.min(x.minX,P.minX),x.minY=Math.min(x.minY,P.minY),x.maxX=Math.max(x.maxX,P.maxX),x.maxY=Math.max(x.maxY,P.maxY),x}function c(x,P){return x.minX-P.minX}function h(x,P){return x.minY-P.minY}function p(x){return(x.maxX-x.minX)*(x.maxY-x.minY)}function g(x){return x.maxX-x.minX+(x.maxY-x.minY)}function _(x,P){return(Math.max(P.maxX,x.maxX)-Math.min(P.minX,x.minX))*(Math.max(P.maxY,x.maxY)-Math.min(P.minY,x.minY))}function E(x,P){var C=Math.max(x.minX,P.minX),O=Math.max(x.minY,P.minY),D=Math.min(x.maxX,P.maxX),F=Math.min(x.maxY,P.maxY);return Math.max(0,D-C)*Math.max(0,F-O)}function y(x,P){return x.minX<=P.minX&&x.minY<=P.minY&&P.maxX<=x.maxX&&P.maxY<=x.maxY}function R(x,P){return P.minX<=x.maxX&&P.minY<=x.maxY&&P.maxX>=x.minX&&P.maxY>=x.minY}function A(x){return{children:x,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function M(x,P,C,O,D){for(var F=[P,C];F.length;)if(C=F.pop(),P=F.pop(),!(C-P<=O)){var k=P+Math.ceil((C-P)/O/2)*O;i(x,k,P,C,D),F.push(P,k,k,C)}}return o})})(ip);const ap=rs;function su(e,n,i){e.prototype=n.prototype=i,i.constructor=e}function _c(e,n){var i=Object.create(e.prototype);for(var t in n)i[t]=n[t];return i}function Yi(){}var Oi=.7,ka=1/Oi,Hn="\\s*([+-]?\\d+)\\s*",Ni="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Pr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",op=/^#([0-9a-f]{3,8})$/,sp=new RegExp("^rgb\\("+[Hn,Hn,Hn]+"\\)$"),up=new RegExp("^rgb\\("+[Pr,Pr,Pr]+"\\)$"),lp=new RegExp("^rgba\\("+[Hn,Hn,Hn,Ni]+"\\)$"),fp=new RegExp("^rgba\\("+[Pr,Pr,Pr,Ni]+"\\)$"),cp=new RegExp("^hsl\\("+[Ni,Pr,Pr]+"\\)$"),hp=new RegExp("^hsla\\("+[Ni,Pr,Pr,Ni]+"\\)$"),ju={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};su(Yi,no,{copy:function(e){return Object.assign(new this.constructor,this,e)},displayable:function(){return this.rgb().displayable()},hex:el,formatHex:el,formatHsl:dp,formatRgb:tl,toString:tl});function el(){return this.rgb().formatHex()}function dp(){return Ec(this).formatHsl()}function tl(){return this.rgb().formatRgb()}function no(e){var n,i;return e=(e+"").trim().toLowerCase(),(n=op.exec(e))?(i=n[1].length,n=parseInt(n[1],16),i===6?rl(n):i===3?new Gt(n>>8&15|n>>4&240,n>>4&15|n&240,(n&15)<<4|n&15,1):i===8?ia(n>>24&255,n>>16&255,n>>8&255,(n&255)/255):i===4?ia(n>>12&15|n>>8&240,n>>8&15|n>>4&240,n>>4&15|n&240,((n&15)<<4|n&15)/255):null):(n=sp.exec(e))?new Gt(n[1],n[2],n[3],1):(n=up.exec(e))?new Gt(n[1]*255/100,n[2]*255/100,n[3]*255/100,1):(n=lp.exec(e))?ia(n[1],n[2],n[3],n[4]):(n=fp.exec(e))?ia(n[1]*255/100,n[2]*255/100,n[3]*255/100,n[4]):(n=cp.exec(e))?al(n[1],n[2]/100,n[3]/100,1):(n=hp.exec(e))?al(n[1],n[2]/100,n[3]/100,n[4]):ju.hasOwnProperty(e)?rl(ju[e]):e==="transparent"?new Gt(NaN,NaN,NaN,0):null}function rl(e){return new Gt(e>>16&255,e>>8&255,e&255,1)}function ia(e,n,i,t){return t<=0&&(e=n=i=NaN),new Gt(e,n,i,t)}function vp(e){return e instanceof Yi||(e=no(e)),e?(e=e.rgb(),new Gt(e.r,e.g,e.b,e.opacity)):new Gt}function pp(e,n,i,t){return arguments.length===1?vp(e):new Gt(e,n,i,t??1)}function Gt(e,n,i,t){this.r=+e,this.g=+n,this.b=+i,this.opacity=+t}su(Gt,pp,_c(Yi,{brighter:function(e){return e=e==null?ka:Math.pow(ka,e),new Gt(this.r*e,this.g*e,this.b*e,this.opacity)},darker:function(e){return e=e==null?Oi:Math.pow(Oi,e),new Gt(this.r*e,this.g*e,this.b*e,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:nl,formatHex:nl,formatRgb:il,toString:il}));function nl(){return"#"+Co(this.r)+Co(this.g)+Co(this.b)}function il(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(e===1?")":", "+e+")")}function Co(e){return e=Math.max(0,Math.min(255,Math.round(e)||0)),(e<16?"0":"")+e.toString(16)}function al(e,n,i,t){return t<=0?e=n=i=NaN:i<=0||i>=1?e=n=NaN:n<=0&&(e=NaN),new Er(e,n,i,t)}function Ec(e){if(e instanceof Er)return new Er(e.h,e.s,e.l,e.opacity);if(e instanceof Yi||(e=no(e)),!e)return new Er;if(e instanceof Er)return e;e=e.rgb();var n=e.r/255,i=e.g/255,t=e.b/255,r=Math.min(n,i,t),a=Math.max(n,i,t),o=NaN,s=a-r,u=(a+r)/2;return s?(n===a?o=(i-t)/s+(i<t)*6:i===a?o=(t-n)/s+2:o=(n-i)/s+4,s/=u<.5?a+r:2-a-r,o*=60):s=u>0&&u<1?0:o,new Er(o,s,u,e.opacity)}function gp(e,n,i,t){return arguments.length===1?Ec(e):new Er(e,n,i,t??1)}function Er(e,n,i,t){this.h=+e,this.s=+n,this.l=+i,this.opacity=+t}su(Er,gp,_c(Yi,{brighter:function(e){return e=e==null?ka:Math.pow(ka,e),new Er(this.h,this.s,this.l*e,this.opacity)},darker:function(e){return e=e==null?Oi:Math.pow(Oi,e),new Er(this.h,this.s,this.l*e,this.opacity)},rgb:function(){var e=this.h%360+(this.h<0)*360,n=isNaN(e)||isNaN(this.s)?0:this.s,i=this.l,t=i+(i<.5?i:1-i)*n,r=2*i-t;return new Gt(Oo(e>=240?e-240:e+120,r,t),Oo(e,r,t),Oo(e<120?e+240:e-120,r,t),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var e=this.opacity;return e=isNaN(e)?1:Math.max(0,Math.min(1,e)),(e===1?"hsl(":"hsla(")+(this.h||0)+", "+(this.s||0)*100+"%, "+(this.l||0)*100+"%"+(e===1?")":", "+e+")")}}));function Oo(e,n,i){return(e<60?n+(i-n)*e/60:e<180?i:e<240?n+(i-n)*(240-e)/60:n)*255}function Et(e,n,i,t){var r=e-i,a=n-t;return Math.sqrt(r*r+a*a)}function Ia(e,n){return Math.abs(e-n)<.001}function io(e,n){var i=Math.min.apply(Math,e),t=Math.min.apply(Math,n),r=Math.max.apply(Math,e),a=Math.max.apply(Math,n);return{x:i,y:t,width:r-i,height:a-t}}function ao(e){return(e+Math.PI*2)%(Math.PI*2)}var zt={box:function(n,i,t,r){return io([n,t],[i,r])},length:function(n,i,t,r){return Et(n,i,t,r)},pointAt:function(n,i,t,r,a){return{x:(1-a)*n+a*t,y:(1-a)*i+a*r}},pointDistance:function(n,i,t,r,a,o){var s=(t-n)*(a-n)+(r-i)*(o-i);if(s<0)return Et(n,i,a,o);var u=(t-n)*(t-n)+(r-i)*(r-i);return s>u?Et(t,r,a,o):this.pointToLine(n,i,t,r,a,o)},pointToLine:function(n,i,t,r,a,o){var s=[t-n,r-i];if(uc(s,[0,0]))return Math.sqrt((a-n)*(a-n)+(o-i)*(o-i));var u=[-s[1],s[0]];oc(u,u);var l=[a-n,o-i];return Math.abs(sc(l,u))},tangentAngle:function(n,i,t,r){return Math.atan2(r-i,t-n)}},mp=1e-4;function yc(e,n,i,t,r,a){var o=-1,s=1/0,u=[i,t],l=20;a&&a>200&&(l=a/10);for(var f=1/l,c=f/10,h=0;h<=l;h++){var p=h*f,g=[r.apply(void 0,e.concat([p])),r.apply(void 0,n.concat([p]))],_=Et(u[0],u[1],g[0],g[1]);_<s&&(o=p,s=_)}if(o===0)return{x:e[0],y:n[0]};if(o===1){var E=e.length;return{x:e[E-1],y:n[E-1]}}s=1/0;for(var y=0;y<32&&!(c<mp);y++){var R=o-c,A=o+c,M=[r.apply(void 0,e.concat([R])),r.apply(void 0,n.concat([R]))],x=Et(u[0],u[1],M[0],M[1]);if(R>=0&&x<s)o=R,s=x;else{var P=[r.apply(void 0,e.concat([A])),r.apply(void 0,n.concat([A]))],C=Et(u[0],u[1],P[0],P[1]);A<=1&&C<s?(o=A,s=C):c*=.5}}return{x:r.apply(void 0,e.concat([o])),y:r.apply(void 0,n.concat([o]))}}function _p(e,n){for(var i=0,t=e.length,r=0;r<t;r++){var a=e[r],o=n[r],s=e[(r+1)%t],u=n[(r+1)%t];i+=Et(a,o,s,u)}return i/2}function Gr(e,n,i,t){var r=1-t;return r*r*e+2*t*r*n+t*t*i}function ol(e,n,i){var t=e+i-2*n;if(Ia(t,0))return[.5];var r=(e-n)/t;return r<=1&&r>=0?[r]:[]}function sl(e,n,i,t){return 2*(1-t)*(n-e)+2*t*(i-n)}function Tc(e,n,i,t,r,a,o){var s=Gr(e,i,r,o),u=Gr(n,t,a,o),l=zt.pointAt(e,n,i,t,o),f=zt.pointAt(i,t,r,a,o);return[[e,n,l.x,l.y,s,u],[s,u,f.x,f.y,r,a]]}function ns(e,n,i,t,r,a,o){if(o===0)return(Et(e,n,i,t)+Et(i,t,r,a)+Et(e,n,r,a))/2;var s=Tc(e,n,i,t,r,a,.5),u=s[0],l=s[1];return u.push(o-1),l.push(o-1),ns.apply(void 0,u)+ns.apply(void 0,l)}var Ep={box:function(n,i,t,r,a,o){var s=ol(n,t,a)[0],u=ol(i,r,o)[0],l=[n,a],f=[i,o];return s!==void 0&&l.push(Gr(n,t,a,s)),u!==void 0&&f.push(Gr(i,r,o,u)),io(l,f)},length:function(n,i,t,r,a,o){return ns(n,i,t,r,a,o,3)},nearestPoint:function(n,i,t,r,a,o,s,u){return yc([n,t,a],[i,r,o],s,u,Gr)},pointDistance:function(n,i,t,r,a,o,s,u){var l=this.nearestPoint(n,i,t,r,a,o,s,u);return Et(l.x,l.y,s,u)},interpolationAt:Gr,pointAt:function(n,i,t,r,a,o,s){return{x:Gr(n,t,a,s),y:Gr(i,r,o,s)}},divide:function(n,i,t,r,a,o,s){return Tc(n,i,t,r,a,o,s)},tangentAngle:function(n,i,t,r,a,o,s){var u=sl(n,t,a,s),l=sl(i,r,o,s),f=Math.atan2(l,u);return ao(f)}};function Kr(e,n,i,t,r){var a=1-r;return a*a*a*e+3*n*r*a*a+3*i*r*r*a+t*r*r*r}function ul(e,n,i,t,r){var a=1-r;return 3*(a*a*(n-e)+2*a*r*(i-n)+r*r*(t-i))}function No(e,n,i,t){var r=-3*e+9*n-9*i+3*t,a=6*e-12*n+6*i,o=3*n-3*e,s=[],u,l,f;if(Ia(r,0))Ia(a,0)||(u=-o/a,u>=0&&u<=1&&s.push(u));else{var c=a*a-4*r*o;Ia(c,0)?s.push(-a/(2*r)):c>0&&(f=Math.sqrt(c),u=(-a+f)/(2*r),l=(-a-f)/(2*r),u>=0&&u<=1&&s.push(u),l>=0&&l<=1&&s.push(l))}return s}function Rc(e,n,i,t,r,a,o,s,u){var l=Kr(e,i,r,o,u),f=Kr(n,t,a,s,u),c=zt.pointAt(e,n,i,t,u),h=zt.pointAt(i,t,r,a,u),p=zt.pointAt(r,a,o,s,u),g=zt.pointAt(c.x,c.y,h.x,h.y,u),_=zt.pointAt(h.x,h.y,p.x,p.y,u);return[[e,n,c.x,c.y,g.x,g.y,l,f],[l,f,_.x,_.y,p.x,p.y,o,s]]}function is(e,n,i,t,r,a,o,s,u){if(u===0)return _p([e,i,r,o],[n,t,a,s]);var l=Rc(e,n,i,t,r,a,o,s,.5),f=[].concat(l[0],[u-1]),c=[].concat(l[1],[u-1]);return is.apply(void 0,f)+is.apply(void 0,c)}var yp={extrema:No,box:function(n,i,t,r,a,o,s,u){for(var l=[n,s],f=[i,u],c=No(n,t,a,s),h=No(i,r,o,u),p=0;p<c.length;p++)l.push(Kr(n,t,a,s,c[p]));for(var g=0;g<h.length;g++)f.push(Kr(i,r,o,u,h[g]));return io(l,f)},length:function(n,i,t,r,a,o,s,u){return is(n,i,t,r,a,o,s,u,3)},nearestPoint:function(n,i,t,r,a,o,s,u,l,f,c){return yc([n,t,a,s],[i,r,o,u],l,f,Kr,c)},pointDistance:function(n,i,t,r,a,o,s,u,l,f,c){var h=this.nearestPoint(n,i,t,r,a,o,s,u,l,f,c);return Et(h.x,h.y,l,f)},interpolationAt:Kr,pointAt:function(n,i,t,r,a,o,s,u,l){return{x:Kr(n,t,a,s,l),y:Kr(i,r,o,u,l)}},divide:function(n,i,t,r,a,o,s,u,l){return Rc(n,i,t,r,a,o,s,u,l)},tangentAngle:function(n,i,t,r,a,o,s,u,l){var f=ul(n,t,a,s,l),c=ul(i,r,o,u,l);return ao(Math.atan2(c,f))}};function ll(e,n){var i=Math.abs(e);return n>0?i:i*-1}var Tp={box:function(n,i,t,r){return{x:n-t,y:i-r,width:t*2,height:r*2}},length:function(n,i,t,r){return Math.PI*(3*(t+r)-Math.sqrt((3*t+r)*(t+3*r)))},nearestPoint:function(n,i,t,r,a,o){var s=t,u=r;if(s===0||u===0)return{x:n,y:i};for(var l=a-n,f=o-i,c=Math.abs(l),h=Math.abs(f),p=s*s,g=u*u,_=Math.PI/4,E=0,y=0,R=0;R<4;R++){E=s*Math.cos(_),y=u*Math.sin(_);var A=(p-g)*Math.pow(Math.cos(_),3)/s,M=(g-p)*Math.pow(Math.sin(_),3)/u,x=E-A,P=y-M,C=c-A,O=h-M,D=Math.hypot(P,x),F=Math.hypot(O,C),k=D*Math.asin((x*O-P*C)/(D*F)),d=k/Math.sqrt(p+g-E*E-y*y);_+=d,_=Math.min(Math.PI/2,Math.max(0,_))}return{x:n+ll(E,l),y:i+ll(y,f)}},pointDistance:function(n,i,t,r,a,o){var s=this.nearestPoint(n,i,t,r,a,o);return Et(s.x,s.y,a,o)},pointAt:function(n,i,t,r,a){var o=2*Math.PI*a;return{x:n+t*Math.cos(o),y:i+r*Math.sin(o)}},tangentAngle:function(n,i,t,r,a){var o=2*Math.PI*a,s=Math.atan2(r*Math.cos(o),-t*Math.sin(o));return ao(s)}};function Rp(e,n,i,t,r,a,o,s){return-1*i*Math.cos(r)*Math.sin(s)-t*Math.sin(r)*Math.cos(s)}function Sp(e,n,i,t,r,a,o,s){return-1*i*Math.sin(r)*Math.sin(s)+t*Math.cos(r)*Math.cos(s)}function Ap(e,n,i){return Math.atan(-n/e*Math.tan(i))}function Pp(e,n,i){return Math.atan(n/(e*Math.tan(i)))}function fl(e,n,i,t,r,a){return i*Math.cos(r)*Math.cos(a)-t*Math.sin(r)*Math.sin(a)+e}function cl(e,n,i,t,r,a){return i*Math.sin(r)*Math.cos(a)+t*Math.cos(r)*Math.sin(a)+n}function xp(e,n,i,t){var r=Math.atan2(t*e,i*n);return(r+Math.PI*2)%(Math.PI*2)}function hl(e,n,i){return{x:e*Math.cos(i),y:n*Math.sin(i)}}function dl(e,n,i){var t=Math.cos(i),r=Math.sin(i);return[e*t-n*r,e*r+n*t]}var Mp={box:function(n,i,t,r,a,o,s){for(var u=Ap(t,r,a),l=1/0,f=-1/0,c=[o,s],h=-Math.PI*2;h<=Math.PI*2;h+=Math.PI){var p=u+h;o<s?o<p&&p<s&&c.push(p):s<p&&p<o&&c.push(p)}for(var g=0;g<c.length;g++){var _=fl(n,i,t,r,a,c[g]);_<l&&(l=_),_>f&&(f=_)}for(var E=Pp(t,r,a),y=1/0,R=-1/0,A=[o,s],M=-Math.PI*2;M<=Math.PI*2;M+=Math.PI){var x=E+M;o<s?o<x&&x<s&&A.push(x):s<x&&x<o&&A.push(x)}for(var P=0;P<A.length;P++){var C=cl(n,i,t,r,a,A[P]);C<y&&(y=C),C>R&&(R=C)}return{x:l,y,width:f-l,height:R-y}},length:function(n,i,t,r,a,o,s){},nearestPoint:function(n,i,t,r,a,o,s,u,l){var f=dl(u-n,l-i,-a),c=f[0],h=f[1],p=Tp.nearestPoint(0,0,t,r,c,h),g=xp(t,r,p.x,p.y);g<o?p=hl(t,r,o):g>s&&(p=hl(t,r,s));var _=dl(p.x,p.y,a);return{x:_[0]+n,y:_[1]+i}},pointDistance:function(n,i,t,r,a,o,s,u,l){var f=this.nearestPoint(n,i,t,r,a,o,s,u,l);return Et(f.x,f.y,u,l)},pointAt:function(n,i,t,r,a,o,s,u){var l=(s-o)*u+o;return{x:fl(n,i,t,r,a,l),y:cl(n,i,t,r,a,l)}},tangentAngle:function(n,i,t,r,a,o,s,u){var l=(s-o)*u+o,f=Rp(n,i,t,r,a,o,s,l),c=Sp(n,i,t,r,a,o,s,l);return ao(Math.atan2(c,f))}};function Sc(e){for(var n=0,i=[],t=0;t<e.length-1;t++){var r=e[t],a=e[t+1],o=Et(r[0],r[1],a[0],a[1]),s={from:r,to:a,length:o};i.push(s),n+=o}return{segments:i,totalLength:n}}function Cp(e){if(e.length<2)return 0;for(var n=0,i=0;i<e.length-1;i++){var t=e[i],r=e[i+1];n+=Et(t[0],t[1],r[0],r[1])}return n}function Op(e,n){if(n>1||n<0||e.length<2)return null;var i=Sc(e),t=i.segments,r=i.totalLength;if(r===0)return{x:e[0][0],y:e[0][1]};for(var a=0,o=null,s=0;s<t.length;s++){var u=t[s],l=u.from,f=u.to,c=u.length/r;if(n>=a&&n<=a+c){var h=(n-a)/c;o=zt.pointAt(l[0],l[1],f[0],f[1],h);break}a+=c}return o}function Np(e,n){if(n>1||n<0||e.length<2)return 0;for(var i=Sc(e),t=i.segments,r=i.totalLength,a=0,o=0,s=0;s<t.length;s++){var u=t[s],l=u.from,f=u.to,c=u.length/r;if(n>=a&&n<=a+c){o=Math.atan2(f[1]-l[1],f[0]-l[0]);break}a+=c}return o}function Ip(e,n,i){for(var t=1/0,r=0;r<e.length-1;r++){var a=e[r],o=e[r+1],s=zt.pointDistance(a[0],a[1],o[0],o[1],n,i);s<t&&(t=s)}return t}var Dp={box:function(n){for(var i=[],t=[],r=0;r<n.length;r++){var a=n[r];i.push(a[0]),t.push(a[1])}return io(i,t)},length:function(n){return Cp(n)},pointAt:function(n,i){return Op(n,i)},pointDistance:function(n,i,t){return Ip(n,i,t)},tangentAngle:function(n,i){return Np(n,i)}},as={},bp={get exports(){return as},set exports(e){as=e}};(function(e){var n=Object.prototype.hasOwnProperty,i="~";function t(){}Object.create&&(t.prototype=Object.create(null),new t().__proto__||(i=!1));function r(u,l,f){this.fn=u,this.context=l,this.once=f||!1}function a(u,l,f,c,h){if(typeof f!="function")throw new TypeError("The listener must be a function");var p=new r(f,c||u,h),g=i?i+l:l;return u._events[g]?u._events[g].fn?u._events[g]=[u._events[g],p]:u._events[g].push(p):(u._events[g]=p,u._eventsCount++),u}function o(u,l){--u._eventsCount===0?u._events=new t:delete u._events[l]}function s(){this._events=new t,this._eventsCount=0}s.prototype.eventNames=function(){var l=[],f,c;if(this._eventsCount===0)return l;for(c in f=this._events)n.call(f,c)&&l.push(i?c.slice(1):c);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(f)):l},s.prototype.listeners=function(l){var f=i?i+l:l,c=this._events[f];if(!c)return[];if(c.fn)return[c.fn];for(var h=0,p=c.length,g=new Array(p);h<p;h++)g[h]=c[h].fn;return g},s.prototype.listenerCount=function(l){var f=i?i+l:l,c=this._events[f];return c?c.fn?1:c.length:0},s.prototype.emit=function(l,f,c,h,p,g){var _=i?i+l:l;if(!this._events[_])return!1;var E=this._events[_],y=arguments.length,R,A;if(E.fn){switch(E.once&&this.removeListener(l,E.fn,void 0,!0),y){case 1:return E.fn.call(E.context),!0;case 2:return E.fn.call(E.context,f),!0;case 3:return E.fn.call(E.context,f,c),!0;case 4:return E.fn.call(E.context,f,c,h),!0;case 5:return E.fn.call(E.context,f,c,h,p),!0;case 6:return E.fn.call(E.context,f,c,h,p,g),!0}for(A=1,R=new Array(y-1);A<y;A++)R[A-1]=arguments[A];E.fn.apply(E.context,R)}else{var M=E.length,x;for(A=0;A<M;A++)switch(E[A].once&&this.removeListener(l,E[A].fn,void 0,!0),y){case 1:E[A].fn.call(E[A].context);break;case 2:E[A].fn.call(E[A].context,f);break;case 3:E[A].fn.call(E[A].context,f,c);break;case 4:E[A].fn.call(E[A].context,f,c,h);break;default:if(!R)for(x=1,R=new Array(y-1);x<y;x++)R[x-1]=arguments[x];E[A].fn.apply(E[A].context,R)}}return!0},s.prototype.on=function(l,f,c){return a(this,l,f,c,!1)},s.prototype.once=function(l,f,c){return a(this,l,f,c,!0)},s.prototype.removeListener=function(l,f,c,h){var p=i?i+l:l;if(!this._events[p])return this;if(!f)return o(this,p),this;var g=this._events[p];if(g.fn)g.fn===f&&(!h||g.once)&&(!c||g.context===c)&&o(this,p);else{for(var _=0,E=[],y=g.length;_<y;_++)(g[_].fn!==f||h&&!g[_].once||c&&g[_].context!==c)&&E.push(g[_]);E.length?this._events[p]=E.length===1?E[0]:E:o(this,p)}return this},s.prototype.removeAllListeners=function(l){var f;return l?(f=i?i+l:l,this._events[f]&&o(this,f)):(this._events=new t,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=i,s.EventEmitter=s,e.exports=s})(bp);const jn=as;var j;(function(e){e.COORDINATE="<coordinate>",e.COLOR="<color>",e.PAINT="<paint>",e.NUMBER="<number>",e.ANGLE="<angle>",e.OPACITY_VALUE="<opacity-value>",e.SHADOW_BLUR="<shadow-blur>",e.LENGTH="<length>",e.PERCENTAGE="<percentage>",e.LENGTH_PERCENTAGE="<length> | <percentage>",e.LENGTH_PERCENTAGE_12="[<length> | <percentage>]{1,2}",e.LENGTH_PERCENTAGE_14="[<length> | <percentage>]{1,4}",e.LIST_OF_POINTS="<list-of-points>",e.PATH="<path>",e.FILTER="<filter>",e.Z_INDEX="<z-index>",e.OFFSET_DISTANCE="<offset-distance>",e.DEFINED_PATH="<defined-path>",e.MARKER="<marker>",e.TRANSFORM="<transform>",e.TRANSFORM_ORIGIN="<transform-origin>",e.TEXT="<text>",e.TEXT_TRANSFORM="<text-transform>"})(j||(j={}));function tt(){tt=function(){return e};var e={},n=Object.prototype,i=n.hasOwnProperty,t=Object.defineProperty||function(d,v,m){d[v]=m.value},r=typeof Symbol=="function"?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(d,v,m){return Object.defineProperty(d,v,{value:m,enumerable:!0,configurable:!0,writable:!0}),d[v]}try{u({},"")}catch{u=function(v,m,S){return v[m]=S}}function l(d,v,m,S){var T=v&&v.prototype instanceof h?v:h,N=Object.create(T.prototype),B=new D(S||[]);return t(N,"_invoke",{value:x(d,m,B)}),N}function f(d,v,m){try{return{type:"normal",arg:d.call(v,m)}}catch(S){return{type:"throw",arg:S}}}e.wrap=l;var c={};function h(){}function p(){}function g(){}var _={};u(_,a,function(){return this});var E=Object.getPrototypeOf,y=E&&E(E(F([])));y&&y!==n&&i.call(y,a)&&(_=y);var R=g.prototype=h.prototype=Object.create(_);function A(d){["next","throw","return"].forEach(function(v){u(d,v,function(m){return this._invoke(v,m)})})}function M(d,v){function m(T,N,B,w){var U=f(d[T],d,N);if(U.type!=="throw"){var V=U.arg,K=V.value;return K&&typeof K=="object"&&i.call(K,"__await")?v.resolve(K.__await).then(function(z){m("next",z,B,w)},function(z){m("throw",z,B,w)}):v.resolve(K).then(function(z){V.value=z,B(V)},function(z){return m("throw",z,B,w)})}w(U.arg)}var S;t(this,"_invoke",{value:function(T,N){function B(){return new v(function(w,U){m(T,N,w,U)})}return S=S?S.then(B,B):B()}})}function x(d,v,m){var S="suspendedStart";return function(T,N){if(S==="executing")throw new Error("Generator is already running");if(S==="completed"){if(T==="throw")throw N;return k()}for(m.method=T,m.arg=N;;){var B=m.delegate;if(B){var w=P(B,m);if(w){if(w===c)continue;return w}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(S==="suspendedStart")throw S="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);S="executing";var U=f(d,v,m);if(U.type==="normal"){if(S=m.done?"completed":"suspendedYield",U.arg===c)continue;return{value:U.arg,done:m.done}}U.type==="throw"&&(S="completed",m.method="throw",m.arg=U.arg)}}}function P(d,v){var m=v.method,S=d.iterator[m];if(S===void 0)return v.delegate=null,m==="throw"&&d.iterator.return&&(v.method="return",v.arg=void 0,P(d,v),v.method==="throw")||m!=="return"&&(v.method="throw",v.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var T=f(S,d.iterator,v.arg);if(T.type==="throw")return v.method="throw",v.arg=T.arg,v.delegate=null,c;var N=T.arg;return N?N.done?(v[d.resultName]=N.value,v.next=d.nextLoc,v.method!=="return"&&(v.method="next",v.arg=void 0),v.delegate=null,c):N:(v.method="throw",v.arg=new TypeError("iterator result is not an object"),v.delegate=null,c)}function C(d){var v={tryLoc:d[0]};1 in d&&(v.catchLoc=d[1]),2 in d&&(v.finallyLoc=d[2],v.afterLoc=d[3]),this.tryEntries.push(v)}function O(d){var v=d.completion||{};v.type="normal",delete v.arg,d.completion=v}function D(d){this.tryEntries=[{tryLoc:"root"}],d.forEach(C,this),this.reset(!0)}function F(d){if(d){var v=d[a];if(v)return v.call(d);if(typeof d.next=="function")return d;if(!isNaN(d.length)){var m=-1,S=function T(){for(;++m<d.length;)if(i.call(d,m))return T.value=d[m],T.done=!1,T;return T.value=void 0,T.done=!0,T};return S.next=S}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=g,t(R,"constructor",{value:g,configurable:!0}),t(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(d){var v=typeof d=="function"&&d.constructor;return!!v&&(v===p||(v.displayName||v.name)==="GeneratorFunction")},e.mark=function(d){return Object.setPrototypeOf?Object.setPrototypeOf(d,g):(d.__proto__=g,u(d,s,"GeneratorFunction")),d.prototype=Object.create(R),d},e.awrap=function(d){return{__await:d}},A(M.prototype),u(M.prototype,o,function(){return this}),e.AsyncIterator=M,e.async=function(d,v,m,S,T){T===void 0&&(T=Promise);var N=new M(l(d,v,m,S),T);return e.isGeneratorFunction(v)?N:N.next().then(function(B){return B.done?B.value:N.next()})},A(R),u(R,s,"Generator"),u(R,a,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),e.keys=function(d){var v=Object(d),m=[];for(var S in v)m.push(S);return m.reverse(),function T(){for(;m.length;){var N=m.pop();if(N in v)return T.value=N,T.done=!1,T}return T.done=!0,T}},e.values=F,D.prototype={constructor:D,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!d)for(var v in this)v.charAt(0)==="t"&&i.call(this,v)&&!isNaN(+v.slice(1))&&(this[v]=void 0)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var v=this;function m(U,V){return N.type="throw",N.arg=d,v.next=U,V&&(v.method="next",v.arg=void 0),!!V}for(var S=this.tryEntries.length-1;S>=0;--S){var T=this.tryEntries[S],N=T.completion;if(T.tryLoc==="root")return m("end");if(T.tryLoc<=this.prev){var B=i.call(T,"catchLoc"),w=i.call(T,"finallyLoc");if(B&&w){if(this.prev<T.catchLoc)return m(T.catchLoc,!0);if(this.prev<T.finallyLoc)return m(T.finallyLoc)}else if(B){if(this.prev<T.catchLoc)return m(T.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return m(T.finallyLoc)}}}},abrupt:function(d,v){for(var m=this.tryEntries.length-1;m>=0;--m){var S=this.tryEntries[m];if(S.tryLoc<=this.prev&&i.call(S,"finallyLoc")&&this.prev<S.finallyLoc){var T=S;break}}T&&(d==="break"||d==="continue")&&T.tryLoc<=v&&v<=T.finallyLoc&&(T=null);var N=T?T.completion:{};return N.type=d,N.arg=v,T?(this.method="next",this.next=T.finallyLoc,c):this.complete(N)},complete:function(d,v){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&v&&(this.next=v),c},finish:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.finallyLoc===d)return this.complete(m.completion,m.afterLoc),O(m),c}},catch:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.tryLoc===d){var S=m.completion;if(S.type==="throw"){var T=S.arg;O(m)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(d,v,m){return this.delegate={iterator:F(d),resultName:v,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},e}function vl(e,n,i,t,r,a,o){try{var s=e[a](o),u=s.value}catch(l){i(l);return}s.done?n(u):Promise.resolve(u).then(t,r)}function Wr(e){return function(){var n=this,i=arguments;return new Promise(function(t,r){var a=e.apply(n,i);function o(u){vl(a,t,r,o,s,"next",u)}function s(u){vl(a,t,r,o,s,"throw",u)}o(void 0)})}}function pl(e,n){for(var i=0;i<n.length;i++){var t=n[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,Fp(t.key),t)}}function Pn(e,n,i){return n&&pl(e.prototype,n),i&&pl(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function pe(){return pe=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},pe.apply(this,arguments)}function Ie(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,os(e,n)}function os(e,n){return os=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},os(e,n)}function vr(e,n){if(e==null)return{};var i={},t=Object.keys(e),r,a;for(a=0;a<t.length;a++)r=t[a],!(n.indexOf(r)>=0)&&(i[r]=e[r]);return i}function Xn(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function wp(e,n){if(e){if(typeof e=="string")return gl(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return gl(e,n)}}function gl(e,n){(n==null||n>e.length)&&(n=e.length);for(var i=0,t=new Array(n);i<n;i++)t[i]=e[i];return t}function Bn(e,n){var i=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=wp(e))||n&&e&&typeof e.length=="number"){i&&(e=i);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Bp(e,n){if(typeof e!="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var t=i.call(e,n||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function Fp(e){var n=Bp(e,"string");return typeof n=="symbol"?n:String(n)}var Q;(function(e){e[e.kUnknown=0]="kUnknown",e[e.kNumber=1]="kNumber",e[e.kPercentage=2]="kPercentage",e[e.kEms=3]="kEms",e[e.kPixels=4]="kPixels",e[e.kRems=5]="kRems",e[e.kDegrees=6]="kDegrees",e[e.kRadians=7]="kRadians",e[e.kGradians=8]="kGradians",e[e.kTurns=9]="kTurns",e[e.kMilliseconds=10]="kMilliseconds",e[e.kSeconds=11]="kSeconds",e[e.kInteger=12]="kInteger"})(Q||(Q={}));var Yt;(function(e){e[e.kUNumber=0]="kUNumber",e[e.kUPercent=1]="kUPercent",e[e.kULength=2]="kULength",e[e.kUAngle=3]="kUAngle",e[e.kUTime=4]="kUTime",e[e.kUOther=5]="kUOther"})(Yt||(Yt={}));var ml;(function(e){e[e.kAll=0]="kAll",e[e.kNonNegative=1]="kNonNegative",e[e.kInteger=2]="kInteger",e[e.kNonNegativeInteger=3]="kNonNegativeInteger",e[e.kPositiveInteger=4]="kPositiveInteger"})(ml||(ml={}));var ss;(function(e){e[e.kYes=0]="kYes",e[e.kNo=1]="kNo"})(ss||(ss={}));var us;(function(e){e[e.kYes=0]="kYes",e[e.kNo=1]="kNo"})(us||(us={}));var Up=[{name:"em",unit_type:Q.kEms},{name:"px",unit_type:Q.kPixels},{name:"deg",unit_type:Q.kDegrees},{name:"rad",unit_type:Q.kRadians},{name:"grad",unit_type:Q.kGradians},{name:"ms",unit_type:Q.kMilliseconds},{name:"s",unit_type:Q.kSeconds},{name:"rem",unit_type:Q.kRems},{name:"turn",unit_type:Q.kTurns}],nn;(function(e){e[e.kUnknownType=0]="kUnknownType",e[e.kUnparsedType=1]="kUnparsedType",e[e.kKeywordType=2]="kKeywordType",e[e.kUnitType=3]="kUnitType",e[e.kSumType=4]="kSumType",e[e.kProductType=5]="kProductType",e[e.kNegateType=6]="kNegateType",e[e.kInvertType=7]="kInvertType",e[e.kMinType=8]="kMinType",e[e.kMaxType=9]="kMaxType",e[e.kClampType=10]="kClampType",e[e.kTransformType=11]="kTransformType",e[e.kPositionType=12]="kPositionType",e[e.kURLImageType=13]="kURLImageType",e[e.kColorType=14]="kColorType",e[e.kUnsupportedColorType=15]="kUnsupportedColorType"})(nn||(nn={}));var kp=function(n){return Up.find(function(i){return i.name===n}).unit_type},Lp=function(n){return n?n==="number"?Q.kNumber:n==="percent"||n==="%"?Q.kPercentage:kp(n):Q.kUnknown},Wp=function(n){switch(n){case Q.kNumber:case Q.kInteger:return Yt.kUNumber;case Q.kPercentage:return Yt.kUPercent;case Q.kPixels:return Yt.kULength;case Q.kMilliseconds:case Q.kSeconds:return Yt.kUTime;case Q.kDegrees:case Q.kRadians:case Q.kGradians:case Q.kTurns:return Yt.kUAngle;default:return Yt.kUOther}},Hp=function(n){switch(n){case Yt.kUNumber:return Q.kNumber;case Yt.kULength:return Q.kPixels;case Yt.kUPercent:return Q.kPercentage;case Yt.kUTime:return Q.kSeconds;case Yt.kUAngle:return Q.kDegrees;default:return Q.kUnknown}},_l=function(n){var i=1;switch(n){case Q.kPixels:case Q.kDegrees:case Q.kSeconds:break;case Q.kMilliseconds:i=.001;break;case Q.kRadians:i=180/Math.PI;break;case Q.kGradians:i=.9;break;case Q.kTurns:i=360;break}return i},ls=function(n){switch(n){case Q.kNumber:case Q.kInteger:return"";case Q.kPercentage:return"%";case Q.kEms:return"em";case Q.kRems:return"rem";case Q.kPixels:return"px";case Q.kDegrees:return"deg";case Q.kRadians:return"rad";case Q.kGradians:return"grad";case Q.kMilliseconds:return"ms";case Q.kSeconds:return"s";case Q.kTurns:return"turn"}return""},oo=function(){function e(){}e.isAngle=function(t){return t===Q.kDegrees||t===Q.kRadians||t===Q.kGradians||t===Q.kTurns},e.isLength=function(t){return t>=Q.kEms&&t<Q.kDegrees},e.isRelativeUnit=function(t){return t===Q.kPercentage||t===Q.kEms||t===Q.kRems},e.isTime=function(t){return t===Q.kSeconds||t===Q.kMilliseconds};var n=e.prototype;return n.toString=function(){return this.buildCSSText(ss.kNo,us.kNo,"")},n.isNumericValue=function(){return this.getType()>=nn.kUnitType&&this.getType()<=nn.kClampType},e}(),Xp=function(e){Ie(n,e);function n(t){var r;return r=e.call(this)||this,r.colorSpace=void 0,r.colorSpace=t,r}var i=n.prototype;return i.getType=function(){return nn.kColorType},i.to=function(r){return this},n}(oo),en;(function(e){e[e.Constant=0]="Constant",e[e.LinearGradient=1]="LinearGradient",e[e.RadialGradient=2]="RadialGradient"})(en||(en={}));var aa=function(e){Ie(n,e);function n(t,r){var a;return a=e.call(this)||this,a.type=void 0,a.value=void 0,a.type=t,a.value=r,a}var i=n.prototype;return i.clone=function(){return new n(this.type,this.value)},i.buildCSSText=function(r,a,o){return o},i.getType=function(){return nn.kColorType},n}(oo),kt=function(e){Ie(n,e);function n(t){var r;return r=e.call(this)||this,r.value=void 0,r.value=t,r}var i=n.prototype;return i.clone=function(){return new n(this.value)},i.getType=function(){return nn.kKeywordType},i.buildCSSText=function(r,a,o){return o+this.value},n}(oo);function yt(e,n){if(typeof e!="function"||n!=null&&typeof n!="function")throw new TypeError("Expected a function");var i=function t(){for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];var s=n?n.apply(this,a):a[0],u=t.cache;if(u.has(s))return u.get(s);var l=e.apply(this,a);return t.cache=u.set(s,l)||u,l};return i.cache=new(yt.Cache||Map),i}yt.Cache=Map;var Vp=yt(function(e){return e===void 0&&(e=""),e.replace(/-([a-z])/g,function(n){return n[1].toUpperCase()})}),El=function(n){return n.split("").map(function(i,t){return i.toUpperCase()===i?(t!==0?"-":"")+i.toLowerCase():i}).join("")};function Yp(e){if(!e)throw new Error}function Fn(e){return typeof e=="function"}function zp(e){return typeof e=="symbol"}var Gp={d:{alias:"path"},strokeDasharray:{alias:"lineDash"},strokeWidth:{alias:"lineWidth"},textAnchor:{alias:"textAlign"},src:{alias:"img"}},fs=yt(function(e){var n=Vp(e),i=Gp[n];return n=(i==null?void 0:i.alias)||n,n}),Kp=function(n,i){i===void 0&&(i="");var t="";return Number.isFinite(n)?(Yp(Number.isNaN(n)),t="NaN"):n>0?t="infinity":t="-infinity",t+=i},cs=function(n){return Hp(Wp(n))},at=function(e){Ie(n,e);function n(t,r){var a;r===void 0&&(r=Q.kNumber),a=e.call(this)||this,a.unit=void 0,a.value=void 0;var o;return typeof r=="string"?o=Lp(r):o=r,a.unit=o,a.value=t,a}var i=n.prototype;return i.clone=function(){return new n(this.value,this.unit)},i.equals=function(r){var a=r;return this.value===a.value&&this.unit===a.unit},i.getType=function(){return nn.kUnitType},i.convertTo=function(r){if(this.unit===r)return new n(this.value,this.unit);var a=cs(this.unit);if(a!==cs(r)||a===Q.kUnknown)return null;var o=_l(this.unit)/_l(r);return new n(this.value*o,r)},i.buildCSSText=function(r,a,o){var s;switch(this.unit){case Q.kUnknown:break;case Q.kInteger:s=Number(this.value).toFixed(0);break;case Q.kNumber:case Q.kPercentage:case Q.kEms:case Q.kRems:case Q.kPixels:case Q.kDegrees:case Q.kRadians:case Q.kGradians:case Q.kMilliseconds:case Q.kSeconds:case Q.kTurns:{var u=-999999,l=999999,f=this.value,c=ls(this.unit);if(f<u||f>l){var h=ls(this.unit);!Number.isFinite(f)||Number.isNaN(f)?s=Kp(f,h):s=f+(h||"")}else s=""+f+c}}return o+=s,o},n}(oo),ot=new at(0,"px");new at(1,"px");var kr=new at(0,"deg"),uu=function(e){Ie(n,e);function n(t,r,a,o,s){var u;return o===void 0&&(o=1),s===void 0&&(s=!1),u=e.call(this,"rgb")||this,u.r=void 0,u.g=void 0,u.b=void 0,u.alpha=void 0,u.isNone=void 0,u.r=t,u.g=r,u.b=a,u.alpha=o,u.isNone=s,u}var i=n.prototype;return i.clone=function(){return new n(this.r,this.g,this.b,this.alpha)},i.buildCSSText=function(r,a,o){return o+("rgba("+this.r+","+this.g+","+this.b+","+this.alpha+")")},n}(Xp),De=new kt("unset"),$p=new kt("initial"),qp=new kt("inherit"),Io={"":De,unset:De,initial:$p,inherit:qp},hs=function(n){return Io[n]||(Io[n]=new kt(n)),Io[n]},ds=new uu(0,0,0,0,!0),Ac=new uu(0,0,0,0),Zp=yt(function(e,n,i,t){return new uu(e,n,i,t)},function(e,n,i,t){return"rgba("+e+","+n+","+i+","+t+")"}),He=function(n,i){return i===void 0&&(i=Q.kNumber),new at(n,i)},La=new at(50,"%"),Do={},Qp=0;function Jp(e,n){if(e){var i=typeof e=="string"?e:e.id||Qp++;Do[i]&&Do[i].destroy(),Do[i]=n}}var ei=typeof window<"u"&&typeof window.document<"u";function jp(e,n){var i=Number(e.parsedStyle.zIndex),t=Number(n.parsedStyle.zIndex);if(i===t){var r=e.parentNode;if(r){var a=r.childNodes||[];return a.indexOf(e)-a.indexOf(n)}}return i-t}function e0(e){var n=e;do{var i,t=(i=n.parsedStyle)===null||i===void 0?void 0:i.clipPath;if(t)return n;n=n.parentElement}while(n!==null);return null}var yl="px";function t0(e,n,i){ei&&e.style&&(e.style.width=n+yl,e.style.height=i+yl)}function Pc(e,n){if(ei)return document.defaultView.getComputedStyle(e,null).getPropertyValue(n)}function r0(e){var n=Pc(e,"width");return n==="auto"?e.offsetWidth:parseFloat(n)}function n0(e){var n=Pc(e,"height");return n==="auto"?e.offsetHeight:parseFloat(n)}var Ce="Method not implemented.",In="Use document.documentElement instead.",i0="Cannot append a destroyed element.",a0=1,o0={touchstart:"pointerdown",touchend:"pointerup",touchendoutside:"pointerupoutside",touchmove:"pointermove",touchcancel:"pointercancel"};function Dn(e,n){return e[0]=n[0],e[1]=n[1],e[2]=n[2],e}function bo(e,n,i){return e[0]=n[0]-i[0],e[1]=n[1]-i[1],e[2]=n[2]-i[2],e}function Da(e,n,i){return e[0]=n[0]+i[0],e[1]=n[1]+i[1],e[2]=n[2]+i[2],e}function Tl(e,n,i){return e[0]=n[0]*i,e[1]=n[1]*i,e[2]=n[2]*i,e}function s0(e,n,i){return e[0]=Math.max(n[0],i[0]),e[1]=Math.max(n[1],i[1]),e[2]=Math.max(n[2],i[2]),e}function u0(e,n,i){return e[0]=Math.min(n[0],i[0]),e[1]=Math.min(n[1],i[1]),e[2]=Math.min(n[2],i[2]),e}function Vn(e){return e===void 0?0:e>360||e<-360?e%360:e}function St(e,n,i){return n===void 0&&(n=0),i===void 0&&(i=0),Array.isArray(e)&&e.length===3?wr(e):Ut(e)?me(e,n,i):me(e[0],e[1]||n,e[2]||i)}function Le(e){return e*(Math.PI/180)}function tr(e){return e*(180/Math.PI)}function l0(e){return 360*e}function f0(e,n){var i=n[0],t=n[1],r=n[2],a=n[3],o=i*i,s=t*t,u=r*r,l=a*a,f=o+s+u+l,c=i*a-t*r;return c>.499995*f?(e[0]=Math.PI/2,e[1]=2*Math.atan2(t,i),e[2]=0):c<-.499995*f?(e[0]=-Math.PI/2,e[1]=2*Math.atan2(t,i),e[2]=0):(e[0]=Math.asin(2*(i*r-a*t)),e[1]=Math.atan2(2*(i*a+t*r),1-2*(u+l)),e[2]=Math.atan2(2*(i*t+r*a),1-2*(s+u))),e}function c0(e,n){var i,t,r=Math.PI*.5,a=Kn(Re(),n),o=a[0],s=a[1],u=a[2],l=Math.asin(-n[2]/o);return l<r?l>-r?(i=Math.atan2(n[6]/s,n[10]/u),t=Math.atan2(n[1]/o,n[0]/o)):(t=0,i=-Math.atan2(n[4]/s,n[5]/s)):(t=0,i=Math.atan2(n[4]/s,n[5]/s)),e[0]=i,e[1]=l,e[2]=t,e}function wo(e,n){return n.length===16?c0(e,n):f0(e,n)}function h0(e,n,i,t,r){var a=Math.cos(e),o=Math.sin(e);return Hd(t*a,r*o,0,-t*o,r*a,0,n,i,1)}function d0(e,n,i,t,r,a,o){var s=2*a/(i-n),u=2*a/(t-r),l=(i+n)/(i-n),f=(t+r)/(t-r),c=-(o+a)/(o-a),h=-2*o*a/(o-a);return e[0]=s,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=u,e[6]=0,e[7]=0,e[8]=l,e[9]=f,e[10]=c,e[11]=-1,e[12]=0,e[13]=0,e[14]=h,e[15]=0,e}function Rl(e){var n=e[0],i=e[1],t=e[3],r=e[4],a=Math.sqrt(n*n+i*i),o=Math.sqrt(t*t+r*r),s=n*r-i*t;s<0&&(n<r?a=-a:o=-o),a&&(n*=1/a,i*=1/a),o&&(t*=1/o,r*=1/o);var u=Math.atan2(i,n),l=tr(u);return[e[6],e[7],a,o,l]}var mr=Te(),cr=Te(),ci=Jr(),se=[Re(),Re(),Re()],Sl=Re();function v0(e,n,i,t,r,a){if(!p0(mr,e)||(Ar(cr,mr),cr[3]=0,cr[7]=0,cr[11]=0,cr[15]=1,Math.abs(qf(cr))<1e-8))return!1;var o=mr[3],s=mr[7],u=mr[11],l=mr[12],f=mr[13],c=mr[14],h=mr[15];if(o!==0||s!==0||u!==0){ci[0]=o,ci[1]=s,ci[2]=u,ci[3]=h;var p=Rr(cr,cr);if(!p)return!1;iu(cr,cr),gn(r,ci,cr)}else r[0]=r[1]=r[2]=0,r[3]=1;if(n[0]=l,n[1]=f,n[2]=c,g0(se,mr),i[0]=Ur(se[0]),En(se[0],se[0]),t[0]=Sr(se[0],se[1]),Bo(se[1],se[1],se[0],1,-t[0]),i[1]=Ur(se[1]),En(se[1],se[1]),t[0]/=i[1],t[1]=Sr(se[0],se[2]),Bo(se[2],se[2],se[0],1,-t[1]),t[2]=Sr(se[1],se[2]),Bo(se[2],se[2],se[1],1,-t[2]),i[2]=Ur(se[2]),En(se[2],se[2]),t[1]/=i[2],t[2]/=i[2],Ca(Sl,se[1],se[2]),Sr(se[0],Sl)<0)for(var g=0;g<3;g++)i[g]*=-1,se[g][0]*=-1,se[g][1]*=-1,se[g][2]*=-1;return a[0]=.5*Math.sqrt(Math.max(1+se[0][0]-se[1][1]-se[2][2],0)),a[1]=.5*Math.sqrt(Math.max(1-se[0][0]+se[1][1]-se[2][2],0)),a[2]=.5*Math.sqrt(Math.max(1-se[0][0]-se[1][1]+se[2][2],0)),a[3]=.5*Math.sqrt(Math.max(1+se[0][0]+se[1][1]+se[2][2],0)),se[2][1]>se[1][2]&&(a[0]=-a[0]),se[0][2]>se[2][0]&&(a[1]=-a[1]),se[1][0]>se[0][1]&&(a[2]=-a[2]),!0}function p0(e,n){var i=n[15];if(i===0)return!1;for(var t=1/i,r=0;r<16;r++)e[r]=n[r]*t;return!0}function g0(e,n){e[0][0]=n[0],e[0][1]=n[1],e[0][2]=n[2],e[1][0]=n[4],e[1][1]=n[5],e[1][2]=n[6],e[2][0]=n[8],e[2][1]=n[9],e[2][2]=n[10]}function Bo(e,n,i,t,r){e[0]=n[0]*t+i[0]*r,e[1]=n[1]*t+i[1]*r,e[2]=n[2]*t+i[2]*r}var hi=Te();function so(e,n){if(e&&e.length){var i=0,t=0;n?(i=n.parsedStyle.defX||0,t=n.parsedStyle.defY||0,n.resetLocalTransform(),n.setLocalPosition(i,t)):n=new At({}),e.forEach(function(r){var a=r.t,o=r.d;if(a==="scale"){var s=(o==null?void 0:o.map(function(S){return S.value}))||[1,1];n.scaleLocal(s[0],s[1],1)}else if(a==="scalex"){var u=(o==null?void 0:o.map(function(S){return S.value}))||[1];n.scaleLocal(u[0],1,1)}else if(a==="scaley"){var l=(o==null?void 0:o.map(function(S){return S.value}))||[1];n.scaleLocal(1,l[0],1)}else if(a==="scalez"){var f=(o==null?void 0:o.map(function(S){return S.value}))||[1];n.scaleLocal(1,1,f[0])}else if(a==="scale3d"){var c=(o==null?void 0:o.map(function(S){return S.value}))||[1,1,1];n.scaleLocal(c[0],c[1],c[2])}else if(a==="translate"){var h=o||[ot,ot];n.translateLocal(h[0].value,h[1].value,0)}else if(a==="translatex"){var p=o||[ot];n.translateLocal(p[0].value,0,0)}else if(a==="translatey"){var g=o||[ot];n.translateLocal(0,g[0].value,0)}else if(a==="translatez"){var _=o||[ot];n.translateLocal(0,0,_[0].value)}else if(a==="translate3d"){var E=o||[ot,ot,ot];n.translateLocal(E[0].value,E[1].value,E[2].value)}else if(a==="rotate"){var y=o||[kr];n.rotateLocal(0,0,Vt(y[0]))}else if(a==="rotatex"){var R=o||[kr];n.rotateLocal(Vt(R[0]),0,0)}else if(a==="rotatey"){var A=o||[kr];n.rotateLocal(0,Vt(A[0]),0)}else if(a==="rotatez"){var M=o||[kr];n.rotateLocal(0,0,Vt(M[0]))}else if(a!=="rotate3d")if(a==="skew"){var x=(o==null?void 0:o.map(function(S){return S.value}))||[0,0];n.setLocalSkew(Le(x[0]),Le(x[1]))}else if(a==="skewx"){var P=(o==null?void 0:o.map(function(S){return S.value}))||[0];n.setLocalSkew(Le(P[0]),n.getLocalSkew()[1])}else if(a==="skewy"){var C=(o==null?void 0:o.map(function(S){return S.value}))||[0];n.setLocalSkew(n.getLocalSkew()[0],Le(C[0]))}else if(a==="matrix"){var O=o.map(function(S){return S.value}),D=O[0],F=O[1],k=O[2],d=O[3],v=O[4],m=O[5];n.setLocalTransform(Qo(hi,D,F,0,0,k,d,0,0,0,0,1,0,v+i,m+t,0,1))}else a==="matrix3d"&&(Qo.apply(cv,[hi].concat(o.map(function(S){return S.value}))),hi[12]+=i,hi[13]+=t,n.setLocalTransform(hi))})}return n.getLocalTransform()}function m0(e){var n=e.type,i=e.value;return n==="hex"?"#"+i:n==="literal"?i:n==="rgb"?"rgb("+i.join(",")+")":"rgba("+i.join(",")+")"}var _0=function(){var e={linearGradient:/^(linear\-gradient)/i,repeatingLinearGradient:/^(repeating\-linear\-gradient)/i,radialGradient:/^(radial\-gradient)/i,repeatingRadialGradient:/^(repeating\-radial\-gradient)/i,conicGradient:/^(conic\-gradient)/i,sideOrCorner:/^to (left (top|bottom)|right (top|bottom)|top (left|right)|bottom (left|right)|left|right|top|bottom)/i,extentKeywords:/^(closest\-side|closest\-corner|farthest\-side|farthest\-corner|contain|cover)/,positionKeywords:/^(left|center|right|top|bottom)/i,pixelValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))px/,percentageValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))\%/,emValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))em/,angleValue:/^(-?(([0-9]*\.[0-9]+)|([0-9]+\.?)))deg/,startCall:/^\(/,endCall:/^\)/,comma:/^,/,hexColor:/^\#([0-9a-fA-F]+)/,literalColor:/^([a-zA-Z]+)/,rgbColor:/^rgb/i,rgbaColor:/^rgba/i,number:/^(([0-9]*\.[0-9]+)|([0-9]+\.?))/},n="";function i(N){throw new Error(n+": "+N)}function t(){var N=r();return n.length>0&&i("Invalid input not EOF"),N}function r(){return A(a)}function a(){return o("linear-gradient",e.linearGradient,u)||o("repeating-linear-gradient",e.repeatingLinearGradient,u)||o("radial-gradient",e.radialGradient,c)||o("repeating-radial-gradient",e.repeatingRadialGradient,c)||o("conic-gradient",e.conicGradient,c)}function o(N,B,w){return s(B,function(U){var V=w();return V&&(S(e.comma)||i("Missing comma before color stops")),{type:N,orientation:V,colorStops:A(M)}})}function s(N,B){var w=S(N);if(w){S(e.startCall)||i("Missing (");var U=B(w);return S(e.endCall)||i("Missing )"),U}}function u(){return l()||f()}function l(){return m("directional",e.sideOrCorner,1)}function f(){return m("angular",e.angleValue,1)}function c(){var N,B=h(),w;return B&&(N=[],N.push(B),w=n,S(e.comma)&&(B=h(),B?N.push(B):n=w)),N}function h(){var N=p()||g();if(N)N.at=E();else{var B=_();if(B){N=B;var w=E();w&&(N.at=w)}else{var U=y();U&&(N={type:"default-radial",at:U})}}return N}function p(){var N=m("shape",/^(circle)/i,0);return N&&(N.style=v()||_()),N}function g(){var N=m("shape",/^(ellipse)/i,0);return N&&(N.style=k()||_()),N}function _(){return m("extent-keyword",e.extentKeywords,1)}function E(){if(m("position",/^at/,0)){var N=y();return N||i("Missing positioning value"),N}}function y(){var N=R();if(N.x||N.y)return{type:"position",value:N}}function R(){return{x:k(),y:k()}}function A(N){var B=N(),w=[];if(B)for(w.push(B);S(e.comma);)B=N(),B?w.push(B):i("One extra comma");return w}function M(){var N=x();return N||i("Expected color definition"),N.length=k(),N}function x(){return C()||D()||O()||P()}function P(){return m("literal",e.literalColor,0)}function C(){return m("hex",e.hexColor,1)}function O(){return s(e.rgbColor,function(){return{type:"rgb",value:A(F)}})}function D(){return s(e.rgbaColor,function(){return{type:"rgba",value:A(F)}})}function F(){return S(e.number)[1]}function k(){return m("%",e.percentageValue,1)||d()||v()}function d(){return m("position-keyword",e.positionKeywords,1)}function v(){return m("px",e.pixelValue,1)||m("em",e.emValue,1)}function m(N,B,w){var U=S(B);if(U)return{type:N,value:U[w]}}function S(N){var B=/^[\n\r\t\s]+/.exec(n);B&&T(B[0].length);var w=N.exec(n);return w&&T(w[0].length),w}function T(N){n=n.substring(N)}return function(N){return n=N,t()}}();function E0(e,n,i){var t=Le(i.value),r=0,a=0,o=r+e/2,s=a+n/2,u=Math.abs(e*Math.cos(t))+Math.abs(n*Math.sin(t)),l=o-Math.cos(t)*u/2,f=s-Math.sin(t)*u/2,c=o+Math.cos(t)*u/2,h=s+Math.sin(t)*u/2;return{x1:l,y1:f,x2:c,y2:h}}function y0(e,n,i,t,r){var a=i.value,o=t.value;i.unit===Q.kPercentage&&(a=i.value/100*e),t.unit===Q.kPercentage&&(o=t.value/100*n);var s=Math.max(Xt([0,0],[a,o]),Xt([0,n],[a,o]),Xt([e,n],[a,o]),Xt([e,0],[a,o]));return r&&(r instanceof at?s=r.value:r instanceof kt&&(r.value==="closest-side"?s=Math.min(a,e-a,o,n-o):r.value==="farthest-side"?s=Math.max(a,e-a,o,n-o):r.value==="closest-corner"&&(s=Math.min(Xt([0,0],[a,o]),Xt([0,n],[a,o]),Xt([e,n],[a,o]),Xt([e,0],[a,o]))))),{x:a,y:o,r:s}}var H;(function(e){e.GROUP="g",e.CIRCLE="circle",e.ELLIPSE="ellipse",e.IMAGE="image",e.RECT="rect",e.LINE="line",e.POLYLINE="polyline",e.POLYGON="polygon",e.TEXT="text",e.PATH="path",e.HTML="html",e.MESH="mesh"})(H||(H={}));function Al(e){return e.parsedStyle.path.totalLength===0&&(e.parsedStyle.path.totalLength=Yv(e.parsedStyle.path.absolutePath)),e.parsedStyle.path.totalLength}function T0(e){for(var n=!1,i=e.length,t=0;t<i;t++){var r=e[t],a=r[0];if(a==="C"||a==="A"||a==="Q"){n=!0;break}}return n}function R0(e){for(var n=[],i=[],t=[],r=0;r<e.length;r++){var a=e[r],o=a[0];o==="M"?(t.length&&(i.push(t),t=[]),t.push([a[1],a[2]])):o==="Z"?t.length&&(n.push(t),t=[]):t.push([a[1],a[2]])}return t.length>0&&i.push(t),{polygons:n,polylines:i}}function vs(e,n){return e[0]===n[0]&&e[1]===n[1]}function S0(e,n){for(var i=[],t=[],r=[],a=0;a<e.length;a++){var o=e[a],s=o.currentPoint,u=o.params,l=o.prePoint,f=void 0;switch(o.command){case"Q":f=Ep.box(l[0],l[1],u[1],u[2],u[3],u[4]);break;case"C":f=yp.box(l[0],l[1],u[1],u[2],u[3],u[4],u[5],u[6]);break;case"A":var c=o.arcParams;f=Mp.box(c.cx,c.cy,c.rx,c.ry,c.xRotation,c.startAngle,c.endAngle);break;default:i.push(s[0]),t.push(s[1]);break}f&&(o.box=f,i.push(f.x,f.x+f.width),t.push(f.y,f.y+f.height)),n&&(o.command==="L"||o.command==="M")&&o.prePoint&&o.nextPoint&&r.push(o)}i=i.filter(function(M){return!Number.isNaN(M)&&M!==1/0&&M!==-1/0}),t=t.filter(function(M){return!Number.isNaN(M)&&M!==1/0&&M!==-1/0});var h=Qu(i),p=Qu(t),g=Zu(i),_=Zu(t);if(r.length===0)return{x:h,y:p,width:g-h,height:_-p};for(var E=0;E<r.length;E++){var y=r[E],R=y.currentPoint,A=void 0;R[0]===h?(A=oa(y,n),h=h-A.xExtra):R[0]===g&&(A=oa(y,n),g=g+A.xExtra),R[1]===p?(A=oa(y,n),p=p-A.yExtra):R[1]===_&&(A=oa(y,n),_=_+A.yExtra)}return{x:h,y:p,width:g-h,height:_-p}}function oa(e,n){var i=e.prePoint,t=e.currentPoint,r=e.nextPoint,a=Math.pow(t[0]-i[0],2)+Math.pow(t[1]-i[1],2),o=Math.pow(t[0]-r[0],2)+Math.pow(t[1]-r[1],2),s=Math.pow(i[0]-r[0],2)+Math.pow(i[1]-r[1],2),u=Math.acos((a+o-s)/(2*Math.sqrt(a)*Math.sqrt(o)));if(!u||Math.sin(u)===0||ep(u,0))return{xExtra:0,yExtra:0};var l=Math.abs(Math.atan2(r[1]-t[1],r[0]-t[0])),f=Math.abs(Math.atan2(r[0]-t[0],r[1]-t[1]));l=l>Math.PI/2?Math.PI-l:l,f=f>Math.PI/2?Math.PI-f:f;var c={xExtra:Math.cos(u/2-l)*(n/2*(1/Math.sin(u/2)))-n/2||0,yExtra:Math.cos(f-u/2)*(n/2*(1/Math.sin(u/2)))-n/2||0};return c}function Pl(e,n){return[n[0]+(n[0]-e[0]),n[1]+(n[1]-e[1])]}var xl=function(n,i){var t=n.x*i.x+n.y*i.y,r=Math.sqrt((Math.pow(n.x,2)+Math.pow(n.y,2))*(Math.pow(i.x,2)+Math.pow(i.y,2))),a=n.x*i.y-n.y*i.x<0?-1:1,o=a*Math.acos(t/r);return o},Ml=function(n,i,t,r,a,o,s,u){i=Math.abs(i),t=Math.abs(t),r=mc(r,360);var l=Le(r);if(n.x===s.x&&n.y===s.y)return{x:n.x,y:n.y,ellipticalArcAngle:0};if(i===0||t===0)return{x:0,y:0,ellipticalArcAngle:0};var f=(n.x-s.x)/2,c=(n.y-s.y)/2,h={x:Math.cos(l)*f+Math.sin(l)*c,y:-Math.sin(l)*f+Math.cos(l)*c},p=Math.pow(h.x,2)/Math.pow(i,2)+Math.pow(h.y,2)/Math.pow(t,2);p>1&&(i=Math.sqrt(p)*i,t=Math.sqrt(p)*t);var g=Math.pow(i,2)*Math.pow(t,2)-Math.pow(i,2)*Math.pow(h.y,2)-Math.pow(t,2)*Math.pow(h.x,2),_=Math.pow(i,2)*Math.pow(h.y,2)+Math.pow(t,2)*Math.pow(h.x,2),E=g/_;E=E<0?0:E;var y=(a!==o?1:-1)*Math.sqrt(E),R={x:y*(i*h.y/t),y:y*(-(t*h.x)/i)},A={x:Math.cos(l)*R.x-Math.sin(l)*R.y+(n.x+s.x)/2,y:Math.sin(l)*R.x+Math.cos(l)*R.y+(n.y+s.y)/2},M={x:(h.x-R.x)/i,y:(h.y-R.y)/t},x=xl({x:1,y:0},M),P={x:(-h.x-R.x)/i,y:(-h.y-R.y)/t},C=xl(M,P);!o&&C>0?C-=2*Math.PI:o&&C<0&&(C+=2*Math.PI),C%=2*Math.PI;var O=x+C*u,D=i*Math.cos(O),F=t*Math.sin(O),k={x:Math.cos(l)*D-Math.sin(l)*F+A.x,y:Math.sin(l)*D+Math.cos(l)*F+A.y,ellipticalArcStartAngle:x,ellipticalArcEndAngle:x+C,ellipticalArcAngle:O,ellipticalArcCenter:A,resultantRx:i,resultantRy:t};return k};function A0(e){for(var n=[],i=null,t=null,r=null,a=0,o=e.length,s=0;s<o;s++){var u=e[s];t=e[s+1];var l=u[0],f={command:l,prePoint:i,params:u,startTangent:null,endTangent:null,currentPoint:null,nextPoint:null,arcParams:null,box:null,cubicParams:null};switch(l){case"M":r=[u[1],u[2]],a=s;break;case"A":var c=P0(i,u);f.arcParams=c;break}if(l==="Z")i=r,t=e[a+1];else{var h=u.length;i=[u[h-2],u[h-1]]}t&&t[0]==="Z"&&(t=e[a],n[a]&&(n[a].prePoint=i)),f.currentPoint=i,n[a]&&vs(i,n[a].currentPoint)&&(n[a].prePoint=f.prePoint);var p=t?[t[t.length-2],t[t.length-1]]:null;f.nextPoint=p;var g=f.prePoint;if(["L","H","V"].includes(l))f.startTangent=[g[0]-i[0],g[1]-i[1]],f.endTangent=[i[0]-g[0],i[1]-g[1]];else if(l==="Q"){var _=[u[1],u[2]];f.startTangent=[g[0]-_[0],g[1]-_[1]],f.endTangent=[i[0]-_[0],i[1]-_[1]]}else if(l==="T"){var E=n[s-1],y=Pl(E.currentPoint,g);E.command==="Q"?(f.command="Q",f.startTangent=[g[0]-y[0],g[1]-y[1]],f.endTangent=[i[0]-y[0],i[1]-y[1]]):(f.command="TL",f.startTangent=[g[0]-i[0],g[1]-i[1]],f.endTangent=[i[0]-g[0],i[1]-g[1]])}else if(l==="C"){var R=[u[1],u[2]],A=[u[3],u[4]];f.startTangent=[g[0]-R[0],g[1]-R[1]],f.endTangent=[i[0]-A[0],i[1]-A[1]],f.startTangent[0]===0&&f.startTangent[1]===0&&(f.startTangent=[R[0]-A[0],R[1]-A[1]]),f.endTangent[0]===0&&f.endTangent[1]===0&&(f.endTangent=[A[0]-R[0],A[1]-R[1]])}else if(l==="S"){var M=n[s-1],x=Pl(M.currentPoint,g),P=[u[1],u[2]];M.command==="C"?(f.command="C",f.startTangent=[g[0]-x[0],g[1]-x[1]],f.endTangent=[i[0]-P[0],i[1]-P[1]]):(f.command="SQ",f.startTangent=[g[0]-P[0],g[1]-P[1]],f.endTangent=[i[0]-P[0],i[1]-P[1]])}else if(l==="A"){var C=Cl(f,0),O=C.x,D=C.y,F=Cl(f,1,!1),k=F.x,d=F.y;f.startTangent=[O,D],f.endTangent=[k,d]}n.push(f)}return n}function Cl(e,n,i){i===void 0&&(i=!0);var t=e.arcParams,r=t.rx,a=r===void 0?0:r,o=t.ry,s=o===void 0?0:o,u=t.xRotation,l=t.arcFlag,f=t.sweepFlag,c=Ml({x:e.prePoint[0],y:e.prePoint[1]},a,s,u,!!l,!!f,{x:e.currentPoint[0],y:e.currentPoint[1]},n),h=Ml({x:e.prePoint[0],y:e.prePoint[1]},a,s,u,!!l,!!f,{x:e.currentPoint[0],y:e.currentPoint[1]},i?n+.005:n-.005),p=h.x-c.x,g=h.y-c.y,_=Math.sqrt(p*p+g*g);return{x:-p/_,y:-g/_}}function sa(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function ps(e,n){return sa(e)*sa(n)?(e[0]*n[0]+e[1]*n[1])/(sa(e)*sa(n)):1}function Ol(e,n){return(e[0]*n[1]<e[1]*n[0]?-1:1)*Math.acos(ps(e,n))}function P0(e,n){var i=n[1],t=n[2],r=mc(Le(n[3]),Math.PI*2),a=n[4],o=n[5],s=e[0],u=e[1],l=n[6],f=n[7],c=Math.cos(r)*(s-l)/2+Math.sin(r)*(u-f)/2,h=-1*Math.sin(r)*(s-l)/2+Math.cos(r)*(u-f)/2,p=c*c/(i*i)+h*h/(t*t);p>1&&(i*=Math.sqrt(p),t*=Math.sqrt(p));var g=i*i*(h*h)+t*t*(c*c),_=g?Math.sqrt((i*i*(t*t)-g)/g):1;a===o&&(_*=-1),isNaN(_)&&(_=0);var E=t?_*i*h/t:0,y=i?_*-t*c/i:0,R=(s+l)/2+Math.cos(r)*E-Math.sin(r)*y,A=(u+f)/2+Math.sin(r)*E+Math.cos(r)*y,M=[(c-E)/i,(h-y)/t],x=[(-1*c-E)/i,(-1*h-y)/t],P=Ol([1,0],M),C=Ol(M,x);return ps(M,x)<=-1&&(C=Math.PI),ps(M,x)>=1&&(C=0),o===0&&C>0&&(C=C-2*Math.PI),o===1&&C<0&&(C=C+2*Math.PI),{cx:R,cy:A,rx:vs(e,[l,f])?0:i,ry:vs(e,[l,f])?0:t,startAngle:P,endAngle:P+C,xRotation:r,arcFlag:a,sweepFlag:o}}function x0(e,n,i){var t=n.parsedStyle,r=t.defX,a=r===void 0?0:r,o=t.defY,s=o===void 0?0:o;return e.reduce(function(u,l){var f="";if(l[0]==="M"||l[0]==="L"){var c=me(l[1]-a,l[2]-s,0);i&&It(c,c,i),f=""+l[0]+c[0]+","+c[1]}else if(l[0]==="Z")f=l[0];else if(l[0]==="C"){var h=me(l[1]-a,l[2]-s,0),p=me(l[3]-a,l[4]-s,0),g=me(l[5]-a,l[6]-s,0);i&&(It(h,h,i),It(p,p,i),It(g,g,i)),f=""+l[0]+h[0]+","+h[1]+","+p[0]+","+p[1]+","+g[0]+","+g[1]}else if(l[0]==="A"){var _=me(l[6]-a,l[7]-s,0);i&&It(_,_,i),f=""+l[0]+l[1]+","+l[2]+","+l[3]+","+l[4]+","+l[5]+","+_[0]+","+_[1]}else if(l[0]==="Q"){var E=me(l[1]-a,l[2]-s,0),y=me(l[3]-a,l[4]-s,0);i&&(It(E,E,i),It(y,y,i)),f=""+l[0]+l[1]+","+l[2]+","+l[3]+","+l[4]+"}"}return u+=f},"")}function M0(e,n,i,t){return[["M",e,n],["L",i,t]]}function Nl(e,n,i,t){var r=(-1+Math.sqrt(2))/3*4,a=e*r,o=n*r,s=i-e,u=i+e,l=t-n,f=t+n;return[["M",s,t],["C",s,t-o,i-a,l,i,l],["C",i+a,l,u,t-o,u,t],["C",u,t+o,i+a,f,i,f],["C",i-a,f,s,t+o,s,t],["Z"]]}function C0(e,n){var i=e.map(function(t,r){return[r===0?"M":"L",t[0],t[1]]});return n&&i.push(["Z"]),i}function O0(e,n,i,t,r){if(r){var a=r[0],o=r[1],s=r[2],u=r[3],l=e>0?1:-1,f=n>0?1:-1,c=l+f!==0?1:0;return[["M",l*a+i,t],["L",e-l*o+i,t],o?["A",o,o,0,0,c,e+i,f*o+t]:null,["L",e+i,n-f*s+t],s?["A",s,s,0,0,c,e+i-l*s,n+t]:null,["L",i+l*u,n+t],u?["A",u,u,0,0,c,i,n+t-f*u]:null,["L",i,f*a+t],a?["A",a,a,0,0,c,l*a+i,t]:null,["Z"]].filter(function(h){return h})}return[["M",i,t],["L",i+e,t],["L",i+e,t+n],["L",i,t+n],["Z"]]}function N0(e,n){n===void 0&&(n=e.getLocalTransform());var i=[];switch(e.nodeName){case H.LINE:var t=e.parsedStyle,r=t.x1,a=t.y1,o=t.x2,s=t.y2;i=M0(r,a,o,s);break;case H.CIRCLE:{var u=e.parsedStyle,l=u.r,f=u.cx,c=u.cy;i=Nl(l,l,f,c);break}case H.ELLIPSE:{var h=e.parsedStyle,p=h.rx,g=h.ry,_=h.cx,E=h.cy;i=Nl(p,g,_,E);break}case H.POLYLINE:case H.POLYGON:var y=e.parsedStyle.points;i=C0(y.points,e.nodeName===H.POLYGON);break;case H.RECT:var R=e.parsedStyle,A=R.width,M=R.height,x=R.x,P=R.y,C=R.radius,O=C&&C.some(function(F){return F!==0});i=O0(A,M,x,P,O&&C.map(function(F){return dt(F,0,Math.min(Math.abs(A)/2,Math.abs(M)/2))}));break;case H.PATH:var D=e.parsedStyle.path.absolutePath;i=[].concat(D);break}if(i.length)return x0(i,e,n)}var I0=function(){function e(){this.callbacks=[]}var n=e.prototype;return n.tapPromise=function(t,r){this.callbacks.push(r)},n.promise=function(){var i=Wr(tt().mark(function r(){var a,o,s,u=arguments;return tt().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:for(a=u.length,o=new Array(a),s=0;s<a;s++)o[s]=u[s];return f.next=3,Promise.all(this.callbacks.map(function(c){return c.apply(void 0,o)}));case 3:case"end":return f.stop()}},r,this)}));function t(){return i.apply(this,arguments)}return t}(),e}(),D0=function(){function e(){this.callbacks=[]}var n=e.prototype;return n.tapPromise=function(t,r){this.callbacks.push(r)},n.promise=function(){var i=Wr(tt().mark(function r(){var a,o,s,u,l=arguments;return tt().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(!this.callbacks.length){c.next=14;break}return c.next=3,(a=this.callbacks)[0].apply(a,l);case 3:o=c.sent,s=0;case 5:if(!(s<this.callbacks.length-1)){c.next=13;break}return u=this.callbacks[s],c.next=9,u(o);case 9:o=c.sent;case 10:s++,c.next=5;break;case 13:return c.abrupt("return",o);case 14:return c.abrupt("return",null);case 15:case"end":return c.stop()}},r,this)}));function t(){return i.apply(this,arguments)}return t}(),e}(),xt=function(){function e(){this.callbacks=[]}var n=e.prototype;return n.tap=function(t,r){this.callbacks.push(r)},n.call=function(){for(var t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];this.callbacks.forEach(function(o){o.apply(void 0,r)})},e}(),Fo=function(){function e(){this.callbacks=[]}var n=e.prototype;return n.tap=function(t,r){this.callbacks.push(r)},n.call=function(){if(this.callbacks.length){for(var t,r=(t=this.callbacks)[0].apply(t,arguments),a=0;a<this.callbacks.length-1;a++){var o=this.callbacks[a];r=o(r)}return r}return null},e}(),b0=["serif","sans-serif","monospace","cursive","fantasy","system-ui"],w0=/([\"\'])[^\'\"]+\1/;function B0(e){for(var n=e.fontSize,i=e.fontFamily,t=e.fontStyle,r=e.fontVariant,a=e.fontWeight,o=Ut(n)&&n+"px"||"16px",s=i.split(","),u=s.length-1;u>=0;u--){var l=s[u].trim();!w0.test(l)&&b0.indexOf(l)<0&&(l='"'+l+'"'),s[u]=l}return t+" "+r+" "+a+" "+o+" "+s.join(",")}var F0=1,U0=function(){return F0++},xr=typeof self=="object"&&self.self==self?self:typeof global=="object"&&global.global==global?global:{},k0=Date.now(),L0=function(){return xr.performance&&typeof xr.performance.now=="function"?xr.performance.now():Date.now()-k0},yi={},Il=Date.now(),W0=function(n){if(typeof n!="function")throw new TypeError(n+" is not a function");var i=Date.now(),t=i-Il,r=t>16?0:16-t,a=U0();return yi[a]=n,Object.keys(yi).length>1||setTimeout(function(){Il=i;var o=yi;yi={},Object.keys(o).forEach(function(s){return o[s](L0())})},r),a},H0=function(n){delete yi[n]},X0=["","webkit","moz","ms","o"],xc=function(n){return typeof n!="string"?W0:n===""?xr.requestAnimationFrame:xr[n+"RequestAnimationFrame"]},V0=function(n){return typeof n!="string"?H0:n===""?xr.cancelAnimationFrame:xr[n+"CancelAnimationFrame"]||xr[n+"CancelRequestAnimationFrame"]},Y0=function(n,i){for(var t=0;n[t]!==void 0;){if(i(n[t]))return n[t];t=t+1}},Mc=Y0(X0,function(e){return!!xc(e)}),Cc=xc(Mc),Oc=V0(Mc);xr.requestAnimationFrame=Cc;xr.cancelAnimationFrame=Oc;var z0=/^l\s*\(\s*([\d.]+)\s*\)\s*(.*)/i,G0=/^r\s*\(\s*([\d.]+)\s*,\s*([\d.]+)\s*,\s*([\d.]+)\s*\)\s*(.*)/i,K0=/^p\s*\(\s*([axyn])\s*\)\s*(.*)/i,Nc=/[\d.]+:(#[^\s]+|[^\)]+\))/gi;function $0(e){var n,i=e.length;if(e[i-1].length=(n=e[i-1].length)!==null&&n!==void 0?n:{type:"%",value:"100"},i>1){var t;e[0].length=(t=e[0].length)!==null&&t!==void 0?t:{type:"%",value:"0"}}for(var r=0,a=Number(e[0].length.value),o=1;o<i;o++){var s,u=(s=e[o].length)===null||s===void 0?void 0:s.value;if(!ae(u)&&!ae(a)){for(var l=1;l<o-r;l++)e[r+l].length={type:"%",value:""+(a+(Number(u)-a)*l/(o-r))};r=o,a=Number(u)}}}var q0={left:270-90,top:0-90,bottom:180-90,right:90-90,"left top":315-90,"top left":315-90,"left bottom":225-90,"bottom left":225-90,"right top":45-90,"top right":45-90,"right bottom":135-90,"bottom right":135-90},Z0=yt(function(e){var n;return e.type==="angular"?n=Number(e.value):n=q0[e.value]||0,He(n,"deg")}),Q0=yt(function(e){var n=50,i=50,t="%",r="%";if((e==null?void 0:e.type)==="position"){var a=e.value,o=a.x,s=a.y;(o==null?void 0:o.type)==="position-keyword"&&(o.value==="left"?n=0:o.value==="center"?n=50:o.value==="right"?n=100:o.value==="top"?i=0:o.value==="bottom"&&(i=100)),(s==null?void 0:s.type)==="position-keyword"&&(s.value==="left"?n=0:s.value==="center"?i=50:s.value==="right"?n=100:s.value==="top"?i=0:s.value==="bottom"&&(i=100)),((o==null?void 0:o.type)==="px"||(o==null?void 0:o.type)==="%"||(o==null?void 0:o.type)==="em")&&(t=o==null?void 0:o.type,n=Number(o.value)),((s==null?void 0:s.type)==="px"||(s==null?void 0:s.type)==="%"||(s==null?void 0:s.type)==="em")&&(r=s==null?void 0:s.type,i=Number(s.value))}return{cx:He(n,t),cy:He(i,r)}}),J0=yt(function(e){if(e.indexOf("linear")>-1||e.indexOf("radial")>-1){var n=_0(e);return n.map(function(s){var u=s.type,l=s.orientation,f=s.colorStops;$0(f);var c=f.map(function(A){return{offset:He(Number(A.length.value),"%"),color:m0(A)}});if(u==="linear-gradient")return new aa(en.LinearGradient,{angle:l?Z0(l):kr,steps:c});if(u==="radial-gradient"&&(l||(l=[{type:"shape",value:"circle"}]),l[0].type==="shape"&&l[0].value==="circle")){var h=Q0(l[0].at),p=h.cx,g=h.cy,_;if(l[0].style){var E=l[0].style,y=E.type,R=E.value;y==="extent-keyword"?_=hs(R):_=He(R,y)}return new aa(en.RadialGradient,{cx:p,cy:g,size:_,steps:c})}})}var i=e[0];if(e[1]==="("||e[2]==="("){if(i==="l"){var t=z0.exec(e);if(t){var r,a=((r=t[2].match(Nc))===null||r===void 0?void 0:r.map(function(s){return s.split(":")}))||[];return[new aa(en.LinearGradient,{angle:He(parseFloat(t[1]),"deg"),steps:a.map(function(s){var u=s[0],l=s[1];return{offset:He(Number(u)*100,"%"),color:l}})})]}}else if(i==="r"){var o=j0(e);if(o)if(vt(o))e=o;else return[new aa(en.RadialGradient,o)]}else if(i==="p")return eg(e)}});function j0(e){var n=G0.exec(e);if(n){var i,t=((i=n[4].match(Nc))===null||i===void 0?void 0:i.map(function(r){return r.split(":")}))||[];return{cx:He(50,"%"),cy:He(50,"%"),steps:t.map(function(r){var a=r[0],o=r[1];return{offset:He(Number(a)*100,"%"),color:o}})}}return null}function eg(e){var n=K0.exec(e);if(n){var i=n[1],t=n[2];switch(i){case"a":i="repeat";break;case"x":i="repeat-x";break;case"y":i="repeat-y";break;case"n":i="no-repeat";break;default:i="no-repeat"}return{image:t,repetition:i}}return null}function mn(e){return e&&!!e.image}function je(e){return e&&!ae(e.r)&&!ae(e.g)&&!ae(e.b)}var ir=yt(function(e){if(mn(e))return pe({repetition:"repeat"},e);if(ae(e)&&(e=""),e==="transparent")return Ac;e==="currentColor"&&(e="black");var n=J0(e);if(n)return n;var i=no(e),t=[0,0,0,0];return i!==null&&(t[0]=i.r||0,t[1]=i.g||0,t[2]=i.b||0,t[3]=i.opacity),Zp.apply(void 0,t)});function tg(e,n){if(!(!je(e)||!je(n)))return[[Number(e.r),Number(e.g),Number(e.b),Number(e.alpha)],[Number(n.r),Number(n.g),Number(n.b),Number(n.alpha)],function(i){var t=i.slice();if(t[3])for(var r=0;r<3;r++)t[r]=Math.round(dt(t[r],0,255));return t[3]=dt(t[3],0,1),"rgba("+t.join(",")+")"}]}function zi(e,n){if(ae(n))return He(0,"px");if(n=(""+n).trim().toLowerCase(),isFinite(Number(n))){if("px".search(e)>=0)return He(Number(n),"px");if("deg".search(e)>=0)return He(Number(n),"deg")}var i=[];n=n.replace(e,function(r){return i.push(r),"U"+r});var t="U("+e.source+")";return i.map(function(r){return He(Number(n.replace(new RegExp("U"+r,"g"),"").replace(new RegExp(t,"g"),"*0")),r)})[0]}var rg=yt(function(e){return zi(new RegExp("px","g"),e)});yt(function(e){return zi(new RegExp("%","g"),e)});var $n=function(n){return Ut(n)||isFinite(Number(n))?He(Number(n)||0,"px"):zi(new RegExp("px|%|em|rem","g"),n)},Ic=yt(function(e){return zi(new RegExp("deg|rad|grad|turn","g"),e)});function ng(e,n,i,t,r){r===void 0&&(r=0);var a="",o=e.value||0,s=n.value||0,u=cs(e.unit),l=e.convertTo(u),f=n.convertTo(u);return l&&f?(o=l.value,s=f.value,a=ls(e.unit)):(at.isLength(e.unit)||at.isLength(n.unit))&&(o=Ht(e,r,i),s=Ht(n,r,i),a="px"),[o,s,function(c){return t&&(c=Math.max(c,0)),c+a}]}function Vt(e){var n=0;return e.unit===Q.kDegrees?n=e.value:e.unit===Q.kRadians?n=tr(Number(e.value)):e.unit===Q.kTurns&&(n=l0(Number(e.value))),n}function Uo(e,n){var i;return Array.isArray(e)?i=e.map(function(t){return Number(t)}):vt(e)?i=e.split(" ").map(function(t){return Number(t)}):Ut(e)&&(i=[e]),n===2?i.length===1?[i[0],i[0]]:[i[0],i[1]]:i.length===1?[i[0],i[0],i[0],i[0]]:i.length===2?[i[0],i[1],i[0],i[1]]:i.length===3?[i[0],i[1],i[2],i[1]]:[i[0],i[1],i[2],i[3]]}function Dc(e){return vt(e)?e.split(" ").map(function(n){return $n(n)}):e.map(function(n){return $n(n.toString())})}function Ht(e,n,i){if(e.value===0)return 0;if(e.unit===Q.kPixels)return Number(e.value);if(e.unit===Q.kPercentage&&i){var t=i.nodeName===H.GROUP?i.getLocalBounds():i.geometry.contentBounds;return e.value/100*t.halfExtents[n]*2}return 0}var ig=function(n){return zi(/deg|rad|grad|turn|px|%/g,n)},ag=["blur","brightness","drop-shadow","contrast","grayscale","sepia","saturate","hue-rotate","invert"];function bc(e){if(e===void 0&&(e=""),e=e.toLowerCase().trim(),e==="none")return[];for(var n=/\s*([\w-]+)\(([^)]*)\)/g,i=[],t,r=0;t=n.exec(e);){if(t.index!==r)return[];if(r=t.index+t[0].length,ag.indexOf(t[1])>-1&&i.push({name:t[1],params:t[2].split(" ").map(function(a){return ig(a)||ir(a)})}),n.lastIndex===e.length)return i}return[]}function wc(e){return e.toString()}var Tn=yt(function(e){return typeof e=="number"?He(e):/^\s*[-+]?(\d*\.)?\d+\s*$/.test(e)?He(Number(e)):He(0)});yt(function(e){return vt(e)?e.split(" ").map(Tn):e.map(Tn)});function lu(e,n){return[e,n,wc]}function fu(e,n){return function(i,t){return[i,t,function(r){return wc(dt(r,e,n))}]}}function Bc(e,n){if(e.length===n.length)return[e,n,function(i){return i}]}var Fc=function(n){if(n===""||Array.isArray(n)&&n.length===0)return{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:{x:0,y:0,width:0,height:0}};var i;try{i=Ua(n)}catch{i=Ua(""),console.error("[g]: Invalid SVG Path definition: "+n)}var t=T0(i),r=R0(i),a=r.polygons,o=r.polylines,s=A0(i),u=S0(s,0),l=u.x,f=u.y,c=u.width,h=u.height;return{absolutePath:i,hasArc:t,segments:s,polygons:a,polylines:o,totalLength:0,rect:{x:Number.isFinite(l)?l:0,y:Number.isFinite(f)?f:0,width:Number.isFinite(c)?c:0,height:Number.isFinite(h)?h:0}}},og=yt(Fc);function Wa(e,n){var i=vt(e)?og(e):Fc(e);return n&&(n.parsedStyle.defX=i.rect.x,n.parsedStyle.defY=i.rect.y),i}function sg(e,n,i){var t=e.curve,r=n.curve;(!t||t.length===0)&&(t=ts(e.absolutePath,!1),e.curve=t),(!r||r.length===0)&&(r=ts(n.absolutePath,!1),n.curve=r);var a=[t,r];t.length!==r.length&&(a=pc(t,r));var o=$u(a[0])!==$u(a[1])?kv(a[0]):Vi(a[0]);return[o,Gv(a[1],o),function(s){return s}]}function Uc(e,n){var i;vt(e)?i=e.split(" ").map(function(f){var c=f.split(","),h=c[0],p=c[1];return[Number(h),Number(p)]}):i=e;var t=[],r=0,a,o,s=Dp.length(i);i.forEach(function(f,c){i[c+1]&&(a=[0,0],a[0]=r/s,o=zt.length(f[0],f[1],i[c+1][0],i[c+1][1]),r+=o,a[1]=r/s,t.push(a))});var u=Math.min.apply(Math,i.map(function(f){return f[0]})),l=Math.min.apply(Math,i.map(function(f){return f[1]}));return n&&(n.parsedStyle.defX=u,n.parsedStyle.defY=l),{points:i,totalLength:s,segments:t}}function ug(e,n){return[e.points,n.points,function(i){return i}]}var Ve=null;function Mt(e){return function(n){var i=0;return e.map(function(t){return t===Ve?n[i++]:t})}}function cn(e){return e}var gs={matrix:["NNNNNN",[Ve,Ve,0,0,Ve,Ve,0,0,0,0,1,0,Ve,Ve,0,1],cn],matrix3d:["NNNNNNNNNNNNNNNN",cn],rotate:["A"],rotatex:["A"],rotatey:["A"],rotatez:["A"],rotate3d:["NNNA"],perspective:["L"],scale:["Nn",Mt([Ve,Ve,new at(1)]),cn],scalex:["N",Mt([Ve,new at(1),new at(1)]),Mt([Ve,new at(1)])],scaley:["N",Mt([new at(1),Ve,new at(1)]),Mt([new at(1),Ve])],scalez:["N",Mt([new at(1),new at(1),Ve])],scale3d:["NNN",cn],skew:["Aa",null,cn],skewx:["A",null,Mt([Ve,kr])],skewy:["A",null,Mt([kr,Ve])],translate:["Tt",Mt([Ve,Ve,ot]),cn],translatex:["T",Mt([Ve,ot,ot]),Mt([Ve,ot])],translatey:["T",Mt([ot,Ve,ot]),Mt([ot,Ve])],translatez:["L",Mt([ot,ot,Ve])],translate3d:["TTL",cn]};function Ii(e){if(e=(e||"none").toLowerCase().trim(),e==="none")return[];for(var n=/\s*(\w+)\(([^)]*)\)/g,i=[],t,r=0;t=n.exec(e);){if(t.index!==r)return[];r=t.index+t[0].length;var a=t[1],o=gs[a];if(!o)return[];var s=t[2].split(","),u=o[0];if(u.length<s.length)return[];for(var l=[],f=0;f<u.length;f++){var c=s[f],h=u[f],p=void 0;if(c?p={A:function(_){return _.trim()==="0"?kr:Ic(_)},N:Tn,T:$n,L:rg}[h.toUpperCase()](c):p={a:kr,n:l[0],t:ot}[h],p===void 0)return[];l.push(p)}if(i.push({t:a,d:l}),n.lastIndex===e.length)return i}return[]}function lg(e){var n,i,t,r;switch(e.t){case"rotatex":return r=Le(Vt(e.d[0])),[1,0,0,0,0,Math.cos(r),Math.sin(r),0,0,-Math.sin(r),Math.cos(r),0,0,0,0,1];case"rotatey":return r=Le(Vt(e.d[0])),[Math.cos(r),0,-Math.sin(r),0,0,1,0,0,Math.sin(r),0,Math.cos(r),0,0,0,0,1];case"rotate":case"rotatez":return r=Le(Vt(e.d[0])),[Math.cos(r),Math.sin(r),0,0,-Math.sin(r),Math.cos(r),0,0,0,0,1,0,0,0,0,1];case"rotate3d":n=e.d[0].value,i=e.d[1].value,t=e.d[2].value,r=Le(Vt(e.d[3]));var a=n*n+i*i+t*t;if(a===0)n=1,i=0,t=0;else if(a!==1){var o=Math.sqrt(a);n/=o,i/=o,t/=o}var s=Math.sin(r/2),u=s*Math.cos(r/2),l=s*s;return[1-2*(i*i+t*t)*l,2*(n*i*l+t*u),2*(n*t*l-i*u),0,2*(n*i*l-t*u),1-2*(n*n+t*t)*l,2*(i*t*l+n*u),0,2*(n*t*l+i*u),2*(i*t*l-n*u),1-2*(n*n+i*i)*l,0,0,0,0,1];case"scale":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,1,0,0,0,0,1];case"scalex":return[e.d[0].value,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"scaley":return[1,0,0,0,0,e.d[0].value,0,0,0,0,1,0,0,0,0,1];case"scalez":return[1,0,0,0,0,1,0,0,0,0,e.d[0].value,0,0,0,0,1];case"scale3d":return[e.d[0].value,0,0,0,0,e.d[1].value,0,0,0,0,e.d[2].value,0,0,0,0,1];case"skew":var f=Le(Vt(e.d[0])),c=Le(Vt(e.d[1]));return[1,Math.tan(c),0,0,Math.tan(f),1,0,0,0,0,1,0,0,0,0,1];case"skewx":return r=Le(Vt(e.d[0])),[1,0,0,0,Math.tan(r),1,0,0,0,0,1,0,0,0,0,1];case"skewy":return r=Le(Vt(e.d[0])),[1,Math.tan(r),0,0,0,1,0,0,0,0,1,0,0,0,0,1];case"translate":return n=Ht(e.d[0],0,null)||0,i=Ht(e.d[1],0,null)||0,[1,0,0,0,0,1,0,0,0,0,1,0,n,i,0,1];case"translatex":return n=Ht(e.d[0],0,null)||0,[1,0,0,0,0,1,0,0,0,0,1,0,n,0,0,1];case"translatey":return i=Ht(e.d[0],0,null)||0,[1,0,0,0,0,1,0,0,0,0,1,0,0,i,0,1];case"translatez":return t=Ht(e.d[0],0,null)||0,[1,0,0,0,0,1,0,0,0,0,1,0,0,0,t,1];case"translate3d":return n=Ht(e.d[0],0,null)||0,i=Ht(e.d[1],0,null)||0,t=Ht(e.d[2],0,null)||0,[1,0,0,0,0,1,0,0,0,0,1,0,n,i,t,1];case"perspective":var h=Ht(e.d[0],0,null)||0,p=h?-1/h:0;return[1,0,0,0,0,1,0,0,0,0,1,p,0,0,0,1];case"matrix":return[e.d[0].value,e.d[1].value,0,0,e.d[2].value,e.d[3].value,0,0,0,0,1,0,e.d[4].value,e.d[5].value,0,1];case"matrix3d":return e.d.map(function(g){return g.value})}}function fg(e,n){return[e[0]*n[0]+e[4]*n[1]+e[8]*n[2]+e[12]*n[3],e[1]*n[0]+e[5]*n[1]+e[9]*n[2]+e[13]*n[3],e[2]*n[0]+e[6]*n[1]+e[10]*n[2]+e[14]*n[3],e[3]*n[0]+e[7]*n[1]+e[11]*n[2]+e[15]*n[3],e[0]*n[4]+e[4]*n[5]+e[8]*n[6]+e[12]*n[7],e[1]*n[4]+e[5]*n[5]+e[9]*n[6]+e[13]*n[7],e[2]*n[4]+e[6]*n[5]+e[10]*n[6]+e[14]*n[7],e[3]*n[4]+e[7]*n[5]+e[11]*n[6]+e[15]*n[7],e[0]*n[8]+e[4]*n[9]+e[8]*n[10]+e[12]*n[11],e[1]*n[8]+e[5]*n[9]+e[9]*n[10]+e[13]*n[11],e[2]*n[8]+e[6]*n[9]+e[10]*n[10]+e[14]*n[11],e[3]*n[8]+e[7]*n[9]+e[11]*n[10]+e[15]*n[11],e[0]*n[12]+e[4]*n[13]+e[8]*n[14]+e[12]*n[15],e[1]*n[12]+e[5]*n[13]+e[9]*n[14]+e[13]*n[15],e[2]*n[12]+e[6]*n[13]+e[10]*n[14]+e[14]*n[15],e[3]*n[12]+e[7]*n[13]+e[11]*n[14]+e[15]*n[15]]}function cg(e){return e.length===0?[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]:e.map(lg).reduce(fg)}function Dl(e){var n=[0,0,0],i=[1,1,1],t=[0,0,0],r=[0,0,0,1],a=[0,0,0,1];return v0(cg(e),n,i,t,r,a),[[n,i,t,a,r]]}var hg=function(){function e(t,r){for(var a=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]],o=0;o<4;o++)for(var s=0;s<4;s++)for(var u=0;u<4;u++)a[o][s]+=r[o][u]*t[u][s];return a}function n(t){return t[0][2]==0&&t[0][3]==0&&t[1][2]==0&&t[1][3]==0&&t[2][0]==0&&t[2][1]==0&&t[2][2]==1&&t[2][3]==0&&t[3][2]==0&&t[3][3]==1}function i(t,r,a,o,s){for(var u=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],l=0;l<4;l++)u[l][3]=s[l];for(var f=0;f<3;f++)for(var c=0;c<3;c++)u[3][f]+=t[c]*u[c][f];var h=o[0],p=o[1],g=o[2],_=o[3],E=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];E[0][0]=1-2*(p*p+g*g),E[0][1]=2*(h*p-g*_),E[0][2]=2*(h*g+p*_),E[1][0]=2*(h*p+g*_),E[1][1]=1-2*(h*h+g*g),E[1][2]=2*(p*g-h*_),E[2][0]=2*(h*g-p*_),E[2][1]=2*(p*g+h*_),E[2][2]=1-2*(h*h+p*p),u=e(u,E);var y=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];a[2]&&(y[2][1]=a[2],u=e(u,y)),a[1]&&(y[2][1]=0,y[2][0]=a[0],u=e(u,y)),a[0]&&(y[2][0]=0,y[1][0]=a[0],u=e(u,y));for(var R=0;R<3;R++)for(var A=0;A<3;A++)u[R][A]*=r[R];return n(u)?[u[0][0],u[0][1],u[1][0],u[1][1],u[3][0],u[3][1]]:u[0].concat(u[1],u[2],u[3])}return i}();function dg(e){return e.toFixed(6).replace(".000000","")}function ko(e,n){var i,t;return e.decompositionPair!==n&&(e.decompositionPair=n,i=Dl(e)),n.decompositionPair!==e&&(n.decompositionPair=e,t=Dl(n)),i[0]===null||t[0]===null?[[!1],[!0],function(r){return r?n[0].d:e[0].d}]:(i[0].push(0),t[0].push(1),[i,t,function(r){var a=pg(i[0][3],t[0][3],r[5]),o=hg(r[0],r[1],r[2],a,r[4]),s=o.map(dg).join(",");return s}])}function vg(e,n){for(var i=0,t=0;t<e.length;t++)i+=e[t]*n[t];return i}function pg(e,n,i){var t=vg(e,n);t=dt(t,-1,1);var r=[];if(t===1)r=e;else for(var a=Math.acos(t),o=Math.sin(i*a)*1/Math.sqrt(1-t*t),s=0;s<4;s++)r.push(e[s]*(Math.cos(i*a)-t*o)+n[s]*o);return r}function Lo(e){return e.replace(/[xy]/,"")}function Wo(e){return e.replace(/(x|y|z|3d)?$/,"3d")}var gg=function(n,i){return n==="perspective"&&i==="perspective"||(n==="matrix"||n==="matrix3d")&&(i==="matrix"||i==="matrix3d")};function mg(e,n,i){var t=!1;if(!e.length||!n.length){e.length||(t=!0,e=n,n=[]);for(var r=function(){var k=e[a],d=k.t,v=k.d,m=d.substring(0,5)==="scale"?1:0;n.push({t:d,d:v.map(function(S){return typeof S=="number"?He(m):He(m,S.unit)})})},a=0;a<e.length;a++)r()}var o=[],s=[],u=[];if(e.length!==n.length){var l=ko(e,n);o=[l[0]],s=[l[1]],u=[["matrix",[l[2]]]]}else for(var f=0;f<e.length;f++){var c=e[f].t,h=n[f].t,p=e[f].d,g=n[f].d,_=gs[c],E=gs[h],y=void 0;if(gg(c,h)){var R=ko([e[f]],[n[f]]);o.push(R[0]),s.push(R[1]),u.push(["matrix",[R[2]]]);continue}else if(c===h)y=c;else if(_[2]&&E[2]&&Lo(c)===Lo(h))y=Lo(c),p=_[2](p),g=E[2](g);else if(_[1]&&E[1]&&Wo(c)===Wo(h))y=Wo(c),p=_[1](p),g=E[1](g);else{var A=ko(e,n);o=[A[0]],s=[A[1]],u=[["matrix",[A[2]]]];break}for(var M=[],x=[],P=[],C=0;C<p.length;C++){var O=ng(p[C],g[C],i,!1,C);M[C]=O[0],x[C]=O[1],P.push(O[2])}o.push(M),s.push(x),u.push([y,P])}if(t){var D=o;o=s,s=D}return[o,s,function(F){return F.map(function(k,d){var v=k.map(function(m,S){return u[d][1][S](m)}).join(",");return u[d][0]==="matrix"&&v.split(",").length===16&&(u[d][0]="matrix3d"),u[d][0]==="matrix3d"&&v.split(",").length===6&&(u[d][0]="matrix"),u[d][0]+"("+v+")"}).join(" ")}]}var kc=yt(function(e){if(vt(e)){if(e==="text-anchor")return[He(0,"px"),He(0,"px")];var n=e.split(" ");return n.length===1&&(n[0]==="top"||n[0]==="bottom"?(n[1]=n[0],n[0]="center"):n[1]="center"),n.length!==2?null:[$n(bl(n[0])),$n(bl(n[1]))]}else return[He(e[0]||0,"px"),He(e[1]||0,"px")]});function bl(e){return e==="center"?"50%":e==="left"||e==="top"?"0":e==="right"||e==="bottom"?"100%":e}var _g=function(){function e(){this.parser=Ic,this.parserWithCSSDisabled=null,this.mixer=lu}var n=e.prototype;return n.calculator=function(t,r,a,o){return Vt(a)},e}(),Eg=function(){function e(){}var n=e.prototype;return n.calculator=function(t,r,a,o){return a instanceof kt&&(a=null),X.sceneGraphService.updateDisplayObjectDependency(t,r,a,o),t==="clipPath"&&o.forEach(function(s){s.childNodes.length===0&&X.sceneGraphService.dirtifyToRoot(s)}),a},e}(),yg=function(){function e(){this.parser=ir,this.parserWithCSSDisabled=ir,this.mixer=tg}var n=e.prototype;return n.calculator=function(t,r,a,o){return a instanceof kt?a.value==="none"?ds:Ac:a},e}(),Tg=function(){function e(){this.parser=bc}var n=e.prototype;return n.calculator=function(t,r,a){return a instanceof kt?[]:a},e}();function wl(e){var n=e.parsedStyle.fontSize;return ae(n)?null:n}var cu=function(){function e(){this.parser=$n,this.parserWithCSSDisabled=null,this.mixer=lu}var n=e.prototype;return n.calculator=function(t,r,a,o,s){if(Ut(a))return a;if(at.isRelativeUnit(a.unit)){if(a.unit===Q.kPercentage)return 0;if(a.unit===Q.kEms){if(o.parentNode){var u=wl(o.parentNode);if(u)return u*=a.value,u;s.addUnresolveProperty(o,t)}else s.addUnresolveProperty(o,t);return 0}else if(a.unit===Q.kRems){var l;if(!(o==null||(l=o.ownerDocument)===null||l===void 0)&&l.documentElement){var f=wl(o.ownerDocument.documentElement);if(f)return f*=a.value,f;s.addUnresolveProperty(o,t)}else s.addUnresolveProperty(o,t);return 0}}else return a.value},e}(),Rg=function(){function e(){this.mixer=Bc}var n=e.prototype;return n.parser=function(t){var r=Dc(Ut(t)?[t]:t),a;return r.length===1?a=[r[0],r[0]]:a=[r[0],r[1]],a},n.calculator=function(t,r,a){return a.map(function(o){return o.value})},e}(),Sg=function(){function e(){this.mixer=Bc}var n=e.prototype;return n.parser=function(t){var r=Dc(Ut(t)?[t]:t),a;return r.length===1?a=[r[0],r[0],r[0],r[0]]:r.length===2?a=[r[0],r[1],r[0],r[1]]:r.length===3?a=[r[0],r[1],r[2],r[1]]:a=[r[0],r[1],r[2],r[3]],a},n.calculator=function(t,r,a){return a.map(function(o){return o.value})},e}(),Ag=function(e){Ie(n,e);function n(){return e.apply(this,arguments)||this}var i=n.prototype;return i.postProcessor=function(r,a){var o,s,u;switch(r.nodeName){case H.CIRCLE:case H.ELLIPSE:var l=r.parsedStyle,f=l.cx,c=l.cy;ae(f)||(o=f),ae(c)||(s=c);break;case H.LINE:var h=r.parsedStyle,p=h.x1,g=h.x2,_=h.y1,E=h.y2,y=Math.min(p,g),R=Math.min(_,E);o=y,s=R,u=0;break;case H.RECT:case H.IMAGE:case H.GROUP:case H.HTML:case H.TEXT:case H.MESH:ae(r.parsedStyle.x)||(o=r.parsedStyle.x),ae(r.parsedStyle.y)||(s=r.parsedStyle.y);break}r.nodeName!==H.PATH&&r.nodeName!==H.POLYLINE&&r.nodeName!==H.POLYGON&&(r.parsedStyle.defX=o||0,r.parsedStyle.defY=s||0);var A=!ae(o)||!ae(s)||!ae(u);if(A&&a.indexOf("transform")===-1){var M=r.parsedStyle.transform;if(M&&M.length)so(M,r);else{var x=r.getLocalPosition(),P=x[0],C=x[1],O=x[2];r.setLocalPosition(ae(o)?P:o,ae(s)?C:s,ae(u)?O:u)}}},n}(cu),Pg=function(){function e(){}var n=e.prototype;return n.calculator=function(t,r,a,o){var s;a instanceof kt&&(a=null);var u=(s=a)===null||s===void 0?void 0:s.cloneNode(!0);return u&&(u.style.isMarker=!0),u},e}(),xg=function(){function e(){this.mixer=lu,this.parser=Tn,this.parserWithCSSDisabled=null}var n=e.prototype;return n.calculator=function(t,r,a){return a.value},e}(),Mg=function(){function e(){this.parser=Tn,this.parserWithCSSDisabled=null,this.mixer=fu(0,1)}var n=e.prototype;return n.calculator=function(t,r,a){return a.value},n.postProcessor=function(t){var r=t.parsedStyle,a=r.offsetPath,o=r.offsetDistance;if(a){var s=a.nodeName;if(s===H.LINE||s===H.PATH||s===H.POLYLINE){var u=a.getPoint(o);u&&(t.parsedStyle.defX=u.x,t.parsedStyle.defY=u.y,t.setLocalPosition(u.x,u.y))}}},e}(),Cg=function(){function e(){this.parser=Tn,this.parserWithCSSDisabled=null,this.mixer=fu(0,1)}var n=e.prototype;return n.calculator=function(t,r,a){return a.value},e}(),ct=function(){function e(){this.center=[0,0,0],this.halfExtents=[0,0,0],this.min=[0,0,0],this.max=[0,0,0]}e.isEmpty=function(t){return!t||t.halfExtents[0]===0&&t.halfExtents[1]===0&&t.halfExtents[2]===0};var n=e.prototype;return n.update=function(t,r){Dn(this.center,t),Dn(this.halfExtents,r),bo(this.min,this.center,this.halfExtents),Da(this.max,this.center,this.halfExtents)},n.setMinMax=function(t,r){Da(this.center,r,t),Tl(this.center,this.center,.5),bo(this.halfExtents,r,t),Tl(this.halfExtents,this.halfExtents,.5),Dn(this.min,t),Dn(this.max,r)},n.getMin=function(){return this.min},n.getMax=function(){return this.max},n.add=function(t){if(!e.isEmpty(t)){if(e.isEmpty(this)){this.setMinMax(t.getMin(),t.getMax());return}var r=this.center,a=r[0],o=r[1],s=r[2],u=this.halfExtents,l=u[0],f=u[1],c=u[2],h=a-l,p=a+l,g=o-f,_=o+f,E=s-c,y=s+c,R=t.center,A=R[0],M=R[1],x=R[2],P=t.halfExtents,C=P[0],O=P[1],D=P[2],F=A-C,k=A+C,d=M-O,v=M+O,m=x-D,S=x+D;F<h&&(h=F),k>p&&(p=k),d<g&&(g=d),v>_&&(_=v),m<E&&(E=m),S>y&&(y=S),r[0]=(h+p)*.5,r[1]=(g+_)*.5,r[2]=(E+y)*.5,u[0]=(p-h)*.5,u[1]=(_-g)*.5,u[2]=(y-E)*.5,this.min[0]=h,this.min[1]=g,this.min[2]=E,this.max[0]=p,this.max[1]=_,this.max[2]=y}},n.setFromTransformedAABB=function(t,r){var a=this.center,o=this.halfExtents,s=t.center,u=t.halfExtents,l=r[0],f=r[4],c=r[8],h=r[1],p=r[5],g=r[9],_=r[2],E=r[6],y=r[10],R=Math.abs(l),A=Math.abs(f),M=Math.abs(c),x=Math.abs(h),P=Math.abs(p),C=Math.abs(g),O=Math.abs(_),D=Math.abs(E),F=Math.abs(y);a[0]=r[12]+l*s[0]+f*s[1]+c*s[2],a[1]=r[13]+h*s[0]+p*s[1]+g*s[2],a[2]=r[14]+_*s[0]+E*s[1]+y*s[2],o[0]=R*u[0]+A*u[1]+M*u[2],o[1]=x*u[0]+P*u[1]+C*u[2],o[2]=O*u[0]+D*u[1]+F*u[2],bo(this.min,a,o),Da(this.max,a,o)},n.intersects=function(t){var r=this.getMax(),a=this.getMin(),o=t.getMax(),s=t.getMin();return a[0]<=o[0]&&r[0]>=s[0]&&a[1]<=o[1]&&r[1]>=s[1]&&a[2]<=o[2]&&r[2]>=s[2]},n.intersection=function(t){if(!this.intersects(t))return null;var r=new e,a=s0([0,0,0],this.getMin(),t.getMin()),o=u0([0,0,0],this.getMax(),t.getMax());return r.setMinMax(a,o),r},n.getNegativeFarPoint=function(t){return t.pnVertexFlag===273?Dn([0,0,0],this.min):t.pnVertexFlag===272?[this.min[0],this.min[1],this.max[2]]:t.pnVertexFlag===257?[this.min[0],this.max[1],this.min[2]]:t.pnVertexFlag===256?[this.min[0],this.max[1],this.max[2]]:t.pnVertexFlag===17?[this.max[0],this.min[1],this.min[2]]:t.pnVertexFlag===16?[this.max[0],this.min[1],this.max[2]]:t.pnVertexFlag===1?[this.max[0],this.max[1],this.min[2]]:[this.max[0],this.max[1],this.max[2]]},n.getPositiveFarPoint=function(t){return t.pnVertexFlag===273?Dn([0,0,0],this.max):t.pnVertexFlag===272?[this.max[0],this.max[1],this.min[2]]:t.pnVertexFlag===257?[this.max[0],this.min[1],this.max[2]]:t.pnVertexFlag===256?[this.max[0],this.min[1],this.min[2]]:t.pnVertexFlag===17?[this.min[0],this.max[1],this.max[2]]:t.pnVertexFlag===16?[this.min[0],this.max[1],this.min[2]]:t.pnVertexFlag===1?[this.min[0],this.min[1],this.max[2]]:[this.min[0],this.min[1],this.min[2]]},e}(),Og=function(){function e(i,t){this.distance=void 0,this.normal=void 0,this.pnVertexFlag=void 0,this.distance=i||0,this.normal=t||me(0,1,0),this.updatePNVertexFlag()}var n=e.prototype;return n.updatePNVertexFlag=function(){this.pnVertexFlag=(+(this.normal[0]>=0)<<8)+(+(this.normal[1]>=0)<<4)+ +(this.normal[2]>=0)},n.distanceToPoint=function(t){return Sr(t,this.normal)-this.distance},n.normalize=function(){var t=1/ac(this.normal);jo(this.normal,this.normal,t),this.distance*=t},n.intersectsLine=function(t,r,a){var o=this.distanceToPoint(t),s=this.distanceToPoint(r),u=o/(o-s),l=u>=0&&u<=1;return l&&a&&es(a,t,r,u),l},e}(),$r;(function(e){e[e.OUTSIDE=4294967295]="OUTSIDE",e[e.INSIDE=0]="INSIDE",e[e.INDETERMINATE=2147483647]="INDETERMINATE"})($r||($r={}));var Ng=function(){function e(i){if(this.planes=[],i)this.planes=i;else for(var t=0;t<6;t++)this.planes.push(new Og)}var n=e.prototype;return n.extractFromVPMatrix=function(t){var r=t[0],a=t[1],o=t[2],s=t[3],u=t[4],l=t[5],f=t[6],c=t[7],h=t[8],p=t[9],g=t[10],_=t[11],E=t[12],y=t[13],R=t[14],A=t[15];Br(this.planes[0].normal,s-r,c-u,_-h),this.planes[0].distance=A-E,Br(this.planes[1].normal,s+r,c+u,_+h),this.planes[1].distance=A+E,Br(this.planes[2].normal,s+a,c+l,_+p),this.planes[2].distance=A+y,Br(this.planes[3].normal,s-a,c-l,_-p),this.planes[3].distance=A-y,Br(this.planes[4].normal,s-o,c-f,_-g),this.planes[4].distance=A-R,Br(this.planes[5].normal,s+o,c+f,_+g),this.planes[5].distance=A+R,this.planes.forEach(function(M){M.normalize(),M.updatePNVertexFlag()})},e}(),ht=function(){function e(i,t){i===void 0&&(i=0),t===void 0&&(t=0),this.x=0,this.y=0,this.x=i,this.y=t}var n=e.prototype;return n.clone=function(){return new e(this.x,this.y)},n.copyFrom=function(t){this.x=t.x,this.y=t.y},e}(),Rn=function(){function e(i,t,r,a){this.x=void 0,this.y=void 0,this.width=void 0,this.height=void 0,this.left=void 0,this.right=void 0,this.top=void 0,this.bottom=void 0,this.x=i,this.y=t,this.width=r,this.height=a,this.left=i,this.right=i+r,this.top=t,this.bottom=t+a}var n=e.prototype;return n.toJSON=function(){},e}(),Ig=function(){function e(){this.parser=Wa,this.parserWithCSSDisabled=Wa,this.mixer=sg}var n=e.prototype;return n.calculator=function(t,r,a){return a instanceof kt&&a.value==="unset"?{absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Rn(0,0,0,0)}:a},n.postProcessor=function(t,r){if(t.nodeName===H.PATH&&r.indexOf("transform")===-1){var a=t.parsedStyle,o=a.defX,s=o===void 0?0:o,u=a.defY,l=u===void 0?0:u;t.setLocalPosition(s,l)}},e}(),Dg=function(){function e(){this.parser=Uc,this.mixer=ug}var n=e.prototype;return n.postProcessor=function(t,r){if((t.nodeName===H.POLYGON||t.nodeName===H.POLYLINE)&&r.indexOf("transform")===-1){var a=t.parsedStyle,o=a.defX,s=a.defY;t.setLocalPosition(o,s)}},e}(),bg=function(e){Ie(n,e);function n(){for(var i,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r))||this,i.mixer=fu(0,1/0),i}return n}(cu),wg=function(){function e(){}var n=e.prototype;return n.calculator=function(t,r,a,o){return a instanceof kt?a.value==="unset"?"":a.value:""+a},n.postProcessor=function(t){t.nodeValue=""+t.parsedStyle.text||""},e}(),Bg=function(){function e(){}var n=e.prototype;return n.calculator=function(t,r,a,o){var s=o.getAttribute("text");if(s){var u=s;a.value==="capitalize"?u=s.charAt(0).toUpperCase()+s.slice(1):a.value==="lowercase"?u=s.toLowerCase():a.value==="uppercase"&&(u=s.toUpperCase()),o.parsedStyle.text=u}return a.value},e}(),Fg=function(){function e(){this.parser=Ii,this.parserWithCSSDisabled=Ii,this.mixer=mg}var n=e.prototype;return n.calculator=function(t,r,a,o){return a instanceof kt?[]:a},n.postProcessor=function(t){var r=t.parsedStyle.transform;so(r,t)},e}(),Ug=function(){this.parser=kc},kg=function(){function e(){this.parser=Tn}var n=e.prototype;return n.calculator=function(t,r,a,o){return a.value},n.postProcessor=function(t){if(t.parentNode){var r=t.parentNode,a=r.renderable,o=r.sortable;a&&(a.dirty=!0),o&&(o.dirty=!0)}},e}(),Lg=function(){function e(){this.registry={},this.define(H.CIRCLE,qg),this.define(H.ELLIPSE,Qg),this.define(H.RECT,fm),this.define(H.IMAGE,rm),this.define(H.LINE,Vc),this.define(H.GROUP,ys),this.define(H.PATH,am),this.define(H.POLYGON,zc),this.define(H.POLYLINE,um),this.define(H.TEXT,Gc),this.define(H.HTML,em)}var n=e.prototype;return n.define=function(t,r){this.registry[t]=r},n.get=function(t){return this.registry[t]},e}();function Wg(e){return!!e.type}var uo=function(){function e(i){this.type=void 0,this.eventPhase=e.prototype.NONE,this.target=void 0,this.bubbles=!0,this.cancelBubble=!0,this.cancelable=!1,this.currentTarget=void 0,this.defaultPrevented=!1,this.timeStamp=void 0,this.nativeEvent=void 0,this.originalEvent=void 0,this.propagationStopped=!1,this.propagationImmediatelyStopped=!1,this.manager=void 0,this.detail=void 0,this.layer=new ht,this.page=new ht,this.canvas=new ht,this.viewport=new ht,this.path=void 0,this.view=void 0,this.which=void 0,this.returnValue=void 0,this.srcElement=void 0,this.composed=!1,this.isTrusted=void 0,this.NONE=0,this.CAPTURING_PHASE=1,this.AT_TARGET=2,this.BUBBLING_PHASE=3,this.manager=i}var n=e.prototype;return n.composedPath=function(){return this.manager&&(!this.path||this.path[0]!==this.target)&&(this.path=this.target?this.manager.propagationPath(this.target):[]),this.path},n.preventDefault=function(){this.nativeEvent instanceof Event&&this.nativeEvent.cancelable&&this.nativeEvent.preventDefault(),this.defaultPrevented=!0},n.stopImmediatePropagation=function(){this.propagationImmediatelyStopped=!0},n.stopPropagation=function(){this.propagationStopped=!0},n.initEvent=function(){},n.initUIEvent=function(){},n.clone=function(){throw new Error(Ce)},Pn(e,[{key:"name",get:function(){return this.type}},{key:"layerX",get:function(){return this.layer.x}},{key:"layerY",get:function(){return this.layer.y}},{key:"pageX",get:function(){return this.page.x}},{key:"pageY",get:function(){return this.page.y}},{key:"x",get:function(){return this.canvas.x}},{key:"y",get:function(){return this.canvas.y}},{key:"canvasX",get:function(){return this.canvas.x}},{key:"canvasY",get:function(){return this.canvas.y}},{key:"viewportX",get:function(){return this.viewport.x}},{key:"viewportY",get:function(){return this.viewport.y}},{key:"propagationPath",get:function(){return this.composedPath()}}]),e}(),Bt=function(e){Ie(n,e);function n(i,t){var r;return r=e.call(this,null)||this,r.type=i,r.detail=t,Object.assign(Xn(r),t),r}return n}(uo),Bl=":",Lc=function(){function e(){this.emitter=new jn}var n=e.prototype;return n.on=function(t,r,a){return this.addEventListener(t,r,a),this},n.addEventListener=function(t,r,a){var o=Ju(a)&&a||Na(a)&&a.capture,s=Na(a)&&a.once,u=Fn(r)?void 0:r,l=!1,f="";if(t.indexOf(Bl)>-1){var c=t.split(Bl),h=c[0],p=c[1];t=p,f=h,l=!0}if(t=o?t+"capture":t,r=Fn(r)?r:r.handleEvent,l){var g=r;r=function(){for(var E,y=arguments.length,R=new Array(y),A=0;A<y;A++)R[A]=arguments[A];((E=R[0].target)===null||E===void 0?void 0:E.name)===f&&g.apply(void 0,R)}}return s?this.emitter.once(t,r,u):this.emitter.on(t,r,u),this},n.off=function(t,r,a){return t?this.removeEventListener(t,r,a):this.removeAllEventListeners(),this},n.removeAllEventListeners=function(){this.emitter.removeAllListeners()},n.removeEventListener=function(t,r,a){var o,s=Ju(a)&&a||Na(a)&&a.capture,u=Fn(r)?void 0:r;return t=s?t+"capture":t,r=Fn(r)?r:(o=r)===null||o===void 0?void 0:o.handleEvent,this.emitter.off(t,r,u),this},n.emit=function(t,r){this.dispatchEvent(new Bt(t,r))},n.dispatchEvent=function(t,r){if(r===void 0&&(r=!1),!Wg(t))throw new Error("DisplayObject cannot propagate events outside of the Federated Events API");var a;if(this.document)a=this;else if(this.defaultView)a=this.defaultView;else{var o;a=(o=this.ownerDocument)===null||o===void 0?void 0:o.defaultView}if(a){var s;if(t.manager=a.getEventService()||null,!t.manager)return!1;t.defaultPrevented=!1,t.path=[],r||(t.target=this),(s=t.manager)===null||s===void 0||s.dispatchEvent(t,t.type,r)}return!t.defaultPrevented},e}(),Ye=function(e){Ie(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.shadow=!1,t.ownerDocument=null,t.isConnected=!1,t.baseURI="",t.childNodes=[],t.nodeType=0,t.nodeName="",t.nodeValue=null,t.parentNode=null,t}n.isNode=function(r){return!!r.childNodes};var i=n.prototype;return i.getRootNode=function(r){return r===void 0&&(r={}),this.parentNode?this.parentNode.getRootNode(r):r.composed&&this.host?this.host.getRootNode(r):this},i.hasChildNodes=function(){return this.childNodes.length>0},i.isDefaultNamespace=function(r){throw new Error(Ce)},i.lookupNamespaceURI=function(r){throw new Error(Ce)},i.lookupPrefix=function(r){throw new Error(Ce)},i.normalize=function(){throw new Error(Ce)},i.isEqualNode=function(r){return this===r},i.isSameNode=function(r){return this.isEqualNode(r)},i.compareDocumentPosition=function(r){if(r===this)return 0;if(!(r instanceof n))throw new TypeError("Node.compareDocumentPosition: Argument 1 does not implement interface Node.");for(var a=r,o=this,s=[a],u=[o];(l=a.parentNode)!==null&&l!==void 0?l:o.parentNode;){var l;a=a.parentNode?(s.push(a.parentNode),a.parentNode):a,o=o.parentNode?(u.push(o.parentNode),o.parentNode):o}if(a!==o)return n.DOCUMENT_POSITION_DISCONNECTED|n.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC|n.DOCUMENT_POSITION_PRECEDING;var f=s.length>u.length?s:u,c=f===s?u:s;if(f[f.length-c.length]===c[0])return f===s?n.DOCUMENT_POSITION_CONTAINED_BY|n.DOCUMENT_POSITION_FOLLOWING:n.DOCUMENT_POSITION_CONTAINS|n.DOCUMENT_POSITION_PRECEDING;for(var h=f.length-c.length,p=c.length-1;p>=0;p--){var g=c[p],_=f[h+p];if(_!==g){var E=g.parentNode.childNodes;return E.indexOf(g)<E.indexOf(_)?c===s?n.DOCUMENT_POSITION_PRECEDING:n.DOCUMENT_POSITION_FOLLOWING:f===s?n.DOCUMENT_POSITION_PRECEDING:n.DOCUMENT_POSITION_FOLLOWING}}return n.DOCUMENT_POSITION_FOLLOWING},i.contain=function(r){return this.contains(r)},i.contains=function(r){for(var a=r;a&&this!==a;)a=a.parentNode;return!!a},i.getAncestor=function(r){for(var a=this;r>0&&a;)a=a.parentNode,r--;return a},i.forEach=function(r,a){a===void 0&&(a=!1),r(this)||(a?this.childNodes.slice():this.childNodes).forEach(function(o){o.forEach(r)})},Pn(n,[{key:"textContent",get:function(){var r="";this.nodeName===H.TEXT&&(r+=this.style.text);for(var a=Bn(this.childNodes),o;!(o=a()).done;){var s=o.value;s.nodeName===H.TEXT?r+=s.nodeValue:r+=s.textContent}return r},set:function(r){var a=this;this.childNodes.slice().forEach(function(o){a.removeChild(o)}),this.nodeName===H.TEXT&&(this.style.text=""+r)}},{key:"parent",get:function(){return this.parentNode}},{key:"parentElement",get:function(){return null}},{key:"nextSibling",get:function(){return null}},{key:"previousSibling",get:function(){return null}},{key:"firstChild",get:function(){return this.childNodes.length>0?this.childNodes[0]:null}},{key:"lastChild",get:function(){return this.childNodes.length>0?this.childNodes[this.childNodes.length-1]:null}}]),n}(Lc);Ye.DOCUMENT_POSITION_DISCONNECTED=1;Ye.DOCUMENT_POSITION_PRECEDING=2;Ye.DOCUMENT_POSITION_FOLLOWING=4;Ye.DOCUMENT_POSITION_CONTAINS=8;Ye.DOCUMENT_POSITION_CONTAINED_BY=16;Ye.DOCUMENT_POSITION_IMPLEMENTATION_SPECIFIC=32;var Hg=function(e){Ie(n,e);function n(){var t;t=e.call(this)||this,t.defaultView=null,t.documentElement=void 0,t.timeline=void 0,t.ownerDocument=null,t.nodeName="document";try{t.timeline=new X.AnimationTimeline(Xn(t))}catch{}var r={};return hu.forEach(function(a){var o=a.n,s=a.inh,u=a.d;s&&u&&(r[o]=Fn(u)?u(H.GROUP):u)}),t.documentElement=new ys({id:"g-root",style:r}),t.documentElement.ownerDocument=Xn(t),t.documentElement.parentNode=Xn(t),t.childNodes=[t.documentElement],t}var i=n.prototype;return i.createElement=function(r,a){if(r==="svg")return this.documentElement;var o=this.defaultView.customElements.get(r);o||(console.warn("Unsupported tagName: ",r),o=r==="tspan"?Gc:ys);var s=new o(a);return s.ownerDocument=this,s},i.createElementNS=function(r,a,o){return this.createElement(a,o)},i.cloneNode=function(r){throw new Error(Ce)},i.destroy=function(){try{this.documentElement.destroyChildren(),this.timeline.destroy()}catch{}},i.elementsFromBBox=function(r,a,o,s){var u=this.defaultView.context.rBushRoot,l=u.search({minX:r,minY:a,maxX:o,maxY:s}),f=[];return l.forEach(function(c){var h=c.displayObject,p=h.parsedStyle.pointerEvents,g=["auto","visiblepainted","visiblefill","visiblestroke","visible"].includes(p);(!g||g&&h.isVisible())&&!h.isCulled()&&h.isInteractive()&&f.push(h)}),f.sort(function(c,h){return h.sortable.renderOrder-c.sortable.renderOrder}),f},i.elementFromPointSync=function(r,a){var o=this.defaultView.canvas2Viewport({x:r,y:a}),s=o.x,u=o.y,l=this.defaultView.getConfig(),f=l.width,c=l.height;if(s<0||u<0||s>f||u>c)return null;var h=this.defaultView.viewport2Client({x:s,y:u}),p=h.x,g=h.y,_=this.defaultView.getRenderingService().hooks.pickSync.call({topmost:!0,position:{x:r,y:a,viewportX:s,viewportY:u,clientX:p,clientY:g},picked:[]}),E=_.picked;return E&&E[0]||this.documentElement},i.elementFromPoint=function(){var t=Wr(tt().mark(function a(o,s){var u,l,f,c,h,p,g,_,E,y,R;return tt().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(u=this.defaultView.canvas2Viewport({x:o,y:s}),l=u.x,f=u.y,c=this.defaultView.getConfig(),h=c.width,p=c.height,!(l<0||f<0||l>h||f>p)){M.next=4;break}return M.abrupt("return",null);case 4:return g=this.defaultView.viewport2Client({x:l,y:f}),_=g.x,E=g.y,M.next=7,this.defaultView.getRenderingService().hooks.pick.promise({topmost:!0,position:{x:o,y:s,viewportX:l,viewportY:f,clientX:_,clientY:E},picked:[]});case 7:return y=M.sent,R=y.picked,M.abrupt("return",R&&R[0]||this.documentElement);case 10:case"end":return M.stop()}},a,this)}));function r(a,o){return t.apply(this,arguments)}return r}(),i.elementsFromPointSync=function(r,a){var o=this.defaultView.canvas2Viewport({x:r,y:a}),s=o.x,u=o.y,l=this.defaultView.getConfig(),f=l.width,c=l.height;if(s<0||u<0||s>f||u>c)return[];var h=this.defaultView.viewport2Client({x:s,y:u}),p=h.x,g=h.y,_=this.defaultView.getRenderingService().hooks.pickSync.call({topmost:!1,position:{x:r,y:a,viewportX:s,viewportY:u,clientX:p,clientY:g},picked:[]}),E=_.picked;return E[E.length-1]!==this.documentElement&&E.push(this.documentElement),E},i.elementsFromPoint=function(){var t=Wr(tt().mark(function a(o,s){var u,l,f,c,h,p,g,_,E,y,R;return tt().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(u=this.defaultView.canvas2Viewport({x:o,y:s}),l=u.x,f=u.y,c=this.defaultView.getConfig(),h=c.width,p=c.height,!(l<0||f<0||l>h||f>p)){M.next=4;break}return M.abrupt("return",[]);case 4:return g=this.defaultView.viewport2Client({x:l,y:f}),_=g.x,E=g.y,M.next=7,this.defaultView.getRenderingService().hooks.pick.promise({topmost:!1,position:{x:o,y:s,viewportX:l,viewportY:f,clientX:_,clientY:E},picked:[]});case 7:return y=M.sent,R=y.picked,R[R.length-1]!==this.documentElement&&R.push(this.documentElement),M.abrupt("return",R);case 11:case"end":return M.stop()}},a,this)}));function r(a,o){return t.apply(this,arguments)}return r}(),i.appendChild=function(r,a){throw new Error(In)},i.insertBefore=function(r,a){throw new Error(In)},i.removeChild=function(r,a){throw new Error(In)},i.replaceChild=function(r,a,o){throw new Error(In)},i.append=function(){throw new Error(In)},i.prepend=function(){throw new Error(In)},i.getElementById=function(r){return this.documentElement.getElementById(r)},i.getElementsByName=function(r){return this.documentElement.getElementsByName(r)},i.getElementsByTagName=function(r){return this.documentElement.getElementsByTagName(r)},i.getElementsByClassName=function(r){return this.documentElement.getElementsByClassName(r)},i.querySelector=function(r){return this.documentElement.querySelector(r)},i.querySelectorAll=function(r){return this.documentElement.querySelectorAll(r)},i.find=function(r){return this.documentElement.find(r)},i.findAll=function(r){return this.documentElement.findAll(r)},Pn(n,[{key:"children",get:function(){return this.childNodes}},{key:"childElementCount",get:function(){return this.childNodes.length}},{key:"firstElementChild",get:function(){return this.firstChild}},{key:"lastElementChild",get:function(){return this.lastChild}}]),n}(Ye),ms;(function(e){e[e.Standard=0]="Standard"})(ms||(ms={}));var fe;(function(e){e.REPARENT="reparent",e.DESTROY="destroy",e.ATTR_MODIFIED="DOMAttrModified",e.INSERTED="DOMNodeInserted",e.REMOVED="removed",e.MOUNTED="DOMNodeInsertedIntoDocument",e.UNMOUNTED="DOMNodeRemovedFromDocument",e.BOUNDS_CHANGED="bounds-changed",e.RENDER_ORDER_CHANGED="render-order-changed",e.CULLED="culled"})(fe||(fe={}));var Mr=function(e){Ie(n,e);function n(i,t,r,a,o,s,u,l){var f;return f=e.call(this,null)||this,f.relatedNode=void 0,f.prevValue=void 0,f.newValue=void 0,f.attrName=void 0,f.attrChange=void 0,f.prevParsedValue=void 0,f.newParsedValue=void 0,f.relatedNode=t,f.prevValue=r,f.newValue=a,f.attrName=o,f.attrChange=s,f.prevParsedValue=u,f.newParsedValue=l,f.type=i,f}return n}(uo);Mr.ADDITION=2;Mr.MODIFICATION=1;Mr.REMOVAL=3;var Xg=0,Fl=new Mr(fe.INSERTED,null,"","","",0,"",""),Ul=new Mr(fe.REMOVED,null,"","","",0,"",""),Vg=new Bt(fe.DESTROY),Wc=function(e){Ie(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.entity=Xg++,t.renderable={bounds:void 0,boundsDirty:!0,renderBounds:void 0,renderBoundsDirty:!0,dirtyRenderBounds:void 0,dirty:!1,proxyNodeName:void 0},t.cullable={strategy:ms.Standard,visibilityPlaneMask:-1,visible:!0,enable:!0},t.transformable={dirtyFlag:!1,localDirtyFlag:!1,frozen:!1,localPosition:[0,0,0],localRotation:[0,0,0,1],localScale:[1,1,1],localTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],localSkew:[0,0],position:[0,0,0],rotation:[0,0,0,1],scaling:[1,1,1],worldTransform:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],origin:[0,0,0]},t.sortable={dirty:!1,sorted:void 0,lastSortedIndex:void 0,renderOrder:0},t.geometry={contentBounds:void 0,renderBounds:void 0},t.rBushNode={aabb:void 0},t.id=void 0,t.name=void 0,t.namespaceURI="g",t.scrollLeft=0,t.scrollTop=0,t.clientTop=0,t.clientLeft=0,t.destroyed=!1,t.style={},t.computedStyle=X.enableCSSParsing?{anchor:De,opacity:De,fillOpacity:De,strokeOpacity:De,fill:De,stroke:De,transform:De,transformOrigin:De,visibility:De,pointerEvents:De,lineWidth:De,lineCap:De,lineJoin:De,increasedLineWidthForHitTesting:De,fontSize:De,fontFamily:De,fontStyle:De,fontWeight:De,fontVariant:De,textAlign:De,textBaseline:De,textTransform:De,zIndex:De,filter:De,shadowType:De}:null,t.parsedStyle={},t.attributes={},t}n.isElement=function(r){return!!r.getAttribute};var i=n.prototype;return i.cloneNode=function(r){throw new Error(Ce)},i.appendChild=function(r,a){var o;if(r.destroyed)throw new Error(i0);return X.sceneGraphService.attach(r,this,a),!((o=this.ownerDocument)===null||o===void 0)&&o.defaultView&&this.ownerDocument.defaultView.mountChildren(r),Fl.relatedNode=this,r.dispatchEvent(Fl),r},i.insertBefore=function(r,a){if(!a)this.appendChild(r);else{var o=this.childNodes.indexOf(a);this.appendChild(r,o-1)}return r},i.replaceChild=function(r,a){var o=this.childNodes.indexOf(a);return this.removeChild(a),this.appendChild(r,o),a},i.removeChild=function(r){var a;return Ul.relatedNode=this,r.dispatchEvent(Ul),!((a=r.ownerDocument)===null||a===void 0)&&a.defaultView&&r.ownerDocument.defaultView.unmountChildren(r),X.sceneGraphService.detach(r),r},i.removeChildren=function(){for(var r=this.childNodes.length-1;r>=0;r--){var a=this.childNodes[r];this.removeChild(a)}},i.destroyChildren=function(){for(var r=this.childNodes.length-1;r>=0;r--){var a=this.childNodes[r];a.childNodes.length&&a.destroyChildren(),a.destroy()}},i.matches=function(r){return X.sceneGraphService.matches(r,this)},i.getElementById=function(r){return X.sceneGraphService.querySelector("#"+r,this)},i.getElementsByName=function(r){return X.sceneGraphService.querySelectorAll('[name="'+r+'"]',this)},i.getElementsByClassName=function(r){return X.sceneGraphService.querySelectorAll("."+r,this)},i.getElementsByTagName=function(r){return X.sceneGraphService.querySelectorAll(r,this)},i.querySelector=function(r){return X.sceneGraphService.querySelector(r,this)},i.querySelectorAll=function(r){return X.sceneGraphService.querySelectorAll(r,this)},i.closest=function(r){var a=this;do{if(X.sceneGraphService.matches(r,a))return a;a=a.parentElement}while(a!==null);return null},i.find=function(r){var a=this,o=null;return this.forEach(function(s){return s!==a&&r(s)?(o=s,!0):!1}),o},i.findAll=function(r){var a=this,o=[];return this.forEach(function(s){s!==a&&r(s)&&o.push(s)}),o},i.after=function(){var r=this;if(this.parentNode){for(var a=this.parentNode.childNodes.indexOf(this),o=arguments.length,s=new Array(o),u=0;u<o;u++)s[u]=arguments[u];s.forEach(function(l,f){var c;return(c=r.parentNode)===null||c===void 0?void 0:c.appendChild(l,a+f+1)})}},i.before=function(){if(this.parentNode){for(var r=this.parentNode.childNodes.indexOf(this),a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var u=o[0],l=o.slice(1);this.parentNode.appendChild(u,r),u.after.apply(u,l)}},i.replaceWith=function(){this.after.apply(this,arguments),this.remove()},i.append=function(){for(var r=this,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];o.forEach(function(u){return r.appendChild(u)})},i.prepend=function(){for(var r=this,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];o.forEach(function(u,l){return r.appendChild(u,l)})},i.replaceChildren=function(){for(;this.childNodes.length&&this.firstChild;)this.removeChild(this.firstChild);this.append.apply(this,arguments)},i.remove=function(){return this.parentNode?this.parentNode.removeChild(this):this},i.destroy=function(){this.dispatchEvent(Vg),this.remove(),this.emitter.removeAllListeners(),this.destroyed=!0},i.getGeometryBounds=function(){return X.sceneGraphService.getGeometryBounds(this)},i.getRenderBounds=function(){return X.sceneGraphService.getBounds(this,!0)},i.getBounds=function(){return X.sceneGraphService.getBounds(this)},i.getLocalBounds=function(){return X.sceneGraphService.getLocalBounds(this)},i.getBoundingClientRect=function(){return X.sceneGraphService.getBoundingClientRect(this)},i.getClientRects=function(){return[this.getBoundingClientRect()]},i.computedStyleMap=function(){return new Map(Object.entries(this.computedStyle))},i.getAttributeNames=function(){return Object.keys(this.attributes)},i.getAttribute=function(r){if(zp(r))return X.enableCSSParsing?null:void 0;var a=this.attributes[r];if(a===void 0){var o=fs(r);return a=this.attributes[o],X.enableCSSParsing&&ae(a)?null:a}else return a},i.hasAttribute=function(r){return this.getAttributeNames().includes(r)},i.hasAttributes=function(){return!!this.getAttributeNames().length},i.removeAttribute=function(r){this.setAttribute(r,null),delete this.attributes[r]},i.setAttribute=function(r,a,o){this.attributes[r]=a},i.getAttributeNS=function(r,a){throw new Error(Ce)},i.getAttributeNode=function(r){throw new Error(Ce)},i.getAttributeNodeNS=function(r,a){throw new Error(Ce)},i.hasAttributeNS=function(r,a){throw new Error(Ce)},i.removeAttributeNS=function(r,a){throw new Error(Ce)},i.removeAttributeNode=function(r){throw new Error(Ce)},i.setAttributeNS=function(r,a,o){throw new Error(Ce)},i.setAttributeNode=function(r){throw new Error(Ce)},i.setAttributeNodeNS=function(r){throw new Error(Ce)},i.toggleAttribute=function(r,a){throw new Error(Ce)},Pn(n,[{key:"className",get:function(){return this.getAttribute("class")||""},set:function(r){this.setAttribute("class",r)}},{key:"classList",get:function(){return this.className.split(" ").filter(function(r){return r!==""})}},{key:"tagName",get:function(){return this.nodeName}},{key:"children",get:function(){return this.childNodes}},{key:"childElementCount",get:function(){return this.childNodes.length}},{key:"firstElementChild",get:function(){return this.firstChild}},{key:"lastElementChild",get:function(){return this.lastChild}},{key:"parentElement",get:function(){return this.parentNode}},{key:"nextSibling",get:function(){if(this.parentNode){var r=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[r+1]||null}return null}},{key:"previousSibling",get:function(){if(this.parentNode){var r=this.parentNode.childNodes.indexOf(this);return this.parentNode.childNodes[r-1]||null}return null}}]),n}(Ye),Hc=function(e){Ie(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.altKey=void 0,t.button=void 0,t.buttons=void 0,t.ctrlKey=void 0,t.metaKey=void 0,t.relatedTarget=void 0,t.shiftKey=void 0,t.client=new ht,t.movement=new ht,t.offset=new ht,t.global=new ht,t.screen=new ht,t}var i=n.prototype;return i.getModifierState=function(r){return"getModifierState"in this.nativeEvent&&this.nativeEvent.getModifierState(r)},i.initMouseEvent=function(){throw new Error(Ce)},Pn(n,[{key:"clientX",get:function(){return this.client.x}},{key:"clientY",get:function(){return this.client.y}},{key:"movementX",get:function(){return this.movement.x}},{key:"movementY",get:function(){return this.movement.y}},{key:"offsetX",get:function(){return this.offset.x}},{key:"offsetY",get:function(){return this.offset.y}},{key:"globalX",get:function(){return this.global.x}},{key:"globalY",get:function(){return this.global.y}},{key:"screenX",get:function(){return this.screen.x}},{key:"screenY",get:function(){return this.screen.y}}]),n}(uo),_s=function(e){Ie(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.pointerId=void 0,t.width=0,t.height=0,t.isPrimary=!1,t.pointerType=void 0,t.pressure=void 0,t.tangentialPressure=void 0,t.tiltX=void 0,t.tiltY=void 0,t.twist=void 0,t}var i=n.prototype;return i.getCoalescedEvents=function(){return this.type==="pointermove"||this.type==="mousemove"||this.type==="touchmove"?[this]:[]},i.getPredictedEvents=function(){throw new Error("getPredictedEvents is not supported!")},i.clone=function(){return this.manager.clonePointerEvent(this)},n}(Hc),Es=function(e){Ie(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.deltaMode=void 0,t.deltaX=void 0,t.deltaY=void 0,t.deltaZ=void 0,t.DOM_DELTA_LINE=0,t.DOM_DELTA_PAGE=1,t.DOM_DELTA_PIXEL=2,t}var i=n.prototype;return i.clone=function(){return this.manager.cloneWheelEvent(this)},n}(Hc);function Pe(e){return!!(e!=null&&e.nodeName)}var Ir=new Mr(fe.ATTR_MODIFIED,null,null,null,null,Mr.MODIFICATION,null,null),Yg={anchor:"",opacity:"",fillOpacity:"",strokeOpacity:"",fill:"",stroke:"",transform:"",transformOrigin:"",visibility:"",pointerEvents:"",lineWidth:"",lineCap:"",lineJoin:"",increasedLineWidthForHitTesting:"",fontSize:"",fontFamily:"",fontStyle:"",fontWeight:"",fontVariant:"",textAlign:"",textBaseline:"",textTransform:"",zIndex:"",filter:"",shadowType:""},Xc={anchor:[0,0],fill:ds,stroke:ds,transform:[],zIndex:0,filter:[],shadowType:"outer",miterLimit:10},zg=pe({},Xc,{opacity:1,fillOpacity:1,strokeOpacity:1,visibility:"visible",pointerEvents:"auto",lineWidth:1,lineCap:"butt",lineJoin:"miter",increasedLineWidthForHitTesting:0,fillRule:"nonzero"}),Gg=["opacity","fillOpacity","strokeOpacity","transformOrigin","visibility","pointerEvents","lineWidth","lineCap","lineJoin","increasedLineWidthForHitTesting"],Kg=[].concat(Gg,["fontSize","fontFamily","fontStyle","fontWeight","fontVariant","textAlign","textBaseline","textTransform"]),kl="data-",At=function(e){Ie(n,e);function n(t){var r,a;a=e.call(this)||this,a.config=void 0,a.isCustomElement=!1,a.isMutationObserved=!1,a.activeAnimations=[],a.dataset=void 0,a.getClip=function(){return this.style.clipPath||null},a.config=t,a.config.interactive=(r=a.config.capture)!==null&&r!==void 0?r:a.config.interactive,a.id=a.config.id||"",a.name=a.config.name||"",(a.config.className||a.config.class)&&(a.className=a.config.className||a.config.class),a.nodeName=a.config.type||H.GROUP,a.config.style=a.config.style||a.config.attrs||{},Object.assign(a.config.style,a.config.attrs),a.config.visible!=null&&(a.config.style.visibility=a.config.visible===!1?"hidden":"visible"),a.config.interactive!=null&&(a.config.style.pointerEvents=a.config.interactive===!1?"none":"auto"),Object.assign(a.parsedStyle,X.enableCSSParsing?Xc:zg,a.config.initialParsedStyle),X.enableCSSParsing&&Object.assign(a.attributes,Yg),a.initAttributes(a.config.style);var o=X.globalThis.Proxy?X.globalThis.Proxy:function(){};return a.dataset=new o({},{get:function(u,l){var f=""+kl+El(l);return u[f]!==void 0?u[f]:a.getAttribute(f)},set:function(u,l,f){return a.setAttribute(""+kl+El(l),f),!0}}),a.style=new o({setProperty:function(u,l){a.setAttribute(u,l)},getPropertyValue:function(u){return a.getAttribute(u)},removeProperty:function(u){a.removeAttribute(u)},item:function(){return""}},{get:function(u,l){return u[l]!==void 0?u[l]:a.getAttribute(l)},set:function(u,l,f){return a.setAttribute(l,f),!0}}),a}var i=n.prototype;return i.destroy=function(){e.prototype.destroy.call(this),this.getAnimations().forEach(function(r){r.cancel()})},i.cloneNode=function(r,a){var o=pe({},this.attributes);for(var s in o){var u=o[s];Pe(u)&&s!=="clipPath"&&s!=="offsetPath"&&s!=="textPath"&&(o[s]=u.cloneNode(r)),a&&(o[s]=a(s,u))}var l=new this.constructor({id:this.id,name:this.name,className:this.name,interactive:this.interactive,style:o});return l.setLocalTransform(this.getLocalTransform()),r&&this.children.forEach(function(f){if(!f.style.isMarker){var c=f.cloneNode(r);l.appendChild(c)}}),l},i.initAttributes=function(r){r===void 0&&(r={});var a=this.renderable,o={forceUpdateGeometry:!0};X.enableCSSParsing&&(o.usedAttributes=Kg);var s={};for(var u in r){var l=fs(u);s[l]=r[u]}X.styleValueRegistry.processProperties(this,s,o),a.dirty=!0},i.setAttribute=function(r,a,o){o===void 0&&(o=!1);var s=fs(r);Xe(a)||(o||a!==this.attributes[s])&&(this.internalSetAttribute(s,a),e.prototype.setAttribute.call(this,s,a))},i.internalSetAttribute=function(r,a,o){var s;o===void 0&&(o={});var u=this.renderable,l=this.attributes[r],f=this.parsedStyle[r];X.styleValueRegistry.processProperties(this,(s={},s[r]=a,s),o),u.dirty=!0;var c=this.parsedStyle[r];this.isConnected&&(Ir.relatedNode=this,Ir.prevValue=l,Ir.newValue=a,Ir.attrName=r,Ir.prevParsedValue=f,Ir.newParsedValue=c,this.isMutationObserved?this.dispatchEvent(Ir):(Ir.target=this,this.ownerDocument.defaultView.dispatchEvent(Ir,!0))),(this.isCustomElement&&this.isConnected||!this.isCustomElement)&&this.attributeChangedCallback&&this.attributeChangedCallback(r,l,a,f,c)},i.getBBox=function(){var r=this.getBounds(),a=r.getMin(),o=a[0],s=a[1],u=r.getMax(),l=u[0],f=u[1];return new Rn(o,s,l-o,f-s)},i.setOrigin=function(r,a,o){return a===void 0&&(a=0),o===void 0&&(o=0),X.sceneGraphService.setOrigin(this,St(r,a,o)),this},i.getOrigin=function(){return X.sceneGraphService.getOrigin(this)},i.setPosition=function(r,a,o){return a===void 0&&(a=0),o===void 0&&(o=0),X.sceneGraphService.setPosition(this,St(r,a,o)),this},i.setLocalPosition=function(r,a,o){return a===void 0&&(a=0),o===void 0&&(o=0),X.sceneGraphService.setLocalPosition(this,St(r,a,o)),this},i.translate=function(r,a,o){return a===void 0&&(a=0),o===void 0&&(o=0),X.sceneGraphService.translate(this,St(r,a,o)),this},i.translateLocal=function(r,a,o){return a===void 0&&(a=0),o===void 0&&(o=0),X.sceneGraphService.translateLocal(this,St(r,a,o)),this},i.getPosition=function(){return X.sceneGraphService.getPosition(this)},i.getLocalPosition=function(){return X.sceneGraphService.getLocalPosition(this)},i.scale=function(r,a,o){return this.scaleLocal(r,a,o)},i.scaleLocal=function(r,a,o){return typeof r=="number"&&(a=a||r,o=o||r,r=St(r,a,o)),X.sceneGraphService.scaleLocal(this,r),this},i.setLocalScale=function(r,a,o){return typeof r=="number"&&(a=a||r,o=o||r,r=St(r,a,o)),X.sceneGraphService.setLocalScale(this,r),this},i.getLocalScale=function(){return X.sceneGraphService.getLocalScale(this)},i.getScale=function(){return X.sceneGraphService.getScale(this)},i.getEulerAngles=function(){var r=wo(Re(),X.sceneGraphService.getWorldTransform(this)),a=r[2];return tr(a)},i.getLocalEulerAngles=function(){var r=wo(Re(),X.sceneGraphService.getLocalRotation(this)),a=r[2];return tr(a)},i.setEulerAngles=function(r){return X.sceneGraphService.setEulerAngles(this,0,0,r),this},i.setLocalEulerAngles=function(r){return X.sceneGraphService.setLocalEulerAngles(this,0,0,r),this},i.rotateLocal=function(r,a,o){return ae(a)&&ae(o)?X.sceneGraphService.rotateLocal(this,0,0,r):X.sceneGraphService.rotateLocal(this,r,a,o),this},i.rotate=function(r,a,o){return ae(a)&&ae(o)?X.sceneGraphService.rotate(this,0,0,r):X.sceneGraphService.rotate(this,r,a,o),this},i.setRotation=function(r,a,o,s){return X.sceneGraphService.setRotation(this,r,a,o,s),this},i.setLocalRotation=function(r,a,o,s){return X.sceneGraphService.setLocalRotation(this,r,a,o,s),this},i.setLocalSkew=function(r,a){return X.sceneGraphService.setLocalSkew(this,r,a),this},i.getRotation=function(){return X.sceneGraphService.getRotation(this)},i.getLocalRotation=function(){return X.sceneGraphService.getLocalRotation(this)},i.getLocalSkew=function(){return X.sceneGraphService.getLocalSkew(this)},i.getLocalTransform=function(){return X.sceneGraphService.getLocalTransform(this)},i.getWorldTransform=function(){return X.sceneGraphService.getWorldTransform(this)},i.setLocalTransform=function(r){return X.sceneGraphService.setLocalTransform(this,r),this},i.resetLocalTransform=function(){X.sceneGraphService.resetLocalTransform(this)},i.getAnimations=function(){return this.activeAnimations},i.animate=function(r,a){var o,s=(o=this.ownerDocument)===null||o===void 0?void 0:o.timeline;return s?s.play(this,r,a):null},i.isVisible=function(){var r;return((r=this.parsedStyle)===null||r===void 0?void 0:r.visibility)==="visible"},i.isInteractive=function(){var r;return((r=this.parsedStyle)===null||r===void 0?void 0:r.pointerEvents)!=="none"},i.isCulled=function(){return!!(this.cullable&&this.cullable.enable&&!this.cullable.visible)},i.toFront=function(){return this.parentNode&&(this.style.zIndex=Math.max.apply(Math,this.parentNode.children.map(function(r){return Number(r.style.zIndex)}))+1),this},i.toBack=function(){return this.parentNode&&(this.style.zIndex=Math.min.apply(Math,this.parentNode.children.map(function(r){return Number(r.style.zIndex)}))-1),this},i.getConfig=function(){return this.config},i.attr=function(){for(var r=this,a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];var u=o[0],l=o[1];return u?Na(u)?(Object.keys(u).forEach(function(f){r.setAttribute(f,u[f])}),this):o.length===2?(this.setAttribute(u,l),this):this.attributes[u]:this.attributes},i.getMatrix=function(r){var a=r||this.getWorldTransform(),o=wa(Re(),a),s=o[0],u=o[1],l=Kn(Re(),a),f=l[0],c=l[1],h=Ba(qe(),a),p=wo(Re(),h),g=p[0],_=p[2];return h0(g||_,s,u,f,c)},i.getLocalMatrix=function(){return this.getMatrix(this.getLocalTransform())},i.setMatrix=function(r){var a=Rl(r),o=a[0],s=a[1],u=a[2],l=a[3],f=a[4];this.setEulerAngles(f).setPosition(o,s).setLocalScale(u,l)},i.setLocalMatrix=function(r){var a=Rl(r),o=a[0],s=a[1],u=a[2],l=a[3],f=a[4];this.setLocalEulerAngles(f).setLocalPosition(o,s).setLocalScale(u,l)},i.show=function(){X.enableCSSParsing?this.style.visibility="visible":this.forEach(function(r){r.style.visibility="visible"})},i.hide=function(){X.enableCSSParsing?this.style.visibility="hidden":this.forEach(function(r){r.style.visibility="hidden"})},i.getCount=function(){return this.childElementCount},i.getParent=function(){return this.parentElement},i.getChildren=function(){return this.children},i.getFirst=function(){return this.firstElementChild},i.getLast=function(){return this.lastElementChild},i.getChildByIndex=function(r){return this.children[r]||null},i.add=function(r,a){return this.appendChild(r,a)},i.setClip=function(r){this.style.clipPath=r},i.set=function(r,a){this.config[r]=a},i.get=function(r){return this.config[r]},i.moveTo=function(r,a,o){return a===void 0&&(a=0),o===void 0&&(o=0),this.setPosition(r,a,o),this},i.move=function(r,a,o){return a===void 0&&(a=0),o===void 0&&(o=0),this.setPosition(r,a,o),this},i.setZIndex=function(r){return this.style.zIndex=r,this},Pn(n,[{key:"interactive",get:function(){return this.isInteractive()},set:function(r){this.style.pointerEvents=r?"auto":"none"}}]),n}(Wc),$g=["style"],qg=function(e){Ie(n,e);function n(i){var t=i===void 0?{}:i,r=t.style,a=vr(t,$g);return e.call(this,pe({type:H.CIRCLE,style:X.enableCSSParsing?pe({cx:"",cy:"",r:""},r):pe({},r),initialParsedStyle:{anchor:[.5,.5],transformOrigin:X.enableCSSParsing?null:[La,La]}},a))||this}return n}(At),Zg=["style"],Qg=function(e){Ie(n,e);function n(i){var t=i===void 0?{}:i,r=t.style,a=vr(t,Zg);return e.call(this,pe({type:H.ELLIPSE,style:X.enableCSSParsing?pe({cx:"",cy:"",rx:"",ry:""},r):pe({},r),initialParsedStyle:{anchor:[.5,.5],transformOrigin:X.enableCSSParsing?null:[La,La]}},a))||this}return n}(At),Jg=["style"],ys=function(e){Ie(n,e);function n(i){var t=i===void 0?{}:i,r=t.style,a=vr(t,Jg);return e.call(this,pe({type:H.GROUP,style:X.enableCSSParsing?pe({x:"",y:"",width:"",height:""},r):pe({},r)},a))||this}return n}(At),jg=["style"],em=function(e){Ie(n,e);function n(t){var r,a=t===void 0?{}:t,o=a.style,s=vr(a,jg);return r=e.call(this,pe({type:H.HTML,style:X.enableCSSParsing?pe({x:"",y:"",width:"auto",height:"auto",innerHTML:""},o):pe({},o)},s))||this,r.cullable.enable=!1,r}var i=n.prototype;return i.getDomElement=function(){return this.parsedStyle.$el},i.getBoundingClientRect=function(){return this.parsedStyle.$el.getBoundingClientRect()},i.getClientRects=function(){return[this.getBoundingClientRect()]},i.getBounds=function(){var r,a,o=this.getBoundingClientRect(),s=(r=this.ownerDocument)===null||r===void 0||(a=r.defaultView)===null||a===void 0?void 0:a.getContextService().getBoundingClientRect();if(s){var u=o.left-s.left,l=o.top-s.top,f=new ct;return f.setMinMax([u,l,0],[u+o.width,l+o.height,0]),f}return null},i.getLocalBounds=function(){if(this.parentNode){var r=Rr(Te(),this.parentNode.getWorldTransform()),a=this.getBounds();if(!ct.isEmpty(a)){var o=new ct;return o.setFromTransformedAABB(a,r),o}}return this.getBounds()},n}(At),tm=["style"],rm=function(e){Ie(n,e);function n(i){var t=i===void 0?{}:i,r=t.style,a=vr(t,tm);return e.call(this,pe({type:H.IMAGE,style:X.enableCSSParsing?pe({x:"",y:"",img:"",width:"",height:""},r):pe({},r)},a))||this}return n}(At),nm=["style"],Vc=function(e){Ie(n,e);function n(t){var r,a=t===void 0?{}:t,o=a.style,s=vr(a,nm);r=e.call(this,pe({type:H.LINE,style:pe({x1:0,y1:0,x2:0,y2:0,z1:0,z2:0,isBillboard:!1},o)},s))||this,r.markerStartAngle=0,r.markerEndAngle=0;var u=r.parsedStyle,l=u.markerStart,f=u.markerEnd;return l&&Pe(l)&&(r.markerStartAngle=l.getLocalEulerAngles(),r.appendChild(l)),f&&Pe(f)&&(r.markerEndAngle=f.getLocalEulerAngles(),r.appendChild(f)),r.transformMarker(!0),r.transformMarker(!1),r}var i=n.prototype;return i.attributeChangedCallback=function(r,a,o,s,u){r==="x1"||r==="y1"||r==="x2"||r==="y2"||r==="markerStartOffset"||r==="markerEndOffset"?(this.transformMarker(!0),this.transformMarker(!1)):r==="markerStart"?(s&&Pe(s)&&(this.markerStartAngle=0,s.remove()),u&&Pe(u)&&(this.markerStartAngle=u.getLocalEulerAngles(),this.appendChild(u),this.transformMarker(!0))):r==="markerEnd"&&(s&&Pe(s)&&(this.markerEndAngle=0,s.remove()),u&&Pe(u)&&(this.markerEndAngle=u.getLocalEulerAngles(),this.appendChild(u),this.transformMarker(!1)))},i.transformMarker=function(r){var a=this.parsedStyle,o=a.markerStart,s=a.markerEnd,u=a.markerStartOffset,l=a.markerEndOffset,f=a.x1,c=a.x2,h=a.y1,p=a.y2,g=a.defX,_=a.defY,E=r?o:s;if(!(!E||!Pe(E))){var y=0,R,A,M,x,P,C;r?(M=f-g,x=h-_,R=c-f,A=p-h,P=u||0,C=this.markerStartAngle):(M=c-g,x=p-_,R=f-c,A=h-p,P=l||0,C=this.markerEndAngle),y=Math.atan2(A,R),E.setLocalEulerAngles(y*180/Math.PI+C),E.setLocalPosition(M+Math.cos(y)*P,x+Math.sin(y)*P)}},i.getPoint=function(r,a){a===void 0&&(a=!1);var o=this.parsedStyle,s=o.x1,u=o.y1,l=o.x2,f=o.y2,c=o.defX,h=o.defY,p=zt.pointAt(s,u,l,f,r),g=p.x,_=p.y,E=It(Re(),me(g-c,_-h,0),a?this.getWorldTransform():this.getLocalTransform());return new ht(E[0],E[1])},i.getPointAtLength=function(r,a){return a===void 0&&(a=!1),this.getPoint(r/this.getTotalLength(),a)},i.getTotalLength=function(){var r=this.parsedStyle,a=r.x1,o=r.y1,s=r.x2,u=r.y2;return zt.length(a,o,s,u)},n}(At),im=["style"],Yc={absolutePath:[],hasArc:!1,segments:[],polygons:[],polylines:[],curve:null,totalLength:0,rect:new Rn(0,0,0,0)},am=function(e){Ie(n,e);function n(t){var r,a=t===void 0?{}:t,o=a.style,s=vr(a,im);r=e.call(this,pe({type:H.PATH,style:X.enableCSSParsing?pe({path:"",miterLimit:""},o):pe({},o),initialParsedStyle:X.enableCSSParsing?null:{miterLimit:4,path:pe({},Yc)}},s))||this,r.markerStartAngle=0,r.markerEndAngle=0,r.markerMidList=[];var u=r.parsedStyle,l=u.markerStart,f=u.markerEnd,c=u.markerMid;return l&&Pe(l)&&(r.markerStartAngle=l.getLocalEulerAngles(),r.appendChild(l)),c&&Pe(c)&&r.placeMarkerMid(c),f&&Pe(f)&&(r.markerEndAngle=f.getLocalEulerAngles(),r.appendChild(f)),r.transformMarker(!0),r.transformMarker(!1),r}var i=n.prototype;return i.attributeChangedCallback=function(r,a,o,s,u){r==="path"?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):r==="markerStartOffset"||r==="markerEndOffset"?(this.transformMarker(!0),this.transformMarker(!1)):r==="markerStart"?(s&&Pe(s)&&(this.markerStartAngle=0,s.remove()),u&&Pe(u)&&(this.markerStartAngle=u.getLocalEulerAngles(),this.appendChild(u),this.transformMarker(!0))):r==="markerEnd"?(s&&Pe(s)&&(this.markerEndAngle=0,s.remove()),u&&Pe(u)&&(this.markerEndAngle=u.getLocalEulerAngles(),this.appendChild(u),this.transformMarker(!1))):r==="markerMid"&&this.placeMarkerMid(u)},i.transformMarker=function(r){var a=this.parsedStyle,o=a.markerStart,s=a.markerEnd,u=a.markerStartOffset,l=a.markerEndOffset,f=a.defX,c=a.defY,h=r?o:s;if(!(!h||!Pe(h))){var p=0,g,_,E,y,R,A;if(r){var M=this.getStartTangent(),x=M[0],P=M[1];E=P[0]-f,y=P[1]-c,g=x[0]-P[0],_=x[1]-P[1],R=u||0,A=this.markerStartAngle}else{var C=this.getEndTangent(),O=C[0],D=C[1];E=D[0]-f,y=D[1]-c,g=O[0]-D[0],_=O[1]-D[1],R=l||0,A=this.markerEndAngle}p=Math.atan2(_,g),h.setLocalEulerAngles(p*180/Math.PI+A),h.setLocalPosition(E+Math.cos(p)*R,y+Math.sin(p)*R)}},i.placeMarkerMid=function(r){var a=this.parsedStyle,o=a.path.segments,s=a.defX,u=a.defY;if(this.markerMidList.forEach(function(g){g.remove()}),r&&Pe(r))for(var l=1;l<o.length-1;l++){var f=o[l].currentPoint,c=f[0],h=f[1],p=l===1?r:r.cloneNode(!0);this.markerMidList.push(p),this.appendChild(p),p.setLocalPosition(c-s,h-u)}},i.getTotalLength=function(){return Al(this)},i.getPointAtLength=function(r,a){a===void 0&&(a=!1);var o=this.parsedStyle,s=o.defX,u=o.defY,l=o.path.absolutePath,f=qv(l,r),c=f.x,h=f.y,p=It(Re(),me(c-s,h-u,0),a?this.getWorldTransform():this.getLocalTransform());return new ht(p[0],p[1])},i.getPoint=function(r,a){return a===void 0&&(a=!1),this.getPointAtLength(r*Al(this),a)},i.getStartTangent=function(){var r=this.parsedStyle.path.segments,a=[];if(r.length>1){var o=r[0].currentPoint,s=r[1].currentPoint,u=r[1].startTangent;a=[],u?(a.push([o[0]-u[0],o[1]-u[1]]),a.push([o[0],o[1]])):(a.push([s[0],s[1]]),a.push([o[0],o[1]]))}return a},i.getEndTangent=function(){var r=this.parsedStyle.path.segments,a=r.length,o=[];if(a>1){var s=r[a-2].currentPoint,u=r[a-1].currentPoint,l=r[a-1].endTangent;o=[],l?(o.push([u[0]-l[0],u[1]-l[1]]),o.push([u[0],u[1]])):(o.push([s[0],s[1]]),o.push([u[0],u[1]]))}return o},n}(At),om=["style"],zc=function(e){Ie(n,e);function n(t){var r,a=t===void 0?{}:t,o=a.style,s=vr(a,om);r=e.call(this,pe({type:H.POLYGON,style:X.enableCSSParsing?pe({points:"",miterLimit:"",isClosed:!0},o):pe({},o),initialParsedStyle:X.enableCSSParsing?null:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!0}},s))||this,r.markerStartAngle=0,r.markerEndAngle=0,r.markerMidList=[];var u=r.parsedStyle,l=u.markerStart,f=u.markerEnd,c=u.markerMid;return l&&Pe(l)&&(r.markerStartAngle=l.getLocalEulerAngles(),r.appendChild(l)),c&&Pe(c)&&r.placeMarkerMid(c),f&&Pe(f)&&(r.markerEndAngle=f.getLocalEulerAngles(),r.appendChild(f)),r.transformMarker(!0),r.transformMarker(!1),r}var i=n.prototype;return i.attributeChangedCallback=function(r,a,o,s,u){r==="points"?(this.transformMarker(!0),this.transformMarker(!1),this.placeMarkerMid(this.parsedStyle.markerMid)):r==="markerStartOffset"||r==="markerEndOffset"?(this.transformMarker(!0),this.transformMarker(!1)):r==="markerStart"?(s&&Pe(s)&&(this.markerStartAngle=0,s.remove()),u&&Pe(u)&&(this.markerStartAngle=u.getLocalEulerAngles(),this.appendChild(u),this.transformMarker(!0))):r==="markerEnd"?(s&&Pe(s)&&(this.markerEndAngle=0,s.remove()),u&&Pe(u)&&(this.markerEndAngle=u.getLocalEulerAngles(),this.appendChild(u),this.transformMarker(!1))):r==="markerMid"&&this.placeMarkerMid(u)},i.transformMarker=function(r){var a=this.parsedStyle,o=a.markerStart,s=a.markerEnd,u=a.markerStartOffset,l=a.markerEndOffset,f=a.points.points,c=a.defX,h=a.defY,p=r?o:s;if(!(!p||!Pe(p))){var g=0,_,E,y,R,A,M;if(y=f[0][0]-c,R=f[0][1]-h,r)_=f[1][0]-f[0][0],E=f[1][1]-f[0][1],A=u||0,M=this.markerStartAngle;else{var x=f.length;this.parsedStyle.isClosed?(_=f[x-1][0]-f[0][0],E=f[x-1][1]-f[0][1]):(y=f[x-1][0]-c,R=f[x-1][1]-h,_=f[x-2][0]-f[x-1][0],E=f[x-2][1]-f[x-1][1]),A=l||0,M=this.markerEndAngle}g=Math.atan2(E,_),p.setLocalEulerAngles(g*180/Math.PI+M),p.setLocalPosition(y+Math.cos(g)*A,R+Math.sin(g)*A)}},i.placeMarkerMid=function(r){var a=this.parsedStyle,o=a.points.points,s=a.defX,u=a.defY;if(this.markerMidList.forEach(function(p){p.remove()}),this.markerMidList=[],r&&Pe(r))for(var l=1;l<(this.parsedStyle.isClosed?o.length:o.length-1);l++){var f=o[l][0]-s,c=o[l][1]-u,h=l===1?r:r.cloneNode(!0);this.markerMidList.push(h),this.appendChild(h),h.setLocalPosition(f,c)}},n}(At),sm=["style"],um=function(e){Ie(n,e);function n(t){var r=t===void 0?{}:t,a=r.style,o=vr(r,sm);return e.call(this,pe({type:H.POLYLINE,style:X.enableCSSParsing?pe({points:"",miterLimit:"",isClosed:!1},a):pe({},a),initialParsedStyle:X.enableCSSParsing?null:{points:{points:[],totalLength:0,segments:[]},miterLimit:4,isClosed:!1}},o))||this}var i=n.prototype;return i.getTotalLength=function(){return this.parsedStyle.points.totalLength},i.getPointAtLength=function(r,a){return a===void 0&&(a=!1),this.getPoint(r/this.getTotalLength(),a)},i.getPoint=function(r,a){a===void 0&&(a=!1);var o=this.parsedStyle,s=o.defX,u=o.defY,l=o.points,f=l.points,c=l.segments,h=0,p=0;c.forEach(function(R,A){r>=R[0]&&r<=R[1]&&(h=(r-R[0])/(R[1]-R[0]),p=A)});var g=zt.pointAt(f[p][0],f[p][1],f[p+1][0],f[p+1][1],h),_=g.x,E=g.y,y=It(Re(),me(_-s,E-u,0),a?this.getWorldTransform():this.getLocalTransform());return new ht(y[0],y[1])},i.getStartTangent=function(){var r=this.parsedStyle.points.points,a=[];return a.push([r[1][0],r[1][1]]),a.push([r[0][0],r[0][1]]),a},i.getEndTangent=function(){var r=this.parsedStyle.points.points,a=r.length-1,o=[];return o.push([r[a-1][0],r[a-1][1]]),o.push([r[a][0],r[a][1]]),o},n}(zc),lm=["style"],fm=function(e){Ie(n,e);function n(i){var t=i===void 0?{}:i,r=t.style,a=vr(t,lm);return e.call(this,pe({type:H.RECT,style:X.enableCSSParsing?pe({x:"",y:"",width:"",height:"",radius:""},r):pe({},r)},a))||this}return n}(At),cm=["style"],Gc=function(e){Ie(n,e);function n(t){var r=t===void 0?{}:t,a=r.style,o=vr(r,cm);return e.call(this,pe({type:H.TEXT,style:X.enableCSSParsing?pe({x:"",y:"",text:"",fontSize:"",fontFamily:"",fontStyle:"",fontWeight:"",fontVariant:"",textAlign:"",textBaseline:"",textTransform:"",fill:"black",letterSpacing:"",lineHeight:"",miterLimit:"",wordWrap:!1,wordWrapWidth:0,leading:0,dx:"",dy:""},a):pe({fill:"black"},a),initialParsedStyle:X.enableCSSParsing?{}:{x:0,y:0,fontSize:16,fontFamily:"sans-serif",fontStyle:"normal",fontWeight:"normal",fontVariant:"normal",lineHeight:0,letterSpacing:0,textBaseline:"alphabetic",textAlign:"start",wordWrap:!1,wordWrapWidth:0,leading:0,dx:0,dy:0}},o))||this}var i=n.prototype;return i.getComputedTextLength=function(){var r;return((r=this.parsedStyle.metrics)===null||r===void 0?void 0:r.maxLineWidth)||0},i.getLineBoundingRects=function(){var r;return((r=this.parsedStyle.metrics)===null||r===void 0?void 0:r.lineMetrics)||[]},i.isOverflowing=function(){return!!this.parsedStyle.isOverflowing},n}(At),hu=[{n:"display",k:["none"]},{n:"opacity",int:!0,inh:!0,d:"1",syntax:j.OPACITY_VALUE},{n:"fillOpacity",int:!0,inh:!0,d:"1",syntax:j.OPACITY_VALUE},{n:"strokeOpacity",int:!0,inh:!0,d:"1",syntax:j.OPACITY_VALUE},{n:"fill",int:!0,k:["none"],d:"none",syntax:j.PAINT},{n:"fillRule",k:["nonzero","evenodd"],d:"nonzero"},{n:"stroke",int:!0,k:["none"],d:"none",syntax:j.PAINT,l:!0},{n:"shadowType",k:["inner","outer","both"],d:"outer",l:!0},{n:"shadowColor",int:!0,syntax:j.COLOR},{n:"shadowOffsetX",int:!0,l:!0,d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"shadowOffsetY",int:!0,l:!0,d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"shadowBlur",int:!0,l:!0,d:"0",syntax:j.SHADOW_BLUR},{n:"lineWidth",int:!0,inh:!0,d:"1",l:!0,a:["strokeWidth"],syntax:j.LENGTH_PERCENTAGE},{n:"increasedLineWidthForHitTesting",inh:!0,d:"0",l:!0,syntax:j.LENGTH_PERCENTAGE},{n:"lineJoin",inh:!0,l:!0,a:["strokeLinejoin"],k:["miter","bevel","round"],d:"miter"},{n:"lineCap",inh:!0,l:!0,a:["strokeLinecap"],k:["butt","round","square"],d:"butt"},{n:"lineDash",int:!0,inh:!0,k:["none"],a:["strokeDasharray"],syntax:j.LENGTH_PERCENTAGE_12},{n:"lineDashOffset",int:!0,inh:!0,d:"0",a:["strokeDashoffset"],syntax:j.LENGTH_PERCENTAGE},{n:"offsetPath",syntax:j.DEFINED_PATH},{n:"offsetDistance",int:!0,syntax:j.OFFSET_DISTANCE},{n:"dx",int:!0,l:!0,d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"dy",int:!0,l:!0,d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"zIndex",ind:!0,int:!0,d:"0",k:["auto"],syntax:j.Z_INDEX},{n:"visibility",k:["visible","hidden"],ind:!0,inh:!0,int:!0,d:"visible"},{n:"pointerEvents",inh:!0,k:["none","auto","stroke","fill","painted","visible","visiblestroke","visiblefill","visiblepainted","all"],d:"auto"},{n:"filter",ind:!0,l:!0,k:["none"],d:"none",syntax:j.FILTER},{n:"clipPath",syntax:j.DEFINED_PATH},{n:"textPath",syntax:j.DEFINED_PATH},{n:"textPathSide",k:["left","right"],d:"left"},{n:"textPathStartOffset",l:!0,d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"transform",p:100,int:!0,k:["none"],d:"none",syntax:j.TRANSFORM},{n:"transformOrigin",p:100,d:function(n){return n===H.CIRCLE||n===H.ELLIPSE?"center":n===H.TEXT?"text-anchor":"left top"},l:!0,syntax:j.TRANSFORM_ORIGIN},{n:"anchor",p:99,d:function(n){return n===H.CIRCLE||n===H.ELLIPSE?"0.5 0.5":"0 0"},l:!0,syntax:j.LENGTH_PERCENTAGE_12},{n:"cx",int:!0,d:"0",syntax:j.COORDINATE},{n:"cy",int:!0,d:"0",syntax:j.COORDINATE},{n:"r",int:!0,l:!0,d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"rx",int:!0,l:!0,d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"ry",int:!0,l:!0,d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"x",int:!0,d:"0",syntax:j.COORDINATE},{n:"y",int:!0,d:"0",syntax:j.COORDINATE},{n:"z",int:!0,d:"0",syntax:j.COORDINATE},{n:"width",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"height",int:!0,l:!0,k:["auto","fit-content","min-content","max-content"],d:"0",syntax:j.LENGTH_PERCENTAGE},{n:"radius",int:!0,l:!0,d:"0",syntax:j.LENGTH_PERCENTAGE_14},{n:"x1",int:!0,l:!0,syntax:j.COORDINATE},{n:"y1",int:!0,l:!0,syntax:j.COORDINATE},{n:"z1",int:!0,l:!0,syntax:j.COORDINATE},{n:"x2",int:!0,l:!0,syntax:j.COORDINATE},{n:"y2",int:!0,l:!0,syntax:j.COORDINATE},{n:"z2",int:!0,l:!0,syntax:j.COORDINATE},{n:"path",int:!0,l:!0,d:"",a:["d"],syntax:j.PATH,p:50},{n:"points",int:!0,l:!0,syntax:j.LIST_OF_POINTS,p:50},{n:"text",l:!0,d:"",syntax:j.TEXT,p:50},{n:"textTransform",l:!0,inh:!0,k:["capitalize","uppercase","lowercase","none"],d:"none",syntax:j.TEXT_TRANSFORM,p:51},{n:"font",l:!0},{n:"fontSize",int:!0,inh:!0,d:"16px",l:!0,syntax:j.LENGTH_PERCENTAGE},{n:"fontFamily",l:!0,inh:!0,d:"sans-serif"},{n:"fontStyle",l:!0,inh:!0,k:["normal","italic","oblique"],d:"normal"},{n:"fontWeight",l:!0,inh:!0,k:["normal","bold","bolder","lighter"],d:"normal"},{n:"fontVariant",l:!0,inh:!0,k:["normal","small-caps"],d:"normal"},{n:"lineHeight",l:!0,syntax:j.LENGTH,int:!0,d:"0"},{n:"letterSpacing",l:!0,syntax:j.LENGTH,int:!0,d:"0"},{n:"miterLimit",l:!0,syntax:j.NUMBER,d:function(n){return n===H.PATH||n===H.POLYGON||n===H.POLYLINE?"4":"10"}},{n:"wordWrap",l:!0},{n:"wordWrapWidth",l:!0},{n:"maxLines",l:!0},{n:"textOverflow",l:!0,d:"clip"},{n:"leading",l:!0},{n:"textBaseline",l:!0,inh:!0,k:["top","hanging","middle","alphabetic","ideographic","bottom"],d:"alphabetic"},{n:"textAlign",l:!0,inh:!0,k:["start","center","middle","end","left","right"],d:"start"},{n:"markerStart",syntax:j.MARKER},{n:"markerEnd",syntax:j.MARKER},{n:"markerMid",syntax:j.MARKER},{n:"markerStartOffset",syntax:j.LENGTH,l:!0,int:!0,d:"0"},{n:"markerEndOffset",syntax:j.LENGTH,l:!0,int:!0,d:"0"}],Ll=hu.filter(function(e){return!!e.l}).map(function(e){return e.n}),zr={},bn=new WeakMap,hm=function(n,i){var t=bn.get(n);return!t||t.length===0?!0:t.includes(i)},dm=function(){function e(){var i=this;hu.forEach(function(t){i.registerMetadata(t)})}var n=e.prototype;return n.registerMetadata=function(t){[t.n].concat(t.a||[]).forEach(function(r){zr[r]=t})},n.unregisterMetadata=function(t){delete zr[t]},n.getPropertySyntax=function(t){return X.CSSPropertySyntaxFactory[t]},n.processProperties=function(t,r,a){var o=this;if(a===void 0&&(a={skipUpdateAttribute:!1,skipParse:!1,forceUpdateGeometry:!1,usedAttributes:[]}),!X.enableCSSParsing){Object.assign(t.attributes,r);var s=Object.keys(r),u=t.parsedStyle.clipPath,l=t.parsedStyle.offsetPath;t.parsedStyle=Object.assign(t.parsedStyle,r);var f=!!a.forceUpdateGeometry;if(!f){for(var c=0;c<Ll.length;c++)if(Ll[c]in r){f=!0;break}}r.fill&&(t.parsedStyle.fill=ir(r.fill)),r.stroke&&(t.parsedStyle.stroke=ir(r.stroke)),r.shadowColor&&(t.parsedStyle.shadowColor=ir(r.shadowColor)),r.filter&&(t.parsedStyle.filter=bc(r.filter)),ae(r.radius)||(t.parsedStyle.radius=Uo(r.radius,4)),ae(r.lineDash)||(t.parsedStyle.lineDash=Uo(r.lineDash,2)),r.points&&(t.parsedStyle.points=Uc(r.points,t)),r.path===""&&(t.parsedStyle.path=pe({},Yc)),r.path&&(t.parsedStyle.path=Wa(r.path,t)),r.textTransform&&X.CSSPropertySyntaxFactory["<text-transform>"].calculator(null,null,{value:r.textTransform},t,null),r.clipPath&&X.CSSPropertySyntaxFactory["<defined-path>"].calculator("clipPath",u,r.clipPath,t,this),r.offsetPath&&X.CSSPropertySyntaxFactory["<defined-path>"].calculator("offsetPath",l,r.offsetPath,t,this),r.anchor&&(t.parsedStyle.anchor=Uo(r.anchor,2)),r.transform&&(t.parsedStyle.transform=Ii(r.transform)),r.transformOrigin&&(t.parsedStyle.transformOrigin=kc(r.transformOrigin)),r.markerStart&&(t.parsedStyle.markerStart=X.CSSPropertySyntaxFactory["<marker>"].calculator(null,r.markerStart,r.markerStart,null,null)),r.markerEnd&&(t.parsedStyle.markerEnd=X.CSSPropertySyntaxFactory["<marker>"].calculator(null,r.markerEnd,r.markerEnd,null,null)),r.markerMid&&(t.parsedStyle.markerMid=X.CSSPropertySyntaxFactory["<marker>"].calculator("",r.markerMid,r.markerMid,null,null)),((t.nodeName===H.CIRCLE||t.nodeName===H.ELLIPSE)&&(!ae(r.cx)||!ae(r.cy))||(t.nodeName===H.RECT||t.nodeName===H.IMAGE||t.nodeName===H.GROUP||t.nodeName===H.HTML||t.nodeName===H.TEXT||t.nodeName===H.MESH)&&(!ae(r.x)||!ae(r.y)||!ae(r.z))||t.nodeName===H.LINE&&(!ae(r.x1)||!ae(r.y1)||!ae(r.z1)||!ae(r.x2)||!ae(r.y2)||!ae(r.z2)))&&X.CSSPropertySyntaxFactory["<coordinate>"].postProcessor(t,s),ae(r.zIndex)||X.CSSPropertySyntaxFactory["<z-index>"].postProcessor(t,s),r.path&&X.CSSPropertySyntaxFactory["<path>"].postProcessor(t,s),r.points&&X.CSSPropertySyntaxFactory["<list-of-points>"].postProcessor(t,s),ae(r.offsetDistance)||X.CSSPropertySyntaxFactory["<offset-distance>"].postProcessor(t,s),r.transform&&X.CSSPropertySyntaxFactory["<transform>"].postProcessor(t,s),f&&this.updateGeometry(t);return}var h=a,p=h.skipUpdateAttribute,g=h.skipParse,_=h.forceUpdateGeometry,E=h.usedAttributes,y=_,R=Object.keys(r);R.forEach(function(A){var M;p||(t.attributes[A]=r[A]),!y&&(!((M=zr[A])===null||M===void 0)&&M.l)&&(y=!0)}),g||R.forEach(function(A){t.computedStyle[A]=o.parseProperty(A,t.attributes[A],t)}),E!=null&&E.length&&(R=Array.from(new Set(R.concat(E)))),R.forEach(function(A){A in t.computedStyle&&(t.parsedStyle[A]=o.computeProperty(A,t.computedStyle[A],t))}),y&&this.updateGeometry(t),R.forEach(function(A){A in t.parsedStyle&&o.postProcessProperty(A,t,R)}),X.enableCSSParsing&&t.children.length&&R.forEach(function(A){A in t.parsedStyle&&o.isPropertyInheritable(A)&&t.children.forEach(function(M){M.internalSetAttribute(A,null,{skipUpdateAttribute:!0,skipParse:!0})})})},n.parseProperty=function(t,r,a){var o=zr[t],s=r;if((r===""||ae(r))&&(r="unset"),r==="unset"||r==="initial"||r==="inherit")s=hs(r);else if(o){var u=o.k,l=o.syntax,f=l&&this.getPropertySyntax(l);u&&u.indexOf(r)>-1?s=hs(r):f&&f.parser&&(s=f.parser(r,a))}return s},n.computeProperty=function(t,r,a){var o=zr[t],s=a.id==="g-root",u=r;if(o){var l=o.syntax,f=o.inh,c=o.d;if(r instanceof kt){var h=r.value;if(h==="unset"&&(f&&!s?h="inherit":h="initial"),h==="initial")ae(c)||(r=this.parseProperty(t,Fn(c)?c(a.nodeName):c,a));else if(h==="inherit"){var p=this.tryToResolveProperty(a,t,{inherited:!0});if(ae(p)){this.addUnresolveProperty(a,t);return}else return p}}var g=l&&this.getPropertySyntax(l);if(g&&g.calculator){var _=a.parsedStyle[t];u=g.calculator(t,_,r,a,this)}else r instanceof kt?u=r.value:u=r}return u},n.postProcessProperty=function(t,r,a){var o=zr[t];if(o&&o.syntax){var s=o.syntax&&this.getPropertySyntax(o.syntax),u=s;u&&u.postProcessor&&u.postProcessor(r,a)}},n.addUnresolveProperty=function(t,r){var a=bn.get(t);a||(bn.set(t,[]),a=bn.get(t)),a.indexOf(r)===-1&&a.push(r)},n.tryToResolveProperty=function(t,r,a){a===void 0&&(a={});var o=a,s=o.inherited;if(s&&t.parentElement&&hm(t.parentElement,r)){var u=t.parentElement.parsedStyle[r];return u==="unset"||u==="initial"||u==="inherit"?void 0:u}},n.recalc=function(t){var r=bn.get(t);if(r&&r.length){var a={};r.forEach(function(o){a[o]=t.attributes[o]}),this.processProperties(t,a),bn.delete(t)}},n.updateGeometry=function(t){var r=t.nodeName,a=X.geometryUpdaterFactory[r];if(a){var o=t.geometry;o.contentBounds||(o.contentBounds=new ct),o.renderBounds||(o.renderBounds=new ct);var s=t.parsedStyle,u=a.update(s,t),l=u.width,f=u.height,c=u.depth,h=c===void 0?0:c,p=u.offsetX,g=p===void 0?0:p,_=u.offsetY,E=_===void 0?0:_,y=u.offsetZ,R=y===void 0?0:y,A=[Math.abs(l)/2,Math.abs(f)/2,h/2],M=s.stroke,x=s.lineWidth,P=s.increasedLineWidthForHitTesting,C=s.shadowType,O=s.shadowColor,D=s.filter,F=D===void 0?[]:D,k=s.transformOrigin,d=s.anchor;r===H.TEXT&&delete s.anchor;var v=[(1-(d&&d[0]||0)*2)*l/2+g,(1-(d&&d[1]||0)*2)*f/2+E,(1-(d&&d[2]||0)*2)*A[2]+R];o.contentBounds.update(v,A);var m=r===H.POLYLINE||r===H.POLYGON||r===H.PATH?Math.SQRT2:.5,S=M&&!M.isNone;if(S){var T=((x||0)+(P||0))*m;A[0]+=T,A[1]+=T}if(o.renderBounds.update(v,A),O&&C&&C!=="inner"){var N=o.renderBounds,B=N.min,w=N.max,U=s.shadowBlur,V=s.shadowOffsetX,K=s.shadowOffsetY,z=U||0,le=V||0,Se=K||0,Ae=B[0]-z+le,ge=w[0]+z+le,ye=B[1]-z+Se,ve=w[1]+z+Se;B[0]=Math.min(B[0],Ae),w[0]=Math.max(w[0],ge),B[1]=Math.min(B[1],ye),w[1]=Math.max(w[1],ve),o.renderBounds.setMinMax(B,w)}F.forEach(function(Tt){var ce=Tt.name,he=Tt.params;if(ce==="blur"){var Oe=he[0].value;o.renderBounds.update(o.renderBounds.center,Da(o.renderBounds.halfExtents,o.renderBounds.halfExtents,[Oe,Oe,0]))}else if(ce==="drop-shadow"){var ne=he[0].value,rt=he[1].value,ke=he[2].value,Ge=o.renderBounds,Kt=Ge.min,ur=Ge.max,ai=Kt[0]-ke+ne,lr=ur[0]+ke+ne,$t=Kt[1]-ke+rt,ln=ur[1]+ke+rt;Kt[0]=Math.min(Kt[0],ai),ur[0]=Math.max(ur[0],lr),Kt[1]=Math.min(Kt[1],$t),ur[1]=Math.max(ur[1],ln),o.renderBounds.setMinMax(Kt,ur)}}),d=s.anchor;var ie=l<0,we=f<0,Pt=(ie?-1:1)*(k?Ht(k[0],0,t):0),Je=(we?-1:1)*(k?Ht(k[1],1,t):0);Pt=Pt-(ie?-1:1)*(d&&d[0]||0)*o.contentBounds.halfExtents[0]*2,Je=Je-(we?-1:1)*(d&&d[1]||0)*o.contentBounds.halfExtents[1]*2,t.setOrigin(Pt,Je),X.sceneGraphService.dirtifyToRoot(t)}},n.isPropertyInheritable=function(t){var r=zr[t];return r?r.inh:!1},e}(),xe;(function(e){e[e.ORBITING=0]="ORBITING",e[e.EXPLORING=1]="EXPLORING",e[e.TRACKING=2]="TRACKING"})(xe||(xe={}));var Di;(function(e){e[e.DEFAULT=0]="DEFAULT",e[e.ROTATIONAL=1]="ROTATIONAL",e[e.TRANSLATIONAL=2]="TRANSLATIONAL",e[e.CINEMATIC=3]="CINEMATIC"})(Di||(Di={}));var Ct;(function(e){e[e.ORTHOGRAPHIC=0]="ORTHOGRAPHIC",e[e.PERSPECTIVE=1]="PERSPECTIVE"})(Ct||(Ct={}));var Kc={UPDATED:"updated"},Wl=2e-4,$c=function(){function e(){this.canvas=void 0,this.eventEmitter=new jn,this.matrix=Te(),this.right=me(1,0,0),this.up=me(0,1,0),this.forward=me(0,0,1),this.position=me(0,0,1),this.focalPoint=me(0,0,0),this.distanceVector=me(0,0,-1),this.distance=1,this.azimuth=0,this.elevation=0,this.roll=0,this.relAzimuth=0,this.relElevation=0,this.relRoll=0,this.dollyingStep=0,this.maxDistance=1/0,this.minDistance=-1/0,this.zoom=1,this.rotateWorld=!1,this.fov=30,this.near=.1,this.far=1e3,this.aspect=1,this.left=void 0,this.rright=void 0,this.top=void 0,this.bottom=void 0,this.projectionMatrix=Te(),this.projectionMatrixInverse=Te(),this.jitteredProjectionMatrix=void 0,this.view=void 0,this.enableUpdate=!0,this.type=xe.EXPLORING,this.trackingMode=Di.DEFAULT,this.projectionMode=Ct.PERSPECTIVE,this.frustum=new Ng,this.orthoMatrix=Te()}var n=e.prototype;return n.isOrtho=function(){return this.projectionMode===Ct.ORTHOGRAPHIC},n.getProjectionMode=function(){return this.projectionMode},n.getPerspective=function(){return this.jitteredProjectionMatrix||this.projectionMatrix},n.getPerspectiveInverse=function(){return this.projectionMatrixInverse},n.getFrustum=function(){return this.frustum},n.getPosition=function(){return this.position},n.getFocalPoint=function(){return this.focalPoint},n.getDollyingStep=function(){return this.dollyingStep},n.getNear=function(){return this.near},n.getFar=function(){return this.far},n.getZoom=function(){return this.zoom},n.getOrthoMatrix=function(){return this.orthoMatrix},n.getView=function(){return this.view},n.setEnableUpdate=function(t){this.enableUpdate=t},n.setType=function(t,r){return this.type=t,this.type===xe.EXPLORING?this.setWorldRotation(!0):this.setWorldRotation(!1),this._getAngles(),this.type===xe.TRACKING&&r!==void 0&&this.setTrackingMode(r),this},n.setProjectionMode=function(t){return this.projectionMode=t,this},n.setTrackingMode=function(t){if(this.type!==xe.TRACKING)throw new Error("Impossible to set a tracking mode if the camera is not of tracking type");return this.trackingMode=t,this},n.setWorldRotation=function(t){return this.rotateWorld=t,this._getAngles(),this},n.getViewTransform=function(){return Rr(Te(),this.matrix)},n.getWorldTransform=function(){return this.matrix},n.jitterProjectionMatrix=function(t,r){var a=Gn(Te(),[t,r,0]);this.jitteredProjectionMatrix=nr(Te(),a,this.projectionMatrix)},n.clearJitterProjectionMatrix=function(){this.jitteredProjectionMatrix=void 0},n.setMatrix=function(t){return this.matrix=t,this._update(),this},n.setFov=function(t){return this.setPerspective(this.near,this.far,t,this.aspect),this},n.setAspect=function(t){return this.setPerspective(this.near,this.far,this.fov,t),this},n.setNear=function(t){return this.projectionMode===Ct.PERSPECTIVE?this.setPerspective(t,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,t,this.far),this},n.setFar=function(t){return this.projectionMode===Ct.PERSPECTIVE?this.setPerspective(this.near,t,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,t),this},n.setViewOffset=function(t,r,a,o,s,u){return this.aspect=t/r,this.view===void 0&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=t,this.view.fullHeight=r,this.view.offsetX=a,this.view.offsetY=o,this.view.width=s,this.view.height=u,this.projectionMode===Ct.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},n.clearViewOffset=function(){return this.view!==void 0&&(this.view.enabled=!1),this.projectionMode===Ct.PERSPECTIVE?this.setPerspective(this.near,this.far,this.fov,this.aspect):this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far),this},n.setZoom=function(t){return this.zoom=t,this.projectionMode===Ct.ORTHOGRAPHIC?this.setOrthographic(this.left,this.rright,this.top,this.bottom,this.near,this.far):this.projectionMode===Ct.PERSPECTIVE&&this.setPerspective(this.near,this.far,this.fov,this.aspect),this},n.setZoomByViewportPoint=function(t,r){var a=this.canvas.viewport2Canvas({x:r[0],y:r[1]}),o=a.x,s=a.y,u=this.roll;this.rotate(0,0,-u),this.setPosition(o,s),this.setFocalPoint(o,s),this.setZoom(t),this.rotate(0,0,u);var l=this.canvas.viewport2Canvas({x:r[0],y:r[1]}),f=l.x,c=l.y,h=me(f-o,c-s,0),p=Sr(h,this.right)/Ur(this.right),g=Sr(h,this.up)/Ur(this.up);return this.pan(-p,-g),this},n.setPerspective=function(t,r,a,o){var s;this.projectionMode=Ct.PERSPECTIVE,this.fov=a,this.near=t,this.far=r,this.aspect=o;var u=this.near*Math.tan(Le(.5*this.fov))/this.zoom,l=2*u,f=this.aspect*l,c=-.5*f;if(!((s=this.view)===null||s===void 0)&&s.enabled){var h=this.view.fullWidth,p=this.view.fullHeight;c+=this.view.offsetX*f/h,u-=this.view.offsetY*l/p,f*=this.view.width/h,l*=this.view.height/p}return d0(this.projectionMatrix,c,c+f,u,u-l,t,this.far),Jo(this.projectionMatrix,this.projectionMatrix,me(1,-1,1)),Rr(this.projectionMatrixInverse,this.projectionMatrix),this.triggerUpdate(),this},n.setOrthographic=function(t,r,a,o,s,u){var l;this.projectionMode=Ct.ORTHOGRAPHIC,this.rright=r,this.left=t,this.top=a,this.bottom=o,this.near=s,this.far=u;var f=(this.rright-this.left)/(2*this.zoom),c=(this.top-this.bottom)/(2*this.zoom),h=(this.rright+this.left)/2,p=(this.top+this.bottom)/2,g=h-f,_=h+f,E=p+c,y=p-c;if(!((l=this.view)===null||l===void 0)&&l.enabled){var R=(this.rright-this.left)/this.view.fullWidth/this.zoom,A=(this.top-this.bottom)/this.view.fullHeight/this.zoom;g+=R*this.view.offsetX,_=g+R*this.view.width,E-=A*this.view.offsetY,y=E-A*this.view.height}return rc(this.projectionMatrix,g,_,y,E,s,u),Jo(this.projectionMatrix,this.projectionMatrix,me(1,-1,1)),Rr(this.projectionMatrixInverse,this.projectionMatrix),this._getOrthoMatrix(),this.triggerUpdate(),this},n.setPosition=function(t,r,a){r===void 0&&(r=this.position[1]),a===void 0&&(a=this.position[2]);var o=St(t,r,a);return this._setPosition(o),this.setFocalPoint(this.focalPoint),this.triggerUpdate(),this},n.setFocalPoint=function(t,r,a){r===void 0&&(r=this.focalPoint[1]),a===void 0&&(a=this.focalPoint[2]);var o=me(0,1,0);if(this.focalPoint=St(t,r,a),this.trackingMode===Di.CINEMATIC){var s=Xu(Re(),this.focalPoint,this.position);t=s[0],r=s[1],a=s[2];var u=Ur(s),l=tr(Math.asin(r/u)),f=90+tr(Math.atan2(a,t)),c=Te();Qf(c,c,Le(f)),Zf(c,c,Le(l)),o=It(Re(),[0,1,0],c)}return Rr(this.matrix,nc(Te(),this.position,this.focalPoint,o)),this._getAxes(),this._getDistance(),this._getAngles(),this.triggerUpdate(),this},n.getDistance=function(){return this.distance},n.getDistanceVector=function(){return this.distanceVector},n.setDistance=function(t){if(this.distance===t||t<0)return this;this.distance=t,this.distance<Wl&&(this.distance=Wl),this.dollyingStep=this.distance/100;var r=Re();t=this.distance;var a=this.forward,o=this.focalPoint;return r[0]=t*a[0]+o[0],r[1]=t*a[1]+o[1],r[2]=t*a[2]+o[2],this._setPosition(r),this.triggerUpdate(),this},n.setMaxDistance=function(t){return this.maxDistance=t,this},n.setMinDistance=function(t){return this.minDistance=t,this},n.setAzimuth=function(t){return this.azimuth=Vn(t),this.computeMatrix(),this._getAxes(),this.type===xe.ORBITING||this.type===xe.EXPLORING?this._getPosition():this.type===xe.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},n.getAzimuth=function(){return this.azimuth},n.setElevation=function(t){return this.elevation=Vn(t),this.computeMatrix(),this._getAxes(),this.type===xe.ORBITING||this.type===xe.EXPLORING?this._getPosition():this.type===xe.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},n.getElevation=function(){return this.elevation},n.setRoll=function(t){return this.roll=Vn(t),this.computeMatrix(),this._getAxes(),this.type===xe.ORBITING||this.type===xe.EXPLORING?this._getPosition():this.type===xe.TRACKING&&this._getFocalPoint(),this.triggerUpdate(),this},n.getRoll=function(){return this.roll},n._update=function(){this._getAxes(),this._getPosition(),this._getDistance(),this._getAngles(),this._getOrthoMatrix(),this.triggerUpdate()},n.computeMatrix=function(){var t=jr(qe(),[0,0,1],Le(this.roll));Xi(this.matrix);var r=jr(qe(),[1,0,0],Le((this.rotateWorld&&this.type!==xe.TRACKING||this.type===xe.TRACKING?1:-1)*this.elevation)),a=jr(qe(),[0,1,0],Le((this.rotateWorld&&this.type!==xe.TRACKING||this.type===xe.TRACKING?1:-1)*this.azimuth)),o=tn(qe(),a,r);o=tn(qe(),o,t);var s=au(Te(),o);this.type===xe.ORBITING||this.type===xe.EXPLORING?(Ln(this.matrix,this.matrix,this.focalPoint),nr(this.matrix,this.matrix,s),Ln(this.matrix,this.matrix,[0,0,this.distance])):this.type===xe.TRACKING&&(Ln(this.matrix,this.matrix,this.position),nr(this.matrix,this.matrix,s))},n._setPosition=function(t,r,a){this.position=St(t,r,a);var o=this.matrix;o[12]=this.position[0],o[13]=this.position[1],o[14]=this.position[2],o[15]=1,this._getOrthoMatrix()},n._getAxes=function(){Dt(this.right,St(gn(Jr(),[1,0,0,0],this.matrix))),Dt(this.up,St(gn(Jr(),[0,1,0,0],this.matrix))),Dt(this.forward,St(gn(Jr(),[0,0,1,0],this.matrix))),En(this.right,this.right),En(this.up,this.up),En(this.forward,this.forward)},n._getAngles=function(){var t=this.distanceVector[0],r=this.distanceVector[1],a=this.distanceVector[2],o=Ur(this.distanceVector);if(o===0){this.elevation=0,this.azimuth=0;return}this.type===xe.TRACKING?(this.elevation=tr(Math.asin(r/o)),this.azimuth=tr(Math.atan2(-t,-a))):this.rotateWorld?(this.elevation=tr(Math.asin(r/o)),this.azimuth=tr(Math.atan2(-t,-a))):(this.elevation=-tr(Math.asin(r/o)),this.azimuth=-tr(Math.atan2(-t,-a)))},n._getPosition=function(){Dt(this.position,St(gn(Jr(),[0,0,0,1],this.matrix))),this._getDistance()},n._getFocalPoint=function(){vv(this.distanceVector,[0,0,-this.distance],Wd(Kf(),this.matrix)),Wn(this.focalPoint,this.position,this.distanceVector),this._getDistance()},n._getDistance=function(){this.distanceVector=Xu(Re(),this.focalPoint,this.position),this.distance=Ur(this.distanceVector),this.dollyingStep=this.distance/100},n._getOrthoMatrix=function(){if(this.projectionMode===Ct.ORTHOGRAPHIC){var t=this.position,r=jr(qe(),[0,0,1],-this.roll*Math.PI/180);Si(this.orthoMatrix,r,me((this.rright-this.left)/2-t[0],(this.top-this.bottom)/2-t[1],0),me(this.zoom,this.zoom,1),t)}},n.triggerUpdate=function(){if(this.enableUpdate){var t=this.getViewTransform(),r=nr(Te(),this.getPerspective(),t);this.getFrustum().extractFromVPMatrix(r),this.eventEmitter.emit(Kc.UPDATED)}},n.rotate=function(t,r,a){throw new Error(Ce)},n.pan=function(t,r){throw new Error(Ce)},n.dolly=function(t){throw new Error(Ce)},n.createLandmark=function(t,r){throw new Error(Ce)},n.gotoLandmark=function(t,r){throw new Error(Ce)},n.cancelLandmarkAnimation=function(){throw new Error(Ce)},e}(),vm=function(){function e(){}var n=e.prototype;return n.update=function(t,r){var a=t.r,o=a*2,s=a*2;return{width:o,height:s}},e}(),pm=function(){function e(){}var n=e.prototype;return n.update=function(t,r){var a=t.rx,o=t.ry,s=a*2,u=o*2;return{width:s,height:u}},e}(),gm=function(){function e(){}var n=e.prototype;return n.update=function(t){var r=t.x1,a=t.y1,o=t.x2,s=t.y2,u=Math.min(r,o),l=Math.max(r,o),f=Math.min(a,s),c=Math.max(a,s),h=l-u,p=c-f;return{width:h,height:p}},e}(),mm=function(){function e(){}var n=e.prototype;return n.update=function(t){var r=t.path,a=r.rect,o=a.width,s=a.height;return{width:o,height:s}},e}(),_m=function(){function e(){}var n=e.prototype;return n.update=function(t){var r=t.points.points,a=Math.min.apply(Math,r.map(function(c){return c[0]})),o=Math.max.apply(Math,r.map(function(c){return c[0]})),s=Math.min.apply(Math,r.map(function(c){return c[1]})),u=Math.max.apply(Math,r.map(function(c){return c[1]})),l=o-a,f=u-s;return{width:l,height:f}},e}(),Em=function(){function e(){}var n=e.prototype;return n.update=function(t,r){var a=t.img,o=t.width,s=o===void 0?0:o,u=t.height,l=u===void 0?0:u,f=s,c=l;return a&&!vt(a)&&(f||(f=a.width,t.width=f),c||(c=a.height,t.height=c)),{width:f,height:c}},e}(),ym=function(){function e(i){this.globalRuntime=void 0,this.globalRuntime=i}var n=e.prototype;return n.isReadyToMeasure=function(t,r){var a=t.text,o=t.textAlign,s=t.textBaseline,u=t.fontSize,l=t.fontStyle,f=t.fontWeight,c=t.fontVariant,h=t.lineWidth;return a&&u&&l&&f&&c&&o&&s&&!ae(h)},n.update=function(t,r){var a,o,s=t.text,u=t.textAlign,l=t.lineWidth,f=t.textBaseline,c=t.dx,h=t.dy,p=(r==null||(a=r.ownerDocument)===null||a===void 0||(o=a.defaultView)===null||o===void 0?void 0:o.getConfig())||{},g=p.offscreenCanvas;if(!this.isReadyToMeasure(t,r))return t.metrics={font:"",width:0,height:0,lines:[],lineWidths:[],lineHeight:0,maxLineWidth:0,fontProperties:{ascent:0,descent:0,fontSize:0},lineMetrics:[]},{width:0,height:0,x:0,y:0,offsetX:0,offsetY:0};var _=this.globalRuntime.textService.measureText(s,t,g);t.metrics=_;var E=_.width,y=_.height,R=_.lineHeight,A=_.fontProperties,M=[E/2,y/2,0],x=[0,1],P=0;u==="center"||u==="middle"?(P=l/2,x=[.5,1]):(u==="right"||u==="end")&&(P=l,x=[1,1]);var C=0;return f==="middle"?C=M[1]:f==="top"||f==="hanging"?C=M[1]*2:f==="alphabetic"?C=X.enableCSSParsing?R-A.ascent:0:(f==="bottom"||f==="ideographic")&&(C=0),c&&(P+=c),h&&(C+=h),t.anchor=[x[0],x[1],0],{width:M[0]*2,height:M[1]*2,offsetX:P,offsetY:C}},e}(),Tm=2048,Rm=function(){function e(i,t){var r=this;this.globalRuntime=void 0,this.context=void 0,this.rootTarget=void 0,this.emitter=new jn,this.cursor="default",this.mappingTable={},this.mappingState={trackingData:{}},this.eventPool=new Map,this.pickHandler=void 0,this.tmpMatrix=Te(),this.tmpVec3=Re(),this.onPointerDown=function(a){var o=r.createPointerEvent(a);if(r.dispatchEvent(o,"pointerdown"),o.pointerType==="touch")r.dispatchEvent(o,"touchstart");else if(o.pointerType==="mouse"||o.pointerType==="pen"){var s=o.button===2;r.dispatchEvent(o,s?"rightdown":"mousedown")}var u=r.trackingData(a.pointerId);u.pressTargetsByButton[a.button]=o.composedPath(),r.freeEvent(o)},this.onPointerUp=function(a){var o=performance.now(),s=r.createPointerEvent(a);if(r.dispatchEvent(s,"pointerup"),s.pointerType==="touch")r.dispatchEvent(s,"touchend");else if(s.pointerType==="mouse"||s.pointerType==="pen"){var u=s.button===2;r.dispatchEvent(s,u?"rightup":"mouseup")}var l=r.trackingData(a.pointerId),f=r.findMountedTarget(l.pressTargetsByButton[a.button]),c=f;if(f&&!s.composedPath().includes(f)){for(var h=f;h&&!s.composedPath().includes(h);){if(s.currentTarget=h,r.notifyTarget(s,"pointerupoutside"),s.pointerType==="touch")r.notifyTarget(s,"touchendoutside");else if(s.pointerType==="mouse"||s.pointerType==="pen"){var p=s.button===2;r.notifyTarget(s,p?"rightupoutside":"mouseupoutside")}Ye.isNode(h)&&(h=h.parentNode)}delete l.pressTargetsByButton[a.button],c=h}if(c){var g,_=r.clonePointerEvent(s,"click");_.target=c,_.path=[],l.clicksByButton[a.button]||(l.clicksByButton[a.button]={clickCount:0,target:_.target,timeStamp:o});var E=l.clicksByButton[a.button];E.target===_.target&&o-E.timeStamp<200?++E.clickCount:E.clickCount=1,E.target=_.target,E.timeStamp=o,_.detail=E.clickCount,!((g=s.detail)===null||g===void 0)&&g.preventClick||(!r.context.config.useNativeClickEvent&&(_.pointerType==="mouse"||_.pointerType==="touch")&&r.dispatchEvent(_,"click"),r.dispatchEvent(_,"pointertap")),r.freeEvent(_)}r.freeEvent(s)},this.onPointerMove=function(a){var o=r.createPointerEvent(a),s=o.pointerType==="mouse"||o.pointerType==="pen",u=r.trackingData(a.pointerId),l=r.findMountedTarget(u.overTargets);if(u.overTargets&&l!==o.target){var f=a.type==="mousemove"?"mouseout":"pointerout",c=r.createPointerEvent(a,f,l||void 0);if(r.dispatchEvent(c,"pointerout"),s&&r.dispatchEvent(c,"mouseout"),!o.composedPath().includes(l)){var h=r.createPointerEvent(a,"pointerleave",l||void 0);for(h.eventPhase=h.AT_TARGET;h.target&&!o.composedPath().includes(h.target);)h.currentTarget=h.target,r.notifyTarget(h),s&&r.notifyTarget(h,"mouseleave"),Ye.isNode(h.target)&&(h.target=h.target.parentNode);r.freeEvent(h)}r.freeEvent(c)}if(l!==o.target){var p=a.type==="mousemove"?"mouseover":"pointerover",g=r.clonePointerEvent(o,p);r.dispatchEvent(g,"pointerover"),s&&r.dispatchEvent(g,"mouseover");for(var _=l&&Ye.isNode(l)&&l.parentNode;_&&_!==(Ye.isNode(r.rootTarget)&&r.rootTarget.parentNode)&&_!==o.target;)_=_.parentNode;var E=!_||_===(Ye.isNode(r.rootTarget)&&r.rootTarget.parentNode);if(E){var y=r.clonePointerEvent(o,"pointerenter");for(y.eventPhase=y.AT_TARGET;y.target&&y.target!==l&&y.target!==(Ye.isNode(r.rootTarget)&&r.rootTarget.parentNode);)y.currentTarget=y.target,r.notifyTarget(y),s&&r.notifyTarget(y,"mouseenter"),Ye.isNode(y.target)&&(y.target=y.target.parentNode);r.freeEvent(y)}r.freeEvent(g)}r.dispatchEvent(o,"pointermove"),o.pointerType==="touch"&&r.dispatchEvent(o,"touchmove"),s&&(r.dispatchEvent(o,"mousemove"),r.cursor=r.getCursor(o.target)),u.overTargets=o.composedPath(),r.freeEvent(o)},this.onPointerOut=function(a){var o=r.trackingData(a.pointerId);if(o.overTargets){var s=a.pointerType==="mouse"||a.pointerType==="pen",u=r.findMountedTarget(o.overTargets),l=r.createPointerEvent(a,"pointerout",u||void 0);r.dispatchEvent(l),s&&r.dispatchEvent(l,"mouseout");var f=r.createPointerEvent(a,"pointerleave",u||void 0);for(f.eventPhase=f.AT_TARGET;f.target&&f.target!==(Ye.isNode(r.rootTarget)&&r.rootTarget.parentNode);)f.currentTarget=f.target,r.notifyTarget(f),s&&r.notifyTarget(f,"mouseleave"),Ye.isNode(f.target)&&(f.target=f.target.parentNode);o.overTargets=null,r.freeEvent(l),r.freeEvent(f)}r.cursor=null},this.onPointerOver=function(a){var o=r.trackingData(a.pointerId),s=r.createPointerEvent(a),u=s.pointerType==="mouse"||s.pointerType==="pen";r.dispatchEvent(s,"pointerover"),u&&r.dispatchEvent(s,"mouseover"),s.pointerType==="mouse"&&(r.cursor=r.getCursor(s.target));var l=r.clonePointerEvent(s,"pointerenter");for(l.eventPhase=l.AT_TARGET;l.target&&l.target!==(Ye.isNode(r.rootTarget)&&r.rootTarget.parentNode);)l.currentTarget=l.target,r.notifyTarget(l),u&&r.notifyTarget(l,"mouseenter"),Ye.isNode(l.target)&&(l.target=l.target.parentNode);o.overTargets=s.composedPath(),r.freeEvent(s),r.freeEvent(l)},this.onPointerUpOutside=function(a){var o=r.trackingData(a.pointerId),s=r.findMountedTarget(o.pressTargetsByButton[a.button]),u=r.createPointerEvent(a);if(s){for(var l=s;l;)u.currentTarget=l,r.notifyTarget(u,"pointerupoutside"),u.pointerType==="touch"||(u.pointerType==="mouse"||u.pointerType==="pen")&&r.notifyTarget(u,u.button===2?"rightupoutside":"mouseupoutside"),Ye.isNode(l)&&(l=l.parentNode);delete o.pressTargetsByButton[a.button]}r.freeEvent(u)},this.onWheel=function(a){var o=r.createWheelEvent(a);r.dispatchEvent(o),r.freeEvent(o)},this.onClick=function(a){if(r.context.config.useNativeClickEvent){var o=r.createPointerEvent(a);r.dispatchEvent(o),r.freeEvent(o)}},this.onPointerCancel=function(a){var o=r.createPointerEvent(a);r.dispatchEvent(o),r.freeEvent(o)},this.globalRuntime=i,this.context=t}var n=e.prototype;return n.init=function(){this.rootTarget=this.context.renderingContext.root.parentNode,this.addEventMapping("pointerdown",this.onPointerDown),this.addEventMapping("pointerup",this.onPointerUp),this.addEventMapping("pointermove",this.onPointerMove),this.addEventMapping("pointerout",this.onPointerOut),this.addEventMapping("pointerleave",this.onPointerOut),this.addEventMapping("pointercancel",this.onPointerCancel),this.addEventMapping("pointerover",this.onPointerOver),this.addEventMapping("pointerupoutside",this.onPointerUpOutside),this.addEventMapping("wheel",this.onWheel),this.addEventMapping("click",this.onClick)},n.destroy=function(){this.emitter.removeAllListeners(),this.mappingTable={},this.mappingState={},this.eventPool.clear()},n.client2Viewport=function(t){var r=this.context.contextService.getBoundingClientRect();return new ht(t.x-((r==null?void 0:r.left)||0),t.y-((r==null?void 0:r.top)||0))},n.viewport2Client=function(t){var r=this.context.contextService.getBoundingClientRect();return new ht(t.x+((r==null?void 0:r.left)||0),t.y+((r==null?void 0:r.top)||0))},n.viewport2Canvas=function(t){var r=t.x,a=t.y,o=this.rootTarget.defaultView,s=o.getCamera(),u=this.context.config,l=u.width,f=u.height,c=s.getPerspectiveInverse(),h=s.getWorldTransform(),p=nr(this.tmpMatrix,h,c),g=Br(this.tmpVec3,r/l*2-1,(1-a/f)*2-1,0);return It(g,g,p),new ht(g[0],g[1])},n.canvas2Viewport=function(t){var r=this.rootTarget.defaultView,a=r.getCamera(),o=a.getPerspective(),s=a.getViewTransform(),u=nr(this.tmpMatrix,o,s),l=Br(this.tmpVec3,t.x,t.y,0);It(this.tmpVec3,this.tmpVec3,u);var f=this.context.config,c=f.width,h=f.height;return new ht((l[0]+1)/2*c,(1-(l[1]+1)/2)*h)},n.setPickHandler=function(t){this.pickHandler=t},n.addEventMapping=function(t,r){this.mappingTable[t]||(this.mappingTable[t]=[]),this.mappingTable[t].push({fn:r,priority:0}),this.mappingTable[t].sort(function(a,o){return a.priority-o.priority})},n.mapEvent=function(t){if(this.rootTarget){var r=this.mappingTable[t.type];if(r)for(var a=0,o=r.length;a<o;a++)r[a].fn(t);else console.warn("[EventService]: Event mapping not defined for "+t.type)}},n.dispatchEvent=function(t,r,a){if(!a)t.propagationStopped=!1,t.propagationImmediatelyStopped=!1,this.propagate(t,r);else{t.eventPhase=t.AT_TARGET;var o=this.rootTarget.defaultView||null;t.currentTarget=o,this.notifyListeners(t,r)}this.emitter.emit(r||t.type,t)},n.propagate=function(t,r){if(t.target){var a=t.composedPath();t.eventPhase=t.CAPTURING_PHASE;for(var o=a.length-1;o>=1;o--)if(t.currentTarget=a[o],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return;if(t.eventPhase=t.AT_TARGET,t.currentTarget=t.target,this.notifyTarget(t,r),!(t.propagationStopped||t.propagationImmediatelyStopped)){var s=a.indexOf(t.currentTarget);t.eventPhase=t.BUBBLING_PHASE;for(var u=s+1;u<a.length;u++)if(t.currentTarget=a[u],this.notifyTarget(t,r),t.propagationStopped||t.propagationImmediatelyStopped)return}}},n.propagationPath=function(t){var r=[t],a=this.rootTarget.defaultView||null;if(a&&a===t)return r.unshift(a.document),r;for(var o=0;o<Tm&&t!==this.rootTarget;o++)Ye.isNode(t)&&t.parentNode&&(r.push(t.parentNode),t=t.parentNode);return a&&r.push(a),r},n.hitTest=function(t){var r=t.viewportX,a=t.viewportY,o=this.context.config,s=o.width,u=o.height;return r<0||a<0||r>s||a>u?null:this.pickHandler(t)||this.rootTarget||null},n.isNativeEventFromCanvas=function(t){var r,a=this.context.contextService.getDomElement(),o=(r=t.nativeEvent)===null||r===void 0?void 0:r.target;if(o){if(o===a)return!0;if(a&&a.contains)return a.contains(o)}return t.nativeEvent.composedPath?t.nativeEvent.composedPath().indexOf(a)>-1:!1},n.getExistedHTML=function(t){if(t.nativeEvent.composedPath)for(var r=Bn(t.nativeEvent.composedPath()),a;!(a=r()).done;){var o=a.value,s=X.nativeHTMLMap.get(o);if(s)return s}return null},n.pickTarget=function(t){return this.hitTest({clientX:t.clientX,clientY:t.clientY,viewportX:t.viewportX,viewportY:t.viewportY,x:t.canvasX,y:t.canvasY})},n.createPointerEvent=function(t,r,a){var o=this.allocateEvent(_s);this.copyPointerData(t,o),this.copyMouseData(t,o),this.copyData(t,o),o.nativeEvent=t.nativeEvent,o.originalEvent=t;var s=this.getExistedHTML(o);return o.target=a??(s||this.isNativeEventFromCanvas(o)&&this.pickTarget(o)),typeof r=="string"&&(o.type=r),o},n.createWheelEvent=function(t){var r=this.allocateEvent(Es);this.copyWheelData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.nativeEvent=t.nativeEvent,r.originalEvent=t;var a=this.getExistedHTML(r);return r.target=a||this.isNativeEventFromCanvas(r)&&this.pickTarget(r),r},n.trackingData=function(t){return this.mappingState.trackingData[t]||(this.mappingState.trackingData[t]={pressTargetsByButton:{},clicksByButton:{},overTarget:null}),this.mappingState.trackingData[t]},n.cloneWheelEvent=function(t){var r=this.allocateEvent(Es);return r.nativeEvent=t.nativeEvent,r.originalEvent=t.originalEvent,this.copyWheelData(t,r),this.copyMouseData(t,r),this.copyData(t,r),r.target=t.target,r.path=t.composedPath().slice(),r.type=t.type,r},n.clonePointerEvent=function(t,r){var a=this.allocateEvent(_s);return a.nativeEvent=t.nativeEvent,a.originalEvent=t.originalEvent,this.copyPointerData(t,a),this.copyMouseData(t,a),this.copyData(t,a),a.target=t.target,a.path=t.composedPath().slice(),a.type=r??a.type,a},n.copyPointerData=function(t,r){r.pointerId=t.pointerId,r.width=t.width,r.height=t.height,r.isPrimary=t.isPrimary,r.pointerType=t.pointerType,r.pressure=t.pressure,r.tangentialPressure=t.tangentialPressure,r.tiltX=t.tiltX,r.tiltY=t.tiltY,r.twist=t.twist},n.copyMouseData=function(t,r){r.altKey=t.altKey,r.button=t.button,r.buttons=t.buttons,r.ctrlKey=t.ctrlKey,r.metaKey=t.metaKey,r.shiftKey=t.shiftKey,r.client.copyFrom(t.client),r.movement.copyFrom(t.movement),r.canvas.copyFrom(t.canvas),r.screen.copyFrom(t.screen),r.global.copyFrom(t.global),r.offset.copyFrom(t.offset)},n.copyWheelData=function(t,r){r.deltaMode=t.deltaMode,r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ},n.copyData=function(t,r){r.isTrusted=t.isTrusted,r.timeStamp=performance.now(),r.type=t.type,r.detail=t.detail,r.view=t.view,r.page.copyFrom(t.page),r.viewport.copyFrom(t.viewport)},n.allocateEvent=function(t){this.eventPool.has(t)||this.eventPool.set(t,[]);var r=this.eventPool.get(t).pop()||new t(this);return r.eventPhase=r.NONE,r.currentTarget=null,r.path=[],r.target=null,r},n.freeEvent=function(t){if(t.manager!==this)throw new Error("It is illegal to free an event not managed by this EventBoundary!");var r=t.constructor;this.eventPool.has(r)||this.eventPool.set(r,[]),this.eventPool.get(r).push(t)},n.notifyTarget=function(t,r){var a;r=(a=r)!==null&&a!==void 0?a:t.type;var o=t.eventPhase===t.CAPTURING_PHASE||t.eventPhase===t.AT_TARGET?r+"capture":r;this.notifyListeners(t,o),t.eventPhase===t.AT_TARGET&&this.notifyListeners(t,r)},n.notifyListeners=function(t,r){var a=t.currentTarget.emitter,o=a._events[r];if(o)if("fn"in o)o.once&&a.removeListener(r,o.fn,void 0,!0),o.fn.call(t.currentTarget||o.context,t);else for(var s=0;s<o.length&&!t.propagationImmediatelyStopped;s++)o[s].once&&a.removeListener(r,o[s].fn,void 0,!0),o[s].fn.call(t.currentTarget||o[s].context,t)},n.findMountedTarget=function(t){if(!t)return null;for(var r=t[t.length-1],a=t.length-2;a>=0;a--){var o=t[a];if(o===this.rootTarget||Ye.isNode(o)&&o.parentNode===r)r=t[a];else break}return r},n.getCursor=function(t){for(var r=t;r;){var a=Wc.isElement(r)&&r.getAttribute("cursor");if(a)return a;r=Ye.isNode(r)&&r.parentNode}},e}(),Sm=function(){function e(){this.canvas=void 0,this.context=void 0}var n=e.prototype;return n.getOrCreateCanvas=function(t,r){if(this.canvas)return this.canvas;if(t)this.canvas=t,this.context=this.canvas.getContext("2d",r);else try{this.canvas=new window.OffscreenCanvas(0,0),this.context=this.canvas.getContext("2d",r),(!this.context||!this.context.measureText)&&(this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"))}catch{this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d",r)}return this.canvas.width=10,this.canvas.height=10,this.canvas},n.getOrCreateContext=function(t,r){return this.context?this.context:(this.getOrCreateCanvas(t,r),this.context)},e}(),qn;(function(e){e[e.CAMERA_CHANGED=0]="CAMERA_CHANGED",e[e.DISPLAY_OBJECT_CHANGED=1]="DISPLAY_OBJECT_CHANGED",e[e.NONE=2]="NONE"})(qn||(qn={}));var Am=function(){function e(i,t){this.globalRuntime=void 0,this.context=void 0,this.inited=!1,this.stats={total:0,rendered:0},this.zIndexCounter=0,this.renderOrderChangedEvent=new Bt(fe.RENDER_ORDER_CHANGED),this.hooks={init:new I0,dirtycheck:new Fo,cull:new Fo,beginFrame:new xt,beforeRender:new xt,render:new xt,afterRender:new xt,endFrame:new xt,destroy:new xt,pick:new D0,pickSync:new Fo,pointerDown:new xt,pointerUp:new xt,pointerMove:new xt,pointerOut:new xt,pointerOver:new xt,pointerWheel:new xt,pointerCancel:new xt,click:new xt},this.globalRuntime=i,this.context=t}var n=e.prototype;return n.init=function(){var i=Wr(tt().mark(function r(){var a;return tt().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a=pe({},this.globalRuntime,this.context),this.context.renderingPlugins.forEach(function(u){u.apply(a,X)}),s.next=4,this.hooks.init.promise();case 4:this.inited=!0;case 5:case"end":return s.stop()}},r,this)}));function t(){return i.apply(this,arguments)}return t}(),n.getStats=function(){return this.stats},n.disableDirtyRectangleRendering=function(){var t=this.context.config.renderer,r=t.getConfig(),a=r.enableDirtyRectangleRendering;return!a||this.context.renderingContext.renderReasons.has(qn.CAMERA_CHANGED)},n.render=function(t,r){var a=this;this.stats.total=0,this.stats.rendered=0,this.zIndexCounter=0;var o=this.context.renderingContext;this.globalRuntime.sceneGraphService.syncHierarchy(o.root),this.globalRuntime.sceneGraphService.triggerPendingEvents(),o.renderReasons.size&&this.inited&&(this.renderDisplayObject(o.root,t,o),this.hooks.beginFrame.call(),o.renderListCurrentFrame.forEach(function(s){a.hooks.beforeRender.call(s),a.hooks.render.call(s),a.hooks.afterRender.call(s)}),this.hooks.endFrame.call(),o.renderListCurrentFrame=[],o.renderReasons.clear(),r())},n.renderDisplayObject=function(t,r,a){var o=this,s=r.renderer.getConfig(),u=s.enableDirtyCheck,l=s.enableCulling;this.globalRuntime.enableCSSParsing&&this.globalRuntime.styleValueRegistry.recalc(t);var f=u?this.hooks.dirtycheck.call(t):t;if(f){var c=l?this.hooks.cull.call(f,this.context.camera):f;c&&(this.stats.rendered++,a.renderListCurrentFrame.push(c))}t.renderable.dirty=!1,t.sortable.renderOrder=this.zIndexCounter++,this.stats.total++;var h=t.sortable,p=!1;h.dirty&&(h.sorted=t.childNodes.slice().sort(jp),p=!0,h.dirty=!1),(h.sorted||t.childNodes).forEach(function(g){o.renderDisplayObject(g,r,a)}),p&&t.forEach(function(g){o.renderOrderChangedEvent.target=g,o.renderOrderChangedEvent.detail={renderOrder:g.sortable.renderOrder},g.ownerDocument.defaultView.dispatchEvent(o.renderOrderChangedEvent,!0)})},n.destroy=function(){this.inited=!1,this.hooks.destroy.call(),this.globalRuntime.sceneGraphService.clearPendingEvents()},n.dirtify=function(){this.context.renderingContext.renderReasons.add(qn.DISPLAY_OBJECT_CHANGED)},e}(),Pm=/\[\s*(.*)=(.*)\s*\]/,xm=function(){function e(){}var n=e.prototype;return n.selectOne=function(t,r){var a=this;if(t.startsWith("."))return r.find(function(l){return((l==null?void 0:l.classList)||[]).indexOf(a.getIdOrClassname(t))>-1});if(t.startsWith("#"))return r.find(function(l){return l.id===a.getIdOrClassname(t)});if(t.startsWith("[")){var o=this.getAttribute(t),s=o.name,u=o.value;return s?r.find(function(l){return r!==l&&(s==="name"?l.name===u:a.attributeToString(l,s)===u)}):null}else return r.find(function(l){return r!==l&&l.nodeName===t})},n.selectAll=function(t,r){var a=this;if(t.startsWith("."))return r.findAll(function(l){return r!==l&&((l==null?void 0:l.classList)||[]).indexOf(a.getIdOrClassname(t))>-1});if(t.startsWith("#"))return r.findAll(function(l){return r!==l&&l.id===a.getIdOrClassname(t)});if(t.startsWith("[")){var o=this.getAttribute(t),s=o.name,u=o.value;return s?r.findAll(function(l){return r!==l&&(s==="name"?l.name===u:a.attributeToString(l,s)===u)}):[]}else return r.findAll(function(l){return r!==l&&l.nodeName===t})},n.is=function(t,r){if(t.startsWith("."))return r.className===this.getIdOrClassname(t);if(t.startsWith("#"))return r.id===this.getIdOrClassname(t);if(t.startsWith("[")){var a=this.getAttribute(t),o=a.name,s=a.value;return o==="name"?r.name===s:this.attributeToString(r,o)===s}else return r.nodeName===t},n.getIdOrClassname=function(t){return t.substring(1)},n.getAttribute=function(t){var r=t.match(Pm),a="",o="";return r&&r.length>2&&(a=r[1].replace(/"/g,""),o=r[2].replace(/"/g,"")),{name:a,value:o}},n.attributeToString=function(t,r){if(!t.getAttribute)return"";var a=t.getAttribute(r);return ae(a)?"":a.toString?a.toString():""},e}();function Hl(e){var n=e.renderable;n&&(n.renderBoundsDirty=!0,n.boundsDirty=!0)}var Mm=new Mr(fe.REPARENT,null,"","","",0,"",""),Cm=function(){function e(i){var t=this;this.runtime=void 0,this.pendingEvents=[],this.boundsChangedEvent=new Bt(fe.BOUNDS_CHANGED),this.rotate=function(){var r=qe();return function(a,o,s,u){s===void 0&&(s=0),u===void 0&&(u=0),typeof o=="number"&&(o=me(o,s,u));var l=a.transformable;if(a.parentNode===null||!a.parentNode.transformable)t.rotateLocal(a,o);else{var f=qe();ta(f,o[0],o[1],o[2]);var c=t.getRotation(a),h=t.getRotation(a.parentNode);ra(r,h),xo(r,r),tn(f,r,f),tn(l.localRotation,f,c),Fa(l.localRotation,l.localRotation),t.dirtifyLocal(a,l)}}}(),this.rotateLocal=function(){var r=qe();return function(a,o,s,u){s===void 0&&(s=0),u===void 0&&(u=0),typeof o=="number"&&(o=me(o,s,u));var l=a.transformable;ta(r,o[0],o[1],o[2]),Yu(l.localRotation,l.localRotation,r),t.dirtifyLocal(a,l)}}(),this.setEulerAngles=function(){var r=qe();return function(a,o,s,u){s===void 0&&(s=0),u===void 0&&(u=0),typeof o=="number"&&(o=me(o,s,u));var l=a.transformable;if(a.parentNode===null||!a.parentNode.transformable)t.setLocalEulerAngles(a,o);else{ta(l.localRotation,o[0],o[1],o[2]);var f=t.getRotation(a.parentNode);ra(r,xo(qe(),f)),Yu(l.localRotation,l.localRotation,r),t.dirtifyLocal(a,l)}}}(),this.translateLocal=function(){return function(r,a,o,s){o===void 0&&(o=0),s===void 0&&(s=0),typeof a=="number"&&(a=me(a,o,s));var u=r.transformable;fi(a,Re())||(pv(a,a,u.localRotation),Wn(u.localPosition,u.localPosition,a),t.dirtifyLocal(r,u))}}(),this.setPosition=function(){var r=Te(),a=Re();return function(o,s){var u=o.transformable;if(a[0]=s[0],a[1]=s[1],a[2]=s[2]||0,!fi(t.getPosition(o),a)){if(Dt(u.position,a),o.parentNode===null||!o.parentNode.transformable)Dt(u.localPosition,a);else{var l=o.parentNode.transformable;Ar(r,l.worldTransform),Rr(r,r),It(u.localPosition,a,r)}t.dirtifyLocal(o,u)}}}(),this.setLocalPosition=function(){var r=Re();return function(a,o){var s=a.transformable;r[0]=o[0],r[1]=o[1],r[2]=o[2]||0,!fi(s.localPosition,r)&&(Dt(s.localPosition,r),t.dirtifyLocal(a,s))}}(),this.translate=function(){var r=Re(),a=Re(),o=Re();return function(s,u,l,f){l===void 0&&(l=0),f===void 0&&(f=0),typeof u=="number"&&(u=Br(a,u,l,f)),!fi(u,r)&&(Wn(o,t.getPosition(s),u),t.setPosition(s,o))}}(),this.setRotation=function(){var r=qe();return function(a,o,s,u,l){var f=a.transformable;if(typeof o=="number"&&(o=Mo(o,s,u,l)),a.parentNode===null||!a.parentNode.transformable)t.setLocalRotation(a,o);else{var c=t.getRotation(a.parentNode);ra(r,c),xo(r,r),tn(f.localRotation,r,o),Fa(f.localRotation,f.localRotation),t.dirtifyLocal(a,f)}}},this.displayObjectDependencyMap=new WeakMap,this.calcLocalTransform=function(){var r=Te(),a=Re(),o=Mo(0,0,0,1);return function(s){var u=s.localSkew[0]!==0||s.localSkew[1]!==0;if(u){if(Si(s.localTransform,s.localRotation,s.localPosition,me(1,1,1),s.origin),s.localSkew[0]!==0||s.localSkew[1]!==0){var l=Xi(r);l[4]=Math.tan(s.localSkew[0]),l[1]=Math.tan(s.localSkew[1]),nr(s.localTransform,s.localTransform,l)}var f=Si(r,o,a,s.localScale,s.origin);nr(s.localTransform,s.localTransform,f)}else Si(s.localTransform,s.localRotation,s.localPosition,s.localScale,s.origin)}}(),this.runtime=i}var n=e.prototype;return n.matches=function(t,r){return this.runtime.sceneGraphSelector.is(t,r)},n.querySelector=function(t,r){return this.runtime.sceneGraphSelector.selectOne(t,r)},n.querySelectorAll=function(t,r){return this.runtime.sceneGraphSelector.selectAll(t,r)},n.attach=function(t,r,a){var o,s,u=!1;t.parentNode&&(u=t.parentNode!==r,this.detach(t)),t.parentNode=r,ae(a)?t.parentNode.childNodes.push(t):t.parentNode.childNodes.splice(a,0,t);var l=r.sortable;(!(l==null||(o=l.sorted)===null||o===void 0)&&o.length||!((s=t.style)===null||s===void 0)&&s.zIndex)&&(l.dirty=!0);var f=t.transformable;f&&this.dirtifyWorld(t,f),f.frozen&&this.unfreezeParentToRoot(t),u&&t.dispatchEvent(Mm)},n.detach=function(t){if(t.parentNode){var r,a,o=t.transformable,s=t.parentNode.sortable;(!(s==null||(r=s.sorted)===null||r===void 0)&&r.length||!((a=t.style)===null||a===void 0)&&a.zIndex)&&(s.dirty=!0);var u=t.parentNode.childNodes.indexOf(t);u>-1&&t.parentNode.childNodes.splice(u,1),o&&this.dirtifyWorld(t,o),t.parentNode=null}},n.getOrigin=function(t){return t.transformable.origin},n.setOrigin=function(t,r,a,o){a===void 0&&(a=0),o===void 0&&(o=0),typeof r=="number"&&(r=[r,a,o]);var s=t.transformable;if(!(r[0]===s.origin[0]&&r[1]===s.origin[1]&&r[2]===s.origin[2])){var u=s.origin;u[0]=r[0],u[1]=r[1],u[2]=r[2]||0,this.dirtifyLocal(t,s)}},n.setLocalEulerAngles=function(t,r,a,o){a===void 0&&(a=0),o===void 0&&(o=0),typeof r=="number"&&(r=me(r,a,o));var s=t.transformable;ta(s.localRotation,r[0],r[1],r[2]),this.dirtifyLocal(t,s)},n.scaleLocal=function(t,r){var a=t.transformable;hv(a.localScale,a.localScale,me(r[0],r[1],r[2]||1)),this.dirtifyLocal(t,a)},n.setLocalScale=function(t,r){var a=t.transformable,o=me(r[0],r[1],r[2]||a.localScale[2]);fi(o,a.localScale)||(Dt(a.localScale,o),this.dirtifyLocal(t,a))},n.setLocalRotation=function(t,r,a,o,s){typeof r=="number"&&(r=Mo(r,a,o,s));var u=t.transformable;ra(u.localRotation,r),this.dirtifyLocal(t,u)},n.setLocalSkew=function(t,r,a){typeof r=="number"&&(r=Tv(r,a));var o=t.transformable;Rv(o.localSkew,r),this.dirtifyLocal(t,o)},n.dirtifyLocal=function(t,r){r.localDirtyFlag||(r.localDirtyFlag=!0,r.dirtyFlag||this.dirtifyWorld(t,r))},n.dirtifyWorld=function(t,r){r.dirtyFlag||this.unfreezeParentToRoot(t),this.dirtifyWorldInternal(t,r),this.dirtifyToRoot(t,!0)},n.triggerPendingEvents=function(){var t=this,r=new Set,a=function(s,u){s.isConnected&&!r.has(s.entity)&&(t.boundsChangedEvent.detail=u,t.boundsChangedEvent.target=s,s.isMutationObserved?s.dispatchEvent(t.boundsChangedEvent):s.ownerDocument.defaultView.dispatchEvent(t.boundsChangedEvent,!0),r.add(s.entity))};this.pendingEvents.forEach(function(o){var s=o[0],u=o[1];u.affectChildren?s.forEach(function(l){a(l,u)}):a(s,u)}),this.clearPendingEvents(),r.clear()},n.clearPendingEvents=function(){this.pendingEvents=[]},n.dirtifyToRoot=function(t,r){r===void 0&&(r=!1);var a=t;for(a.renderable&&(a.renderable.dirty=!0);a;)Hl(a),a=a.parentNode;r&&t.forEach(function(o){Hl(o)}),this.informDependentDisplayObjects(t),this.pendingEvents.push([t,{affectChildren:r}])},n.updateDisplayObjectDependency=function(t,r,a,o){if(r&&r!==a){var s=this.displayObjectDependencyMap.get(r);if(s&&s[t]){var u=s[t].indexOf(o);s[t].splice(u,1)}}if(a){var l=this.displayObjectDependencyMap.get(a);l||(this.displayObjectDependencyMap.set(a,{}),l=this.displayObjectDependencyMap.get(a)),l[t]||(l[t]=[]),l[t].push(o)}},n.informDependentDisplayObjects=function(t){var r=this,a=this.displayObjectDependencyMap.get(t);a&&Object.keys(a).forEach(function(o){a[o].forEach(function(s){r.dirtifyToRoot(s,!0),s.dispatchEvent(new Mr(fe.ATTR_MODIFIED,s,r,r,o,Mr.MODIFICATION,r,r)),s.isCustomElement&&s.isConnected&&s.attributeChangedCallback&&s.attributeChangedCallback(o,r,r)})})},n.getPosition=function(t){var r=t.transformable;return wa(r.position,this.getWorldTransform(t,r))},n.getRotation=function(t){var r=t.transformable;return Ba(r.rotation,this.getWorldTransform(t,r))},n.getScale=function(t){var r=t.transformable;return Kn(r.scaling,this.getWorldTransform(t,r))},n.getWorldTransform=function(t,r){return r===void 0&&(r=t.transformable),!r.localDirtyFlag&&!r.dirtyFlag||(t.parentNode&&t.parentNode.transformable&&this.getWorldTransform(t.parentNode),this.sync(t,r)),r.worldTransform},n.getLocalPosition=function(t){return t.transformable.localPosition},n.getLocalRotation=function(t){return t.transformable.localRotation},n.getLocalScale=function(t){return t.transformable.localScale},n.getLocalSkew=function(t){return t.transformable.localSkew},n.getLocalTransform=function(t){var r=t.transformable;return r.localDirtyFlag&&(this.calcLocalTransform(r),r.localDirtyFlag=!1),r.localTransform},n.setLocalTransform=function(t,r){var a=wa(Re(),r),o=Ba(qe(),r),s=Kn(Re(),r);this.setLocalScale(t,s),this.setLocalPosition(t,a),this.setLocalRotation(t,o)},n.resetLocalTransform=function(t){this.setLocalScale(t,[1,1,1]),this.setLocalPosition(t,[0,0,0]),this.setLocalEulerAngles(t,[0,0,0]),this.setLocalSkew(t,[0,0])},n.getTransformedGeometryBounds=function(t,r,a){r===void 0&&(r=!1);var o=this.getGeometryBounds(t,r);if(ct.isEmpty(o))return null;var s=a||new ct;return s.setFromTransformedAABB(o,this.getWorldTransform(t)),s},n.getGeometryBounds=function(t,r){r===void 0&&(r=!1);var a=t.geometry,o=r?a.renderBounds:a.contentBounds||null;return o||new ct},n.getBounds=function(t,r){var a=this;r===void 0&&(r=!1);var o=t.renderable;if(!o.boundsDirty&&!r&&o.bounds)return o.bounds;if(!o.renderBoundsDirty&&r&&o.renderBounds)return o.renderBounds;var s=r?o.renderBounds:o.bounds,u=this.getTransformedGeometryBounds(t,r,s),l=t.childNodes;if(l.forEach(function(h){var p=a.getBounds(h,r);p&&(u?u.add(p):(u=s||new ct,u.update(p.center,p.halfExtents)))}),r){var f=e0(t);if(f){var c=f.parsedStyle.clipPath.getBounds(r);u?c&&(u=c.intersection(u)):u=c}}return u||(u=new ct),u&&(r?o.renderBounds=u:o.bounds=u),r?o.renderBoundsDirty=!1:o.boundsDirty=!1,u},n.getLocalBounds=function(t){if(t.parentNode){var r=Te();t.parentNode.transformable&&(r=Rr(Te(),this.getWorldTransform(t.parentNode)));var a=this.getBounds(t);if(!ct.isEmpty(a)){var o=new ct;return o.setFromTransformedAABB(a,r),o}}return this.getBounds(t)},n.getBoundingClientRect=function(t){var r,a,o,s=this.getGeometryBounds(t);ct.isEmpty(s)||(o=new ct,o.setFromTransformedAABB(s,this.getWorldTransform(t)));var u=(r=t.ownerDocument)===null||r===void 0||(a=r.defaultView)===null||a===void 0?void 0:a.getContextService().getBoundingClientRect();if(o){var l=o.getMin(),f=l[0],c=l[1],h=o.getMax(),p=h[0],g=h[1];return new Rn(f+((u==null?void 0:u.left)||0),c+((u==null?void 0:u.top)||0),p-f,g-c)}return new Rn((u==null?void 0:u.left)||0,(u==null?void 0:u.top)||0,0,0)},n.dirtifyWorldInternal=function(t,r){var a=this;if(!r.dirtyFlag){r.dirtyFlag=!0,r.frozen=!1,t.childNodes.forEach(function(s){var u=s.transformable;u.dirtyFlag||a.dirtifyWorldInternal(s,u)});var o=t.renderable;o&&(o.renderBoundsDirty=!0,o.boundsDirty=!0,o.dirty=!0)}},n.syncHierarchy=function(t){var r=t.transformable;if(!r.frozen){r.frozen=!0,(r.localDirtyFlag||r.dirtyFlag)&&this.sync(t,r);for(var a=t.childNodes,o=0;o<a.length;o++)this.syncHierarchy(a[o])}},n.sync=function(t,r){if(r.localDirtyFlag&&(this.calcLocalTransform(r),r.localDirtyFlag=!1),r.dirtyFlag){var a=t.parentNode,o=a&&a.transformable;a===null||!o?Ar(r.worldTransform,r.localTransform):nr(r.worldTransform,o.worldTransform,r.localTransform),r.dirtyFlag=!1}},n.unfreezeParentToRoot=function(t){for(var r=t.parentNode;r;){var a=r.transformable;a&&(a.frozen=!1),r=r.parentNode}},e}(),hn={MetricsString:"|ÉqÅ",BaselineSymbol:"M",BaselineMultiplier:1.4,HeightMultiplier:2,Newlines:[10,13],BreakingSpaces:[9,32,8192,8193,8194,8195,8196,8197,8198,8200,8201,8202,8287,12288]},Xl=/[a-zA-Z0-9\u00C0-\u00D6\u00D8-\u00f6\u00f8-\u00ff!"#$%&'()*+,-./:;]/,Om=/[!%),.:;?\]}¢°·'""†‡›℃∶、。〃〆〕〗〞﹚﹜！＂％＇），．：；？！］｝～]/,Nm=/[$(£¥·'"〈《「『【〔〖〝﹙﹛＄（．［｛￡￥]/,Im=/[!),.:;?\]}¢·–—'"•"、。〆〞〕〉》」︰︱︲︳﹐﹑﹒﹓﹔﹕﹖﹘﹚﹜！），．：；？︶︸︺︼︾﹀﹂﹗］｜｝､]/,Dm=/[([{£¥'"‵〈《「『〔〝︴﹙﹛（｛︵︷︹︻︽︿﹁﹃﹏]/,bm=/[)\]｝〕〉》」』】〙〗〟'"｠»ヽヾーァィゥェォッャュョヮヵヶぁぃぅぇぉっゃゅょゎゕゖㇰㇱㇲㇳㇴㇵㇶㇷㇸㇹㇺㇻㇼㇽㇾㇿ々〻‐゠–〜?!‼⁇⁈⁉・、:;,。.]/,wm=/[([｛〔〈《「『【〘〖〝'"｟«—...‥〳〴〵]/,Bm=/[!%),.:;?\]}¢°'"†‡℃〆〈《「『〕！％），．：；？］｝]/,Fm=/[$([{£¥'"々〇〉》」〔＄（［｛｠￥￦#]/,Um=new RegExp(Om.source+"|"+Im.source+"|"+bm.source+"|"+Bm.source),km=new RegExp(Nm.source+"|"+Dm.source+"|"+wm.source+"|"+Fm.source),Lm=function(){function e(i){var t=this;this.runtime=void 0,this.fontMetricsCache={},this.shouldBreakByKinsokuShorui=function(r,a){return t.isBreakingSpace(a)?!1:!!(r&&(km.exec(a)||Um.exec(r)))},this.trimByKinsokuShorui=function(r){var a=[].concat(r),o=a[a.length-2];if(!o)return r;var s=o[o.length-1];return a[a.length-2]=o.slice(0,-1),a[a.length-1]=s+a[a.length-1],a},this.runtime=i}var n=e.prototype;return n.measureFont=function(t,r){if(this.fontMetricsCache[t])return this.fontMetricsCache[t];var a={ascent:0,descent:0,fontSize:0},o=this.runtime.offscreenCanvas.getOrCreateCanvas(r),s=this.runtime.offscreenCanvas.getOrCreateContext(r);s.font=t;var u=hn.MetricsString+hn.BaselineSymbol,l=Math.ceil(s.measureText(u).width),f=Math.ceil(s.measureText(hn.BaselineSymbol).width),c=hn.HeightMultiplier*f;f=f*hn.BaselineMultiplier|0,o.width=l,o.height=c,s.fillStyle="#f00",s.fillRect(0,0,l,c),s.font=t,s.textBaseline="alphabetic",s.fillStyle="#000",s.fillText(u,0,f);var h=s.getImageData(0,0,l||1,c||1).data,p=h.length,g=l*4,_=0,E=0,y=!1;for(_=0;_<f;++_){for(var R=0;R<g;R+=4)if(h[E+R]!==255){y=!0;break}if(!y)E+=g;else break}for(a.ascent=f-_,E=p-g,y=!1,_=c;_>f;--_){for(var A=0;A<g;A+=4)if(h[E+A]!==255){y=!0;break}if(!y)E-=g;else break}return a.descent=_-f,a.fontSize=a.ascent+a.descent,this.fontMetricsCache[t]=a,a},n.measureText=function(t,r,a){var o=r.fontSize,s=r.wordWrap,u=r.lineHeight,l=r.lineWidth,f=r.textBaseline,c=r.textAlign,h=r.letterSpacing,p=r.textPath;r.textPathSide,r.textPathStartOffset;var g=r.leading,_=g===void 0?0:g,E=B0(r),y=this.measureFont(E,a);y.fontSize===0&&(y.fontSize=o,y.ascent=o);var R=this.runtime.offscreenCanvas.getOrCreateContext(a);R.font=E,r.isOverflowing=!1;var A=s?this.wordWrap(t,r,a):t,M=A.split(/(?:\r\n|\r|\n)/),x=new Array(M.length),P=0;if(p){p.getTotalLength();for(var C=0;C<M.length;C++)R.measureText(M[C]).width+(M[C].length-1)*h}else{for(var O=0;O<M.length;O++){var D=R.measureText(M[O]).width+(M[O].length-1)*h;x[O]=D,P=Math.max(P,D)}var F=P+l,k=u||y.fontSize+l,d=Math.max(k,y.fontSize+l)+(M.length-1)*(k+_);k+=_;var v=0;return f==="middle"?v=-d/2:f==="bottom"||f==="alphabetic"||f==="ideographic"?v=-d:(f==="top"||f==="hanging")&&(v=0),{font:E,width:F,height:d,lines:M,lineWidths:x,lineHeight:k,maxLineWidth:P,fontProperties:y,lineMetrics:x.map(function(m,S){var T=0;return c==="center"||c==="middle"?T-=m/2:(c==="right"||c==="end")&&(T-=m),new Rn(T-l/2,v+S*k,m+l,k)})}}},n.setGraphemeOnPath=function(){},n.wordWrap=function(t,r,a){var o=this,s=r.wordWrapWidth,u=s===void 0?0:s,l=r.letterSpacing,f=r.maxLines,c=f===void 0?1/0:f,h=r.textOverflow,p=this.runtime.offscreenCanvas.getOrCreateContext(a),g=u+l,_="";h==="ellipsis"?_="...":h&&h!=="clip"&&(_=h);for(var E=[],y=0,R=0,A={},M=function(B){return o.getFromCache(B,l,A,p)},x=Array.from(_).reduce(function(N,B){return N+M(B)},0),P=Array.from(t),C=0;C<P.length;C++){var O=P[C],D=t[C-1],F=t[C+1],k=M(O);if(this.isNewline(O)){if(y++,y>=c){r.isOverflowing=!0;break}R=0,E[y]="";continue}if(R>0&&R+k>g){if(y+1>=c){if(r.isOverflowing=!0,x>0&&x<=g){for(var d=E[y].length,v=0,m=d,S=0;S<d;S++){var T=M(E[y][S]);if(v+T+x>g){m=S;break}v+=T}E[y]=(E[y]||"").slice(0,m)+_}break}if(y++,R=0,E[y]="",this.isBreakingSpace(O))continue;this.canBreakInLastChar(O)||(E=this.trimToBreakable(E),R=this.sumTextWidthByCache(E[y]||"",A)),this.shouldBreakByKinsokuShorui(O,F)&&(E=this.trimByKinsokuShorui(E),R+=M(D||""))}R+=k,E[y]=(E[y]||"")+O}return E.join(`
`)},n.isBreakingSpace=function(t){return typeof t!="string"?!1:hn.BreakingSpaces.indexOf(t.charCodeAt(0))>=0},n.isNewline=function(t){return typeof t!="string"?!1:hn.Newlines.indexOf(t.charCodeAt(0))>=0},n.trimToBreakable=function(t){var r=[].concat(t),a=r[r.length-2],o=this.findBreakableIndex(a);if(o===-1||!a)return r;var s=a.slice(o,o+1),u=this.isBreakingSpace(s),l=o+1,f=o+(u?0:1);return r[r.length-1]+=a.slice(l,a.length),r[r.length-2]=a.slice(0,f),r},n.canBreakInLastChar=function(t){return!(t&&Xl.test(t))},n.sumTextWidthByCache=function(t,r){return t.split("").reduce(function(a,o){if(!r[o])throw Error("cannot count the word without cache");return a+r[o]},0)},n.findBreakableIndex=function(t){for(var r=t.length-1;r>=0;r--)if(!Xl.test(t[r]))return r;return-1},n.getFromCache=function(t,r,a,o){var s=a[t];if(typeof s!="number"){var u=t.length*r;s=o.measureText(t).width+u,a[t]=s}return s},e}(),X={},Wm=function(){var e,n=new Em,i=new _m;return e={},e[H.CIRCLE]=new vm,e[H.ELLIPSE]=new pm,e[H.RECT]=n,e[H.IMAGE]=n,e[H.GROUP]=n,e[H.LINE]=new gm,e[H.TEXT]=new ym(X),e[H.POLYLINE]=i,e[H.POLYGON]=i,e[H.PATH]=new mm,e[H.HTML]=null,e[H.MESH]=null,e}(),Hm=function(){var e,n=new yg,i=new cu;return e={},e[j.PERCENTAGE]=null,e[j.NUMBER]=new xg,e[j.ANGLE]=new _g,e[j.DEFINED_PATH]=new Eg,e[j.PAINT]=n,e[j.COLOR]=n,e[j.FILTER]=new Tg,e[j.LENGTH]=i,e[j.LENGTH_PERCENTAGE]=i,e[j.LENGTH_PERCENTAGE_12]=new Rg,e[j.LENGTH_PERCENTAGE_14]=new Sg,e[j.COORDINATE]=new Ag,e[j.OFFSET_DISTANCE]=new Mg,e[j.OPACITY_VALUE]=new Cg,e[j.PATH]=new Ig,e[j.LIST_OF_POINTS]=new Dg,e[j.SHADOW_BLUR]=new bg,e[j.TEXT]=new wg,e[j.TEXT_TRANSFORM]=new Bg,e[j.TRANSFORM]=new Fg,e[j.TRANSFORM_ORIGIN]=new Ug,e[j.Z_INDEX]=new kg,e[j.MARKER]=new Pg,e}(),Xm=function(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global `this`")};X.CameraContribution=$c;X.AnimationTimeline=null;X.EasingFunction=null;X.offscreenCanvas=new Sm;X.nativeHTMLMap=new WeakMap;X.sceneGraphSelector=new xm;X.sceneGraphService=new Cm(X);X.textService=new Lm(X);X.geometryUpdaterFactory=Wm;X.CSSPropertySyntaxFactory=Hm;X.styleValueRegistry=new dm;X.layoutRegistry=null;X.globalThis=Xm();X.enableCSSParsing=!0;var un=function(){function e(){this.context=void 0,this.plugins=[]}var n=e.prototype;return n.addRenderingPlugin=function(t){this.plugins.push(t),this.context.renderingPlugins.push(t)},n.removeAllRenderingPlugins=function(){var t=this;this.plugins.forEach(function(r){var a=t.context.renderingPlugins.indexOf(r);a>=0&&t.context.renderingPlugins.splice(a,1)})},e}(),Vm=function(){function e(i){this.plugins=[],this.config=void 0,this.config=pe({enableDirtyCheck:!0,enableCulling:!1,enableAutoRendering:!0,enableDirtyRectangleRendering:!0,enableDirtyRectangleRenderingDebug:!1},i)}var n=e.prototype;return n.registerPlugin=function(t){var r=this.plugins.findIndex(function(a){return a===t});r===-1&&this.plugins.push(t)},n.unregisterPlugin=function(t){var r=this.plugins.findIndex(function(a){return a===t});r>-1&&this.plugins.splice(r,1)},n.getPlugins=function(){return this.plugins},n.getPlugin=function(t){return this.plugins.find(function(r){return r.name===t})},n.getConfig=function(){return this.config},n.setConfig=function(t){Object.assign(this.config,t)},e}(),qc=function(){function e(i){this.strategies=void 0,this.strategies=i}var n=e.prototype;return n.apply=function(t){var r=t.camera,a=t.renderingService,o=t.renderingContext,s=this.strategies;a.hooks.cull.tap(e.tag,function(u){if(u){var l=u.cullable;return s.length===0?l.visible=o.unculledEntities.indexOf(u.entity)>-1:l.visible=s.every(function(f){return f.isVisible(r,u)}),!u.isCulled()&&u.isVisible()?u:(u.dispatchEvent(new Bt(fe.CULLED)),null)}return u}),a.hooks.afterRender.tap(e.tag,function(u){u.cullable.visibilityPlaneMask=-1})},e}();qc.tag="Culling";var Zc=function(){function e(){}var n=e.prototype;return n.apply=function(t){var r=t.renderingService;r.hooks.dirtycheck.tap(e.tag,function(a){if(a){var o=a.renderable,s=o.dirty||r.disableDirtyRectangleRendering();return s?a:null}return a})},e}();Zc.tag="DirtyCheck";var Qc=function(){function e(){var i=this;this.autoPreventDefault=!1,this.rootPointerEvent=new _s(null),this.rootWheelEvent=new Es(null),this.context=void 0,this.onPointerMove=function(t){var r,a,o=(r=i.context.renderingContext.root)===null||r===void 0||(a=r.ownerDocument)===null||a===void 0?void 0:a.defaultView;if(!(o.supportsTouchEvents&&t.pointerType==="touch")){for(var s=i.normalizeToPointerEvent(t,o),u=Bn(s),l;!(l=u()).done;){var f=l.value,c=i.bootstrapEvent(i.rootPointerEvent,f,o,t);i.context.eventService.mapEvent(c)}i.setCursor(i.context.eventService.cursor)}}}var n=e.prototype;return n.apply=function(t){var r=this;this.context=t;var a=t.renderingService,o=this.context.renderingContext.root.ownerDocument.defaultView;this.context.eventService.setPickHandler(function(s){var u=r.context.renderingService.hooks.pickSync.call({position:s,picked:[],topmost:!0}),l=u.picked;return l[0]||null}),a.hooks.pointerWheel.tap(e.tag,function(s){var u=r.normalizeWheelEvent(s);r.context.eventService.mapEvent(u)}),a.hooks.pointerDown.tap(e.tag,function(s){if(!(o.supportsTouchEvents&&s.pointerType==="touch")){var u=r.normalizeToPointerEvent(s,o);if(r.autoPreventDefault&&u[0].isNormalized){var l=s.cancelable||!("cancelable"in s);l&&s.preventDefault()}for(var f=Bn(u),c;!(c=f()).done;){var h=c.value,p=r.bootstrapEvent(r.rootPointerEvent,h,o,s);r.context.eventService.mapEvent(p)}r.setCursor(r.context.eventService.cursor)}}),a.hooks.pointerUp.tap(e.tag,function(s){if(!(o.supportsTouchEvents&&s.pointerType==="touch")){var u=r.context.contextService.getDomElement(),l="outside";try{l=u&&s.target&&s.target!==u&&u.contains&&!u.contains(s.target)?"outside":""}catch{}for(var f=r.normalizeToPointerEvent(s,o),c=Bn(f),h;!(h=c()).done;){var p=h.value,g=r.bootstrapEvent(r.rootPointerEvent,p,o,s);g.type+=l,r.context.eventService.mapEvent(g)}r.setCursor(r.context.eventService.cursor)}}),a.hooks.pointerMove.tap(e.tag,this.onPointerMove),a.hooks.pointerOver.tap(e.tag,this.onPointerMove),a.hooks.pointerOut.tap(e.tag,this.onPointerMove),a.hooks.click.tap(e.tag,this.onPointerMove),a.hooks.pointerCancel.tap(e.tag,function(s){for(var u=r.normalizeToPointerEvent(s,o),l=Bn(u),f;!(f=l()).done;){var c=f.value,h=r.bootstrapEvent(r.rootPointerEvent,c,o,s);r.context.eventService.mapEvent(h)}r.setCursor(r.context.eventService.cursor)})},n.getViewportXY=function(t){var r,a,o=t.offsetX,s=t.offsetY,u=t.clientX,l=t.clientY;if(this.context.config.supportsCSSTransform&&!ae(o)&&!ae(s))r=o,a=s;else{var f=this.context.eventService.client2Viewport(new ht(u,l));r=f.x,a=f.y}return{x:r,y:a}},n.bootstrapEvent=function(t,r,a,o){t.view=a,t.originalEvent=null,t.nativeEvent=o,t.pointerId=r.pointerId,t.width=r.width,t.height=r.height,t.isPrimary=r.isPrimary,t.pointerType=r.pointerType,t.pressure=r.pressure,t.tangentialPressure=r.tangentialPressure,t.tiltX=r.tiltX,t.tiltY=r.tiltY,t.twist=r.twist,this.transferMouseData(t,r);var s=this.getViewportXY(r),u=s.x,l=s.y;t.viewport.x=u,t.viewport.y=l;var f=this.context.eventService.viewport2Canvas(t.viewport),c=f.x,h=f.y;return t.canvas.x=c,t.canvas.y=h,t.global.copyFrom(t.canvas),t.offset.copyFrom(t.canvas),t.isTrusted=o.isTrusted,t.type==="pointerleave"&&(t.type="pointerout"),t.type.startsWith("mouse")&&(t.type=t.type.replace("mouse","pointer")),t.type.startsWith("touch")&&(t.type=o0[t.type]||t.type),t},n.normalizeWheelEvent=function(t){var r=this.rootWheelEvent;this.transferMouseData(r,t),r.deltaMode=t.deltaMode,r.deltaX=t.deltaX,r.deltaY=t.deltaY,r.deltaZ=t.deltaZ;var a=this.getViewportXY(t),o=a.x,s=a.y;r.viewport.x=o,r.viewport.y=s;var u=this.context.eventService.viewport2Canvas(r.viewport),l=u.x,f=u.y;return r.canvas.x=l,r.canvas.y=f,r.global.copyFrom(r.canvas),r.offset.copyFrom(r.canvas),r.nativeEvent=t,r.type=t.type,r},n.transferMouseData=function(t,r){t.isTrusted=r.isTrusted,t.srcElement=r.srcElement,t.timeStamp=performance.now(),t.type=r.type,t.altKey=r.altKey,t.metaKey=r.metaKey,t.shiftKey=r.shiftKey,t.ctrlKey=r.ctrlKey,t.button=r.button,t.buttons=r.buttons,t.client.x=r.clientX,t.client.y=r.clientY,t.movement.x=r.movementX,t.movement.y=r.movementY,t.page.x=r.pageX,t.page.y=r.pageY,t.screen.x=r.screenX,t.screen.y=r.screenY,t.relatedTarget=null},n.setCursor=function(t){this.context.contextService.applyCursorStyle(t||this.context.config.cursor||"default")},n.normalizeToPointerEvent=function(t,r){var a=[];if(r.isTouchEvent(t))for(var o=0;o<t.changedTouches.length;o++){var s=t.changedTouches[o];Xe(s.button)&&(s.button=0),Xe(s.buttons)&&(s.buttons=1),Xe(s.isPrimary)&&(s.isPrimary=t.touches.length===1&&t.type==="touchstart"),Xe(s.width)&&(s.width=s.radiusX||1),Xe(s.height)&&(s.height=s.radiusY||1),Xe(s.tiltX)&&(s.tiltX=0),Xe(s.tiltY)&&(s.tiltY=0),Xe(s.pointerType)&&(s.pointerType="touch"),Xe(s.pointerId)&&(s.pointerId=s.identifier||0),Xe(s.pressure)&&(s.pressure=s.force||.5),Xe(s.twist)&&(s.twist=0),Xe(s.tangentialPressure)&&(s.tangentialPressure=0),s.isNormalized=!0,s.type=t.type,a.push(s)}else if(r.isMouseEvent(t)){var u=t;Xe(u.isPrimary)&&(u.isPrimary=!0),Xe(u.width)&&(u.width=1),Xe(u.height)&&(u.height=1),Xe(u.tiltX)&&(u.tiltX=0),Xe(u.tiltY)&&(u.tiltY=0),Xe(u.pointerType)&&(u.pointerType="mouse"),Xe(u.pointerId)&&(u.pointerId=a0),Xe(u.pressure)&&(u.pressure=.5),Xe(u.twist)&&(u.twist=0),Xe(u.tangentialPressure)&&(u.tangentialPressure=0),u.isNormalized=!0,a.push(u)}else a.push(t);return a},e}();Qc.tag="Event";var Ym=[H.CIRCLE,H.ELLIPSE,H.IMAGE,H.RECT,H.LINE,H.POLYLINE,H.POLYGON,H.TEXT,H.PATH,H.HTML],zm=function(){function e(){}var n=e.prototype;return n.isVisible=function(t,r){var a,o,s=r.cullable;if(!s.enable)return!0;var u=r.getRenderBounds();if(ct.isEmpty(u))return!1;var l=t.getFrustum(),f=(a=r.parentNode)===null||a===void 0||(o=a.cullable)===null||o===void 0?void 0:o.visibilityPlaneMask;return s.visibilityPlaneMask=this.computeVisibilityWithPlaneMask(r,u,f||$r.INDETERMINATE,l.planes),s.visible=s.visibilityPlaneMask!==$r.OUTSIDE,s.visible},n.computeVisibilityWithPlaneMask=function(t,r,a,o){if(a===$r.OUTSIDE||a===$r.INSIDE)return a;for(var s=$r.INSIDE,u=Ym.indexOf(t.nodeName)>-1,l=0,f=o.length;l<f;++l){var c=1<<l;if(a&c&&!(u&&(l===4||l===5))){var h=o[l],p=h.normal,g=h.distance;if(Sr(p,r.getPositiveFarPoint(o[l]))+g<0)return $r.OUTSIDE;Sr(p,r.getNegativeFarPoint(o[l]))+g<0&&(s|=c)}}return s},e}(),Jc=function(){function e(){this.rBush=void 0,this.toSync=new Set}var n=e.prototype;return n.apply=function(t){var r=this,a=t.renderingService,o=t.renderingContext,s=t.rBushRoot,u=o.root.ownerDocument.defaultView;this.rBush=s;var l=function(g){var _=g.target;_.renderable.dirty=!0,a.dirtify()},f=function(g){var _=g.detail.affectChildren,E=g.target;_&&E.forEach(function(R){r.toSync.add(R)});for(var y=E;y;)y.renderable&&r.toSync.add(y),y=y.parentElement;a.dirtify()},c=function(g){var _=g.target;X.enableCSSParsing&&X.styleValueRegistry.recalc(_),X.sceneGraphService.dirtifyToRoot(_),a.dirtify()},h=function(g){var _=g.target,E=_.rBushNode;E.aabb&&r.rBush.remove(E.aabb),r.toSync.delete(_),X.sceneGraphService.dirtifyToRoot(_),a.dirtify()};a.hooks.init.tapPromise(e.tag,Wr(tt().mark(function p(){return tt().wrap(function(_){for(;;)switch(_.prev=_.next){case 0:u.addEventListener(fe.MOUNTED,c),u.addEventListener(fe.UNMOUNTED,h),u.addEventListener(fe.ATTR_MODIFIED,l),u.addEventListener(fe.BOUNDS_CHANGED,f);case 4:case"end":return _.stop()}},p)}))),a.hooks.destroy.tap(e.tag,function(){u.removeEventListener(fe.MOUNTED,c),u.removeEventListener(fe.UNMOUNTED,h),u.removeEventListener(fe.ATTR_MODIFIED,l),u.removeEventListener(fe.BOUNDS_CHANGED,f),r.toSync.clear()}),a.hooks.endFrame.tap(e.tag,function(){r.syncRTree()})},n.syncRTree=function(){var t=this,r=[];Array.from(this.toSync).filter(function(a){return a.isConnected}).forEach(function(a){var o=a.rBushNode;o&&o.aabb&&t.rBush.remove(o.aabb);var s=a.getRenderBounds();if(s){var u=s.getMin(),l=u[0],f=u[1],c=s.getMax(),h=c[0],p=c[1];o.aabb||(o.aabb={}),o.aabb.displayObject=a,o.aabb.minX=l,o.aabb.minY=f,o.aabb.maxX=h,o.aabb.maxY=p}o.aabb&&!isNaN(o.aabb.maxX)&&!isNaN(o.aabb.maxX)&&!isNaN(o.aabb.minX)&&!isNaN(o.aabb.minY)&&r.push(o.aabb)}),this.rBush.load(r),r.length=0,this.toSync.clear()},e}();Jc.tag="Prepare";var ar;(function(e){e.READY="ready",e.BEFORE_RENDER="beforerender",e.RERENDER="rerender",e.AFTER_RENDER="afterrender",e.BEFORE_DESTROY="beforedestroy",e.AFTER_DESTROY="afterdestroy",e.RESIZE="resize",e.DIRTY_RECTANGLE="dirtyrectangle"})(ar||(ar={}));var Vl=500,Gm=.1,Km=1e3,Ho=new Bt(fe.MOUNTED),Xo=new Bt(fe.UNMOUNTED),$m=new Bt(ar.BEFORE_RENDER),qm=new Bt(ar.RERENDER),Zm=new Bt(ar.AFTER_RENDER),Qm=function(e){Ie(n,e);function n(t){var r;r=e.call(this)||this,r.document=void 0,r.customElements=void 0,r.requestAnimationFrame=void 0,r.cancelAnimationFrame=void 0,r.devicePixelRatio=void 0,r.supportsPointerEvents=void 0,r.supportsTouchEvents=void 0,r.isTouchEvent=void 0,r.isMouseEvent=void 0,r.Element=At,r.frameId=void 0,r.inited=!1,r.readyPromise=void 0,r.resolveReadyPromise=void 0,r.context={},r.document=new Hg,r.document.defaultView=Xn(r),r.customElements=new Lg;var a=t.container,o=t.canvas,s=t.offscreenCanvas,u=t.width,l=t.height,f=t.devicePixelRatio,c=t.renderer,h=t.background,p=t.cursor,g=t.document,_=t.requestAnimationFrame,E=t.cancelAnimationFrame,y=t.createImage,R=t.supportsPointerEvents,A=t.supportsTouchEvents,M=t.supportsCSSTransform,x=t.useNativeClickEvent,P=t.isTouchEvent,C=t.isMouseEvent;Jp(a,Xn(r));var O=u,D=l,F=f;return o&&(F=f||ei&&window.devicePixelRatio||1,F=F>=1?Math.ceil(F):1,O=u||r0(o)||o.width/F,D=l||n0(o)||o.height/F),r.devicePixelRatio=F,r.requestAnimationFrame=_??Cc.bind(X.globalThis),r.cancelAnimationFrame=E??Oc.bind(X.globalThis),r.supportsTouchEvents=A??"ontouchstart"in X.globalThis,r.supportsPointerEvents=R??!!X.globalThis.PointerEvent,r.isTouchEvent=P??function(k){return r.supportsTouchEvents&&k instanceof X.globalThis.TouchEvent},r.isMouseEvent=C??function(k){return!X.globalThis.MouseEvent||k instanceof X.globalThis.MouseEvent&&(!r.supportsPointerEvents||!(k instanceof X.globalThis.PointerEvent))},r.initRenderingContext({container:a,canvas:o,width:O,height:D,renderer:c,offscreenCanvas:s,devicePixelRatio:F,cursor:p||"default",background:h||"transparent",createImage:y,document:g,supportsCSSTransform:M,useNativeClickEvent:x}),r.initDefaultCamera(O,D),Wr(tt().mark(function k(){return tt().wrap(function(v){for(;;)switch(v.prev=v.next){case 0:return v.next=2,r.initRenderer(c);case 2:r.dispatchEvent(new Bt(ar.READY)),r.readyPromise&&r.resolveReadyPromise();case 4:case"end":return v.stop()}},k)}))(),r}var i=n.prototype;return i.initRenderingContext=function(r){this.context.config=r,this.context.renderingContext={root:this.document.documentElement,renderListCurrentFrame:[],unculledEntities:[],renderReasons:new Set,force:!1,dirty:!1}},i.initDefaultCamera=function(r,a){var o=this,s=new X.CameraContribution;s.setType(xe.EXPLORING,Di.DEFAULT).setPosition(r/2,a/2,Vl).setFocalPoint(r/2,a/2,0).setOrthographic(r/-2,r/2,a/2,a/-2,Gm,Km),s.canvas=this,s.eventEmitter.on(Kc.UPDATED,function(){o.context.renderingContext.renderReasons.add(qn.CAMERA_CHANGED)}),this.context.camera=s},i.getConfig=function(){return this.context.config},i.getRoot=function(){return this.document.documentElement},i.getCamera=function(){return this.context.camera},i.getContextService=function(){return this.context.contextService},i.getEventService=function(){return this.context.eventService},i.getRenderingService=function(){return this.context.renderingService},i.getRenderingContext=function(){return this.context.renderingContext},i.getStats=function(){return this.getRenderingService().getStats()},i.destroy=function(r,a){if(r===void 0&&(r=!0),a===void 0&&(a=!1),a||this.dispatchEvent(new Bt(ar.BEFORE_DESTROY)),this.frameId){var o=this.getConfig().cancelAnimationFrame||cancelAnimationFrame;o(this.frameId)}var s=this.getRoot();this.unmountChildren(s),r&&(this.document.destroy(),this.getEventService().destroy()),this.getRenderingService().destroy(),this.getContextService().destroy(),r&&this.context.rBushRoot&&(this.context.rBushRoot.clear(),this.context.rBushRoot=null,this.context.renderingContext.root=null),a||this.dispatchEvent(new Bt(ar.AFTER_DESTROY))},i.changeSize=function(r,a){this.resize(r,a)},i.resize=function(r,a){var o=this.context.config;o.width=r,o.height=a,this.getContextService().resize(r,a);var s=this.context.camera,u=s.getProjectionMode();s.setPosition(r/2,a/2,Vl).setFocalPoint(r/2,a/2,0),u===Ct.ORTHOGRAPHIC?s.setOrthographic(r/-2,r/2,a/2,a/-2,s.getNear(),s.getFar()):s.setAspect(r/a),this.dispatchEvent(new Bt(ar.RESIZE,{width:r,height:a}))},i.appendChild=function(r,a){return this.document.documentElement.appendChild(r,a)},i.insertBefore=function(r,a){return this.document.documentElement.insertBefore(r,a)},i.removeChild=function(r){return this.document.documentElement.removeChild(r)},i.removeChildren=function(){this.document.documentElement.removeChildren()},i.destroyChildren=function(){this.document.documentElement.destroyChildren()},i.render=function(){var r=this;this.dispatchEvent($m);var a=this.getRenderingService();a.render(this.getConfig(),function(){r.dispatchEvent(qm)}),this.dispatchEvent(Zm)},i.run=function(){var r=this,a=function o(){r.render(),r.frameId=requestAnimationFrame(o)};a()},i.initRenderer=function(){var t=Wr(tt().mark(function a(o){return tt().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:if(o){u.next=2;break}throw new Error("Renderer is required.");case 2:return this.inited=!1,this.readyPromise=void 0,this.context.rBushRoot=new ap,this.context.renderingPlugins=[],this.context.renderingPlugins.push(new Qc,new Jc,new Zc,new qc([new zm])),this.loadRendererContainerModule(o),this.context.contextService=new this.context.ContextService(pe({},X,this.context)),this.context.renderingService=new Am(X,this.context),this.context.eventService=new Rm(X,this.context),this.context.eventService.init(),u.next=14,this.context.contextService.init();case 14:return u.next=16,this.context.renderingService.init();case 16:this.inited=!0,this.getRoot().forEach(function(l){var f=l.renderable;f&&(f.renderBoundsDirty=!0,f.boundsDirty=!0,f.dirty=!0)}),this.mountChildren(this.getRoot()),o.getConfig().enableAutoRendering&&this.run();case 20:case"end":return u.stop()}},a,this)}));function r(a){return t.apply(this,arguments)}return r}(),i.loadRendererContainerModule=function(r){var a=this,o=r.getPlugins();o.forEach(function(s){s.context=a.context,s.init(X)})},i.setRenderer=function(){var t=Wr(tt().mark(function a(o){var s,u;return tt().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(s=this.getConfig(),s.renderer!==o){f.next=3;break}return f.abrupt("return");case 3:return u=s.renderer,s.renderer=o,this.destroy(!1,!0),[].concat(u==null?void 0:u.getPlugins()).reverse().forEach(function(c){c.destroy(X)}),f.next=9,this.initRenderer(o);case 9:case"end":return f.stop()}},a,this)}));function r(a){return t.apply(this,arguments)}return r}(),i.setCursor=function(r){var a=this.getConfig();a.cursor=r,this.getContextService().applyCursorStyle(r)},i.unmountChildren=function(r){var a=this;r.childNodes.forEach(function(o){a.unmountChildren(o)}),this.inited&&(r.isMutationObserved?r.dispatchEvent(Xo):(Xo.target=r,this.dispatchEvent(Xo,!0)),r!==this.document.documentElement&&(r.ownerDocument=null),r.isConnected=!1),r.isCustomElement&&r.disconnectedCallback&&r.disconnectedCallback()},i.mountChildren=function(r){var a=this;this.inited?r.isConnected||(r.ownerDocument=this.document,r.isConnected=!0,r.isMutationObserved?r.dispatchEvent(Ho):(Ho.target=r,this.dispatchEvent(Ho,!0))):console.warn("[g]: You are trying to call `canvas.appendChild` before canvas' initialization finished. You can either await `canvas.ready` or listen to `CanvasEvent.READY` manually.","appended child: ",r.nodeName),r.childNodes.forEach(function(o){a.mountChildren(o)}),r.isCustomElement&&r.connectedCallback&&r.connectedCallback()},i.client2Viewport=function(r){return this.getEventService().client2Viewport(r)},i.viewport2Client=function(r){return this.getEventService().viewport2Client(r)},i.viewport2Canvas=function(r){return this.getEventService().viewport2Canvas(r)},i.canvas2Viewport=function(r){return this.getEventService().canvas2Viewport(r)},i.getPointByClient=function(r,a){return this.client2Viewport({x:r,y:a})},i.getClientByPoint=function(r,a){return this.viewport2Client({x:r,y:a})},Pn(n,[{key:"ready",get:function(){var r=this;return this.readyPromise||(this.readyPromise=new Promise(function(a){r.resolveReadyPromise=function(){a(r)}}),this.inited&&this.resolveReadyPromise()),this.readyPromise}}]),n}(Lc);function Jm(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,Ts(e,n)}function Ts(e,n){return Ts=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Ts(e,n)}var jm=function(e){Jm(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.landmarks=[],t.landmarkAnimationID=void 0,t}var i=n.prototype;return i.rotate=function(r,a,o){if(this.relElevation=Vn(a),this.relAzimuth=Vn(r),this.relRoll=Vn(o),this.elevation+=this.relElevation,this.azimuth+=this.relAzimuth,this.roll+=this.relRoll,this.type===xe.EXPLORING){var s=jr(qe(),[1,0,0],Le((this.rotateWorld?1:-1)*this.relElevation)),u=jr(qe(),[0,1,0],Le((this.rotateWorld?1:-1)*this.relAzimuth)),l=jr(qe(),[0,0,1],Le(this.relRoll)),f=tn(qe(),u,s);f=tn(qe(),f,l);var c=au(Te(),f);Ln(this.matrix,this.matrix,[0,0,-this.distance]),nr(this.matrix,this.matrix,c),Ln(this.matrix,this.matrix,[0,0,this.distance])}else{if(Math.abs(this.elevation)>90)return this;this.computeMatrix()}return this._getAxes(),this.type===xe.ORBITING||this.type===xe.EXPLORING?this._getPosition():this.type===xe.TRACKING&&this._getFocalPoint(),this._update(),this},i.pan=function(r,a){var o=St(r,a,0),s=wr(this.position);return Wn(s,s,jo(Re(),this.right,o[0])),Wn(s,s,jo(Re(),this.up,o[1])),this._setPosition(s),this.triggerUpdate(),this},i.dolly=function(r){var a=this.forward,o=wr(this.position),s=r*this.dollyingStep,u=this.distance+r*this.dollyingStep;return s=Math.max(Math.min(u,this.maxDistance),this.minDistance)-this.distance,o[0]+=s*a[0],o[1]+=s*a[1],o[2]+=s*a[2],this._setPosition(o),this.type===xe.ORBITING||this.type===xe.EXPLORING?this._getDistance():this.type===xe.TRACKING&&Wn(this.focalPoint,o,this.distanceVector),this.triggerUpdate(),this},i.cancelLandmarkAnimation=function(){this.landmarkAnimationID!==void 0&&this.canvas.cancelAnimationFrame(this.landmarkAnimationID)},i.createLandmark=function(r,a){var o,s,u,l;a===void 0&&(a={});var f=a,c=f.position,h=c===void 0?this.position:c,p=f.focalPoint,g=p===void 0?this.focalPoint:p,_=f.roll,E=f.zoom,y=new X.CameraContribution;y.setType(this.type,void 0),y.setPosition(h[0],(o=h[1])!==null&&o!==void 0?o:this.position[1],(s=h[2])!==null&&s!==void 0?s:this.position[2]),y.setFocalPoint(g[0],(u=g[1])!==null&&u!==void 0?u:this.focalPoint[1],(l=g[2])!==null&&l!==void 0?l:this.focalPoint[2]),y.setRoll(_??this.roll),y.setZoom(E??this.zoom);var R={name:r,matrix:$f(y.getWorldTransform()),right:wr(y.right),up:wr(y.up),forward:wr(y.forward),position:wr(y.getPosition()),focalPoint:wr(y.getFocalPoint()),distanceVector:wr(y.getDistanceVector()),distance:y.getDistance(),dollyingStep:y.getDollyingStep(),azimuth:y.getAzimuth(),elevation:y.getElevation(),roll:y.getRoll(),relAzimuth:y.relAzimuth,relElevation:y.relElevation,relRoll:y.relRoll,zoom:y.getZoom()};return this.landmarks.push(R),R},i.gotoLandmark=function(r,a){var o=this;a===void 0&&(a={});var s=vt(r)?this.landmarks.find(function(F){return F.name===r}):r;if(s){var u=Ut(a)?{duration:a}:a,l=u.easing,f=l===void 0?"linear":l,c=u.duration,h=c===void 0?100:c,p=u.easingFunction,g=p===void 0?void 0:p,_=u.onfinish,E=_===void 0?void 0:_,y=.01;if(h===0){this.syncFromLandmark(s),E&&E();return}this.cancelLandmarkAnimation();var R=s.position,A=s.focalPoint,M=s.zoom,x=s.roll,P=g||X.EasingFunction(f),C,O=function(){o.setFocalPoint(A),o.setPosition(R),o.setRoll(x),o.setZoom(M),o.computeMatrix(),o.triggerUpdate(),E&&E()},D=function F(k){C===void 0&&(C=k);var d=k-C;if(d>h){O();return}var v=P(d/h),m=Re(),S=Re(),T=1,N=0;es(m,o.focalPoint,A,v),es(S,o.position,R,v),N=o.roll*(1-v)+x*v,T=o.zoom*(1-v)+M*v,o.setFocalPoint(m),o.setPosition(S),o.setRoll(N),o.setZoom(T);var B=Vu(m,A)+Vu(S,R);if(B<=y){O();return}o.computeMatrix(),o.triggerUpdate(),d<h&&(o.landmarkAnimationID=o.canvas.requestAnimationFrame(F))};this.canvas.requestAnimationFrame(D)}},i.syncFromLandmark=function(r){this.matrix=Ar(this.matrix,r.matrix),this.right=Dt(this.right,r.right),this.up=Dt(this.up,r.up),this.forward=Dt(this.forward,r.forward),this.position=Dt(this.position,r.position),this.focalPoint=Dt(this.focalPoint,r.focalPoint),this.distanceVector=Dt(this.distanceVector,r.distanceVector),this.azimuth=r.azimuth,this.elevation=r.elevation,this.roll=r.roll,this.relAzimuth=r.relAzimuth,this.relElevation=r.relElevation,this.relRoll=r.relRoll,this.dollyingStep=r.dollyingStep,this.distance=r.distance,this.zoom=r.zoom},n}($c);X.CameraContribution=jm;var Yl;(function(e){e.Layout="layout",e.IntrinsicSizes="intrinsic-sizes"})(Yl||(Yl={}));var zl;(function(e){e[e.block=0]="block",e[e.normal=1]="normal"})(zl||(zl={}));var Gl;(function(e){e[e["block-like"]=0]="block-like",e[e.manual=1]="manual"})(Gl||(Gl={}));var Kl;(function(e){e.LAYOUT="display",e.LEFT="left",e.TOP="top",e.BOTTOM="bottom",e.RIGHT="right",e.WIDTH="width",e.HEIGHT="height",e.MIN_WIDTH="minWidth",e.MAX_WIDTH="maxWidth",e.MIN_HEIGHT="minHeight",e.MAX_HEIGHT="maxHeight",e.BOX_SIZING="boxSizing",e.PADDING="padding",e.PADDING_TOP="paddingTop",e.PADDING_BOTTOM="paddingBottom",e.PADDING_START="paddingLeft",e.PADDING_END="paddingRight",e.MARGIN="margin",e.MARGIN_TOP="marginTop",e.MARGIN_BOTTOM="marginBottom",e.MARGIN_START="marginLeft",e.MARGIN_END="marginRight",e.BORDER="border",e.BORDER_TOP="borderTop",e.BORDER_BOTTOM="borderBottom",e.BORDER_START="borderLeft",e.BORDER_END="borderRight",e.FLEX_DIRECTION="flexDirection",e.FLEX_WRAP="flexWrap",e.FLEX_FLOW="flexFlow",e.ALIGN_ITEMS="alignItems",e.ALIGN_CONTENT="alignContent",e.JUSTIFY_CONTENT="justifyContent",e.FLEX="flex",e.ALIGN_SELF="alignSelf",e.FLEX_SHRINK="flexShrink",e.FLEX_BASIS="flexBasis",e.FLEX_GROW="flexGrow",e.OFFSET_WIDTH="offsetWidth",e.OFFSET_HEIGHT="offsetHeight",e.ORDER="order"})(Kl||(Kl={}));function $l(e,n){for(var i=0;i<n.length;i++){var t=n[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,r_(t.key),t)}}function jc(e,n,i){return n&&$l(e.prototype,n),i&&$l(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function e_(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,Rs(e,n)}function Rs(e,n){return Rs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Rs(e,n)}function t_(e,n){if(typeof e!="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var t=i.call(e,n||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function r_(e){var n=t_(e,"string");return typeof n=="symbol"?n:String(n)}var Vo=function(e){e_(n,e);function n(i,t,r,a){var o;return o=e.call(this,i)||this,o.currentTime=void 0,o.timelineTime=void 0,o.currentTime=r,o.timelineTime=a,o.target=t,o.type="finish",o.bubbles=!1,o.currentTarget=t,o.defaultPrevented=!1,o.eventPhase=o.AT_TARGET,o.timeStamp=Date.now(),o.currentTime=r,o.timelineTime=a,o}return n}(uo),n_=0,i_=function(){function e(i,t){var r;this.effect=void 0,this.timeline=void 0,this.id=void 0,this.currentTimePending=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this.oldPlayState=void 0,this._holdTime=void 0,this.readyPromise=void 0,this.finishedPromise=void 0,this.resolveReadyPromise=void 0,this.rejectReadyPromise=void 0,this.resolveFinishedPromise=void 0,this.rejectFinishedPromise=void 0,this.onfinish=void 0,this.oncancel=void 0,this.onframe=void 0,this._currentTime=0,this._startTime=void 0,this._playbackRate=1,this._totalDuration=void 0,this._inEffect=void 0,this._inTimeline=!0,this.onremove=void 0,this.effect=i,i.animation=this,this.timeline=t,this.id=""+n_++,this._inEffect=!!this.effect.update(0),this._totalDuration=Number((r=this.effect)===null||r===void 0?void 0:r.getComputedTiming().endTime),this._holdTime=0,this._paused=!1,this.oldPlayState="idle",this.updatePromises()}var n=e.prototype;return n.updatePromises=function(){var t=this.oldPlayState,r=this.pending?"pending":this.playState;return this.readyPromise&&r!==t&&(r==="idle"?(this.rejectReadyPromise(),this.readyPromise=void 0):t==="pending"?this.resolveReadyPromise():r==="pending"&&(this.readyPromise=void 0)),this.finishedPromise&&r!==t&&(r==="idle"?(this.rejectFinishedPromise(),this.finishedPromise=void 0):r==="finished"?this.resolveFinishedPromise():t==="finished"&&(this.finishedPromise=void 0)),this.oldPlayState=r,this.readyPromise||this.finishedPromise},n.play=function(){this.updatePromises(),this._paused=!1,(this._isFinished||this._idle)&&(this.rewind(),this._startTime=null),this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this),this.timeline.animations.indexOf(this)===-1&&this.timeline.animations.push(this),this.updatePromises()},n.pause=function(){this.updatePromises(),this.currentTime&&(this._holdTime=this.currentTime),!this._isFinished&&!this._paused&&!this._idle?this.currentTimePending=!0:this._idle&&(this.rewind(),this._idle=!1),this._startTime=null,this._paused=!0,this.updatePromises()},n.finish=function(){this.updatePromises(),!this._idle&&(this.currentTime=this._playbackRate>0?this._totalDuration:0,this._startTime=this._totalDuration-this.currentTime,this.currentTimePending=!1,this.timeline.applyDirtiedAnimation(this),this.updatePromises())},n.cancel=function(){var t=this;if(this.updatePromises(),!!this._inEffect&&(this._inEffect=!1,this._idle=!0,this._paused=!1,this._finishedFlag=!0,this._currentTime=0,this._startTime=null,this.effect.update(null),this.timeline.applyDirtiedAnimation(this),this.updatePromises(),this.oncancel)){var r=new Vo(null,this,this.currentTime,null);setTimeout(function(){t.oncancel(r)})}},n.reverse=function(){this.updatePromises();var t=this.currentTime;this.playbackRate*=-1,this.play(),t!==null&&(this.currentTime=t),this.updatePromises()},n.updatePlaybackRate=function(t){this.playbackRate=t},n.targetAnimations=function(){var t,r=(t=this.effect)===null||t===void 0?void 0:t.target;return r.getAnimations()},n.markTarget=function(){var t=this.targetAnimations();t.indexOf(this)===-1&&t.push(this)},n.unmarkTarget=function(){var t=this.targetAnimations(),r=t.indexOf(this);r!==-1&&t.splice(r,1)},n.tick=function(t,r){!this._idle&&!this._paused&&(this._startTime===null?r&&(this.startTime=t-this._currentTime/this.playbackRate):this._isFinished||this.tickCurrentTime((t-this._startTime)*this.playbackRate)),r&&(this.currentTimePending=!1,this.fireEvents(t))},n.rewind=function(){if(this.playbackRate>=0)this.currentTime=0;else if(this._totalDuration<1/0)this.currentTime=this._totalDuration;else throw new Error("Unable to rewind negative playback rate animation with infinite duration")},n.persist=function(){throw new Error(Ce)},n.addEventListener=function(t,r,a){throw new Error(Ce)},n.removeEventListener=function(t,r,a){throw new Error(Ce)},n.dispatchEvent=function(t){throw new Error(Ce)},n.commitStyles=function(){throw new Error(Ce)},n.ensureAlive=function(){if(this.playbackRate<0&&this.currentTime===0){var t;this._inEffect=!!(!((t=this.effect)===null||t===void 0)&&t.update(-1))}else{var r;this._inEffect=!!(!((r=this.effect)===null||r===void 0)&&r.update(this.currentTime))}!this._inTimeline&&(this._inEffect||!this._finishedFlag)&&(this._inTimeline=!0,this.timeline.animations.push(this))},n.tickCurrentTime=function(t,r){t!==this._currentTime&&(this._currentTime=t,this._isFinished&&!r&&(this._currentTime=this._playbackRate>0?this._totalDuration:0),this.ensureAlive())},n.fireEvents=function(t){var r=this;if(this._isFinished){if(!this._finishedFlag){if(this.onfinish){var a=new Vo(null,this,this.currentTime,t);setTimeout(function(){r.onfinish&&r.onfinish(a)})}this._finishedFlag=!0}}else{if(this.onframe&&this.playState==="running"){var o=new Vo(null,this,this.currentTime,t);this.onframe(o)}this._finishedFlag=!1}},jc(e,[{key:"pending",get:function(){return this._startTime===null&&!this._paused&&this.playbackRate!==0||this.currentTimePending}},{key:"playState",get:function(){return this._idle?"idle":this._isFinished?"finished":this._paused?"paused":"running"}},{key:"ready",get:function(){var t=this;return this.readyPromise||(this.timeline.animationsWithPromises.indexOf(this)===-1&&this.timeline.animationsWithPromises.push(this),this.readyPromise=new Promise(function(r,a){t.resolveReadyPromise=function(){r(t)},t.rejectReadyPromise=function(){a(new Error)}}),this.pending||this.resolveReadyPromise()),this.readyPromise}},{key:"finished",get:function(){var t=this;return this.finishedPromise||(this.timeline.animationsWithPromises.indexOf(this)===-1&&this.timeline.animationsWithPromises.push(this),this.finishedPromise=new Promise(function(r,a){t.resolveFinishedPromise=function(){r(t)},t.rejectFinishedPromise=function(){a(new Error)}}),this.playState==="finished"&&this.resolveFinishedPromise()),this.finishedPromise}},{key:"currentTime",get:function(){return this.updatePromises(),this._idle||this.currentTimePending?null:this._currentTime},set:function(t){if(t=Number(t),!isNaN(t)){if(this.timeline.restart(),!this._paused&&this._startTime!==null){var r;this._startTime=Number((r=this.timeline)===null||r===void 0?void 0:r.currentTime)-t/this.playbackRate}this.currentTimePending=!1,this._currentTime!==t&&(this._idle&&(this._idle=!1,this._paused=!0),this.tickCurrentTime(t,!0),this.timeline.applyDirtiedAnimation(this))}}},{key:"startTime",get:function(){return this._startTime},set:function(t){if(t!==null){if(this.updatePromises(),t=Number(t),isNaN(t)||this._paused||this._idle)return;this._startTime=t,this.tickCurrentTime((Number(this.timeline.currentTime)-this._startTime)*this.playbackRate),this.timeline.applyDirtiedAnimation(this),this.updatePromises()}}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(t){if(t!==this._playbackRate){this.updatePromises();var r=this.currentTime;this._playbackRate=t,this.startTime=null,this.playState!=="paused"&&this.playState!=="idle"&&(this._finishedFlag=!1,this._idle=!1,this.ensureAlive(),this.timeline.applyDirtiedAnimation(this)),r!==null&&(this.currentTime=r),this.updatePromises()}}},{key:"_isFinished",get:function(){return!this._idle&&(this._playbackRate>0&&Number(this._currentTime)>=this._totalDuration||this._playbackRate<0&&Number(this._currentTime)<=0)}},{key:"totalDuration",get:function(){return this._totalDuration}},{key:"_needsTick",get:function(){return this.pending||this.playState==="running"||!this._finishedFlag}}]),e}(),a_=4,o_=.001,s_=1e-7,u_=10,Ti=11,ua=1/(Ti-1),l_=typeof Float32Array=="function",eh=function(n,i){return 1-3*i+3*n},th=function(n,i){return 3*i-6*n},rh=function(n){return 3*n},Ha=function(n,i,t){return((eh(i,t)*n+th(i,t))*n+rh(i))*n},nh=function(n,i,t){return 3*eh(i,t)*n*n+2*th(i,t)*n+rh(i)},f_=function(n,i,t,r,a){var o,s,u=0;do s=i+(t-i)/2,o=Ha(s,r,a)-n,o>0?t=s:i=s;while(Math.abs(o)>s_&&++u<u_);return s},c_=function(n,i,t,r){for(var a=0;a<a_;++a){var o=nh(i,t,r);if(o===0)return i;var s=Ha(i,t,r)-n;i-=s/o}return i},du=function(n,i,t,r){if(!(0<=n&&n<=1&&0<=t&&t<=1))throw new Error("bezier x values must be in [0, 1] range");if(n===i&&t===r)return function(u){return u};for(var a=l_?new Float32Array(Ti):new Array(Ti),o=0;o<Ti;++o)a[o]=Ha(o*ua,n,t);var s=function(l){for(var f=0,c=1,h=Ti-1;c!==h&&a[c]<=l;++c)f+=ua;--c;var p=(l-a[c])/(a[c+1]-a[c]),g=f+p*ua,_=nh(g,n,t);return _>=o_?c_(l,g,n,t):_===0?g:f_(l,f,f+ua,n,t)};return function(u){return u===0||u===1?u:Ha(s(u),i,r)}},h_=function(n){return n=n.replace(/([A-Z])/g,function(i){return"-"+i.toLowerCase()}),n.charAt(0)==="-"?n.substring(1):n},la=function(n){return Math.pow(n,2)},fa=function(n){return Math.pow(n,3)},ca=function(n){return Math.pow(n,4)},ha=function(n){return Math.pow(n,5)},da=function(n){return Math.pow(n,6)},va=function(n){return 1-Math.cos(n*Math.PI/2)},pa=function(n){return 1-Math.sqrt(1-n*n)},ga=function(n){return n*n*(3*n-2)},ma=function(n){for(var i,t=4;n<((i=Math.pow(2,--t))-1)/11;);return 1/Math.pow(4,3-t)-7.5625*Math.pow((i*3-2)/22-n,2)},_a=function(n,i){i===void 0&&(i=[]);var t=i,r=t[0],a=r===void 0?1:r,o=t[1],s=o===void 0?.5:o,u=dt(Number(a),1,10),l=dt(Number(s),.1,2);return n===0||n===1?n:-u*Math.pow(2,10*(n-1))*Math.sin((n-1-l/(Math.PI*2)*Math.asin(1/u))*(Math.PI*2)/l)},di=function(n,i,t){i===void 0&&(i=[]);var r=i,a=r[0],o=a===void 0?1:a,s=r[1],u=s===void 0?100:s,l=r[2],f=l===void 0?10:l,c=r[3],h=c===void 0?0:c;o=dt(o,.1,1e3),u=dt(u,.1,1e3),f=dt(f,.1,1e3),h=dt(h,.1,1e3);var p=Math.sqrt(u/o),g=f/(2*Math.sqrt(u*o)),_=g<1?p*Math.sqrt(1-g*g):0,E=1,y=g<1?(g*p+-h)/_:-h+p,R=t?t*n/1e3:n;return g<1?R=Math.exp(-R*g*p)*(E*Math.cos(_*R)+y*Math.sin(_*R)):R=(E+y*R)*Math.exp(-R*p),n===0||n===1?n:1-R},Yo=function(n,i){i===void 0&&(i=[]);var t=i,r=t[0],a=r===void 0?10:r,o=t[1],s=o=="start"?Math.ceil:Math.floor;return s(dt(n,0,1)*a)/a},ql=function(n,i){i===void 0&&(i=[]);var t=i,r=t[0],a=t[1],o=t[2],s=t[3];return du(r,a,o,s)(n)},Ea=du(.42,0,1,1),Zt=function(n){return function(i,t,r){return t===void 0&&(t=[]),1-n(1-i,t,r)}},Qt=function(n){return function(i,t,r){return t===void 0&&(t=[]),i<.5?n(i*2,t,r)/2:1-n(i*-2+2,t,r)/2}},Jt=function(n){return function(i,t,r){return t===void 0&&(t=[]),i<.5?(1-n(1-i*2,t,r))/2:(n(i*2-1,t,r)+1)/2}},Zl={steps:Yo,"step-start":function(n){return Yo(n,[1,"start"])},"step-end":function(n){return Yo(n,[1,"end"])},linear:function(n){return n},"cubic-bezier":ql,ease:function(n){return ql(n,[.25,.1,.25,1])},in:Ea,out:Zt(Ea),"in-out":Qt(Ea),"out-in":Jt(Ea),"in-quad":la,"out-quad":Zt(la),"in-out-quad":Qt(la),"out-in-quad":Jt(la),"in-cubic":fa,"out-cubic":Zt(fa),"in-out-cubic":Qt(fa),"out-in-cubic":Jt(fa),"in-quart":ca,"out-quart":Zt(ca),"in-out-quart":Qt(ca),"out-in-quart":Jt(ca),"in-quint":ha,"out-quint":Zt(ha),"in-out-quint":Qt(ha),"out-in-quint":Jt(ha),"in-expo":da,"out-expo":Zt(da),"in-out-expo":Qt(da),"out-in-expo":Jt(da),"in-sine":va,"out-sine":Zt(va),"in-out-sine":Qt(va),"out-in-sine":Jt(va),"in-circ":pa,"out-circ":Zt(pa),"in-out-circ":Qt(pa),"out-in-circ":Jt(pa),"in-back":ga,"out-back":Zt(ga),"in-out-back":Qt(ga),"out-in-back":Jt(ga),"in-bounce":ma,"out-bounce":Zt(ma),"in-out-bounce":Qt(ma),"out-in-bounce":Jt(ma),"in-elastic":_a,"out-elastic":Zt(_a),"in-out-elastic":Qt(_a),"out-in-elastic":Jt(_a),spring:di,"spring-in":di,"spring-out":Zt(di),"spring-in-out":Qt(di),"spring-out-in":Jt(di)},d_=function(n){return h_(n).replace(/^ease-/,"").replace(/(\(|\s).+/,"").toLowerCase().trim()},v_=function(n){return Zl[d_(n)]||Zl.linear},p_=function(n){return n},g_=1,m_=.5,Ql=0;function Jl(e,n){return function(i){if(i>=1)return 1;var t=1/e;return i+=n*t,i-i%t}}var ya="\\s*(-?\\d+\\.?\\d*|-?\\.\\d+)\\s*",__=new RegExp("cubic-bezier\\("+ya+","+ya+","+ya+","+ya+"\\)"),E_=/steps\(\s*(\d+)\s*\)/,y_=/steps\(\s*(\d+)\s*,\s*(start|middle|end)\s*\)/;function vu(e){var n=__.exec(e);if(n)return du.apply(void 0,n.slice(1).map(Number));var i=E_.exec(e);if(i)return Jl(Number(i[1]),Ql);var t=y_.exec(e);return t?Jl(Number(t[1]),{start:g_,middle:m_,end:Ql}[t[2]]):v_(e)}function T_(e){return Math.abs(R_(e)/(e.playbackRate||1))}function R_(e){var n;return e.duration===0||e.iterations===0?0:(e.duration==="auto"?0:Number(e.duration))*((n=e.iterations)!==null&&n!==void 0?n:1)}var ih=0,pu=1,lo=2,ah=3;function S_(e,n,i){if(n===null)return ih;var t=i.endTime;return n<Math.min(i.delay,t)?pu:n>=Math.min(i.delay+e+i.endDelay,t)?lo:ah}function A_(e,n,i,t,r){switch(t){case pu:return n==="backwards"||n==="both"?0:null;case ah:return i-r;case lo:return n==="forwards"||n==="both"?e:null;case ih:return null}}function P_(e,n,i,t,r){var a=r;return e===0?n!==pu&&(a+=i):a+=t/e,a}function x_(e,n,i,t,r,a){var o=e===1/0?n%1:e%1;return o===0&&i===lo&&t!==0&&(r!==0||a===0)&&(o=1),o}function M_(e,n,i,t){return e===lo&&n===1/0?1/0:i===1?Math.floor(t)-1:Math.floor(t)}function C_(e,n,i){var t=e;if(e!=="normal"&&e!=="reverse"){var r=n;e==="alternate-reverse"&&(r+=1),t="normal",r!==1/0&&r%2!==0&&(t="reverse")}return t==="normal"?i:1-i}function O_(e,n,i){var t=S_(e,n,i),r=A_(e,i.fill,n,t,i.delay);if(r===null)return null;var a=i.duration==="auto"?0:i.duration,o=P_(a,t,i.iterations,r,i.iterationStart),s=x_(o,i.iterationStart,t,i.iterations,r,a),u=M_(t,i.iterations,s,o),l=C_(i.direction,u,s);return i.currentIteration=u,i.progress=l,i.easingFunction(l)}function N_(e,n,i){var t=I_(e,n),r=D_(t,i);return function(a,o){if(o!==null)r.filter(function(u){return o>=u.applyFrom&&o<u.applyTo}).forEach(function(u){var l=o-u.startOffset,f=u.endOffset-u.startOffset,c=f===0?0:u.easingFunction(l/f);a.setAttribute(u.property,u.interpolation(c))});else for(var s in t)oh(s)&&a.setAttribute(s,null)}}function oh(e){return e!=="offset"&&e!=="easing"&&e!=="composite"&&e!=="computedOffset"}function I_(e,n){for(var i={},t=0;t<e.length;t++)for(var r in e[t])if(oh(r)){var a={offset:e[t].offset,computedOffset:e[t].computedOffset,easing:e[t].easing,easingFunction:vu(e[t].easing)||n.easingFunction,value:e[t][r]};i[r]=i[r]||[],i[r].push(a)}return i}function D_(e,n){var i=[];for(var t in e)for(var r=e[t],a=0;a<r.length-1;a++){var o=a,s=a+1,u=r[o].computedOffset,l=r[s].computedOffset,f=u,c=l;a===0&&(f=-1/0,l===0&&(s=o)),a===r.length-2&&(c=1/0,u===1&&(o=s)),i.push({applyFrom:f,applyTo:c,startOffset:r[o].computedOffset,endOffset:r[s].computedOffset,easingFunction:r[o].easingFunction,property:t,interpolation:b_(t,r[o].value,r[s].value,n)})}return i.sort(function(h,p){return h.startOffset-p.startOffset}),i}var jl=function(n,i,t){return function(r){var a=sh(n,i,r);return!X.enableCSSParsing&&Ut(a)?a:t(a)}};function b_(e,n,i,t){var r=zr[e];if(r&&r.syntax&&r.int){var a=X.styleValueRegistry.getPropertySyntax(r.syntax);if(a){var o,s;if(X.enableCSSParsing){var u=X.styleValueRegistry.parseProperty(e,n,t),l=X.styleValueRegistry.parseProperty(e,i,t);o=X.styleValueRegistry.computeProperty(e,u,t),s=X.styleValueRegistry.computeProperty(e,l,t)}else{var f=a.parserWithCSSDisabled;o=f?f(n,t):n,s=f?f(i,t):i}var c=a.mixer(o,s,t);if(c){var h=jl.apply(void 0,c);return function(p){return p===0?n:p===1?i:h(p)}}}}return jl(!1,!0,function(p){return p?i:n})}function sh(e,n,i){if(typeof e=="number"&&typeof n=="number")return e*(1-i)+n*i;if(typeof e=="boolean"&&typeof n=="boolean"||typeof e=="string"&&typeof n=="string")return i<.5?e:n;if(Array.isArray(e)&&Array.isArray(n)){for(var t=e.length,r=n.length,a=Math.max(t,r),o=[],s=0;s<a;s++)o.push(sh(e[s<t?s:t-1],n[s<r?s:r-1],i));return o}throw new Error("Mismatched interpolation arguments "+e+":"+n)}var w_=function(){function e(){this.delay=0,this.direction="normal",this.duration="auto",this._easing="linear",this.easingFunction=p_,this.endDelay=0,this.fill="auto",this.iterationStart=0,this.iterations=1,this.playbackRate=void 0,this.effect=void 0,this.composite=void 0,this.activeDuration=void 0,this.endTime=void 0,this.currentIteration=null,this.progress=null}return jc(e,[{key:"easing",get:function(){return this._easing},set:function(i){this.easingFunction=vu(i),this._easing=i}}]),e}();function B_(e){var n=[];for(var i in e)if(!(i in["easing","offset","composite"])){var t=e[i];Array.isArray(t)||(t=[t]);for(var r=t.length,a=0;a<r;a++){if(!n[a]){var o={};"offset"in e&&(o.offset=Number(e.offset)),"easing"in e&&(o.easing=e.easing),"composite"in e&&(o.composite=e.composite),n[a]=o}t[a]!==void 0&&t[a]!==null&&(n[a][i]=t[a])}}return n.sort(function(s,u){return(s.computedOffset||0)-(u.computedOffset||0)}),n}function ef(e,n){if(e===null)return[];Array.isArray(e)||(e=B_(e));for(var i=e.map(function(u){var l={};n!=null&&n.composite&&(l.composite="auto");for(var f in u){var c=u[f];if(f==="offset"){if(c!==null){if(c=Number(c),!isFinite(c))throw new Error("Keyframe offsets must be numbers.");if(c<0||c>1)throw new Error("Keyframe offsets must be between 0 and 1.");l.computedOffset=c}}else if(f==="composite"&&["replace","add","accumulate","auto"].indexOf(c)===-1)throw new Error(c+" compositing is not supported");l[f]=c}return l.offset===void 0&&(l.offset=null),l.easing===void 0&&(l.easing=(n==null?void 0:n.easing)||"linear"),l.composite===void 0&&(l.composite="auto"),l}),t=!0,r=-1/0,a=0;a<i.length;a++){var o=i[a].offset;if(ae(o))t=!1;else{if(o<r)throw new TypeError("Keyframes are not loosely sorted by offset. Sort or specify offsets.");r=o}}i=i.filter(function(u){return Number(u.offset)>=0&&Number(u.offset)<=1});function s(){var u,l=i.length;if(i[l-1].computedOffset=Number((u=i[l-1].offset)!==null&&u!==void 0?u:1),l>1){var f;i[0].computedOffset=Number((f=i[0].offset)!==null&&f!==void 0?f:0)}for(var c=0,h=Number(i[0].computedOffset),p=1;p<l;p++){var g=i[p].computedOffset;if(!ae(g)&&!ae(h)){for(var _=1;_<p-c;_++)i[c+_].computedOffset=h+(Number(g)-h)*_/(p-c);c=p,h=Number(g)}}}return t||s(),i}var F_="backwards|forwards|both|none".split("|"),U_="reverse|alternate|alternate-reverse".split("|");function k_(e,n){var i=new w_;return n&&(i.fill="both",i.duration="auto"),typeof e=="number"&&!isNaN(e)?i.duration=e:e!==void 0&&Object.keys(e).forEach(function(t){if(e[t]!==void 0&&e[t]!==null&&e[t]!=="auto"){if((typeof i[t]=="number"||t==="duration")&&(typeof e[t]!="number"||isNaN(e[t]))||t==="fill"&&F_.indexOf(e[t])===-1||t==="direction"&&U_.indexOf(e[t])===-1)return;i[t]=e[t]}}),i}function L_(e,n){var i;return e=W_((i=e)!==null&&i!==void 0?i:{duration:"auto"}),k_(e,n)}function W_(e){return typeof e=="number"&&(isNaN(e)?e={duration:"auto"}:e={duration:e}),e}var H_=function(){function e(i,t,r){var a=this;this.composite="replace",this.iterationComposite="replace",this.target=void 0,this.animation=void 0,this.timing=void 0,this.computedTiming=void 0,this.normalizedKeyframes=void 0,this.timeFraction=void 0,this.interpolations=void 0,this.target=i,this.timing=L_(r,!1),this.timing.effect=this,this.timing.activeDuration=T_(this.timing),this.timing.endTime=Math.max(0,this.timing.delay+this.timing.activeDuration+this.timing.endDelay),this.normalizedKeyframes=ef(t,this.timing),this.interpolations=N_(this.normalizedKeyframes,this.timing,this.target);var o=X.globalThis.Proxy;this.computedTiming=o?new o(this.timing,{get:function(u,l){return l==="duration"?u.duration==="auto"?0:u.duration:l==="fill"?u.fill==="auto"?"none":u.fill:l==="localTime"?a.animation&&a.animation.currentTime||null:l==="currentIteration"?!a.animation||a.animation.playState!=="running"?null:u.currentIteration||0:l==="progress"?!a.animation||a.animation.playState!=="running"?null:u.progress||0:u[l]},set:function(){return!0}}):this.timing}var n=e.prototype;return n.applyInterpolations=function(){this.interpolations(this.target,Number(this.timeFraction))},n.update=function(t){return t===null?!1:(this.timeFraction=O_(this.timing.activeDuration,t,this.timing),this.timeFraction!==null)},n.getKeyframes=function(){return this.normalizedKeyframes},n.setKeyframes=function(t){this.normalizedKeyframes=ef(t)},n.getComputedTiming=function(){return this.computedTiming},n.getTiming=function(){return this.timing},n.updateTiming=function(t){var r=this;Object.keys(t||{}).forEach(function(a){r.timing[a]=t[a]})},e}();function tf(e,n){return Number(e.id)-Number(n.id)}var X_=function(){function e(i){var t=this;this.document=void 0,this.animations=[],this.ticking=!1,this.timelineTicking=!1,this.hasRestartedThisFrame=!1,this.animationsWithPromises=[],this.inTick=!1,this.pendingEffects=[],this.currentTime=null,this.rafId=0,this.rafCallbacks=[],this.frameId=void 0,this.webAnimationsNextTick=function(r){t.currentTime=r,t.discardAnimations(),t.animations.length===0?t.timelineTicking=!1:t.requestAnimationFrame(t.webAnimationsNextTick)},this.processRafCallbacks=function(r){var a=t.rafCallbacks;t.rafCallbacks=[],r<Number(t.currentTime)&&(r=Number(t.currentTime)),t.animations.sort(tf),t.animations=t.tick(r,!0,t.animations)[0],a.forEach(function(o){o[1](r)}),t.applyPendingEffects()},this.document=i}var n=e.prototype;return n.getAnimations=function(){return this.discardAnimations(),this.animations.slice()},n.isTicking=function(){return this.inTick},n.play=function(t,r,a){var o=new H_(t,r,a),s=new i_(o,this);return this.animations.push(s),this.restartWebAnimationsNextTick(),s.updatePromises(),s.play(),s.updatePromises(),s},n.applyDirtiedAnimation=function(t){var r=this;if(!this.inTick){t.markTarget();var a=t.targetAnimations();a.sort(tf);var o=this.tick(Number(this.currentTime),!1,a.slice())[1];o.forEach(function(s){var u=r.animations.indexOf(s);u!==-1&&r.animations.splice(u,1)}),this.applyPendingEffects()}},n.restart=function(){return this.ticking||(this.ticking=!0,this.requestAnimationFrame(function(){}),this.hasRestartedThisFrame=!0),this.hasRestartedThisFrame},n.destroy=function(){this.document.defaultView.cancelAnimationFrame(this.frameId)},n.applyPendingEffects=function(){this.pendingEffects.forEach(function(t){t==null||t.applyInterpolations()}),this.pendingEffects=[]},n.updateAnimationsPromises=function(){this.animationsWithPromises=this.animationsWithPromises.filter(function(t){return t.updatePromises()})},n.discardAnimations=function(){this.updateAnimationsPromises(),this.animations=this.animations.filter(function(t){return t.playState!=="finished"&&t.playState!=="idle"})},n.restartWebAnimationsNextTick=function(){this.timelineTicking||(this.timelineTicking=!0,this.requestAnimationFrame(this.webAnimationsNextTick))},n.rAF=function(t){var r=this.rafId++;return this.rafCallbacks.length===0&&(this.frameId=this.document.defaultView.requestAnimationFrame(this.processRafCallbacks)),this.rafCallbacks.push([r,t]),r},n.requestAnimationFrame=function(t){var r=this;return this.rAF(function(a){r.updateAnimationsPromises(),t(a),r.updateAnimationsPromises()})},n.tick=function(t,r,a){var o=this,s,u;this.inTick=!0,this.hasRestartedThisFrame=!1,this.currentTime=t,this.ticking=!1;var l=[],f=[],c=[],h=[];return a.forEach(function(p){p.tick(t,r),p._inEffect?(f.push(p.effect),p.markTarget()):(l.push(p.effect),p.unmarkTarget()),p._needsTick&&(o.ticking=!0);var g=p._inEffect||p._needsTick;p._inTimeline=g,g?c.push(p):h.push(p)}),(s=this.pendingEffects).push.apply(s,l),(u=this.pendingEffects).push.apply(u,f),this.ticking&&this.requestAnimationFrame(function(){}),this.inTick=!1,[c,h]},e}();X.EasingFunction=vu;X.AnimationTimeline=X_;var rf={},V_={get exports(){return rf},set exports(e){rf=e}};(function(e){var n=function(i){var t=Object.prototype,r=t.hasOwnProperty,a=Object.defineProperty||function(w,U,V){w[U]=V.value},o,s=typeof Symbol=="function"?Symbol:{},u=s.iterator||"@@iterator",l=s.asyncIterator||"@@asyncIterator",f=s.toStringTag||"@@toStringTag";function c(w,U,V){return Object.defineProperty(w,U,{value:V,enumerable:!0,configurable:!0,writable:!0}),w[U]}try{c({},"")}catch{c=function(U,V,K){return U[V]=K}}function h(w,U,V,K){var z=U&&U.prototype instanceof A?U:A,le=Object.create(z.prototype),Se=new T(K||[]);return a(le,"_invoke",{value:d(w,V,Se)}),le}i.wrap=h;function p(w,U,V){try{return{type:"normal",arg:w.call(U,V)}}catch(K){return{type:"throw",arg:K}}}var g="suspendedStart",_="suspendedYield",E="executing",y="completed",R={};function A(){}function M(){}function x(){}var P={};c(P,u,function(){return this});var C=Object.getPrototypeOf,O=C&&C(C(N([])));O&&O!==t&&r.call(O,u)&&(P=O);var D=x.prototype=A.prototype=Object.create(P);M.prototype=x,a(D,"constructor",{value:x,configurable:!0}),a(x,"constructor",{value:M,configurable:!0}),M.displayName=c(x,f,"GeneratorFunction");function F(w){["next","throw","return"].forEach(function(U){c(w,U,function(V){return this._invoke(U,V)})})}i.isGeneratorFunction=function(w){var U=typeof w=="function"&&w.constructor;return U?U===M||(U.displayName||U.name)==="GeneratorFunction":!1},i.mark=function(w){return Object.setPrototypeOf?Object.setPrototypeOf(w,x):(w.__proto__=x,c(w,f,"GeneratorFunction")),w.prototype=Object.create(D),w},i.awrap=function(w){return{__await:w}};function k(w,U){function V(le,Se,Ae,ge){var ye=p(w[le],w,Se);if(ye.type==="throw")ge(ye.arg);else{var ve=ye.arg,ie=ve.value;return ie&&typeof ie=="object"&&r.call(ie,"__await")?U.resolve(ie.__await).then(function(we){V("next",we,Ae,ge)},function(we){V("throw",we,Ae,ge)}):U.resolve(ie).then(function(we){ve.value=we,Ae(ve)},function(we){return V("throw",we,Ae,ge)})}}var K;function z(le,Se){function Ae(){return new U(function(ge,ye){V(le,Se,ge,ye)})}return K=K?K.then(Ae,Ae):Ae()}a(this,"_invoke",{value:z})}F(k.prototype),c(k.prototype,l,function(){return this}),i.AsyncIterator=k,i.async=function(w,U,V,K,z){z===void 0&&(z=Promise);var le=new k(h(w,U,V,K),z);return i.isGeneratorFunction(U)?le:le.next().then(function(Se){return Se.done?Se.value:le.next()})};function d(w,U,V){var K=g;return function(le,Se){if(K===E)throw new Error("Generator is already running");if(K===y){if(le==="throw")throw Se;return B()}for(V.method=le,V.arg=Se;;){var Ae=V.delegate;if(Ae){var ge=v(Ae,V);if(ge){if(ge===R)continue;return ge}}if(V.method==="next")V.sent=V._sent=V.arg;else if(V.method==="throw"){if(K===g)throw K=y,V.arg;V.dispatchException(V.arg)}else V.method==="return"&&V.abrupt("return",V.arg);K=E;var ye=p(w,U,V);if(ye.type==="normal"){if(K=V.done?y:_,ye.arg===R)continue;return{value:ye.arg,done:V.done}}else ye.type==="throw"&&(K=y,V.method="throw",V.arg=ye.arg)}}}function v(w,U){var V=U.method,K=w.iterator[V];if(K===o)return U.delegate=null,V==="throw"&&w.iterator.return&&(U.method="return",U.arg=o,v(w,U),U.method==="throw")||V!=="return"&&(U.method="throw",U.arg=new TypeError("The iterator does not provide a '"+V+"' method")),R;var z=p(K,w.iterator,U.arg);if(z.type==="throw")return U.method="throw",U.arg=z.arg,U.delegate=null,R;var le=z.arg;if(!le)return U.method="throw",U.arg=new TypeError("iterator result is not an object"),U.delegate=null,R;if(le.done)U[w.resultName]=le.value,U.next=w.nextLoc,U.method!=="return"&&(U.method="next",U.arg=o);else return le;return U.delegate=null,R}F(D),c(D,f,"Generator"),c(D,u,function(){return this}),c(D,"toString",function(){return"[object Generator]"});function m(w){var U={tryLoc:w[0]};1 in w&&(U.catchLoc=w[1]),2 in w&&(U.finallyLoc=w[2],U.afterLoc=w[3]),this.tryEntries.push(U)}function S(w){var U=w.completion||{};U.type="normal",delete U.arg,w.completion=U}function T(w){this.tryEntries=[{tryLoc:"root"}],w.forEach(m,this),this.reset(!0)}i.keys=function(w){var U=Object(w),V=[];for(var K in U)V.push(K);return V.reverse(),function z(){for(;V.length;){var le=V.pop();if(le in U)return z.value=le,z.done=!1,z}return z.done=!0,z}};function N(w){if(w){var U=w[u];if(U)return U.call(w);if(typeof w.next=="function")return w;if(!isNaN(w.length)){var V=-1,K=function z(){for(;++V<w.length;)if(r.call(w,V))return z.value=w[V],z.done=!1,z;return z.value=o,z.done=!0,z};return K.next=K}}return{next:B}}i.values=N;function B(){return{value:o,done:!0}}return T.prototype={constructor:T,reset:function(w){if(this.prev=0,this.next=0,this.sent=this._sent=o,this.done=!1,this.delegate=null,this.method="next",this.arg=o,this.tryEntries.forEach(S),!w)for(var U in this)U.charAt(0)==="t"&&r.call(this,U)&&!isNaN(+U.slice(1))&&(this[U]=o)},stop:function(){this.done=!0;var w=this.tryEntries[0],U=w.completion;if(U.type==="throw")throw U.arg;return this.rval},dispatchException:function(w){if(this.done)throw w;var U=this;function V(ge,ye){return le.type="throw",le.arg=w,U.next=ge,ye&&(U.method="next",U.arg=o),!!ye}for(var K=this.tryEntries.length-1;K>=0;--K){var z=this.tryEntries[K],le=z.completion;if(z.tryLoc==="root")return V("end");if(z.tryLoc<=this.prev){var Se=r.call(z,"catchLoc"),Ae=r.call(z,"finallyLoc");if(Se&&Ae){if(this.prev<z.catchLoc)return V(z.catchLoc,!0);if(this.prev<z.finallyLoc)return V(z.finallyLoc)}else if(Se){if(this.prev<z.catchLoc)return V(z.catchLoc,!0)}else if(Ae){if(this.prev<z.finallyLoc)return V(z.finallyLoc)}else throw new Error("try statement without catch or finally")}}},abrupt:function(w,U){for(var V=this.tryEntries.length-1;V>=0;--V){var K=this.tryEntries[V];if(K.tryLoc<=this.prev&&r.call(K,"finallyLoc")&&this.prev<K.finallyLoc){var z=K;break}}z&&(w==="break"||w==="continue")&&z.tryLoc<=U&&U<=z.finallyLoc&&(z=null);var le=z?z.completion:{};return le.type=w,le.arg=U,z?(this.method="next",this.next=z.finallyLoc,R):this.complete(le)},complete:function(w,U){if(w.type==="throw")throw w.arg;return w.type==="break"||w.type==="continue"?this.next=w.arg:w.type==="return"?(this.rval=this.arg=w.arg,this.method="return",this.next="end"):w.type==="normal"&&U&&(this.next=U),R},finish:function(w){for(var U=this.tryEntries.length-1;U>=0;--U){var V=this.tryEntries[U];if(V.finallyLoc===w)return this.complete(V.completion,V.afterLoc),S(V),R}},catch:function(w){for(var U=this.tryEntries.length-1;U>=0;--U){var V=this.tryEntries[U];if(V.tryLoc===w){var K=V.completion;if(K.type==="throw"){var z=K.arg;S(V)}return z}}throw new Error("illegal catch attempt")},delegateYield:function(w,U,V){return this.delegate={iterator:N(w),resultName:U,nextLoc:V},this.method==="next"&&(this.arg=o),R}},i}(e.exports);try{regeneratorRuntime=n}catch{typeof globalThis=="object"?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}})(V_);var bi={},Y_={get exports(){return bi},set exports(e){bi=e}};Y_.exports=fo;bi.default=fo;function fo(e,n,i){i=i||2;var t=n&&n.length,r=t?n[0]*i:e.length,a=uh(e,0,r,i,!0),o=[];if(!a||a.next===a.prev)return o;var s,u,l,f,c,h,p;if(t&&(a=q_(e,n,a,i)),e.length>80*i){s=l=e[0],u=f=e[1];for(var g=i;g<r;g+=i)c=e[g],h=e[g+1],c<s&&(s=c),h<u&&(u=h),c>l&&(l=c),h>f&&(f=h);p=Math.max(l-s,f-u),p=p!==0?32767/p:0}return wi(a,o,i,s,u,p,0),o}function uh(e,n,i,t,r){var a,o;if(r===Ps(e,n,i,t)>0)for(a=n;a<i;a+=t)o=nf(a,e[a],e[a+1],o);else for(a=i-t;a>=n;a-=t)o=nf(a,e[a],e[a+1],o);return o&&co(o,o.next)&&(Fi(o),o=o.next),o}function Sn(e,n){if(!e)return e;n||(n=e);var i=e,t;do if(t=!1,!i.steiner&&(co(i,i.next)||ze(i.prev,i,i.next)===0)){if(Fi(i),i=n=i.prev,i===i.next)break;t=!0}else i=i.next;while(t||i!==n);return n}function wi(e,n,i,t,r,a,o){if(e){!o&&a&&eE(e,t,r,a);for(var s=e,u,l;e.prev!==e.next;){if(u=e.prev,l=e.next,a?G_(e,t,r,a):z_(e)){n.push(u.i/i|0),n.push(e.i/i|0),n.push(l.i/i|0),Fi(e),e=l.next,s=l.next;continue}if(e=l,e===s){o?o===1?(e=K_(Sn(e),n,i),wi(e,n,i,t,r,a,2)):o===2&&$_(e,n,i,t,r,a):wi(Sn(e),n,i,t,r,a,1);break}}}}function z_(e){var n=e.prev,i=e,t=e.next;if(ze(n,i,t)>=0)return!1;for(var r=n.x,a=i.x,o=t.x,s=n.y,u=i.y,l=t.y,f=r<a?r<o?r:o:a<o?a:o,c=s<u?s<l?s:l:u<l?u:l,h=r>a?r>o?r:o:a>o?a:o,p=s>u?s>l?s:l:u>l?u:l,g=t.next;g!==n;){if(g.x>=f&&g.x<=h&&g.y>=c&&g.y<=p&&Un(r,s,a,u,o,l,g.x,g.y)&&ze(g.prev,g,g.next)>=0)return!1;g=g.next}return!0}function G_(e,n,i,t){var r=e.prev,a=e,o=e.next;if(ze(r,a,o)>=0)return!1;for(var s=r.x,u=a.x,l=o.x,f=r.y,c=a.y,h=o.y,p=s<u?s<l?s:l:u<l?u:l,g=f<c?f<h?f:h:c<h?c:h,_=s>u?s>l?s:l:u>l?u:l,E=f>c?f>h?f:h:c>h?c:h,y=Ss(p,g,n,i,t),R=Ss(_,E,n,i,t),A=e.prevZ,M=e.nextZ;A&&A.z>=y&&M&&M.z<=R;){if(A.x>=p&&A.x<=_&&A.y>=g&&A.y<=E&&A!==r&&A!==o&&Un(s,f,u,c,l,h,A.x,A.y)&&ze(A.prev,A,A.next)>=0||(A=A.prevZ,M.x>=p&&M.x<=_&&M.y>=g&&M.y<=E&&M!==r&&M!==o&&Un(s,f,u,c,l,h,M.x,M.y)&&ze(M.prev,M,M.next)>=0))return!1;M=M.nextZ}for(;A&&A.z>=y;){if(A.x>=p&&A.x<=_&&A.y>=g&&A.y<=E&&A!==r&&A!==o&&Un(s,f,u,c,l,h,A.x,A.y)&&ze(A.prev,A,A.next)>=0)return!1;A=A.prevZ}for(;M&&M.z<=R;){if(M.x>=p&&M.x<=_&&M.y>=g&&M.y<=E&&M!==r&&M!==o&&Un(s,f,u,c,l,h,M.x,M.y)&&ze(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function K_(e,n,i){var t=e;do{var r=t.prev,a=t.next.next;!co(r,a)&&lh(r,t,t.next,a)&&Bi(r,a)&&Bi(a,r)&&(n.push(r.i/i|0),n.push(t.i/i|0),n.push(a.i/i|0),Fi(t),Fi(t.next),t=e=a),t=t.next}while(t!==e);return Sn(t)}function $_(e,n,i,t,r,a){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&nE(o,s)){var u=fh(o,s);o=Sn(o,o.next),u=Sn(u,u.next),wi(o,n,i,t,r,a,0),wi(u,n,i,t,r,a,0);return}s=s.next}o=o.next}while(o!==e)}function q_(e,n,i,t){var r=[],a,o,s,u,l;for(a=0,o=n.length;a<o;a++)s=n[a]*t,u=a<o-1?n[a+1]*t:e.length,l=uh(e,s,u,t,!1),l===l.next&&(l.steiner=!0),r.push(rE(l));for(r.sort(Z_),a=0;a<r.length;a++)i=Q_(r[a],i);return i}function Z_(e,n){return e.x-n.x}function Q_(e,n){var i=J_(e,n);if(!i)return n;var t=fh(i,e);return Sn(t,t.next),Sn(i,i.next)}function J_(e,n){var i=n,t=e.x,r=e.y,a=-1/0,o;do{if(r<=i.y&&r>=i.next.y&&i.next.y!==i.y){var s=i.x+(r-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(s<=t&&s>a&&(a=s,o=i.x<i.next.x?i:i.next,s===t))return o}i=i.next}while(i!==n);if(!o)return null;var u=o,l=o.x,f=o.y,c=1/0,h;i=o;do t>=i.x&&i.x>=l&&t!==i.x&&Un(r<f?t:a,r,l,f,r<f?a:t,r,i.x,i.y)&&(h=Math.abs(r-i.y)/(t-i.x),Bi(i,e)&&(h<c||h===c&&(i.x>o.x||i.x===o.x&&j_(o,i)))&&(o=i,c=h)),i=i.next;while(i!==u);return o}function j_(e,n){return ze(e.prev,e,n.prev)<0&&ze(n.next,e,e.next)<0}function eE(e,n,i,t){var r=e;do r.z===0&&(r.z=Ss(r.x,r.y,n,i,t)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next;while(r!==e);r.prevZ.nextZ=null,r.prevZ=null,tE(r)}function tE(e){var n,i,t,r,a,o,s,u,l=1;do{for(i=e,e=null,a=null,o=0;i;){for(o++,t=i,s=0,n=0;n<l&&(s++,t=t.nextZ,!!t);n++);for(u=l;s>0||u>0&&t;)s!==0&&(u===0||!t||i.z<=t.z)?(r=i,i=i.nextZ,s--):(r=t,t=t.nextZ,u--),a?a.nextZ=r:e=r,r.prevZ=a,a=r;i=t}a.nextZ=null,l*=2}while(o>1);return e}function Ss(e,n,i,t,r){return e=(e-i)*r|0,n=(n-t)*r|0,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,n=(n|n<<8)&16711935,n=(n|n<<4)&252645135,n=(n|n<<2)&858993459,n=(n|n<<1)&1431655765,e|n<<1}function rE(e){var n=e,i=e;do(n.x<i.x||n.x===i.x&&n.y<i.y)&&(i=n),n=n.next;while(n!==e);return i}function Un(e,n,i,t,r,a,o,s){return(r-o)*(n-s)>=(e-o)*(a-s)&&(e-o)*(t-s)>=(i-o)*(n-s)&&(i-o)*(a-s)>=(r-o)*(t-s)}function nE(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!iE(e,n)&&(Bi(e,n)&&Bi(n,e)&&aE(e,n)&&(ze(e.prev,e,n.prev)||ze(e,n.prev,n))||co(e,n)&&ze(e.prev,e,e.next)>0&&ze(n.prev,n,n.next)>0)}function ze(e,n,i){return(n.y-e.y)*(i.x-n.x)-(n.x-e.x)*(i.y-n.y)}function co(e,n){return e.x===n.x&&e.y===n.y}function lh(e,n,i,t){var r=Ra(ze(e,n,i)),a=Ra(ze(e,n,t)),o=Ra(ze(i,t,e)),s=Ra(ze(i,t,n));return!!(r!==a&&o!==s||r===0&&Ta(e,i,n)||a===0&&Ta(e,t,n)||o===0&&Ta(i,e,t)||s===0&&Ta(i,n,t))}function Ta(e,n,i){return n.x<=Math.max(e.x,i.x)&&n.x>=Math.min(e.x,i.x)&&n.y<=Math.max(e.y,i.y)&&n.y>=Math.min(e.y,i.y)}function Ra(e){return e>0?1:e<0?-1:0}function iE(e,n){var i=e;do{if(i.i!==e.i&&i.next.i!==e.i&&i.i!==n.i&&i.next.i!==n.i&&lh(i,i.next,e,n))return!0;i=i.next}while(i!==e);return!1}function Bi(e,n){return ze(e.prev,e,e.next)<0?ze(e,n,e.next)>=0&&ze(e,e.prev,n)>=0:ze(e,n,e.prev)<0||ze(e,e.next,n)<0}function aE(e,n){var i=e,t=!1,r=(e.x+n.x)/2,a=(e.y+n.y)/2;do i.y>a!=i.next.y>a&&i.next.y!==i.y&&r<(i.next.x-i.x)*(a-i.y)/(i.next.y-i.y)+i.x&&(t=!t),i=i.next;while(i!==e);return t}function fh(e,n){var i=new As(e.i,e.x,e.y),t=new As(n.i,n.x,n.y),r=e.next,a=n.prev;return e.next=n,n.prev=e,i.next=r,r.prev=i,t.next=i,i.prev=t,a.next=t,t.prev=a,t}function nf(e,n,i,t){var r=new As(e,n,i);return t?(r.next=t.next,r.prev=t,t.next.prev=r,t.next=r):(r.prev=r,r.next=r),r}function Fi(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function As(e,n,i){this.i=e,this.x=n,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}fo.deviation=function(e,n,i,t){var r=n&&n.length,a=r?n[0]*i:e.length,o=Math.abs(Ps(e,0,a,i));if(r)for(var s=0,u=n.length;s<u;s++){var l=n[s]*i,f=s<u-1?n[s+1]*i:e.length;o-=Math.abs(Ps(e,l,f,i))}var c=0;for(s=0;s<t.length;s+=3){var h=t[s]*i,p=t[s+1]*i,g=t[s+2]*i;c+=Math.abs((e[h]-e[g])*(e[p+1]-e[h+1])-(e[h]-e[p])*(e[g+1]-e[h+1]))}return o===0&&c===0?0:Math.abs((c-o)/o)};function Ps(e,n,i,t){for(var r=0,a=n,o=i-t;a<i;a+=t)r+=(e[o]-e[a])*(e[a+1]+e[o+1]),o=a;return r}fo.flatten=function(e){for(var n=e[0][0].length,i={vertices:[],holes:[],dimensions:n},t=0,r=0;r<e.length;r++){for(var a=0;a<e[r].length;a++)for(var o=0;o<n;o++)i.vertices.push(e[r][a][o]);r>0&&(t+=e[r-1].length,i.holes.push(t))}return i};function dr(){dr=function(){return e};var e={},n=Object.prototype,i=n.hasOwnProperty,t=Object.defineProperty||function(d,v,m){d[v]=m.value},r=typeof Symbol=="function"?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(d,v,m){return Object.defineProperty(d,v,{value:m,enumerable:!0,configurable:!0,writable:!0}),d[v]}try{u({},"")}catch{u=function(v,m,S){return v[m]=S}}function l(d,v,m,S){var T=v&&v.prototype instanceof h?v:h,N=Object.create(T.prototype),B=new D(S||[]);return t(N,"_invoke",{value:x(d,m,B)}),N}function f(d,v,m){try{return{type:"normal",arg:d.call(v,m)}}catch(S){return{type:"throw",arg:S}}}e.wrap=l;var c={};function h(){}function p(){}function g(){}var _={};u(_,a,function(){return this});var E=Object.getPrototypeOf,y=E&&E(E(F([])));y&&y!==n&&i.call(y,a)&&(_=y);var R=g.prototype=h.prototype=Object.create(_);function A(d){["next","throw","return"].forEach(function(v){u(d,v,function(m){return this._invoke(v,m)})})}function M(d,v){function m(T,N,B,w){var U=f(d[T],d,N);if(U.type!=="throw"){var V=U.arg,K=V.value;return K&&typeof K=="object"&&i.call(K,"__await")?v.resolve(K.__await).then(function(z){m("next",z,B,w)},function(z){m("throw",z,B,w)}):v.resolve(K).then(function(z){V.value=z,B(V)},function(z){return m("throw",z,B,w)})}w(U.arg)}var S;t(this,"_invoke",{value:function(T,N){function B(){return new v(function(w,U){m(T,N,w,U)})}return S=S?S.then(B,B):B()}})}function x(d,v,m){var S="suspendedStart";return function(T,N){if(S==="executing")throw new Error("Generator is already running");if(S==="completed"){if(T==="throw")throw N;return k()}for(m.method=T,m.arg=N;;){var B=m.delegate;if(B){var w=P(B,m);if(w){if(w===c)continue;return w}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(S==="suspendedStart")throw S="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);S="executing";var U=f(d,v,m);if(U.type==="normal"){if(S=m.done?"completed":"suspendedYield",U.arg===c)continue;return{value:U.arg,done:m.done}}U.type==="throw"&&(S="completed",m.method="throw",m.arg=U.arg)}}}function P(d,v){var m=v.method,S=d.iterator[m];if(S===void 0)return v.delegate=null,m==="throw"&&d.iterator.return&&(v.method="return",v.arg=void 0,P(d,v),v.method==="throw")||m!=="return"&&(v.method="throw",v.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var T=f(S,d.iterator,v.arg);if(T.type==="throw")return v.method="throw",v.arg=T.arg,v.delegate=null,c;var N=T.arg;return N?N.done?(v[d.resultName]=N.value,v.next=d.nextLoc,v.method!=="return"&&(v.method="next",v.arg=void 0),v.delegate=null,c):N:(v.method="throw",v.arg=new TypeError("iterator result is not an object"),v.delegate=null,c)}function C(d){var v={tryLoc:d[0]};1 in d&&(v.catchLoc=d[1]),2 in d&&(v.finallyLoc=d[2],v.afterLoc=d[3]),this.tryEntries.push(v)}function O(d){var v=d.completion||{};v.type="normal",delete v.arg,d.completion=v}function D(d){this.tryEntries=[{tryLoc:"root"}],d.forEach(C,this),this.reset(!0)}function F(d){if(d){var v=d[a];if(v)return v.call(d);if(typeof d.next=="function")return d;if(!isNaN(d.length)){var m=-1,S=function T(){for(;++m<d.length;)if(i.call(d,m))return T.value=d[m],T.done=!1,T;return T.value=void 0,T.done=!0,T};return S.next=S}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=g,t(R,"constructor",{value:g,configurable:!0}),t(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(d){var v=typeof d=="function"&&d.constructor;return!!v&&(v===p||(v.displayName||v.name)==="GeneratorFunction")},e.mark=function(d){return Object.setPrototypeOf?Object.setPrototypeOf(d,g):(d.__proto__=g,u(d,s,"GeneratorFunction")),d.prototype=Object.create(R),d},e.awrap=function(d){return{__await:d}},A(M.prototype),u(M.prototype,o,function(){return this}),e.AsyncIterator=M,e.async=function(d,v,m,S,T){T===void 0&&(T=Promise);var N=new M(l(d,v,m,S),T);return e.isGeneratorFunction(v)?N:N.next().then(function(B){return B.done?B.value:N.next()})},A(R),u(R,s,"Generator"),u(R,a,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),e.keys=function(d){var v=Object(d),m=[];for(var S in v)m.push(S);return m.reverse(),function T(){for(;m.length;){var N=m.pop();if(N in v)return T.value=N,T.done=!1,T}return T.done=!0,T}},e.values=F,D.prototype={constructor:D,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!d)for(var v in this)v.charAt(0)==="t"&&i.call(this,v)&&!isNaN(+v.slice(1))&&(this[v]=void 0)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var v=this;function m(U,V){return N.type="throw",N.arg=d,v.next=U,V&&(v.method="next",v.arg=void 0),!!V}for(var S=this.tryEntries.length-1;S>=0;--S){var T=this.tryEntries[S],N=T.completion;if(T.tryLoc==="root")return m("end");if(T.tryLoc<=this.prev){var B=i.call(T,"catchLoc"),w=i.call(T,"finallyLoc");if(B&&w){if(this.prev<T.catchLoc)return m(T.catchLoc,!0);if(this.prev<T.finallyLoc)return m(T.finallyLoc)}else if(B){if(this.prev<T.catchLoc)return m(T.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return m(T.finallyLoc)}}}},abrupt:function(d,v){for(var m=this.tryEntries.length-1;m>=0;--m){var S=this.tryEntries[m];if(S.tryLoc<=this.prev&&i.call(S,"finallyLoc")&&this.prev<S.finallyLoc){var T=S;break}}T&&(d==="break"||d==="continue")&&T.tryLoc<=v&&v<=T.finallyLoc&&(T=null);var N=T?T.completion:{};return N.type=d,N.arg=v,T?(this.method="next",this.next=T.finallyLoc,c):this.complete(N)},complete:function(d,v){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&v&&(this.next=v),c},finish:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.finallyLoc===d)return this.complete(m.completion,m.afterLoc),O(m),c}},catch:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.tryLoc===d){var S=m.completion;if(S.type==="throw"){var T=S.arg;O(m)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(d,v,m){return this.delegate={iterator:F(d),resultName:v,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},e}function af(e,n,i,t,r,a,o){try{var s=e[a](o),u=s.value}catch(l){i(l);return}s.done?n(u):Promise.resolve(u).then(t,r)}function Xa(e){return function(){var n=this,i=arguments;return new Promise(function(t,r){var a=e.apply(n,i);function o(u){af(a,t,r,o,s,"next",u)}function s(u){af(a,t,r,o,s,"throw",u)}o(void 0)})}}function of(e,n){for(var i=0;i<n.length;i++){var t=n[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,uE(t.key),t)}}function ch(e,n,i){return n&&of(e.prototype,n),i&&of(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Me(){return Me=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},Me.apply(this,arguments)}function $e(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,xs(e,n)}function xs(e,n){return xs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},xs(e,n)}function gu(e,n){if(e==null)return{};var i={},t=Object.keys(e),r,a;for(a=0;a<t.length;a++)r=t[a],!(n.indexOf(r)>=0)&&(i[r]=e[r]);return i}function sf(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function oE(e,n){if(e){if(typeof e=="string")return uf(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return uf(e,n)}}function uf(e,n){(n==null||n>e.length)&&(n=e.length);for(var i=0,t=new Array(n);i<n;i++)t[i]=e[i];return t}function yr(e,n){var i=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=oE(e))||n&&e&&typeof e.length=="number"){i&&(e=i);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function sE(e,n){if(typeof e!="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var t=i.call(e,n||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function uE(e){var n=sE(e,"string");return typeof n=="symbol"?n:String(n)}var hh=function(){this.pickingId=void 0,this.encodedPickingColor=void 0,this.meshes=[]};hh.tag="c-renderable-3d";var lE=function(){function e(){this.lights=[],this.fog=void 0}var n=e.prototype;return n.addLight=function(t){this.lights.push(t),this.sortLights()},n.removeLight=function(t){var r=this.lights.indexOf(t);this.lights.splice(r,1),this.sortLights()},n.addFog=function(t){this.fog=t},n.removeFog=function(t){this.fog=null},n.getFog=function(){return this.fog},n.getAllLights=function(){return this.lights},n.getDefines=function(){var t={USE_LIGHT:!!this.lights.length};return this.lights.forEach(function(r){t[r.define]||(t[r.define]=0),t[r.define]++}),t},n.sortLights=function(){this.lights.sort(function(t,r){return t.order-r.order})},e}(),fE=["style"],cE=function(e){$e(n,e);function n(t){var r,a=t.style,o=gu(t,fE);return r=e.call(this,Me({type:H.MESH,style:Me({x:"",y:"",z:"",lineWidth:0},a)},o))||this,r.cullable.enable=!1,r.style.geometry.meshes.push(sf(r)),r.style.material.meshes.push(sf(r)),r}var i=n.prototype;return i.destroy=function(){e.prototype.destroy.call(this);var r=this.style.geometry.meshes,a=r.indexOf(this);r.splice(a,1),r=this.style.material.meshes,a=r.indexOf(this),r.splice(a,1)},n}(At),hE=function(){function e(){}var n=e.prototype;return n.update=function(t){var r=t.geometry;return r.computeBoundingBox(),{width:0,height:0,depth:0}},e}(),dE=function(){function e(){this.counter=0,this.id2DisplayObjectMap={}}var n=e.prototype;return n.getId=function(t){var r=this.counter++;return this.id2DisplayObjectMap[r]=t,r},n.getById=function(t){return this.id2DisplayObjectMap[t]},n.reset=function(){this.counter=0,this.id2DisplayObjectMap={}},n.decodePickingColor=function(t){var r=t[0],a=t[1],o=t[2],s=r+a*256+o*65536-1;return s},n.encodePickingColor=function(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]},e}(),Ze;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.InputState=7]="InputState",e[e.RenderPipeline=8]="RenderPipeline",e[e.ComputePipeline=9]="ComputePipeline",e[e.Readback=10]="Readback",e[e.QueryPool=11]="QueryPool"})(Ze||(Ze={}));var an;(function(e){e[e.Never=512]="Never",e[e.Less=513]="Less",e[e.Equal=514]="Equal",e[e.LessEqual=515]="LessEqual",e[e.Greater=516]="Greater",e[e.NotEqual=517]="NotEqual",e[e.GreaterEqual=518]="GreaterEqual",e[e.Always=519]="Always"})(an||(an={}));var Ms;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Ms||(Ms={}));var hr;(function(e){e[e.None=0]="None",e[e.Front=1]="Front",e[e.Back=2]="Back",e[e.FrontAndBack=3]="FrontAndBack"})(hr||(hr={}));var Ft;(function(e){e[e.Zero=0]="Zero",e[e.One=1]="One",e[e.Src=768]="Src",e[e.OneMinusSrc=769]="OneMinusSrc",e[e.Dst=774]="Dst",e[e.OneMinusDst=775]="OneMinusDst",e[e.SrcAlpha=770]="SrcAlpha",e[e.OneMinusSrcAlpha=771]="OneMinusSrcAlpha",e[e.DstAlpha=772]="DstAlpha",e[e.OneMinusDstAlpha=773]="OneMinusDstAlpha"})(Ft||(Ft={}));var on;(function(e){e[e.Add=32774]="Add",e[e.Subtract=32778]="Subtract",e[e.ReverseSubtract=32779]="ReverseSubtract"})(on||(on={}));var Lr;(function(e){e[e.Clamp=0]="Clamp",e[e.Repeat=1]="Repeat",e[e.Mirror=2]="Mirror"})(Lr||(Lr={}));var _t;(function(e){e[e.Point=0]="Point",e[e.Bilinear=1]="Bilinear"})(_t||(_t={}));var bt;(function(e){e[e.NoMip=0]="NoMip",e[e.Nearest=1]="Nearest",e[e.Linear=2]="Linear"})(bt||(bt={}));var Tr;(function(e){e[e.Points=0]="Points",e[e.Triangles=1]="Triangles",e[e.TriangleStrip=2]="TriangleStrip",e[e.Lines=3]="Lines",e[e.LineStrip=4]="LineStrip"})(Tr||(Tr={}));var ut;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(ut||(ut={}));var Zn;(function(e){e[e.Static=1]="Static",e[e.Dynamic=2]="Dynamic"})(Zn||(Zn={}));var be;(function(e){e[e.PerVertex=1]="PerVertex",e[e.PerInstance=2]="PerInstance"})(be||(be={}));var Yn;(function(e){e.LOADED="loaded"})(Yn||(Yn={}));var et;(function(e){e[e.n2D=0]="n2D",e[e.n2DArray=1]="n2DArray",e[e.n3D=2]="n3D",e[e.Cube=3]="Cube"})(et||(et={}));var sn;(function(e){e[e.Sampled=1]="Sampled",e[e.RenderTarget=2]="RenderTarget"})(sn||(sn={}));var it;(function(e){e[e.None=0]="None",e[e.Red=1]="Red",e[e.Green=2]="Green",e[e.Blue=4]="Blue",e[e.Alpha=8]="Alpha",e[e.RGB=7]="RGB",e[e.AllChannels=15]="AllChannels"})(it||(it={}));var Ui;(function(e){e[e.Keep=7680]="Keep",e[e.Zero=0]="Zero",e[e.Replace=7681]="Replace",e[e.Invert=5386]="Invert",e[e.IncrementClamp=7682]="IncrementClamp",e[e.DecrementClamp=7683]="DecrementClamp",e[e.IncrementWrap=34055]="IncrementWrap",e[e.DecrementWrap=34056]="DecrementWrap"})(Ui||(Ui={}));function dh(e,n,i,t){var r=et.n2D,a=1,o=sn.Sampled;return{dimension:r,pixelFormat:e,width:n,height:i,depth:a,numLevels:t,usage:o}}var wt;(function(e){e[e.Float=0]="Float",e[e.Uint=1]="Uint",e[e.Sint=2]="Sint",e[e.Depth=3]="Depth"})(wt||(wt={}));var Va;(function(e){e[e.LowerLeft=0]="LowerLeft",e[e.UpperLeft=1]="UpperLeft"})(Va||(Va={}));var Ya;(function(e){e[e.NegativeOne=0]="NegativeOne",e[e.Zero=1]="Zero"})(Ya||(Ya={}));var Cs;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(Cs||(Cs={}));var $;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})($||($={}));var re;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(re||(re={}));var ee;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget"})(ee||(ee={}));function oe(e,n,i){return e<<16|n<<8|i}var G;(function(e){e[e.ALPHA=oe($.U8,re.A,ee.None)]="ALPHA",e[e.F16_R=oe($.F16,re.R,ee.None)]="F16_R",e[e.F16_RG=oe($.F16,re.RG,ee.None)]="F16_RG",e[e.F16_RGB=oe($.F16,re.RGB,ee.None)]="F16_RGB",e[e.F16_RGBA=oe($.F16,re.RGBA,ee.None)]="F16_RGBA",e[e.F32_R=oe($.F32,re.R,ee.None)]="F32_R",e[e.F32_RG=oe($.F32,re.RG,ee.None)]="F32_RG",e[e.F32_RGB=oe($.F32,re.RGB,ee.None)]="F32_RGB",e[e.F32_RGBA=oe($.F32,re.RGBA,ee.None)]="F32_RGBA",e[e.U8_R=oe($.U8,re.R,ee.None)]="U8_R",e[e.U8_R_NORM=oe($.U8,re.R,ee.Normalized)]="U8_R_NORM",e[e.U8_RG=oe($.U8,re.RG,ee.None)]="U8_RG",e[e.U8_RG_NORM=oe($.U8,re.RG,ee.Normalized)]="U8_RG_NORM",e[e.U8_RGB=oe($.U8,re.RGB,ee.None)]="U8_RGB",e[e.U8_RGB_NORM=oe($.U8,re.RGB,ee.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=oe($.U8,re.RGB,ee.sRGB|ee.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=oe($.U8,re.RGBA,ee.None)]="U8_RGBA",e[e.U8_RGBA_NORM=oe($.U8,re.RGBA,ee.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=oe($.U8,re.RGBA,ee.sRGB|ee.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=oe($.U16,re.R,ee.None)]="U16_R",e[e.U16_R_NORM=oe($.U16,re.R,ee.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=oe($.U16,re.RG,ee.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=oe($.U16,re.RGBA,ee.Normalized)]="U16_RGBA_NORM",e[e.U16_RGB=oe($.U16,re.RGB,ee.None)]="U16_RGB",e[e.U32_R=oe($.U32,re.R,ee.None)]="U32_R",e[e.U32_RG=oe($.U32,re.RG,ee.None)]="U32_RG",e[e.S8_R=oe($.S8,re.R,ee.None)]="S8_R",e[e.S8_R_NORM=oe($.S8,re.R,ee.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=oe($.S8,re.RG,ee.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=oe($.S8,re.RGB,ee.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=oe($.S8,re.RGBA,ee.Normalized)]="S8_RGBA_NORM",e[e.S16_R=oe($.S16,re.R,ee.None)]="S16_R",e[e.S16_RG=oe($.S16,re.RG,ee.None)]="S16_RG",e[e.S16_RG_NORM=oe($.S16,re.RG,ee.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=oe($.S16,re.RGB,ee.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=oe($.S16,re.RGBA,ee.None)]="S16_RGBA",e[e.S16_RGBA_NORM=oe($.S16,re.RGBA,ee.Normalized)]="S16_RGBA_NORM",e[e.S32_R=oe($.S32,re.R,ee.None)]="S32_R",e[e.U16_RGBA_5551=oe($.U16_PACKED_5551,re.RGBA,ee.Normalized)]="U16_RGBA_5551",e[e.BC1=oe($.BC1,re.RGBA,ee.Normalized)]="BC1",e[e.BC1_SRGB=oe($.BC1,re.RGBA,ee.Normalized|ee.sRGB)]="BC1_SRGB",e[e.BC2=oe($.BC2,re.RGBA,ee.Normalized)]="BC2",e[e.BC2_SRGB=oe($.BC2,re.RGBA,ee.Normalized|ee.sRGB)]="BC2_SRGB",e[e.BC3=oe($.BC3,re.RGBA,ee.Normalized)]="BC3",e[e.BC3_SRGB=oe($.BC3,re.RGBA,ee.Normalized|ee.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=oe($.BC4_UNORM,re.R,ee.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=oe($.BC4_SNORM,re.R,ee.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=oe($.BC5_UNORM,re.RG,ee.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=oe($.BC5_SNORM,re.RG,ee.Normalized)]="BC5_SNORM",e[e.D24=oe($.D24,re.R,ee.Depth)]="D24",e[e.D24_S8=oe($.D24S8,re.RG,ee.Depth|ee.Stencil)]="D24_S8",e[e.D32F=oe($.D32F,re.R,ee.Depth)]="D32F",e[e.D32F_S8=oe($.D32FS8,re.RG,ee.Depth|ee.Stencil)]="D32F_S8",e[e.U8_RGB_RT=oe($.U8,re.RGB,ee.RenderTarget|ee.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=oe($.U8,re.RGBA,ee.RenderTarget|ee.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=oe($.U8,re.RGBA,ee.RenderTarget|ee.Normalized|ee.sRGB)]="U8_RGBA_RT_SRGB"})(G||(G={}));function vh(e){return e>>>8&255}function xn(e){return e>>>16&255}function ho(e){return e&255}function vE(e){switch(e){case $.F32:case $.U32:case $.S32:return 4;case $.U16:case $.S16:case $.F16:return 2;case $.U8:case $.S8:return 1;default:throw new Error("whoops")}}function pE(e){return vE(xn(e))}function gE(e){var n=ho(e);if(n&ee.Depth)return wt.Depth;if(n&ee.Normalized)return wt.Float;var i=xn(e);if(i===$.F16||i===$.F32)return wt.Float;if(i===$.U8||i===$.U16||i===$.U32)return wt.Uint;if(i===$.S8||i===$.S16||i===$.S32)return wt.Sint;throw new Error("whoops")}var L;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(L||(L={}));function Z(e,n){if(n===void 0&&(n=""),!e)throw console.error(new Error().stack),new Error("Assert fail: "+n)}function Ue(e){if(e!=null)return e;throw new Error("Missing object")}function ph(e,n){return e.r===n.r&&e.g===n.g&&e.b===n.b&&e.a===n.a}function gh(e,n){e.r=n.r,e.g=n.g,e.b=n.b,e.a=n.a}function mh(e){var n=e.r,i=e.g,t=e.b,r=e.a;return{r:n,g:i,b:t,a:r}}function ti(e,n,i,t){return t===void 0&&(t=1),{r:e,g:n,b:i,a:t}}var ki=ti(0,0,0,0);ti(0,0,0,1);ti(1,1,1,0);var mE=ti(1,1,1,1);function za(e){return e&&(e&e-1)===0}function Dr(e,n){return e??n}function _h(e){return e===void 0?null:e}function zo(e,n,i){e.length=n,e.fill(i)}function _E(e,n){var i=n-1;return e+i&~i}function vi(e,n){return((e+n-1)/n|0)*n}function EE(e,n,i){for(var t=0,r=e.length;t<r;){var a=t+(r-t>>>1),o=i(n,e[a]);o<0?r=a:t=a+1}return t}function yE(e,n,i){var t=EE(e,n,i);e.splice(t,0,n)}function Sa(e,n,i){return i?e|=n:e&=~n,e}function Ga(e,n){for(var i=new Array(e),t=0;t<e;t++)i[t]=n();return i}function TE(e,n){n===void 0&&(n=1);var i=e.split(`
`);return i.map(function(t,r){return RE(""+(n+r),4," ")+"  "+t}).join(`
`)}function RE(e,n,i){for(i===void 0&&(i="0");e.length<n;)e=""+i+e;return e}function lf(e,n){e.blendDstFactor=n.blendDstFactor,e.blendSrcFactor=n.blendSrcFactor,e.blendMode=n.blendMode}function SE(e,n){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),lf(e.rgbBlendState,n.rgbBlendState),lf(e.alphaBlendState,n.alphaBlendState),e.channelWriteMask=n.channelWriteMask,e}function mu(e,n){e.length!==n.length&&(e.length=n.length);for(var i=0;i<n.length;i++)e[i]=SE(e[i],n[i])}function Os(e,n){n.attachmentsState!==void 0&&mu(e.attachmentsState,n.attachmentsState),n.blendConstant!==void 0&&gh(e.blendConstant,n.blendConstant),e.depthCompare=Dr(n.depthCompare,e.depthCompare),e.depthWrite=Dr(n.depthWrite,e.depthWrite),e.stencilCompare=Dr(n.stencilCompare,e.stencilCompare),e.stencilWrite=Dr(n.stencilWrite,e.stencilWrite),e.stencilPassOp=Dr(n.stencilPassOp,e.stencilPassOp),e.stencilRef=Dr(n.stencilRef,e.stencilRef),e.cullMode=Dr(n.cullMode,e.cullMode),e.frontFace=Dr(n.frontFace,e.frontFace),e.polygonOffset=Dr(n.polygonOffset,e.polygonOffset)}function Gi(e){var n=Object.assign({},e);return n.attachmentsState=[],mu(n.attachmentsState,e.attachmentsState),n.blendConstant=mh(n.blendConstant),n}function AE(e,n){n.channelWriteMask!==void 0&&(e.channelWriteMask=n.channelWriteMask),n.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=n.rgbBlendMode),n.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=n.alphaBlendMode),n.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=n.rgbBlendSrcFactor),n.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=n.alphaBlendSrcFactor),n.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=n.rgbBlendDstFactor),n.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=n.alphaBlendDstFactor)}var ff={blendMode:on.Add,blendSrcFactor:Ft.One,blendDstFactor:Ft.Zero},ri={attachmentsState:[{channelWriteMask:it.RGB,rgbBlendState:ff,alphaBlendState:ff}],blendConstant:mh(ki),depthWrite:!0,depthCompare:an.LessEqual,stencilCompare:an.Always,stencilWrite:!1,stencilPassOp:Ui.Keep,stencilRef:0,cullMode:hr.None,frontFace:Ms.CCW,polygonOffset:!1};function PE(e,n){e===void 0&&(e=null),n===void 0&&(n=ri);var i=Gi(n);return e!==null&&Os(i,e),i}PE({depthCompare:an.Always,depthWrite:!1},ri);function Eh(e,n){return e.attachmentsState===void 0&&(e.attachmentsState=[],mu(e.attachmentsState,ri.attachmentsState)),AE(e.attachmentsState[0],n),e}var xE={formatKind:wt.Float,dimension:et.n2D};function An(e,n,i){if(e.length!==n.length)return!1;for(var t=0;t<e.length;t++)if(!i(e[t],n[t]))return!1;return!0}function Qn(e,n){for(var i=Array(e.length),t=0;t<e.length;t++)i[t]=n(e[t]);return i}function ME(e,n){return e.buffer===n.buffer&&e.wordCount===n.wordCount}function CE(e,n){return e===null?n===null:n===null?!1:e.sampler===n.sampler&&e.texture===n.texture}function OE(e,n){return!(e.samplerBindings.length!==n.samplerBindings.length||!An(e.samplerBindings,n.samplerBindings,CE)||!An(e.uniformBufferBindings,n.uniformBufferBindings,ME)||!yh(e.bindingLayout,n.bindingLayout))}function cf(e,n){return e.blendMode==n.blendMode&&e.blendSrcFactor===n.blendSrcFactor&&e.blendDstFactor===n.blendDstFactor}function NE(e,n){return!(!cf(e.rgbBlendState,n.rgbBlendState)||!cf(e.alphaBlendState,n.alphaBlendState)||e.channelWriteMask!==n.channelWriteMask)}function IE(e,n){return!An(e.attachmentsState,n.attachmentsState,NE)||!ph(e.blendConstant,n.blendConstant)?!1:e.depthCompare===n.depthCompare&&e.depthWrite===n.depthWrite&&e.stencilCompare===n.stencilCompare&&e.stencilWrite===n.stencilWrite&&e.stencilPassOp===n.stencilPassOp&&e.stencilRef===n.stencilRef&&e.cullMode===n.cullMode&&e.frontFace===n.frontFace&&e.polygonOffset===n.polygonOffset}function yh(e,n){return e.numSamplers===n.numSamplers&&e.numUniformBuffers===n.numUniformBuffers}function DE(e,n){return e.id===n.id}function bE(e,n){return e===n}function wE(e,n){return!(e.topology!==n.topology||e.inputLayout!==n.inputLayout||e.sampleCount!==n.sampleCount||!IE(e.megaStateDescriptor,n.megaStateDescriptor)||!DE(e.program,n.program)||!An(e.bindingLayouts,n.bindingLayouts,yh)||!An(e.colorAttachmentFormats,n.colorAttachmentFormats,bE)||e.depthStencilAttachmentFormat!==n.depthStencilAttachmentFormat)}function BE(e,n){return e.bufferIndex===n.bufferIndex&&e.bufferByteOffset===n.bufferByteOffset&&e.location===n.location&&e.format===n.format}function FE(e,n){return ae(e)?ae(n):ae(n)?!1:e.byteStride===n.byteStride&&e.frequency===n.frequency}function UE(e,n){return!(e.indexBufferFormat!==n.indexBufferFormat||!An(e.vertexBufferDescriptors,n.vertexBufferDescriptors,FE)||!An(e.vertexAttributeDescriptors,n.vertexAttributeDescriptors,BE))}function kE(e,n){return e.wrapS===n.wrapS&&e.wrapT===n.wrapT&&e.minFilter===n.minFilter&&e.magFilter===n.magFilter&&e.mipFilter===n.mipFilter&&e.minLOD===n.minLOD&&e.maxLOD===n.maxLOD&&e.maxAnisotropy===n.maxAnisotropy&&e.compareMode===n.compareMode}function LE(e){var n=e.sampler,i=e.texture,t=e.lateBinding;return{sampler:n,texture:i,lateBinding:t}}function WE(e){var n=e.buffer,i=e.wordCount;return{buffer:n,wordCount:i}}function HE(e){var n=e.bindingLayout,i=Qn(e.samplerBindings,LE),t=Qn(e.uniformBufferBindings,WE);return{bindingLayout:n,samplerBindings:i,uniformBufferBindings:t,pipeline:e.pipeline}}function XE(e){var n=e.dimension,i=e.formatKind;return{dimension:n,formatKind:i}}function VE(e){var n=e.numSamplers,i=e.numUniformBuffers,t=e.samplerEntries!==void 0?Qn(e.samplerEntries,XE):void 0;return{numSamplers:n,numUniformBuffers:i,samplerEntries:t}}function YE(e){var n=Qn(e.bindingLayouts,VE),i=e.inputLayout,t=e.program,r=e.topology,a=Gi(e.megaStateDescriptor),o=e.colorAttachmentFormats.slice(),s=e.depthStencilAttachmentFormat,u=e.sampleCount;return{bindingLayouts:n,inputLayout:i,megaStateDescriptor:a,program:t,topology:r,colorAttachmentFormats:o,depthStencilAttachmentFormat:s,sampleCount:u}}function zE(e){var n=e.location,i=e.format,t=e.bufferIndex,r=e.bufferByteOffset,a=e.byteStride,o=e.divisor;return{location:n,format:i,bufferIndex:t,bufferByteOffset:r,byteStride:a,divisor:o}}function GE(e){if(ae(e))return e;var n=e.byteStride,i=e.frequency;return{byteStride:n,frequency:i}}function KE(e){var n=Qn(e.vertexAttributeDescriptors,zE),i=Qn(e.vertexBufferDescriptors,GE),t=e.indexBufferFormat;return{vertexAttributeDescriptors:n,vertexBufferDescriptors:i,indexBufferFormat:t}}var Ka;(function(e){e[e.LITTLE_ENDIAN=0]="LITTLE_ENDIAN",e[e.BIG_ENDIAN=1]="BIG_ENDIAN"})(Ka||(Ka={}));var $E=new Uint16Array([65279]),qE=new DataView($E.buffer);qE.getUint8(0)==255?Ka.LITTLE_ENDIAN:Ka.BIG_ENDIAN;var de,ZE=/([^[]*)(\[[0-9]+\])?/;function QE(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var n=e.match(ZE);if(!n||n.length<2)throw new Error("Failed to parse GLSL uniform name "+e);return{name:n[1],length:Number(n[2])||1,isArray:!!n[2]}}function ft(){var e=null;return function(n,i,t){var r=e!==t;return r&&(n.uniform1i(i,t),e=t),r}}function Be(e,n,i,t){var r=null,a=null;return function(o,s,u){var l=n(u,i),f=l.length,c=!1;if(r===null)r=new Float32Array(f),a=f,c=!0;else{Z(a===f,"Uniform length cannot change.");for(var h=0;h<f;++h)if(l[h]!==r[h]){c=!0;break}}return c&&(t(o,e,s,l),r.set(l)),c}}function pt(e,n,i,t){e[n](i,t)}function br(e,n,i,t){e[n](i,!1,t)}var JE={},jE={},ey={},hf=[0];function _u(e,n,i,t){n===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(hf[0]=e,e=hf);var r=e.length;if(e instanceof i)return e;var a=t[r];a||(a=new i(r),t[r]=a);for(var o=0;o<r;o++)a[o]=e[o];return a}function Wt(e,n){return _u(e,n,Float32Array,JE)}function Vr(e,n){return _u(e,n,Int32Array,jE)}function Aa(e,n){return _u(e,n,Uint32Array,ey)}var ty=(de={},de[L.FLOAT]=Be.bind(null,"uniform1fv",Wt,1,pt),de[L.FLOAT_VEC2]=Be.bind(null,"uniform2fv",Wt,2,pt),de[L.FLOAT_VEC3]=Be.bind(null,"uniform3fv",Wt,3,pt),de[L.FLOAT_VEC4]=Be.bind(null,"uniform4fv",Wt,4,pt),de[L.INT]=Be.bind(null,"uniform1iv",Vr,1,pt),de[L.INT_VEC2]=Be.bind(null,"uniform2iv",Vr,2,pt),de[L.INT_VEC3]=Be.bind(null,"uniform3iv",Vr,3,pt),de[L.INT_VEC4]=Be.bind(null,"uniform4iv",Vr,4,pt),de[L.BOOL]=Be.bind(null,"uniform1iv",Vr,1,pt),de[L.BOOL_VEC2]=Be.bind(null,"uniform2iv",Vr,2,pt),de[L.BOOL_VEC3]=Be.bind(null,"uniform3iv",Vr,3,pt),de[L.BOOL_VEC4]=Be.bind(null,"uniform4iv",Vr,4,pt),de[L.FLOAT_MAT2]=Be.bind(null,"uniformMatrix2fv",Wt,4,br),de[L.FLOAT_MAT3]=Be.bind(null,"uniformMatrix3fv",Wt,9,br),de[L.FLOAT_MAT4]=Be.bind(null,"uniformMatrix4fv",Wt,16,br),de[L.SAMPLER_2D]=ft,de[L.SAMPLER_CUBE]=ft,de[L.UNSIGNED_INT]=Be.bind(null,"uniform1uiv",Aa,1,pt),de[L.UNSIGNED_INT_VEC2]=Be.bind(null,"uniform2uiv",Aa,2,pt),de[L.UNSIGNED_INT_VEC3]=Be.bind(null,"uniform3uiv",Aa,3,pt),de[L.UNSIGNED_INT_VEC4]=Be.bind(null,"uniform4uiv",Aa,4,pt),de[L.FLOAT_MAT2x3]=Be.bind(null,"uniformMatrix2x3fv",Wt,6,br),de[L.FLOAT_MAT2x4]=Be.bind(null,"uniformMatrix2x4fv",Wt,8,br),de[L.FLOAT_MAT3x2]=Be.bind(null,"uniformMatrix3x2fv",Wt,6,br),de[L.FLOAT_MAT3x4]=Be.bind(null,"uniformMatrix3x4fv",Wt,12,br),de[L.FLOAT_MAT4x2]=Be.bind(null,"uniformMatrix4x2fv",Wt,8,br),de[L.FLOAT_MAT4x3]=Be.bind(null,"uniformMatrix4x3fv",Wt,12,br),de[L.SAMPLER_2D]=ft,de[L.SAMPLER_CUBE]=ft,de[L.SAMPLER_3D]=ft,de[L.SAMPLER_2D_SHADOW]=ft,de[L.SAMPLER_2D_ARRAY]=ft,de[L.SAMPLER_2D_ARRAY_SHADOW]=ft,de[L.SAMPLER_CUBE_SHADOW]=ft,de[L.INT_SAMPLER_2D]=ft,de[L.INT_SAMPLER_3D]=ft,de[L.INT_SAMPLER_CUBE]=ft,de[L.INT_SAMPLER_2D_ARRAY]=ft,de[L.UNSIGNED_INT_SAMPLER_2D]=ft,de[L.UNSIGNED_INT_SAMPLER_3D]=ft,de[L.UNSIGNED_INT_SAMPLER_CUBE]=ft,de[L.UNSIGNED_INT_SAMPLER_2D_ARRAY]=ft,de);function df(e,n,i){var t=ty[i.type];if(!t)throw new Error("Unknown GLSL uniform type "+i.type);return t().bind(null,e,n)}var ry=[[/\btexture(2D|2DProj|Cube)Lod\(/g,"texture$1LodEXT("],[/\btexture\(/g,"texture2D("],[/\btextureLod\(/g,"texture2DLodEXT("]];function Pa(e,n){return"#define "+e+" "+n}function ny(e){var n={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(i,t,r){var a=Number(r);return n[t]=isNaN(a)?r:a,""}),n}function iy(e,n){var i=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(t,r,a){var o=Number(r);return i.push({location:isNaN(o)?n[r]:o,name:a}),""}),i}function ay(e){var n=[],i=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(t,r,a){var o=[];return a.trim().split(`
`).forEach(function(s){var u=s.trim().split(/\s+/),l=u[0],f=u[1];o.push({type:l.trim(),name:f.replace(";","").trim()})}),i.push({type:r.trim(),uniforms:o}),""}),e.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(t,r){return r.trim().split(`
`).forEach(function(a){var o=a.trim().split(" "),s=o[0]||"",u=o[1]||"",l=u.indexOf("[")>-1;if(u=u.replace(";","").replace("[","").trim(),!s.startsWith("#")){if(s){var f=i.find(function(p){return s===p.type});if(f)if(l)for(var c=function(g){f.uniforms.forEach(function(_){n.push(u+"["+g+"]."+_.name)})},h=0;h<5;h++)c(h);else f.uniforms.forEach(function(p){n.push(u+"."+p.name)})}u&&n.push(u)}}),""}),n}function Li(e,n,i,t,r){t===void 0&&(t=null);var a=e.glslVersion==="#version 100",o=!1,s=i.split(`
`).map(function(C){return C.replace(/[/][/].*$/,"")}).filter(function(C){var O=!C||/^\s+$/.test(C);return!O}),u="";t!==null&&(u=Object.keys(t).map(function(C){return Pa(C,t[C])}).join(`
`));var l=s.find(function(C){return C.startsWith("precision")})||"precision mediump float;",f=s.filter(function(C){return!C.startsWith("precision")}).join(`
`),c="";if(e.viewportOrigin===Va.UpperLeft&&(c+=Pa("VIEWPORT_ORIGIN_TL","1")+`
`),e.clipSpaceNearZ===Ya.Zero&&(c+=Pa("CLIPSPACE_NEAR_ZERO","1")+`
`),e.explicitBindingLocations){var h=0,p=0,g=0;f=f.replace(/^(layout\((.*)\))?\s*uniform(.+{)$/gm,function(C,O,D,F){var k=D?D+", ":"";return"layout("+k+"set = "+h+", binding = "+p+++") uniform "+F}),h++,p=0,Z(e.separateSamplerTextures),f=f.replace(/uniform sampler2D (.*);/g,function(C,O){return n==="frag"?`
layout(set = `+h+", binding = "+p+++") uniform texture2D T_"+O+`;
layout(set = `+h+", binding = "+p+++") uniform sampler S_"+O+`;
`:""}),f=f.replace(n==="frag"?/^\b(varying|in)\b/gm:/^\b(varying|out)\b/gm,function(C,O){return"layout(location = "+g+++") "+O}),c+=Pa("gl_VertexID","gl_VertexIndex")+`
`}e.separateSamplerTextures?(f=f.replace(/\bPD_SAMPLER_2D\((.*?)\)/g,function(C,O){return"texture2D T_P_"+O+", sampler S_P_"+O}),f=f.replace(/\bPU_SAMPLER_2D\((.*?)\)/g,function(C,O){return"SAMPLER_2D(P_"+O+")"}),f=f.replace(/\bPP_SAMPLER_2D\((.*?)\)/g,function(C,O){return"T_"+O+", S_"+O}),f=f.replace(/\bSAMPLER_2D\((.*?)\)/g,function(C,O){return"sampler2D(T_"+O+", S_"+O+")"})):(f=f.replace(/\bPD_SAMPLER_2D\((.*?)\)/g,function(C,O){return"sampler2D P_"+O}),f=f.replace(/\bPU_SAMPLER_2D\((.*?)\)/g,function(C,O){return"SAMPLER_2D(P_"+O+")"}),f=f.replace(/\bPP_SAMPLER_2D\((.*?)\)/g,function(C,O){return O}),f=f.replace(/\bSAMPLER_2D\((.*?)\)/g,function(C,O){return O}));var _=((a?"":e.glslVersion)+`
`+(a&&o?"#extension GL_EXT_draw_buffers : require":"")+`
`+(a&&n==="frag"?"#extension GL_OES_standard_derivatives : enable":"")+`
`+l+`
`+c+`
`+u+`
`+f+`
`).trim();if(e.explicitBindingLocations&&n==="frag"&&(_=_.replace(/^\b(out)\b/gm,function(C,O){return"layout(location = 0) "+O})),a){if(n==="frag"&&(_=_.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(C,O,D){return"varying "+O+" "+D+`;
`})),n==="vert"&&(_=_.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(C,O,D){return"varying "+O+" "+D+`;
`}),_=_.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(C,O,D){return"attribute "+O+" "+D+`;
`})),_=_.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(C,O){return O.trim().replace(/^.*$/gm,function(D){var F=D.trim();return F.startsWith("#")?F:D?"uniform "+F:""})}),n==="frag"){var E;_=_.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(C,O,D){return E=D,O+" "+D+`;
`});var y=_.lastIndexOf("}");_=_.substring(0,y)+(`
  gl_FragColor = vec4(`+E+`);
`)+_.substring(y)}_=_.replace(/^\s*layout\((.*)\)/gm,"");for(var R=yr(ry),A;!(A=R()).done;){var M=A.value,x=M[0],P=M[1];_=_.replace(x,P)}}return _}function oy(e,n,i,t,r){t===void 0&&(t=null);var a=Li(e,"vert",n,t),o=Li(e,"frag",i,t);return{vert:n,frag:i,preprocessedVert:a,preprocessedFrag:o}}function Th(e,n){var i=n.defines!==void 0?n.defines:null;n.features!==void 0&&n.features;var t=n.both!==void 0?n.both+n.vert:n.vert,r=n.both!==void 0?n.both+n.frag:n.frag;return oy(e.queryVendorInfo(),t,r,i)}var Rh=function(){function e(){this.name="(unnamed)",this.preprocessedVert="",this.preprocessedFrag="",this.both="",this.vert="",this.frag="",this.defines={},this.features={MRT:!0}}var n=e.prototype;return n.definesChanged=function(){this.preprocessedVert="",this.preprocessedFrag=""},n.setDefineString=function(t,r){if(r!==null){if(this.defines[t]===r)return!1;this.defines[t]=r}else{if(ae(this.defines[t]))return!1;delete this.defines[t]}return this.definesChanged(),!0},n.setDefineBool=function(t,r){return this.setDefineString(t,r?"1":null)},n.getDefineString=function(t){return _h(this.defines[t])},n.getDefineBool=function(t){var r=this.getDefineString(t);return r!==null&&Z(r==="1"),r!==null},n.ensurePreprocessed=function(t){this.preprocessedVert===""&&(this.preprocessedVert=Li(t,"vert",this.both+this.vert,this.defines,this.features),this.preprocessedFrag=Li(t,"frag",this.both+this.frag,this.defines,this.features))},e}(),sy=function(){function e(i){this.device=void 0,this.uniformBufferWordAlignment=void 0,this.uniformBufferMaxPageWordSize=void 0,this.currentBufferWordSize=-1,this.currentWordOffset=0,this.buffer=null,this.shadowBufferF32=null,this.shadowBufferU8=null,this.device=i;var t=i.queryLimits();this.uniformBufferWordAlignment=t.uniformBufferWordAlignment,this.uniformBufferMaxPageWordSize=t.uniformBufferMaxPageWordSize}var n=e.prototype;return n.isSupportedUBO=function(){return this.device.queryVendorInfo().platformString!=="WebGL1"},n.findPageIndex=function(t){return t/this.uniformBufferMaxPageWordSize|0},n.allocateChunk=function(t){t=vi(t,this.uniformBufferWordAlignment),Z(t<this.uniformBufferMaxPageWordSize);var r=this.currentWordOffset;return this.findPageIndex(r)!==this.findPageIndex(r+t-1)&&(r=vi(r,this.uniformBufferMaxPageWordSize)),this.currentWordOffset=r+t,this.ensureShadowBuffer(r,t),r},n.ensureShadowBuffer=function(t,r){if(this.shadowBufferU8===null||this.shadowBufferF32===null){var a=vi(this.currentWordOffset,this.uniformBufferMaxPageWordSize);this.shadowBufferU8=new Uint8Array(a*4),this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer)}else if(t+r>=this.shadowBufferF32.length){Z(t<this.currentWordOffset&&t+r<=this.currentWordOffset);var o=vi(Math.max(this.currentWordOffset,this.shadowBufferF32.length*2),this.uniformBufferMaxPageWordSize),s=new Uint8Array(o*4);if(s.set(this.shadowBufferU8,0),this.shadowBufferU8=s,this.shadowBufferF32=new Float32Array(this.shadowBufferU8.buffer),!(this.currentWordOffset<=o))throw new Error("Assert fail: this.currentWordOffset ["+this.currentWordOffset+"] <= newWordCount ["+o+"]")}},n.mapBufferF32=function(){return Ue(this.shadowBufferF32)},n.prepareToRender=function(){if(this.shadowBufferF32!==null){var t=Ue(this.shadowBufferF32);t.length!==this.currentBufferWordSize&&(this.currentBufferWordSize=t.length,this.buffer!==null&&this.buffer.destroy(),this.buffer=this.device.createBuffer({viewOrSize:this.currentBufferWordSize,usage:ut.UNIFORM|ut.COPY_DST,hint:Zn.Dynamic}));var r=vi(this.currentWordOffset,this.uniformBufferMaxPageWordSize);if(!(r<=this.currentBufferWordSize))throw new Error("Assert fail: wordCount ["+r+"] ("+this.currentWordOffset+" aligned "+this.uniformBufferMaxPageWordSize+") <= this.currentBufferWordSize ["+this.currentBufferWordSize+"]");if(this.isSupportedUBO()){var a=Ue(this.buffer);a.setSubData(0,this.shadowBufferU8,0,r*4)}this.currentWordOffset=0}},n.destroy=function(){this.buffer!==null&&this.buffer.destroy(),this.shadowBufferF32=null,this.shadowBufferU8=null},e}();function Ke(e,n){return e+=n,e+=e<<10,e+=e>>>6,e>>>0}function Sh(e){return e+=e<<3,e^=e>>>11,e+=e<<15,e>>>0}function Go(e){return 0}var uy=function(){this.keys=[],this.values=[]},pi=function(){function e(i,t){this.keyEqualFunc=void 0,this.keyHashFunc=void 0,this.buckets=new Map,this.keyEqualFunc=i,this.keyHashFunc=t}var n=e.prototype;return n.findBucketIndex=function(t,r){for(var a=0;a<t.keys.length;a++)if(this.keyEqualFunc(r,t.keys[a]))return a;return-1},n.findBucket=function(t){var r=this.keyHashFunc(t);return this.buckets.get(r)},n.get=function(t){var r=this.findBucket(t);if(r===void 0)return null;var a=this.findBucketIndex(r,t);return a<0?null:r.values[a]},n.add=function(t,r){var a=this.keyHashFunc(t);this.buckets.get(a)===void 0&&this.buckets.set(a,new uy);var o=this.buckets.get(a);o.keys.push(t),o.values.push(r)},n.delete=function(t){var r=this.findBucket(t);if(r!==void 0){var a=this.findBucketIndex(r,t);a!==-1&&(r.keys.splice(a,1),r.values.splice(a,1))}},n.clear=function(){this.buckets.clear()},n.size=function(){for(var t=0,r=yr(this.buckets.values()),a;!(a=r()).done;){var o=a.value;t+=o.values.length}return t},n.values=dr().mark(function i(){var t,r,a,o;return dr().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:t=yr(this.buckets.values());case 1:if((r=t()).done){u.next=12;break}a=r.value,o=a.values.length-1;case 4:if(!(o>=0)){u.next=10;break}return u.next=7,a.values[o];case 7:o--,u.next=4;break;case 10:u.next=1;break;case 12:case"end":return u.stop()}},i,this)}),e}();function ly(e,n){return Z(e.preprocessedVert!==""&&n.preprocessedVert!==""),Z(e.preprocessedFrag!==""&&n.preprocessedFrag!==""),e.preprocessedVert===n.preprocessedVert&&e.preprocessedFrag===n.preprocessedFrag}function fy(e){var n=e.preprocessedVert,i=e.preprocessedFrag,t=e.vert,r=e.frag;return{preprocessedVert:n,preprocessedFrag:i,vert:t,frag:r}}function cy(e,n){return e=Ke(e,n.numUniformBuffers),e=Ke(e,n.numSamplers),e}function vf(e,n){return e=Ke(e,n.blendMode),e=Ke(e,n.blendSrcFactor),e=Ke(e,n.blendDstFactor),e}function hy(e,n){return e=vf(e,n.rgbBlendState),e=vf(e,n.alphaBlendState),e=Ke(e,n.channelWriteMask),e}function dy(e,n){return e=Ke(e,n.r<<24|n.g<<16|n.b<<8|n.a),e}function vy(e,n){for(var i=0;i<n.attachmentsState.length;i++)e=hy(e,n.attachmentsState[i]);return e=dy(e,n.blendConstant),e=Ke(e,n.depthCompare),e=Ke(e,n.depthWrite?1:0),e=Ke(e,n.stencilCompare),e=Ke(e,n.stencilPassOp),e=Ke(e,n.stencilWrite?1:0),e=Ke(e,n.cullMode),e=Ke(e,n.frontFace?1:0),e=Ke(e,n.polygonOffset?1:0),e}function py(e){var n=0;n=Ke(n,e.program.id),e.inputLayout!==null&&(n=Ke(n,e.inputLayout.id));for(var i=0;i<e.bindingLayouts.length;i++)n=cy(n,e.bindingLayouts[i]);n=vy(n,e.megaStateDescriptor);for(var t=0;t<e.colorAttachmentFormats.length;t++)n=Ke(n,e.colorAttachmentFormats[t]||0);return n=Ke(n,e.depthStencilAttachmentFormat||0),Sh(n)}function gy(e){for(var n=0,i=0;i<e.samplerBindings.length;i++){var t=e.samplerBindings[i];t!==null&&t.texture!==null&&(n=Ke(n,t.texture.id))}for(var r=0;r<e.uniformBufferBindings.length;r++){var a=e.uniformBufferBindings[r];a!==null&&a.buffer!==null&&(n=Ke(n,a.buffer.id),n=Ke(n,a.wordCount))}return Sh(n)}var my=function(){function e(i){this.device=void 0,this.bindingsCache=new pi(OE,gy),this.renderPipelinesCache=new pi(wE,py),this.inputLayoutsCache=new pi(UE,Go),this.programCache=new pi(ly,Go),this.samplerCache=new pi(kE,Go),this.device=i}var n=e.prototype;return n.createBindings=function(t){var r=this.bindingsCache.get(t);if(r===null){var a=HE(t);r=this.device.createBindings(a),this.bindingsCache.add(a,r)}return r},n.createRenderPipeline=function(t){var r=this.renderPipelinesCache.get(t);if(r===null){var a=YE(t);r=this.device.createRenderPipeline(a),this.renderPipelinesCache.add(a,r)}return r},n.createInputLayout=function(t){var r=this.inputLayoutsCache.get(t);if(r===null){var a=KE(t);r=this.device.createInputLayout(a),this.inputLayoutsCache.add(a,r)}return r},n.createProgramSimple=function(t){var r=this.programCache.get(t);if(r===null){var a=fy(t);r=this.device.createProgramSimple(a),this.programCache.add(a,r)}return r},n.createProgram=function(t){return t.ensurePreprocessed(this.device.queryVendorInfo()),this.createProgramSimple(t)},n.createSampler=function(t){var r=this.samplerCache.get(t);return r===null&&(r=this.device.createSampler(t),this.samplerCache.add(t,r)),r},n.destroy=function(){for(var t=yr(this.bindingsCache.values()),r;!(r=t()).done;){var a=r.value;a.destroy()}for(var o=yr(this.renderPipelinesCache.values()),s;!(s=o()).done;){var u=s.value;u.destroy()}for(var l=yr(this.inputLayoutsCache.values()),f;!(f=l()).done;){var c=f.value;c.destroy()}for(var h=yr(this.programCache.values()),p;!(p=h()).done;){var g=p.value;g.destroy()}for(var _=yr(this.samplerCache.values()),E;!(E=_()).done;){var y=E.value;y.destroy()}this.bindingsCache.clear(),this.renderPipelinesCache.clear(),this.inputLayoutsCache.clear(),this.programCache.clear(),this.samplerCache.clear()},e}(),st;(function(e){e[e.Color0=0]="Color0",e[e.Color1=1]="Color1",e[e.Color2=2]="Color2",e[e.Color3=3]="Color3",e[e.ColorMax=3]="ColorMax",e[e.DepthStencil=4]="DepthStencil"})(st||(st={}));var _y={x:0,y:0,w:1,h:1},Ey=function(){function e(){this.renderTargetIDs=[],this.resolveTextureOutputIDs=[],this.resolveTextureOutputExternalTextures=[],this.resolveTextureInputIDs=[],this.renderTargetExtraRefs=[],this.viewport=_y,this.resolveTextureInputTextures=[],this.renderTargets=[],this.descriptor={colorAttachment:[],colorResolveTo:[],colorStore:[],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,colorClearColor:["load"],depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null},this.viewportX=0,this.viewportY=0,this.viewportW=0,this.viewportH=0,this.execFunc=null,this.postFunc=null,this.debugName=void 0,this.debugThumbnails=[]}var n=e.prototype;return n.setDebugName=function(t){this.debugName=t},n.pushDebugThumbnail=function(t){this.debugThumbnails[t]=!0},n.setViewport=function(t){this.viewport=t},n.attachRenderTargetID=function(t,r){Z(this.renderTargetIDs[t]===void 0),this.renderTargetIDs[t]=r},n.attachResolveTexture=function(t){this.resolveTextureInputIDs.push(t)},n.attachOcclusionQueryPool=function(t){this.descriptor.occlusionQueryPool=t},n.resolveToExternalTexture=function(t,r){this.resolveTextureOutputExternalTextures[t]=r},n.exec=function(t){Z(this.execFunc===null),this.execFunc=t},n.post=function(t){Z(this.postFunc===null),this.postFunc=t},n.addExtraRef=function(t){this.renderTargetExtraRefs[t]=!0},e}(),yy=function(){function e(i,t){this.debugName=void 0,this.dimension=et.n2D,this.depth=1,this.numLevels=1,this.pixelFormat=void 0,this.width=0,this.height=0,this.sampleCount=0,this.usage=sn.RenderTarget,this.immutable=!0,this.needsClear=!0,this.texture=null,this.attachment=void 0,this.age=0,this.pixelFormat=t.pixelFormat,this.width=t.width,this.height=t.height,this.sampleCount=t.sampleCount,Z(this.sampleCount>=1),this.sampleCount>1?this.attachment=i.createRenderTarget(this):(this.texture=i.createTexture(this),this.attachment=i.createRenderTargetFromTexture(this.texture))}var n=e.prototype;return n.setDebugName=function(t,r){this.debugName=r,this.texture!==null&&t.setResourceName(this.texture,this.debugName),t.setResourceName(this.attachment,this.debugName)},n.matchesDescription=function(t){return this.pixelFormat===t.pixelFormat&&this.width===t.width&&this.height===t.height&&this.sampleCount===t.sampleCount},n.reset=function(t){Z(this.matchesDescription(t)),this.age=0},n.destroy=function(){this.texture!==null&&this.texture.destroy(),this.attachment.destroy()},e}(),Ty=function(){function e(i,t){this.dimension=et.n2D,this.depth=1,this.numLevels=1,this.usage=sn.RenderTarget,this.pixelFormat=void 0,this.width=0,this.height=0,this.texture=void 0,this.age=0,this.immutable=!0,this.pixelFormat=t.pixelFormat,this.width=t.width,this.height=t.height,this.texture=i.createTexture(this)}var n=e.prototype;return n.matchesDescription=function(t){return this.pixelFormat===t.pixelFormat&&this.width===t.width&&this.height===t.height},n.reset=function(t){Z(this.matchesDescription(t)),this.age=0},n.destroy=function(){this.texture.destroy()},e}(),Ry=function(){this.renderTargetDescriptions=[],this.resolveTextureRenderTargetIDs=[],this.passes=[],this.renderTargetDebugNames=[]},Sy=function(){function e(i){this.device=void 0,this.currentPass=null,this.renderTargetDeadPool=[],this.singleSampledTextureDeadPool=[],this.currentGraph=null,this.renderTargetOutputCount=[],this.renderTargetResolveCount=[],this.resolveTextureUseCount=[],this.renderTargetAliveForID=[],this.singleSampledTextureForResolveTextureID=[],this.device=i}var n=e.prototype;return n.acquireRenderTargetForDescription=function(t){for(var r=0;r<this.renderTargetDeadPool.length;r++){var a=this.renderTargetDeadPool[r];if(a.matchesDescription(t))return a.reset(t),this.renderTargetDeadPool.splice(r--,1),a}return new yy(this.device,t)},n.acquireSingleSampledTextureForDescription=function(t){for(var r=0;r<this.singleSampledTextureDeadPool.length;r++){var a=this.singleSampledTextureDeadPool[r];if(a.matchesDescription(t))return a.reset(t),this.singleSampledTextureDeadPool.splice(r--,1),a}return new Ty(this.device,t)},n.beginGraphBuilder=function(){Z(this.currentGraph===null),this.currentGraph=new Ry},n.pushPass=function(t){var r=new Ey;t(r),this.currentGraph.passes.push(r)},n.createRenderTargetID=function(t,r){return this.currentGraph.renderTargetDebugNames.push(r),this.currentGraph.renderTargetDescriptions.push(t)-1},n.createResolveTextureID=function(t){return this.currentGraph.resolveTextureRenderTargetIDs.push(t)-1},n.findMostRecentPassThatAttachedRenderTarget=function(t){for(var r=this.currentGraph.passes.length-1;r>=0;r--){var a=this.currentGraph.passes[r];if(a.renderTargetIDs.includes(t))return a}return null},n.resolveRenderTargetPassAttachmentSlot=function(t,r){var a=t;if(a.resolveTextureOutputIDs[r]===void 0){var o=a.renderTargetIDs[r],s=this.createResolveTextureID(o);a.resolveTextureOutputIDs[r]=s}return a.resolveTextureOutputIDs[r]},n.findPassForResolveRenderTarget=function(t){var r=Ue(this.findMostRecentPassThatAttachedRenderTarget(t)),a=r.renderTargetIDs.indexOf(t);return Z(r.resolveTextureOutputExternalTextures[a]===void 0),r},n.resolveRenderTarget=function(t){var r=this.findPassForResolveRenderTarget(t),a=r.renderTargetIDs.indexOf(t);return this.resolveRenderTargetPassAttachmentSlot(r,a)},n.resolveRenderTargetToExternalTexture=function(t,r){var a=this.findPassForResolveRenderTarget(t),o=a.renderTargetIDs.indexOf(t);Z(a.resolveTextureOutputIDs[o]===void 0),a.resolveTextureOutputExternalTextures[o]=r},n.getRenderTargetDescription=function(t){return Ue(this.currentGraph.renderTargetDescriptions[t])},n.scheduleAddUseCount=function(t,r){for(var a=0;a<r.renderTargetIDs.length;a++){var o=r.renderTargetIDs[a];o!==void 0&&(this.renderTargetOutputCount[o]++,r.renderTargetExtraRefs[a]&&this.renderTargetOutputCount[o]++)}for(var s=0;s<r.resolveTextureInputIDs.length;s++){var u=r.resolveTextureInputIDs[s];if(u!==void 0){this.resolveTextureUseCount[u]++;var l=t.resolveTextureRenderTargetIDs[u];this.renderTargetResolveCount[l]++}}},n.acquireRenderTargetForID=function(t,r){if(r===void 0)return null;if(Z(this.renderTargetOutputCount[r]>0),!this.renderTargetAliveForID[r]){var a=t.renderTargetDescriptions[r],o=this.acquireRenderTargetForDescription(a);o.setDebugName(this.device,t.renderTargetDebugNames[r]),this.renderTargetAliveForID[r]=o}return this.renderTargetAliveForID[r]},n.releaseRenderTargetForID=function(t,r){if(t===void 0)return null;var a=Ue(this.renderTargetAliveForID[t]);return r?(Z(this.renderTargetOutputCount[t]>0),this.renderTargetOutputCount[t]--):(Z(this.renderTargetResolveCount[t]>0),this.renderTargetResolveCount[t]--),this.renderTargetOutputCount[t]===0&&this.renderTargetResolveCount[t]===0&&(a.needsClear=!0,delete this.renderTargetAliveForID[t],this.renderTargetDeadPool.push(a)),a},n.acquireResolveTextureInputTextureForID=function(t,r){var a=t.resolveTextureRenderTargetIDs[r];Z(this.resolveTextureUseCount[r]>0),this.resolveTextureUseCount[r]--;var o=Ue(this.releaseRenderTargetForID(a,!1));if(this.singleSampledTextureForResolveTextureID[r]!==void 0){var s=this.singleSampledTextureForResolveTextureID[r];return this.resolveTextureUseCount[r]===0&&this.singleSampledTextureDeadPool.push(s),s.texture}else return Ue(o.texture)},n.determineResolveParam=function(t,r,a){var o=r.renderTargetIDs[a],s=r.resolveTextureOutputIDs[a],u=r.resolveTextureOutputExternalTextures[a],l=s!==void 0,f=u!==void 0;Z(!(l&&f));var c=null,h=!1;if(this.renderTargetOutputCount[o]>1&&(h=!0),l){Z(t.resolveTextureRenderTargetIDs[s]===o),Z(this.resolveTextureUseCount[s]>0),Z(this.renderTargetOutputCount[o]>0);var p=Ue(this.renderTargetAliveForID[o]);if(p.texture!==null&&this.renderTargetOutputCount[o]===1)c=null,h=!0;else{if(!this.singleSampledTextureForResolveTextureID[s]){var g=Ue(t.renderTargetDescriptions[o]);this.singleSampledTextureForResolveTextureID[s]=this.acquireSingleSampledTextureForDescription(g),this.device.setResourceName(this.singleSampledTextureForResolveTextureID[s].texture,p.debugName+(" (Resolve "+s+")"))}c=this.singleSampledTextureForResolveTextureID[s].texture}}else f?c=u:c=null;return{resolveTo:c,store:h}},n.schedulePass=function(t,r){for(var a=r.renderTargetIDs[st.DepthStencil],o=st.Color0;o<=st.ColorMax;o++){var s=r.renderTargetIDs[o],u=this.acquireRenderTargetForID(t,s);r.renderTargets[o]=u,r.descriptor.colorAttachment[o]=u!==null?u.attachment:null;var l=this.determineResolveParam(t,r,o),f=l.resolveTo,c=l.store;r.descriptor.colorResolveTo[o]=f,r.descriptor.colorStore[o]=c,r.descriptor.colorClearColor[o]=u!==null&&u.needsClear?t.renderTargetDescriptions[s].colorClearColor:"load"}var h=this.acquireRenderTargetForID(t,a);r.renderTargets[st.DepthStencil]=h,r.descriptor.depthStencilAttachment=h!==null?h.attachment:null;var p=this.determineResolveParam(t,r,st.DepthStencil),g=p.resolveTo,_=p.store;r.descriptor.depthStencilResolveTo=g,r.descriptor.depthStencilStore=_,r.descriptor.depthClearValue=h!==null&&h.needsClear?t.renderTargetDescriptions[a].depthClearValue:"load",r.descriptor.stencilClearValue=h!==null&&h.needsClear?t.renderTargetDescriptions[a].stencilClearValue:"load";for(var E=0,y=0,R=0,A=0;A<r.renderTargets.length;A++){var M=r.renderTargets[A];M&&(E===0&&(E=M.width,y=M.height,R=M.sampleCount),Z(M.width===E),Z(M.height===y),Z(M.sampleCount===R),M.needsClear=!1)}if(E>0&&y>0){var x=E*r.viewport.x,P=y*r.viewport.y,C=E*r.viewport.w,O=y*r.viewport.h;r.viewportX=x,r.viewportY=P,r.viewportW=C,r.viewportH=O}for(var D=0;D<r.resolveTextureInputIDs.length;D++){var F=r.resolveTextureInputIDs[D];r.resolveTextureInputTextures[D]=this.acquireResolveTextureInputTextureForID(t,F)}for(var k=0;k<r.renderTargetIDs.length;k++)this.releaseRenderTargetForID(r.renderTargetIDs[k],!0);for(var d=0;d<r.renderTargetExtraRefs.length;d++)r.renderTargetExtraRefs[d]&&this.releaseRenderTargetForID(r.renderTargetIDs[d],!0)},n.scheduleGraph=function(t){Z(this.renderTargetOutputCount.length===0),Z(this.renderTargetResolveCount.length===0),Z(this.resolveTextureUseCount.length===0);for(var r=0;r<this.renderTargetDeadPool.length;r++)this.renderTargetDeadPool[r].age++;for(var a=0;a<this.singleSampledTextureDeadPool.length;a++)this.singleSampledTextureDeadPool[a].age++;zo(this.renderTargetOutputCount,t.renderTargetDescriptions.length,0),zo(this.renderTargetResolveCount,t.renderTargetDescriptions.length,0),zo(this.resolveTextureUseCount,t.resolveTextureRenderTargetIDs.length,0);for(var o=0;o<t.passes.length;o++)this.scheduleAddUseCount(t,t.passes[o]);for(var s=0;s<t.passes.length;s++)this.schedulePass(t,t.passes[s]);for(var u=0;u<this.renderTargetOutputCount.length;u++)Z(this.renderTargetOutputCount[u]===0);for(var l=0;l<this.renderTargetResolveCount.length;l++)Z(this.renderTargetResolveCount[l]===0);for(var f=0;f<this.resolveTextureUseCount.length;f++)Z(this.resolveTextureUseCount[f]===0);for(var c=0;c<this.renderTargetAliveForID.length;c++)Z(this.renderTargetAliveForID[c]===void 0);for(var h=1,p=0;p<this.renderTargetDeadPool.length;p++)this.renderTargetDeadPool[p].age>=h&&(this.renderTargetDeadPool[p].destroy(),this.renderTargetDeadPool.splice(p--,1));for(var g=0;g<this.singleSampledTextureDeadPool.length;g++)this.singleSampledTextureDeadPool[g].age>=h&&(this.singleSampledTextureDeadPool[g].destroy(),this.singleSampledTextureDeadPool.splice(g--,1));this.renderTargetResolveCount.length=0,this.renderTargetOutputCount.length=0,this.resolveTextureUseCount.length=0},n.execPass=function(t){Z(this.currentPass===null),this.currentPass=t;var r=this.device.createRenderPass(t.descriptor);r.beginDebugGroup(t.debugName),r.setViewport(t.viewportX,t.viewportY,t.viewportW,t.viewportH),t.execFunc!==null&&t.execFunc(r,this),r.endDebugGroup(),this.device.submitPass(r),t.postFunc!==null&&t.postFunc(this),this.currentPass=null},n.execGraph=function(t){var r=this;this.scheduleGraph(t),t.passes.forEach(function(a){r.execPass(a)}),this.singleSampledTextureForResolveTextureID.length=0},n.execute=function(){var t=Ue(this.currentGraph);this.execGraph(t),this.currentGraph=null},n.getDebug=function(){return this},n.getPasses=function(){return this.currentGraph.passes},n.getPassDebugThumbnails=function(t){return t.debugThumbnails},n.getPassRenderTargetID=function(t,r){return t.renderTargetIDs[r]},n.getRenderTargetIDDebugName=function(t){return this.currentGraph.renderTargetDebugNames[t]},n.getResolveTextureForID=function(t){var r=this.currentPass,a=r.resolveTextureInputIDs.indexOf(t);return Z(a>=0),Ue(r.resolveTextureInputTextures[a])},n.getRenderTargetAttachment=function(t){var r=this.currentPass,a=r.renderTargets[t];return a?a.attachment:null},n.getRenderTargetTexture=function(t){var r=this.currentPass,a=r.renderTargets[t];return a?a.texture:null},n.newGraphBuilder=function(){return this.beginGraphBuilder(),this},n.destroy=function(){for(var t=0;t<this.renderTargetAliveForID.length;t++)Z(this.renderTargetAliveForID[t]===void 0);for(var r=0;r<this.singleSampledTextureForResolveTextureID.length;r++)Z(this.singleSampledTextureForResolveTextureID[r]===void 0);for(var a=0;a<this.renderTargetDeadPool.length;a++)this.renderTargetDeadPool[a].destroy();for(var o=0;o<this.singleSampledTextureDeadPool.length;o++)this.singleSampledTextureDeadPool[o].destroy()},e}(),Ns;(function(e){e[e.BACKGROUND=0]="BACKGROUND",e[e.ALPHA_TEST=16]="ALPHA_TEST",e[e.OPAQUE=32]="OPAQUE",e[e.TRANSLUCENT=128]="TRANSLUCENT"})(Ns||(Ns={}));function Ay(e,n){return(e&16777215|(n&255)<<24)>>>0}function Py(e,n){var i=!!(e>>>31&1);return i?e:(e&4278190335|(n&65535)<<8)>>>0}function xy(e,n){return Ay(Py(0,n),e)}nu(1,0,0,0,0,1,0,0,0,0,2,0,0,0,-1,1);nu(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);function My(e,n,i,t,r,a){return t===void 0&&(t=0),r===void 0&&(r=0),a===void 0&&(a=0),e[n+0]=i,e[n+1]=t,e[n+2]=r,e[n+3]=a,4}var Ot;(function(e){e[e.Indexed=1]="Indexed",e[e.AllowSkippingIfPipelineNotReady=2]="AllowSkippingIfPipelineNotReady",e[e.Template=4]="Template",e[e.Draw=8]="Draw",e[e.InheritedFlags=3]="InheritedFlags"})(Ot||(Ot={}));var Cy=function(){function e(){this.sortKey=0,this.debug=null,this.renderPipelineDescriptor=void 0,this.uniformBuffer=void 0,this.uniforms=[],this.bindingDescriptors=Ga(1,function(){return{bindingLayout:null,samplerBindings:[],uniformBufferBindings:[]}}),this.dynamicUniformBufferByteOffsets=Ga(4,function(){return 0}),this.flags=0,this.inputState=null,this.drawStart=0,this.drawCount=0,this.drawInstanceCount=0,this.renderPipelineDescriptor={bindingLayouts:[],inputLayout:null,megaStateDescriptor:Gi(ri),program:null,topology:Tr.Triangles,colorAttachmentFormats:[],depthStencilAttachmentFormat:null,sampleCount:1},this.reset()}var n=e.prototype;return n.reset=function(){this.sortKey=0,this.flags=Ot.AllowSkippingIfPipelineNotReady,this.inputState=null,this.renderPipelineDescriptor.inputLayout=null},n.setFromTemplate=function(t){Os(this.renderPipelineDescriptor.megaStateDescriptor,t.renderPipelineDescriptor.megaStateDescriptor),this.renderPipelineDescriptor.program=t.renderPipelineDescriptor.program,this.renderPipelineDescriptor.inputLayout=t.renderPipelineDescriptor.inputLayout,this.renderPipelineDescriptor.topology=t.renderPipelineDescriptor.topology,this.renderPipelineDescriptor.colorAttachmentFormats.length=Math.max(this.renderPipelineDescriptor.colorAttachmentFormats.length,t.renderPipelineDescriptor.colorAttachmentFormats.length);for(var r=0;r<t.renderPipelineDescriptor.colorAttachmentFormats.length;r++)this.renderPipelineDescriptor.colorAttachmentFormats[r]=t.renderPipelineDescriptor.colorAttachmentFormats[r];this.renderPipelineDescriptor.depthStencilAttachmentFormat=t.renderPipelineDescriptor.depthStencilAttachmentFormat,this.renderPipelineDescriptor.sampleCount=t.renderPipelineDescriptor.sampleCount,this.inputState=t.inputState,this.uniformBuffer=t.uniformBuffer,this.uniforms=[].concat(t.uniforms),this.drawCount=t.drawCount,this.drawStart=t.drawStart,this.drawInstanceCount=t.drawInstanceCount,this.flags=this.flags&~Ot.InheritedFlags|t.flags&Ot.InheritedFlags,this.sortKey=t.sortKey;var a=this.bindingDescriptors[0],o=t.bindingDescriptors[0];o.bindingLayout!==null&&this.setBindingLayout(o.bindingLayout);for(var s=0;s<Math.min(a.uniformBufferBindings.length,o.uniformBufferBindings.length);s++)a.uniformBufferBindings[s].wordCount=t.bindingDescriptors[0].uniformBufferBindings[s].wordCount;this.setSamplerBindingsFromTextureMappings(o.samplerBindings);for(var u=0;u<t.dynamicUniformBufferByteOffsets.length;u++)this.dynamicUniformBufferByteOffsets[u]=t.dynamicUniformBufferByteOffsets[u]},n.setProgram=function(t){this.renderPipelineDescriptor.program=t},n.setMegaStateFlags=function(t){return Os(this.renderPipelineDescriptor.megaStateDescriptor,t),this.renderPipelineDescriptor.megaStateDescriptor},n.getMegaStateFlags=function(){return this.renderPipelineDescriptor.megaStateDescriptor},n.setInputLayoutAndState=function(t,r){this.inputState=r,this.renderPipelineDescriptor.inputLayout=t},n.setBindingLayout=function(t){Z(t.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length),this.renderPipelineDescriptor.bindingLayouts[0]=t,this.bindingDescriptors[0].bindingLayout=t;for(var r=this.bindingDescriptors[0].uniformBufferBindings.length;r<t.numUniformBuffers;r++)this.bindingDescriptors[0].uniformBufferBindings.push({buffer:null,wordCount:0});for(var a=this.bindingDescriptors[0].samplerBindings.length;a<t.numSamplers;a++)this.bindingDescriptors[0].samplerBindings.push({sampler:null,texture:null,lateBinding:null})},n.setBindingLayouts=function(t){Z(t.length<=this.bindingDescriptors.length),Z(t.length===1),this.setBindingLayout(t[0])},n.drawIndexes=function(t,r){r===void 0&&(r=0),this.flags=Sa(this.flags,Ot.Indexed,!0),this.drawCount=t,this.drawStart=r,this.drawInstanceCount=1},n.drawIndexesInstanced=function(t,r,a){a===void 0&&(a=0),this.flags=Sa(this.flags,Ot.Indexed,!0),this.drawCount=t,this.drawStart=a,this.drawInstanceCount=r},n.drawPrimitives=function(t,r){r===void 0&&(r=0),this.flags=Sa(this.flags,Ot.Indexed,!1),this.drawCount=t,this.drawStart=r,this.drawInstanceCount=1},n.setUniforms=function(t,r){if(r.length!==0){this.uniforms[t]=r;var a=0,o=[];r.forEach(function(h){var p=h.value;if(Ut(p)||Array.isArray(p)||p instanceof Float32Array){var g=Ut(p)?[p]:p,_=g.length>4?4:g.length,E=4-a%4;if(E!==4&&!(E>=_)){a+=E;for(var y=0;y<E;y++)o.push(0)}a+=g.length,o.push.apply(o,g)}});var s=4-o.length%4;if(s!==4)for(var u=0;u<s;u++)o.push(0);for(var l=this.allocateUniformBuffer(t,o.length),f=this.mapUniformBufferF32(t),c=0;c<o.length;c+=4)l+=My(f,l,o[c],o[c+1],o[c+2],o[c+3])}},n.setUniformBuffer=function(t){this.uniformBuffer=t},n.allocateUniformBuffer=function(t,r){Z(this.bindingDescriptors[0].bindingLayout.numUniformBuffers<this.dynamicUniformBufferByteOffsets.length),this.dynamicUniformBufferByteOffsets[t]=this.uniformBuffer.allocateChunk(r)<<2;var a=this.bindingDescriptors[0].uniformBufferBindings[t];return a.wordCount=r,this.getUniformBufferOffset(t)},n.getUniformBufferOffset=function(t){var r=this.dynamicUniformBufferByteOffsets[t]>>>2;return r},n.setUniformBufferOffset=function(t,r,a){this.dynamicUniformBufferByteOffsets[t]=r<<2;var o=this.bindingDescriptors[0].uniformBufferBindings[t];o.wordCount=a},n.mapUniformBufferF32=function(t){return this.uniformBuffer.mapBufferF32()},n.getUniformBuffer=function(){return this.uniformBuffer},n.setSamplerBindingsFromTextureMappings=function(t){t=t.filter(function(s){return s});for(var r=0;r<this.bindingDescriptors[0].samplerBindings.length;r++){var a=this.bindingDescriptors[0].samplerBindings[r],o=t[r];if(o==null){a.texture=null,a.sampler=null,a.lateBinding=null;continue}a.texture=o.texture,a.sampler=o.sampler,a.lateBinding=o.lateBinding}},n.hasLateSamplerBinding=function(t){for(var r=0;r<this.bindingDescriptors[0].samplerBindings.length;r++){var a=this.bindingDescriptors[0].samplerBindings[r];if(a.lateBinding===t)return!0}return!1},n.resolveLateSamplerBinding=function(t,r){for(var a=0;a<this.bindingDescriptors[0].samplerBindings.length;a++){var o=this.bindingDescriptors[0].samplerBindings[a];o.lateBinding===t&&(r===null?(o.texture=null,o.sampler=null):(Z(r.lateBinding===null),o.texture=r.texture,r.sampler!==null&&(o.sampler=r.sampler)),o.lateBinding=null)}},n.setAllowSkippingIfPipelineNotReady=function(t){this.flags=Sa(this.flags,Ot.AllowSkippingIfPipelineNotReady,t)},n.setAttachmentFormatsFromRenderPass=function(t,r){for(var a=t.queryRenderPass(r),o=-1,s=0;s<a.colorAttachment.length;s++){var u=a.colorAttachment[s]!==null?t.queryRenderTarget(a.colorAttachment[s]):null;this.renderPipelineDescriptor.colorAttachmentFormats[s]=u!==null?u.pixelFormat:null,u!==null&&(o===-1?o=u.sampleCount:Z(o===u.sampleCount))}var l=a.depthStencilAttachment!==null?t.queryRenderTarget(a.depthStencilAttachment):null;this.renderPipelineDescriptor.depthStencilAttachmentFormat=l!==null?l.pixelFormat:null,l!==null&&(o===-1?o=l.sampleCount:Z(o==l.sampleCount)),Z(o>0),this.renderPipelineDescriptor.sampleCount=o},n.drawOnPass=function(t,r){var a=this,o=t.device;this.setAttachmentFormatsFromRenderPass(o,r);var s=t.createRenderPipeline(this.renderPipelineDescriptor),u=o.pipelineQueryReady(s);if(!u){if(this.flags&Ot.AllowSkippingIfPipelineNotReady)return!1;o.pipelineForceReady(s)}r.setPipeline(s),r.setInputState(this.inputState);for(var l=0;l<this.bindingDescriptors[0].uniformBufferBindings.length;l++)this.bindingDescriptors[0].uniformBufferBindings[l].buffer=Ue(this.uniformBuffer.buffer);this.renderPipelineDescriptor.program.gl_program&&this.uniforms.forEach(function(c){var h={};c.forEach(function(p){var g=p.name,_=p.value;h[g]=_}),a.renderPipelineDescriptor.program.setUniforms(h)});var f=t.createBindings(Me({},this.bindingDescriptors[0],{pipeline:s}));return r.setBindings(0,f,this.dynamicUniformBufferByteOffsets),this.drawInstanceCount>1?(Z(!!(this.flags&Ot.Indexed)),r.drawIndexedInstanced(this.drawCount,this.drawStart,this.drawInstanceCount)):this.flags&Ot.Indexed?r.drawIndexed(this.drawCount,this.drawStart):r.draw(this.drawCount,this.drawStart),!0},e}();function Oy(e,n){return e.sortKey-n.sortKey}var $a;(function(e){e[e.Forwards=0]="Forwards",e[e.Backwards=1]="Backwards"})($a||($a={}));var Is=function(){function e(i,t){i===void 0&&(i=Oy),t===void 0&&(t=$a.Forwards),this.renderInsts=[],this.compareFunction=void 0,this.executionOrder=void 0,this.usePostSort=!1,this.compareFunction=i,this.executionOrder=t}var n=e.prototype;return n.checkUsePostSort=function(){this.usePostSort=this.compareFunction!==null&&this.renderInsts.length>=500},n.insertSorted=function(t){this.compareFunction===null?this.renderInsts.push(t):this.usePostSort?this.renderInsts.push(t):yE(this.renderInsts,t,this.compareFunction),this.checkUsePostSort()},n.submitRenderInst=function(t){t.flags|=Ot.Draw,this.insertSorted(t)},n.hasLateSamplerBinding=function(t){for(var r=0;r<this.renderInsts.length;r++)if(this.renderInsts[r].hasLateSamplerBinding(t))return!0;return!1},n.resolveLateSamplerBinding=function(t,r){for(var a=0;a<this.renderInsts.length;a++)this.renderInsts[a].resolveLateSamplerBinding(t,r)},n.ensureSorted=function(){this.usePostSort&&(this.renderInsts.length!==0&&this.renderInsts.sort(this.compareFunction),this.usePostSort=!1)},n.drawOnPassRendererNoReset=function(t,r){this.ensureSorted();var a=0;if(this.executionOrder===$a.Forwards)for(var o=0;o<this.renderInsts.length;o++)this.renderInsts[o].drawOnPass(t,r)&&a++;else for(var s=this.renderInsts.length-1;s>=0;s--)this.renderInsts[s].drawOnPass(t,r)&&a++;return a},n.reset=function(){this.renderInsts.length=0},n.drawOnPassRenderer=function(t,r){this.drawOnPassRendererNoReset(t,r),this.reset()},e}(),pf=function(){function e(){this.pool=[],this.allocCount=0}var n=e.prototype;return n.allocRenderInstIndex=function(){return this.allocCount++,this.allocCount>this.pool.length&&this.pool.push(new Cy),this.allocCount-1},n.popRenderInst=function(){this.allocCount--},n.reset=function(){for(var t=0;t<this.pool.length;t++)this.pool[t].reset();this.allocCount=0},n.destroy=function(){this.pool.length=0,this.allocCount=0},e}(),Ny=function(){function e(i){this.renderCache=void 0,this.instPool=new pf,this.templatePool=new pf,this.simpleRenderInstList=new Is,this.currentRenderInstList=this.simpleRenderInstList,this.renderCache=i}var n=e.prototype;return n.newRenderInst=function(){var t=this.templatePool.allocCount-1,r=this.instPool.allocRenderInstIndex(),a=this.instPool.pool[r];return a.debug=null,t>=0&&a.setFromTemplate(this.templatePool.pool[t]),a},n.submitRenderInst=function(t,r){r===void 0&&(r=this.currentRenderInstList),r.submitRenderInst(t)},n.setCurrentRenderInstList=function(t){Z(this.simpleRenderInstList===null),this.currentRenderInstList=t},n.pushTemplateRenderInst=function(){var t=this.templatePool.allocCount-1,r=this.templatePool.allocRenderInstIndex(),a=this.templatePool.pool[r];return t>=0&&a.setFromTemplate(this.templatePool.pool[t]),a.flags|=Ot.Template,a},n.popTemplateRenderInst=function(){this.templatePool.popRenderInst()},n.getTemplateRenderInst=function(){var t=this.templatePool.allocCount-1;return this.templatePool.pool[t]},n.resetRenderInsts=function(){this.instPool.reset(),this.simpleRenderInstList!==null&&this.simpleRenderInstList.reset(),Z(this.templatePool.allocCount===0)},n.destroy=function(){this.instPool.destroy(),this.renderCache.destroy()},n.disableSimpleMode=function(){this.simpleRenderInstList=null},n.drawOnPassRenderer=function(t){var r=Ue(this.simpleRenderInstList);r.drawOnPassRenderer(this.renderCache,t)},n.drawOnPassRendererNoReset=function(t){var r=Ue(this.simpleRenderInstList);r.drawOnPassRendererNoReset(this.renderCache,t)},e}(),Iy=function(){function e(){this.renderCache=void 0,this.renderGraph=void 0,this.renderInstManager=void 0,this.uniformBuffer=void 0,this.device=void 0}var n=e.prototype;return n.getDevice=function(){return this.device},n.setDevice=function(t){this.device=t,this.renderCache=new my(t),this.renderGraph=new Sy(this.device),this.renderInstManager=new Ny(this.renderCache),this.uniformBuffer=new sy(this.device)},n.pushTemplateRenderInst=function(){var t=this.renderInstManager.pushTemplateRenderInst();return t.setUniformBuffer(this.uniformBuffer),t},n.prepareToRender=function(){this.uniformBuffer.prepareToRender()},n.destroy=function(){this.uniformBuffer&&this.uniformBuffer.destroy(),this.renderInstManager&&this.renderInstManager.destroy(),this.renderCache.destroy(),this.renderGraph.destroy()},n.getCache=function(){return this.renderCache},e}(),Dy=function(){function e(i){this.pixelFormat=void 0,this.width=0,this.height=0,this.sampleCount=0,this.colorClearColor="load",this.depthClearValue="load",this.stencilClearValue="load",this.pixelFormat=i}var n=e.prototype;return n.setDimensions=function(t,r,a){this.width=t,this.height=r,this.sampleCount=a},n.copyDimensions=function(t){this.width=t.width,this.height=t.height,this.sampleCount=t.sampleCount},e}();function vo(e){return{colorClearColor:e,depthClearValue:1,stencilClearValue:0}}vo(ti(.88,.88,.88,1));var Ah=vo(mE),Wi;(function(e){e[e.None=0]="None",e[e.FXAA=1]="FXAA",e[e.MSAAx4=2]="MSAAx4"})(Wi||(Wi={}));function by(e){if(e===st.Color0)return G.U8_RGBA_RT;if(e===st.DepthStencil)return G.D24_S8;throw new Error("whoops")}function wy(e){return e.antialiasingMode===Wi.MSAAx4?4:1}function By(e,n){var i=wy(n);e.setDimensions(n.backbufferWidth,n.backbufferHeight,i)}function qa(e,n,i){var t=by(e),r=new Dy(t);return By(r,n),i!==null&&(r.colorClearColor=i.colorClearColor,r.depthClearValue=i.depthClearValue,r.stencilClearValue=i.stencilClearValue),r}var Ds=function(){function e(){this.name=void 0,this.texture=null,this.sampler=null,this.lateBinding=null,this.width=0,this.height=0,this.lodBias=0}var n=e.prototype;return n.reset=function(){this.texture=null,this.sampler=null,this.lateBinding=null,this.width=0,this.height=0,this.lodBias=0},n.copy=function(t){this.texture=t.texture,this.sampler=t.sampler,this.lateBinding=t.lateBinding,this.width=t.width,this.height=t.height,this.lodBias=t.lodBias},e}(),Fy=["style"],Za=function(e){$e(n,e);function n(i){var t=i===void 0?{}:i,r=t.style,a=gu(t,Fy);return e.call(this,Me({type:n.tag,style:Me({intensity:Math.PI},r)},a))||this}return n}(At);Za.tag="light";var Uy=["style"],bs;(function(e){e[e.NONE=0]="NONE",e[e.EXP=1]="EXP",e[e.EXP2=2]="EXP2",e[e.LINEAR=3]="LINEAR"})(bs||(bs={}));var ws=function(e){$e(n,e);function n(i){var t=i===void 0?{}:i,r=t.style,a=gu(t,Uy);return e.call(this,Me({type:n.tag,style:Me({type:bs.NONE,fill:"black",start:1,end:1e3,density:0},r)},a))||this}return n}(At);ws.tag="fog";var Ph=0,mt;(function(e){e.PROJECTION_MATRIX="u_ProjectionMatrix",e.VIEW_MATRIX="u_ViewMatrix",e.CAMERA_POSITION="u_CameraPosition",e.DEVICE_PIXEL_RATIO="u_DevicePixelRatio",e.VIEWPORT="u_Viewport",e.IS_ORTHO="u_IsOrtho",e.IS_PICKING="u_IsPicking"})(mt||(mt={}));var xh=function(){function e(i,t,r,a){this.renderHelper=void 0,this.lightPool=void 0,this.texturePool=void 0,this.batchManager=void 0,this.context=void 0,this.device=void 0,this.swapChain=void 0,this.renderLists={world:new Is,picking:new Is},this.builder=void 0,this.enableCapture=void 0,this.captureOptions=void 0,this.capturePromise=void 0,this.resolveCapturePromise=void 0,this.renderHelper=i,this.lightPool=t,this.texturePool=r,this.batchManager=a}var n=e.prototype;return n.getDevice=function(){return this.device},n.getSwapChain=function(){return this.swapChain},n.getRenderLists=function(){return this.renderLists},n.apply=function(t){var r=this;this.context=t;var a=t.renderingService,o=t.renderingContext,s=o.root.ownerDocument.defaultView,u=function(g){var _=g.target;if(_.nodeName===Za.tag){r.lightPool.addLight(_);return}else if(_.nodeName===ws.tag){r.lightPool.addFog(_);return}var E=new hh;_.renderable3D=E,r.batchManager.add(_)},l=function(g){var _=g.target;if(_.nodeName===Za.tag){r.lightPool.removeLight(_);return}else if(_.nodeName===ws.tag){r.lightPool.removeFog(_);return}r.batchManager.remove(_),delete _.renderable3D},f=function(g){var _=g.target,E=g.attrName,y=g.newValue;r.batchManager.updateAttribute(_,E,y)},c=function(g){var _=g.target;r.batchManager.updateAttribute(_,"modelMatrix",null)},h=function(g){var _=g.target,E=g.detail.renderOrder;r.batchManager.changeRenderOrder(_,E)};a.hooks.init.tapPromise(e.tag,Xa(dr().mark(function p(){var g,_,E,y;return dr().wrap(function(A){for(;;)switch(A.prev=A.next){case 0:return s.addEventListener(fe.MOUNTED,u),s.addEventListener(fe.UNMOUNTED,l),s.addEventListener(fe.ATTR_MODIFIED,f),s.addEventListener(fe.BOUNDS_CHANGED,c),s.addEventListener(fe.RENDER_ORDER_CHANGED,h),r.context.config.renderer.getConfig().enableDirtyRectangleRendering=!1,g=r.context.contextService.getDomElement(),_=r.context.config,E=_.width,y=_.height,r.context.contextService.resize(E,y),A.next=11,r.context.deviceContribution.createSwapChain(g);case 11:r.swapChain=A.sent,r.device=r.swapChain.getDevice(),r.renderHelper.setDevice(r.device),r.renderHelper.renderInstManager.disableSimpleMode(),r.swapChain.configureSwapChain(g.width,g.height),s.addEventListener(ar.RESIZE,function(){r.swapChain.configureSwapChain(g.width,g.height)}),r.batchManager.attach(Me({device:r.device},t));case 18:case"end":return A.stop()}},p)}))),a.hooks.destroy.tap(e.tag,function(){r.renderHelper.destroy(),s.removeEventListener(fe.MOUNTED,u),s.removeEventListener(fe.UNMOUNTED,l),s.removeEventListener(fe.ATTR_MODIFIED,f),s.removeEventListener(fe.BOUNDS_CHANGED,c),s.removeEventListener(fe.RENDER_ORDER_CHANGED,h)}),a.hooks.beginFrame.tap(e.tag,function(){var p=r.swapChain.getCanvas(),g=r.renderHelper.renderInstManager;r.builder=r.renderHelper.renderGraph.newGraphBuilder();var _=ir(r.context.config.background),E=r.context.config.background?ti(Number(_.r)/255*Number(_.alpha),Number(_.g)/255*Number(_.alpha),Number(_.b)/255*Number(_.alpha),Number(_.alpha)):ki,y={backbufferWidth:p.width,backbufferHeight:p.height,antialiasingMode:Wi.None},R=qa(st.Color0,y,vo(E)),A=qa(st.DepthStencil,y,Ah),M=r.builder.createRenderTargetID(R,"Main Color"),x=r.builder.createRenderTargetID(A,"Main Depth");r.builder.pushPass(function(P){P.setDebugName("Main Render Pass"),P.attachRenderTargetID(st.Color0,M),P.attachRenderTargetID(st.DepthStencil,x),P.exec(function(C){r.renderLists.world.drawOnPassRenderer(g.renderCache,C)})}),r.builder.resolveRenderTargetToExternalTexture(M,r.swapChain.getOnscreenTexture())}),a.hooks.endFrame.tap(e.tag,function(){var p=r.renderHelper.renderInstManager,g=r.renderHelper.pushTemplateRenderInst();g.setBindingLayouts([{numUniformBuffers:2,numSamplers:0}]),g.setMegaStateFlags(Eh({depthWrite:!0,blendConstant:ki},{rgbBlendMode:on.Add,alphaBlendMode:on.Add,rgbBlendSrcFactor:Ft.SrcAlpha,alphaBlendSrcFactor:Ft.One,rgbBlendDstFactor:Ft.OneMinusSrcAlpha,alphaBlendDstFactor:Ft.OneMinusSrcAlpha}));var _=r.context.config,E=_.width,y=_.height,R=r.context.camera;if(g.setUniforms(Ph,[{name:mt.PROJECTION_MATRIX,value:R.getPerspective()},{name:mt.VIEW_MATRIX,value:R.getViewTransform()},{name:mt.CAMERA_POSITION,value:R.getPosition()},{name:mt.DEVICE_PIXEL_RATIO,value:r.context.contextService.getDPR()},{name:mt.VIEWPORT,value:[E,y]},{name:mt.IS_ORTHO,value:R.isOrtho()?1:0},{name:mt.IS_PICKING,value:0}]),r.batchManager.render(r.renderLists.world),p.popTemplateRenderInst(),r.renderHelper.prepareToRender(),r.renderHelper.renderGraph.execute(),p.resetRenderInsts(),r.swapChain.present(),r.enableCapture&&r.resolveCapturePromise){var A=r.captureOptions,M=A.type,x=A.encoderOptions,P=r.context.contextService.getDomElement().toDataURL(M,x);r.resolveCapturePromise(P),r.enableCapture=!1,r.captureOptions=void 0,r.resolveCapturePromise=void 0}})},n.loadTexture=function(t,r,a){return this.texturePool.getOrCreateTexture(this.device,t,r,function(o){a&&a(o)})},n.toDataURL=function(){var i=Xa(dr().mark(function r(a){var o=this;return dr().wrap(function(u){for(;;)switch(u.prev=u.next){case 0:return this.enableCapture=!0,this.captureOptions=a,this.capturePromise=new Promise(function(l){o.resolveCapturePromise=function(f){l(f)}}),u.abrupt("return",this.capturePromise);case 4:case"end":return u.stop()}},r,this)}));function t(r){return i.apply(this,arguments)}return t}(),e}();xh.tag="RenderGraph";var gf=100,Mh=function(){function e(i,t,r,a){this.renderHelper=void 0,this.renderGraphPlugin=void 0,this.pickingIdGenerator=void 0,this.batchManager=void 0,this.context=void 0,this.renderHelper=i,this.renderGraphPlugin=t,this.pickingIdGenerator=r,this.batchManager=a}var n=e.prototype;return n.apply=function(t){var r=this;this.context=t;var a=t.renderingService,o=t.renderingContext,s=o.root.ownerDocument.defaultView,u=function(f){var c=f.target,h=c.renderable3D;if(h){var p=r.pickingIdGenerator.getId(c);h.pickingId=p,h.encodedPickingColor=r.pickingIdGenerator.encodePickingColor(p)}};a.hooks.init.tapPromise(e.tag,Xa(dr().mark(function l(){return dr().wrap(function(c){for(;;)switch(c.prev=c.next){case 0:s.addEventListener(fe.MOUNTED,u);case 1:case"end":return c.stop()}},l)}))),a.hooks.destroy.tap(e.tag,function(){s.removeEventListener(fe.MOUNTED,u)}),a.hooks.pickSync.tap(e.tag,function(l){return r.pick(l)}),a.hooks.pick.tapPromise(e.tag,function(){var l=Xa(dr().mark(function f(c){return dr().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:return p.abrupt("return",r.pick(c));case 1:case"end":return p.stop()}},f)}));return function(f){return l.apply(this,arguments)}}())},n.pick=function(t){var r=t.topmost,a=t.position,o=a.viewportX,s=a.viewportY,u=this.context.contextService.getDPR(),l=this.context.config.width*u,f=this.context.config.height*u,c=o*u,h=s*u;if(c>l||c<0||h>f||h<0)return t.picked=[],t;var p=this.pickByRectangleInDepth(new Rn(dt(Math.round(c),0,l-1),dt(Math.round(h),0,f-1),1,1),r?1:gf);return t.picked=p,t},n.pickByRectangleInDepth=function(t,r){r===void 0&&(r=gf);var a=null,o=1,s=[];do if(a=this.pickByRectangle(t,a),a)o++,s.push(a);else break;while(a&&o<=r);return r>1&&this.restorePickingColor(s),s},n.restorePickingColor=function(t){var r=this;t.forEach(function(a){r.batchManager.updateAttribute(a,"pointerEvents",!0,!0)})},n.pickByRectangle=function(t,r){var a=this,o=this.renderGraphPlugin.getDevice(),s=this.renderGraphPlugin.getRenderLists(),u=this.renderHelper.renderInstManager,l=this.renderHelper.renderGraph.newGraphBuilder(),f=ki,c=this.context.camera,h=t.x,p=t.y,g=t.width,_=t.height,E={backbufferWidth:g,backbufferHeight:_,antialiasingMode:Wi.None},y=qa(st.Color0,E,vo(f)),R=l.createRenderTargetID(y,"Picking Color"),A=qa(st.DepthStencil,E,Ah),M=l.createRenderTargetID(A,"Picking Depth"),x=Me({},c.getView());this.renderHelper.renderGraph.renderTargetDeadPool.forEach(function(d){d.age=-1});var P;l.pushPass(function(d){d.setDebugName("Picking Pass"),d.attachRenderTargetID(st.Color0,R),d.attachRenderTargetID(st.DepthStencil,M),d.exec(function(v){s.picking.drawOnPassRenderer(u.renderCache,v)}),d.post(function(v){var m=v.getRenderTargetTexture(st.Color0),S=o.createReadback();x&&x.enabled?c.setViewOffset(x.fullWidth,x.fullHeight,x.offsetX,x.offsetY,x.width,x.height):c.clearViewOffset(),c.setEnableUpdate(!0);var T=S.readTexture(m,0,0,g,_,new Uint8Array(g*_*4)),N=-1;if(T&&(T[0]!==0||T[1]!==0||T[2]!==0)&&(N=a.pickingIdGenerator.decodePickingColor(T)),N>-1){var B=a.pickingIdGenerator.getById(N);B&&B.isVisible()&&B.isInteractive()&&(P=B)}S.destroy()})});var C=this.renderHelper.pushTemplateRenderInst();C.setBindingLayouts([{numUniformBuffers:2,numSamplers:0}]),C.setMegaStateFlags(Eh({depthWrite:!0},{rgbBlendMode:on.Add,rgbBlendSrcFactor:Ft.One,rgbBlendDstFactor:Ft.Zero,alphaBlendMode:on.Add,alphaBlendSrcFactor:Ft.One,alphaBlendDstFactor:Ft.Zero}));var O=this.context.config,D=O.width,F=O.height,k=this.context.contextService.getDPR();return c.setEnableUpdate(!1),c.setViewOffset(D*k,F*k,h,p,g,_),C.setUniforms(Ph,[{name:mt.PROJECTION_MATRIX,value:c.getPerspective()},{name:mt.VIEW_MATRIX,value:c.getViewTransform()},{name:mt.CAMERA_POSITION,value:c.getPosition()},{name:mt.DEVICE_PIXEL_RATIO,value:this.context.contextService.getDPR()},{name:mt.VIEWPORT,value:[D,F]},{name:mt.IS_ORTHO,value:c.isOrtho()?1:0},{name:mt.IS_PICKING,value:1}]),r&&this.batchManager.updateAttribute(r,"pointerEvents",!1,!0),this.batchManager.render(s.picking,!0),u.popTemplateRenderInst(),this.renderHelper.prepareToRender(),this.renderHelper.renderGraph.execute(),u.resetRenderInsts(),P},e}();Mh.tag="WebGLPicker";var rn=1/200,ky=1,Mn=function(){function e(){this.id=ky++,this.meshes=[],this.clipPathMeshCreated=!1}var n=e.prototype;return n.shouldSubmitRenderInst=function(t,r){return!0},n.beforeUploadUBO=function(t,r,a){},n.beforeInitMesh=function(t){},n.afterInitMesh=function(t){},e}();function Bs(e,n,i){var t=e.createBuffer({viewOrSize:_E(i.byteLength,4)/4,usage:n,hint:Zn.Static});return t.setSubData(0,new Uint8Array(i)),t}var Qa;(function(e){e.CHANGED="changed"})(Qa||(Qa={}));var Ch=function(e){$e(n,e);function n(t,r){var a;return r===void 0&&(r={}),a=e.call(this)||this,a.device=void 0,a.props=void 0,a.drawMode=Tr.Triangles,a.vertexBuffers=[],a.vertices=[],a.indexBuffer=void 0,a.indices=void 0,a.inputLayoutDescriptor={vertexBufferDescriptors:[],vertexAttributeDescriptors:[],indexBufferFormat:G.U32_R},a.vertexCount=0,a.instancedCount=0,a.indexStart=0,a.primitiveStart=0,a.dirty=!0,a.meshes=[],a.device=t,a.props=r,a}var i=n.prototype;return i.validate=function(r){return!0},i.build=function(r){},i.computeBoundingBox=function(){return new ct},i.setIndexBuffer=function(r){return this.indexBuffer&&this.indexBuffer.destroy(),this.indexBuffer=Bs(this.device,ut.INDEX|ut.COPY_DST,new Uint32Array(ArrayBuffer.isView(r)?r.buffer:r).buffer),this.indices=r,this},i.setVertexBuffer=function(r){var a=this,o=r.bufferIndex,s=r.byteStride,u=r.frequency,l=r.attributes,f=r.data;this.inputLayoutDescriptor.vertexBufferDescriptors[o]={byteStride:s,frequency:u},this.vertices[o]=f,l.forEach(function(h){var p=h.format,g=h.bufferByteOffset,_=h.location,E=h.divisor,y=h.byteStride,R=a.inputLayoutDescriptor.vertexAttributeDescriptors.find(function(A){return A.bufferIndex===o&&A.location===_});R?(R.format=p,R.bufferByteOffset=g,R.byteStride=y,R.divisor=E):a.inputLayoutDescriptor.vertexAttributeDescriptors.push({format:p,bufferIndex:o,bufferByteOffset:g,location:_,byteStride:y,divisor:E})}),this.vertexBuffers[o]&&this.vertexBuffers[o].destroy();var c=Bs(this.device,ut.VERTEX|ut.COPY_DST,f.buffer);return this.vertexBuffers[o]=c,this},i.getVertexBuffer=function(r){return this.vertexBuffers[r]},i.updateVertexBuffer=function(r,a,o,s){var u=this.inputLayoutDescriptor.vertexBufferDescriptors[r].byteStride,l=this.inputLayoutDescriptor.vertexAttributeDescriptors.find(function(h){return h.location===a});if(l){var f=this.getVertexBuffer(r),c=o*u;f.setSubData(l.bufferByteOffset+c,s)}this.emit(Qa.CHANGED)},i.updateIndices=function(r,a){return a===void 0&&(a=0),this.indexBuffer&&this.indexBuffer.setSubData(a,ArrayBuffer.isView(r)?r:new Uint32Array(r)),this},i.destroy=function(){this.vertexBuffers.forEach(function(r){r&&r.destroy()}),this.indexBuffer&&this.indexBuffer.destroy(),this.inputLayoutDescriptor.vertexAttributeDescriptors=[],this.inputLayoutDescriptor.vertexBufferDescriptors=[],this.indexBuffer=void 0,this.vertexBuffers=[],this.indices=void 0,this.vertices=[],this.vertexCount=0,this.instancedCount=0},n}(jn);function Ly(e){return!!(e&&e.type)}var Ja;(function(e){e.CHANGED="changed"})(Ja||(Ja={}));var Oh=function(e){$e(n,e);function n(t,r){var a;a=e.call(this)||this,a.device=void 0,a.props={},a.meshes=[],a.defines={},a.uniforms={},a.uniformNames=void 0,a.uboBuffer=[],a.textures={},a.samplers=[],a.programDirty=!0,a.textureDirty=!0,a.geometryDirty=!0;var o=Gi(ri),s=o.cullMode,u=o.depthCompare,l=o.depthWrite,f=o.stencilCompare,c=o.stencilWrite,h=o.stencilPassOp,p=o.frontFace,g=o.polygonOffset,_=o.attachmentsState;return a.device=t,a.props=Me({cullMode:s,depthTest:!0,depthCompare:u,depthWrite:l,stencilCompare:f,stencilWrite:c,stencilPassOp:h,frontFace:p,polygonOffset:g,attachmentsState:_,dithering:!1,wireframe:!1,wireframeColor:"black",wireframeLineWidth:1,vertexShader:"",fragmentShader:""},r),a.compile(),a}var i=n.prototype;return i.compile=function(){var r=this;this.props.fragmentShader.replace(/^\s*uniform\s*sampler2D\s*(.*)\s*;$/gm,function(a,o){return r.samplers.push(o),""}),this.uniformNames=ay(this.props.fragmentShader)},i.setUniforms=function(r){var a=this,o=!1;Object.keys(r).forEach(function(s){var u=r[s],l=a.textures[s];l&&l!==u&&(a.textureDirty=!0),Ly(u)?(a.textures[s]=u,a.textureDirty=!0,u.on(Yn.LOADED,function(){a.dispatchMutationEvent()})):(a.uniforms[s]=u,o=!0),ae(r[s])&&(delete a.textures[s],delete a.uniforms[s])}),o&&this.dispatchMutationEvent()},i.dispatchMutationEvent=function(){this.emit(Ja.CHANGED)},ch(n,[{key:"cullMode",get:function(){return this.props.cullMode},set:function(r){this.props.cullMode=r}},{key:"frontFace",get:function(){return this.props.frontFace},set:function(r){this.props.frontFace=r}},{key:"blendConstant",get:function(){return this.props.blendConstant},set:function(r){this.props.blendConstant=r}},{key:"blendEquation",get:function(){return this.props.blendEquation},set:function(r){this.props.blendEquation=r}},{key:"blendEquationAlpha",get:function(){return this.props.blendEquationAlpha},set:function(r){this.props.blendEquationAlpha=r}},{key:"blendSrc",get:function(){return this.props.blendSrc},set:function(r){this.props.blendSrc=r}},{key:"blendDst",get:function(){return this.props.blendDst},set:function(r){this.props.blendDst=r}},{key:"blendSrcAlpha",get:function(){return this.props.blendSrcAlpha},set:function(r){this.props.blendSrcAlpha=r}},{key:"blendDstAlpha",get:function(){return this.props.blendDstAlpha},set:function(r){this.props.blendDstAlpha=r}},{key:"depthCompare",get:function(){return this.props.depthCompare},set:function(r){this.props.depthCompare=r}},{key:"depthTest",get:function(){return this.props.depthTest},set:function(r){this.props.depthTest=r}},{key:"depthWrite",get:function(){return this.props.depthWrite},set:function(r){this.props.depthWrite=r}},{key:"stencilCompare",get:function(){return this.props.stencilCompare},set:function(r){this.props.stencilCompare=r}},{key:"stencilWrite",get:function(){return this.props.stencilWrite},set:function(r){this.props.stencilWrite=r}},{key:"stencilPassOp",get:function(){return this.props.stencilPassOp},set:function(r){this.props.stencilPassOp=r}},{key:"stencilRef",get:function(){return this.props.stencilRef},set:function(r){this.props.stencilRef=r}},{key:"polygonOffset",get:function(){return this.props.polygonOffset},set:function(r){this.props.polygonOffset=r}},{key:"dithering",get:function(){return this.props.dithering},set:function(r){this.props.dithering=r}},{key:"wireframe",get:function(){return this.props.wireframe},set:function(r){this.props.wireframe!==r&&(this.geometryDirty=!0,this.programDirty=!0,this.props.wireframe=r,this.dispatchMutationEvent()),this.defines.USE_WIREFRAME=!!r}},{key:"wireframeColor",get:function(){return this.props.wireframeColor},set:function(r){this.props.wireframeColor=r}},{key:"wireframeLineWidth",get:function(){return this.props.wireframeLineWidth},set:function(r){this.props.wireframeLineWidth=r}},{key:"vertexShader",get:function(){return this.props.vertexShader},set:function(r){this.props.vertexShader!==r&&(this.programDirty=!0,this.props.vertexShader=r,this.compile())}},{key:"fragmentShader",get:function(){return this.props.fragmentShader},set:function(r){this.props.fragmentShader!==r&&(this.programDirty=!0,this.props.fragmentShader=r,this.compile())}}]),n}(jn),Wy=function(e){$e(n,e);function n(i,t){var r;return r=e.call(this,i,Me({},t))||this,r.defines=Me({},r.defines,{USE_UV:!1,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1}),r}return n}(Oh);function Jn(e){var n={};return Object.keys(e).forEach(function(i){typeof e[i]=="number"&&(n[i]=e[i])}),n}function Hy(e,n){var i=Object.keys(e),t=Object.keys(n);return i.length!==t.length?!1:i.every(function(r){return e[r]===n[r]})}var Ko=function(n){return Object.fromEntries(Object.entries(n).filter(function(i){i[0];var t=i[1];return t!==void 0}))},Xy=1,Fs="FillTextureMapping",Ne;(function(e){e[e.MODEL_MATRIX=0]="MODEL_MATRIX",e[e.FILL_STROKE=1]="FILL_STROKE",e[e.PACKED_STYLE=2]="PACKED_STYLE",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.POSITION=4]="POSITION",e[e.NORMAL=5]="NORMAL",e[e.UV=6]="UV",e[e.BARYCENTRIC=7]="BARYCENTRIC",e[e.MAX=8]="MAX"})(Ne||(Ne={}));var _e;(function(e){e[e.MODEL_MATRIX0=0]="MODEL_MATRIX0",e[e.MODEL_MATRIX1=1]="MODEL_MATRIX1",e[e.MODEL_MATRIX2=2]="MODEL_MATRIX2",e[e.MODEL_MATRIX3=3]="MODEL_MATRIX3",e[e.COLOR=4]="COLOR",e[e.STROKE_COLOR=5]="STROKE_COLOR",e[e.PACKED_STYLE1=6]="PACKED_STYLE1",e[e.PACKED_STYLE2=7]="PACKED_STYLE2",e[e.PICKING_COLOR=8]="PICKING_COLOR",e[e.POSITION=9]="POSITION",e[e.NORMAL=10]="NORMAL",e[e.UV=11]="UV",e[e.BARYCENTRIC=12]="BARYCENTRIC",e[e.MAX=13]="MAX"})(_e||(_e={}));var Cn=function(){function e(i,t,r){this.renderHelper=void 0,this.texturePool=void 0,this.lightPool=void 0,this.id=Xy++,this.renderer=void 0,this.index=-1,this.context=void 0,this.objects=[],this.material=void 0,this.geometry=void 0,this.clipPath=void 0,this.clipPathTarget=void 0,this.inputState=void 0,this.program=new Rh,this.programDescriptorSimpleWithOrig=void 0,this.geometryDirty=!0,this.materialDirty=!0,this.inputStateDirty=!0,this.textureMappings=[],this.samplerEntries=void 0,this.inited=!1,this.renderHelper=i,this.texturePool=t,this.lightPool=r}var n=e.prototype;return n.init=function(t){this.inited||(this.renderer.beforeInitMesh(this),this.context=t,this.material=new Wy(this.context.device),this.material.defines=Me({},Jn(_e),this.material.defines),this.geometry=new Ch(this.context.device),this.geometry.meshes=this.objects,this.material.meshes=this.objects,this.observeGeometryChanged(),this.observeMaterialChanged(),this.inited=!0,this.renderer.afterInitMesh(this))},n.observeGeometryChanged=function(){var t=this;this.geometry.on(Qa.CHANGED,function(){t.geometry.meshes.forEach(function(r){r.renderable.dirty=!0}),t.context.renderingService.dirtify()})},n.observeMaterialChanged=function(){var t=this;this.material.on(Ja.CHANGED,function(){t.material.meshes.forEach(function(r){r.renderable.dirty=!0}),t.context.renderingService.dirtify()})},n.shouldMergeColor=function(t,r,a){var o=t.parsedStyle[a],s=r.parsedStyle[a];return!!(je(o)&&je(s)||mn(o)&&mn(s)&&o.image===s.image||Array.isArray(o)&&Array.isArray(s)&&t.style[a]===r.style[a])},n.shouldMerge=function(t,r){return this.instance?!(this.instance.nodeName!==t.nodeName&&this.instance.nodeName!==t.renderable.proxyNodeName&&this.instance.renderable.proxyNodeName!==t.nodeName&&this.instance.renderable.proxyNodeName!==t.renderable.proxyNodeName||t.parsedStyle.clipPath||!this.shouldMergeColor(this.instance,t,"fill")||!this.shouldMergeColor(this.instance,t,"stroke")):!0},n.createGeometry=function(t){var r=this,a=Te(),o=Te(),s=[],u=[],l=[],f=[];t.forEach(function(c){var h,p=c.parsedStyle,g=p.fill,_=p.stroke,E=p.opacity,y=p.fillOpacity,R=p.strokeOpacity,A=p.lineWidth,M=p.anchor,x=p.visibility,P=p.increasedLineWidthForHitTesting,C=[0,0,0,0];je(g)&&(C=[Number(g.r)/255,Number(g.g)/255,Number(g.b)/255,Number(g.alpha)]);var O=[0,0,0,0];je(_)&&(O=[Number(_.r)/255,Number(_.g)/255,Number(_.b)/255,Number(_.alpha)]),r.clipPathTarget?(Ar(a,c.getLocalTransform()),C=[1,1,1,1],yn(a,r.clipPathTarget.getWorldTransform(),a)):Ar(a,c.getWorldTransform()),yn(o,r.context.camera.getViewTransform(),a);var D=c.isInteractive()&&((h=c.renderable3D)===null||h===void 0?void 0:h.encodedPickingColor)||[0,0,0];s.push.apply(s,a),u.push.apply(u,C.concat(O)),l.push(E,y,R,A,x==="visible"?1:0,M[0],M[1],P||0),f.push.apply(f,D.concat([c.sortable.renderOrder*rn]))}),this.geometry.instancedCount=t.length,this.geometry.setVertexBuffer({bufferIndex:Ne.MODEL_MATRIX,byteStride:4*(4*4),frequency:be.PerInstance,attributes:[{format:G.F32_RGBA,bufferByteOffset:4*0,location:_e.MODEL_MATRIX0,divisor:1},{format:G.F32_RGBA,bufferByteOffset:4*4,location:_e.MODEL_MATRIX1,divisor:1},{format:G.F32_RGBA,bufferByteOffset:4*8,location:_e.MODEL_MATRIX2,divisor:1},{format:G.F32_RGBA,bufferByteOffset:4*12,location:_e.MODEL_MATRIX3,divisor:1}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:Ne.FILL_STROKE,byteStride:4*8,frequency:be.PerInstance,attributes:[{format:G.F32_RGBA,bufferByteOffset:4*0,location:_e.COLOR,divisor:1},{format:G.F32_RGBA,bufferByteOffset:4*4,location:_e.STROKE_COLOR,divisor:1}],data:new Float32Array(u)}),this.geometry.setVertexBuffer({bufferIndex:Ne.PACKED_STYLE,byteStride:4*8,frequency:be.PerInstance,attributes:[{format:G.F32_RGBA,bufferByteOffset:4*0,location:_e.PACKED_STYLE1,divisor:1},{format:G.F32_RGBA,bufferByteOffset:4*4,location:_e.PACKED_STYLE2,divisor:1}],data:new Float32Array(l)}),this.geometry.setVertexBuffer({bufferIndex:Ne.PICKING_COLOR,byteStride:4*4,frequency:be.PerInstance,attributes:[{format:G.F32_RGBA,bufferByteOffset:4*0,location:_e.PICKING_COLOR,divisor:1}],data:new Float32Array(f)})},n.destroy=function(){this.geometry&&this.geometry.destroy(),this.inputState&&this.inputState.destroy()},n.applyRenderInst=function(t,r){var a=this,o=this.lightPool.getAllLights(),s=this.lightPool.getFog(),u=!!s,l=!!o.length;this.clipPathTarget||this.clipPath?this.clipPathTarget?(this.material.stencilWrite=!0,this.material.depthWrite=!1,this.material.stencilCompare=an.Always,this.material.stencilPassOp=Ui.Replace):(this.material.stencilWrite=!1,this.material.depthWrite=!0,this.material.stencilCompare=an.Equal,this.material.stencilPassOp=Ui.Keep):this.material.stencilWrite=!1,(this.materialDirty||this.material.programDirty)&&this.createMaterial(r);var f=Me({},this.material.defines);if(this.material.defines.USE_FOG=u,this.material.defines.USE_LIGHT=l,this.material.defines=Me({},this.material.defines,this.lightPool.getDefines()),this.material.textureDirty){this.textureMappings=[];var c=this.createFillGradientTextureMapping(r);c&&this.textureMappings.push(c),Object.keys(this.material.textures).sort(function(E,y){return a.material.samplers.indexOf(E)-a.material.samplers.indexOf(y)}).forEach(function(E){var y=new Ds;y.name=E,y.texture=a.material.textures[E],a.context.device.setResourceName(y.texture,"Material Texture "+E),y.sampler=a.renderHelper.getCache().createSampler({wrapS:Lr.Clamp,wrapT:Lr.Clamp,minFilter:_t.Point,magFilter:_t.Bilinear,mipFilter:bt.Linear,minLOD:0,maxLOD:0}),a.textureMappings.push(y)}),this.textureMappings.length?(this.material.defines.USE_UV=!0,this.material.defines.USE_MAP=!0):(this.material.defines.USE_UV=!1,this.material.defines.USE_MAP=!1),this.material.textureDirty=!1}var h=!Hy(f,this.material.defines);(h||this.material.programDirty||this.materialDirty)&&(this.material.defines=Me({},this.material.defines,Jn(_e)),Object.keys(this.material.defines).forEach(function(E){var y=a.material.defines[E];typeof y=="number"?a.program.setDefineString(E,""+y):a.program.setDefineBool(E,y)}),this.program.vert=this.material.vertexShader,this.program.frag=this.material.fragmentShader,this.programDescriptorSimpleWithOrig=Th(this.context.device,this.program),this.material.programDirty=!1,this.materialDirty=!1),this.material.geometryDirty&&(this.geometryDirty=!0,this.inputStateDirty=!0,this.material.geometryDirty=!1),(this.geometryDirty||this.geometry.dirty)&&(this.geometry&&this.geometry.destroy(),this.createGeometry(r),this.material.wireframe&&this.generateWireframe(this.geometry),this.geometryDirty=!1,this.geometry.dirty=!1,this.inputStateDirty=!0);var p=this.renderHelper.getCache().createInputLayout(this.geometry.inputLayoutDescriptor),g=this.renderHelper.getCache().createProgramSimple(this.programDescriptorSimpleWithOrig),_=!!this.geometry.indexBuffer;this.inputStateDirty&&(this.inputState&&this.inputState.destroy(),this.inputState=this.context.device.createInputState(p,this.geometry.vertexBuffers.map(function(E){return{buffer:E,byteOffset:0}}),_?{buffer:this.geometry.indexBuffer,byteOffset:0}:null,g),this.inputStateDirty=!1),t.renderPipelineDescriptor.topology=this.geometry.drawMode,t.setProgram(g),t.setInputLayoutAndState(p,this.inputState),this.renderer.beforeUploadUBO(t,this,this.index),this.uploadUBO(t),_?t.drawIndexesInstanced(this.geometry.vertexCount,this.geometry.instancedCount,this.geometry.indexStart):t.drawPrimitives(this.geometry.vertexCount,this.geometry.primitiveStart),t.sortKey=xy(Ns.OPAQUE,r[0].sortable.renderOrder)},n.updateBatchedAttribute=function(t,r,a,o){var s=["opacity","fillOpacity","strokeOpacity","lineWidth","visibility","anchor","increasedLineWidthForHitTesting"];if(a==="fill"||a==="stroke"){var u=[];t.forEach(function(_){var E=_.parsedStyle,y=E.fill,R=E.stroke,A=[0,0,0,0];je(y)&&(A=[Number(y.r)/255,Number(y.g)/255,Number(y.b)/255,Number(y.alpha)]);var M=[0,0,0,0];je(R)&&(M=[Number(R.r)/255,Number(R.g)/255,Number(R.b)/255,Number(R.alpha)]),u.push.apply(u,A.concat(M))}),this.geometry.updateVertexBuffer(Ne.FILL_STROKE,_e.COLOR,r,new Uint8Array(new Float32Array(u).buffer));var l=this.instance.parsedStyle.fill,f=this.textureMappings.findIndex(function(_){return _.name===Fs});if(je(l))f>=0&&(this.textureMappings.splice(f,-1),this.material.textureDirty=!0);else{var c=this.createFillGradientTextureMapping([this.instance]);f>=0&&this.textureMappings.splice(f,1,c),this.material.textureDirty=!0}}else if(s.indexOf(a)>-1){var h=[];t.forEach(function(_){var E=_.parsedStyle,y=E.opacity,R=E.fillOpacity,A=E.strokeOpacity,M=E.lineWidth,x=E.visibility,P=E.anchor,C=E.increasedLineWidthForHitTesting;h.push(y,R,A,M,x==="visible"?1:0,P[0],P[1],C||0)}),this.geometry.updateVertexBuffer(Ne.PACKED_STYLE,_e.PACKED_STYLE1,r,new Uint8Array(new Float32Array(h).buffer))}else if(a==="modelMatrix"){var p=[];t.forEach(function(_){var E=Ar(Te(),_.getWorldTransform());p.push.apply(p,E)}),this.geometry.updateVertexBuffer(Ne.MODEL_MATRIX,_e.MODEL_MATRIX0,r,new Uint8Array(new Float32Array(p).buffer))}else if(a==="pointerEvents"){var g=[];t.forEach(function(_){var E,y=o&&_.isInteractive()&&((E=_.renderable3D)===null||E===void 0?void 0:E.encodedPickingColor)||[0,0,0];g.push.apply(g,y.concat([_.sortable.renderOrder*rn]))}),this.geometry.updateVertexBuffer(Ne.PICKING_COLOR,_e.PICKING_COLOR,r,new Uint8Array(new Float32Array(g).buffer))}},n.updateAttribute=function(t,r,a,o){a==="clipPath"&&this.clipPath&&(this.geometryDirty=!0)},n.changeRenderOrder=function(t,r){var a,o=this.objects.indexOf(t),s=t.isInteractive()&&((a=t.renderable3D)===null||a===void 0?void 0:a.encodedPickingColor)||[0,0,0];this.geometry.updateVertexBuffer(Ne.PICKING_COLOR,_e.PICKING_COLOR,o,new Uint8Array(new Float32Array([].concat(s,[r*rn])).buffer))},n.generateWireframe=function(t){for(var r=t.indices,a=t.indices.length,o=t.vertices.map(function(C){return C.slice()}),s=Ne.PICKING_COLOR;s<t.vertexBuffers.length;s++){var u=t.inputLayoutDescriptor.vertexBufferDescriptors[s].byteStride;t.vertices[s]=new Float32Array(u/4*a)}for(var l=0,f=new Uint32Array(a),c=0;c<a;c++){for(var h=r[c],p=1;p<t.vertices.length;p++)for(var g=t.inputLayoutDescriptor.vertexBufferDescriptors[p].byteStride,_=g/4,E=0;E<_;E++)t.vertices[p][l*_+E]=o[p][h*_+E];f[c]=l,l++}for(var y=function(O){var D=t.inputLayoutDescriptor.vertexBufferDescriptors[O],F=D.frequency,k=D.byteStride,d=t.inputLayoutDescriptor.vertexAttributeDescriptors.find(function(B){var w=B.bufferIndex;return w===O});if(d){var v=d.location,m=d.bufferIndex,S=d.bufferByteOffset,T=d.format,N=d.divisor;t.setVertexBuffer({bufferIndex:m,byteStride:k,frequency:F,attributes:[{format:T,bufferByteOffset:S,location:v,divisor:N}],data:t.vertices[O]})}},R=Ne.PICKING_COLOR+1;R<t.vertexBuffers.length;R++)y(R);for(var A=new Float32Array(a*3),M=0;M<a;)for(var x=0;x<3;x++){var P=f[M++];A[P*3+x]=1}t.setVertexBuffer({bufferIndex:Ne.BARYCENTRIC,byteStride:4*3,frequency:be.PerVertex,attributes:[{format:G.F32_RGB,bufferByteOffset:4*0,location:Number(_e.BARYCENTRIC)}],data:A}),t.setIndexBuffer(f)},n.beforeUploadUBO=function(t,r,a){},n.uploadUBO=function(t){var r=this,a=1,o=this.material,s=this.lightPool.getAllLights(),u=this.lightPool.getFog(),l=!!u,f=!!s.length,c=o.defines.USE_WIREFRAME,h=[];if(c){var p=ir(o.wireframeColor);h.push({name:"u_WireframeLineColor",value:[Number(p.r)/255,Number(p.g)/255,Number(p.b)/255]}),h.push({name:"u_WireframeLineWidth",value:o.wireframeLineWidth})}if(l&&this.uploadFog(h,u),this.uploadMaterial(h,o),f){var g={};s.forEach(function(N){g[N.define]||(g[N.define]=-1),g[N.define]++,N.uploadUBO(h,g[N.define])})}h.sort(function(N,B){return r.material.uniformNames.indexOf(N.name)-r.material.uniformNames.indexOf(B.name)}),t.setUniforms(a,h);var _=o.depthCompare,E=o.depthWrite,y=o.stencilCompare,R=o.stencilWrite,A=o.stencilPassOp,M=o.stencilRef,x=o.cullMode,P=o.frontFace,C=o.polygonOffset,O=o.blendConstant,D=o.blendEquation,F=o.blendEquationAlpha,k=o.blendSrc,d=o.blendDst,v=o.blendSrcAlpha,m=o.blendDstAlpha,S=Ko({blendConstant:O,depthCompare:_,depthWrite:E,stencilCompare:y,stencilWrite:R,stencilPassOp:A,stencilRef:M,cullMode:x,frontFace:P,polygonOffset:C}),T=t.getMegaStateFlags().attachmentsState[0];t.setMegaStateFlags(Me({attachmentsState:[{channelWriteMask:this.material.stencilWrite?it.None:it.AllChannels,rgbBlendState:Me({},T.rgbBlendState,Ko({blendMode:D,blendSrcFactor:k,blendDstFactor:d})),alphaBlendState:Me({},T.alphaBlendState,Ko({blendMode:F,blendSrcFactor:v,blendDstFactor:m}))}]},S)),t.setBindingLayouts([{numUniformBuffers:a,numSamplers:this.textureMappings.length,samplerEntries:this.samplerEntries}]),t.setSamplerBindingsFromTextureMappings(this.textureMappings)},n.uploadFog=function(t,r){var a=r.parsedStyle,o=a.type,s=a.fill,u=a.start,l=a.end,f=a.density;if(je(s)){var c=[Number(s.r)/255,Number(s.g)/255,Number(s.b)/255,Number(s.alpha)];t.push({name:"u_FogInfos",value:[o,u,l,f]}),t.push({name:"u_FogColor",value:c})}},n.uploadMaterial=function(t,r){var a=Object.keys(r.uniforms).map(function(o){return{name:o,value:r.uniforms[o]}});t.push.apply(t,a)},n.createFillGradientTextureMapping=function(t){var r=this,a=t[0],o=a.nodeName===H.LINE?a.parsedStyle.stroke:a.parsedStyle.fill,s;if(o&&(mn(o)||Array.isArray(o))){Array.isArray(o)?(this.program.setDefineBool("USE_PATTERN",!1),this.texturePool.getOrCreateGradient({gradients:o,width:128,height:128,instance:a})):mn(o)&&(this.program.setDefineBool("USE_PATTERN",!0),this.texturePool.getOrCreatePattern(o,a,function(){t.forEach(function(f){f.renderable.dirty=!0}),r.material.textureDirty=!0})),s=this.texturePool.getOrCreateCanvas();var u=this.texturePool.getOrCreateTexture(this.context.device,s,dh(G.U8_RGBA_NORM,1,1,1));if(u){var l=new Ds;return l.name=Fs,l.texture=u,l.texture.on("loaded",function(){t.forEach(function(f){f.renderable.dirty=!0}),r.material.textureDirty=!0}),this.context.device.setResourceName(l.texture,"Fill Texture"+this.id),l.sampler=this.renderHelper.getCache().createSampler({wrapS:Lr.Repeat,wrapT:Lr.Repeat,minFilter:_t.Point,magFilter:_t.Bilinear,mipFilter:bt.Linear,minLOD:0,maxLOD:0}),l}}return null},ch(e,[{key:"instance",get:function(){return this.objects[0]}}]),e}(),Vy=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};

in vec4 v_PickingResult;
in vec4 v_Color;
in vec4 v_StrokeColor;
in vec4 v_StylePacked1;
in vec4 v_StylePacked2;
#ifdef USE_UV
  in vec2 v_Uv;
#endif
#ifdef USE_MAP
  uniform sampler2D u_Map;
#endif

in vec4 v_Data;
in vec2 v_Radius;
in vec4 v_StylePacked3;

out vec4 outputColor;

/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

// @see http://www.iquilezles.org/www/articles/ellipsoids/ellipsoids.htm
float sdEllipsoidApproximated(vec2 p, vec2 r) {
  float k0 = length(p / r);
  float k1 = length(p / (r * r));
  return k0 * (k0 - 1.0) / k1;
}

// @see https://www.shadertoy.com/view/4llXD7
float sdRoundedBox(vec2 p, vec2 b, vec2 r) {
  vec2 q = abs(p) - b + r;
  return min(max(q.x, q.y), 0.0) + length(max(q, 0.0)) - r.x;
}

void main() {
  int shape = int(floor(v_Data.w + 0.5));
  float epsilon = 0.000001;

  vec4 u_Color = v_Color;
vec4 u_StrokeColor = v_StrokeColor;
float u_Opacity = v_StylePacked1.x;
float u_FillOpacity = v_StylePacked1.y;
float u_StrokeOpacity = v_StylePacked1.z;
float u_StrokeWidth = v_StylePacked1.w;
float u_Visible = v_StylePacked2.x;
vec3 u_PickingColor = v_PickingResult.xyz;

if (u_Visible < 0.5) {
    discard;
}
  #ifdef USE_MAP
  #ifdef USE_PATTERN
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #else
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #endif
#endif

  bool omitStroke = v_StylePacked3.z == 1.0;

  float antialiasblur = v_Data.z;
  float antialiased_blur = -max(0.0, antialiasblur);
  vec2 r = (v_Radius - (omitStroke ? 0.0 : u_StrokeWidth)) / v_Radius;

  float outer_df;
  float inner_df;
  // 'circle', 'ellipse', 'rect'
  if (shape == 0) {
    outer_df = sdCircle(v_Data.xy, 1.0);
    inner_df = sdCircle(v_Data.xy, r.x);
  } else if (shape == 1) {
    outer_df = sdEllipsoidApproximated(v_Data.xy, vec2(1.0));
    inner_df = sdEllipsoidApproximated(v_Data.xy, r);
  } else if (shape == 2) {
    outer_df = sdRoundedBox(v_Data.xy, vec2(1.0), vec2(0.0));
    inner_df = sdRoundedBox(v_Data.xy, r, vec2(0.0));
  }

  float opacity_t = smoothstep(0.0, antialiased_blur, outer_df);

  float color_t = u_StrokeWidth < 0.01 ? 0.0 : smoothstep(
    antialiased_blur,
    0.0,
    inner_df
  );

  // vec2 imagecoord = mod(v_Uv, 0.1);
  // vec4 texel = texture(SAMPLER_2D(u_Map), imagecoord);
  // u_Color = texel;

  vec4 diffuseColor;
  vec4 strokeColor;
  if (u_IsPicking > 0.5) {
    diffuseColor = vec4(u_PickingColor, 1.0);
    strokeColor = vec4(u_PickingColor, 1.0);
  } else {
    diffuseColor = u_Color;
    strokeColor = (u_StrokeColor == vec4(0) || omitStroke) ? vec4(0.0) : u_StrokeColor;
  }

  outputColor = mix(vec4(diffuseColor.rgb, diffuseColor.a * u_FillOpacity), strokeColor * u_StrokeOpacity, color_t);
  outputColor.a = outputColor.a * u_Opacity * opacity_t;

  if (outputColor.a < epsilon)
    discard;

  if (u_IsPicking > 0.5) {
    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {
      discard;
    }
  }
}`,Yy=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};

layout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;
layout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;
layout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;
layout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;
layout(location = COLOR) in vec4 a_Color;
layout(location = STROKE_COLOR) in vec4 a_StrokeColor;
layout(location = PACKED_STYLE1) in vec4 a_StylePacked1;
layout(location = PACKED_STYLE2) in vec4 a_StylePacked2;
layout(location = PICKING_COLOR) in vec4 a_PickingColor;

out vec4 v_PickingResult;
out vec4 v_Color;
out vec4 v_StrokeColor;
out vec4 v_StylePacked1;
out vec4 v_StylePacked2;

#define COLOR_SCALE 1. / 255.
void setPickingColor(vec3 pickingColor) {
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}
vec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {
  return pm * vm * mm * pos;
}

layout(location = POSITION) in vec2 a_Extrude;
layout(location = PACKED_STYLE3) in vec4 a_StylePacked3;
layout(location = SIZE) in vec2 a_Size;
#ifdef USE_UV
  layout(location = UV) in vec2 a_Uv;
  out vec2 v_Uv;
#endif

out vec4 v_Data;
out vec2 v_Radius;
out vec4 v_StylePacked3;

void main() {
  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
vec4 u_StrokeColor = a_StrokeColor;
float u_Opacity = a_StylePacked1.x;
float u_FillOpacity = a_StylePacked1.y;
float u_StrokeOpacity = a_StylePacked1.z;
float u_StrokeWidth = a_StylePacked1.w;
float u_ZIndex = a_PickingColor.w;
vec2 u_Anchor = a_StylePacked2.yz;
float u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;

setPickingColor(a_PickingColor.xyz);

v_Color = a_Color;
v_StrokeColor = a_StrokeColor;
v_StylePacked1 = a_StylePacked1;
v_StylePacked2 = a_StylePacked2;

#ifdef CLIPSPACE_NEAR_ZERO
    gl_Position.z = gl_Position.z * 0.5 + 0.5;
#endif
  #ifdef USE_UV
  v_Uv = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
    v_Uv.y = 1.0 - v_Uv.y;
  #endif
#endif

  float strokeWidth;
  if (u_IsPicking > 0.5) {
    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;
  } else {
    strokeWidth = u_StrokeWidth;
  }

  float antialiasblur = 1.0 / (a_Size.x + strokeWidth);

  bool omitStroke = a_StylePacked3.z == 1.0;
  vec2 radius = a_Size + vec2(omitStroke ? 0.0 : strokeWidth / 2.0);
  vec2 offset = (a_Extrude + vec2(1.0) - 2.0 * u_Anchor.xy) * radius;

  gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);
  
  v_Radius = radius;
  v_Data = vec4(a_Extrude, antialiasblur, a_StylePacked3.x);
  v_StylePacked3 = a_StylePacked3;
}`,ja;(function(e){e[e.PACKED_STYLE=5]="PACKED_STYLE"})(ja||(ja={}));var kn;(function(e){e[e.PACKED_STYLE3=13]="PACKED_STYLE3",e[e.SIZE=14]="SIZE"})(kn||(kn={}));var mf=[H.CIRCLE,H.ELLIPSE,H.RECT],Nh=function(e){$e(n,e);function n(){return e.apply(this,arguments)||this}var i=n.prototype;return i.shouldMerge=function(r,a){var o=e.prototype.shouldMerge.call(this,r,a);if(!o||this.needDrawStrokeSeparately(r.parsedStyle)||this.needDrawStrokeSeparately(this.instance.parsedStyle))return!1;var s=this.instance.parsedStyle.fill,u=r.parsedStyle.fill;return s.isNone===u.isNone},i.createMaterial=function(r){this.material.vertexShader=Yy,this.material.fragmentShader=Vy,this.material.defines=Me({},this.material.defines,Jn(kn))},i.createGeometry=function(r){var a=this;e.prototype.createGeometry.call(this,r);var o=[],s=[],u=[];r.forEach(function(l,f){var c=l,h=f*4,p=c.parsedStyle.radius,g=a.shouldOmitStroke(c.parsedStyle),_=a.getSize(l.parsedStyle,c.nodeName);s.push.apply(s,_.concat([mf.indexOf(c.nodeName),p||0,g?1:0,0])),o.push(-1,-1,0,0,1,-1,1,0,1,1,1,1,-1,1,0,1),u.push(0+h,2+h,1+h,0+h,3+h,2+h)}),this.geometry.setIndexBuffer(new Uint32Array(u)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:Ne.POSITION,byteStride:4*4,frequency:be.PerVertex,attributes:[{format:G.F32_RG,bufferByteOffset:4*0,location:_e.POSITION},{format:G.F32_RG,bufferByteOffset:4*2,location:_e.UV}],data:new Float32Array(o)}),this.geometry.setVertexBuffer({bufferIndex:ja.PACKED_STYLE,byteStride:4*6,frequency:be.PerInstance,attributes:[{format:G.F32_RG,bufferByteOffset:4*0,location:kn.SIZE,divisor:1},{format:G.F32_RGBA,bufferByteOffset:4*2,location:kn.PACKED_STYLE3,divisor:1}],data:new Float32Array(s)})},i.updateAttribute=function(r,a,o,s){var u=this;if(e.prototype.updateAttribute.call(this,r,a,o,s),this.updateBatchedAttribute(r,a,o,s),o==="r"||o==="rx"||o==="ry"||o==="width"||o==="height"||o==="lineWidth"||o==="stroke"||o==="lineDash"||o==="strokeOpacity"){var l=[];r.forEach(function(f){var c=f,h=u.shouldOmitStroke(c.parsedStyle),p=u.getSize(f.parsedStyle,f.nodeName),g=p[0],_=p[1],E=[g,_];l.push.apply(l,E.concat([mf.indexOf(f.nodeName),f.parsedStyle.radius||0,h?1:0,0]))}),this.geometry.updateVertexBuffer(ja.PACKED_STYLE,kn.SIZE,a,new Uint8Array(new Float32Array(l).buffer))}},i.getSize=function(r,a){var o=[0,0];if(a===H.CIRCLE){var s=r.r;o=[s,s]}else if(a===H.ELLIPSE){var u=r.rx,l=r.ry;o=[u,l]}else if(a===H.RECT){var f=r.width,c=r.height;o=[f/2,c/2]}return o},i.shouldOmitStroke=function(r){var a=r.lineDash,o=r.stroke,s=r.strokeOpacity,u=o&&!o.isNone,l=a&&a.length&&a.every(function(c){return c!==0}),f=s<1;return!u||u&&(l||f)},i.needDrawStrokeSeparately=function(r){var a=r.stroke,o=r.lineDash,s=r.lineWidth,u=r.strokeOpacity,l=a&&!a.isNone,f=o&&o.length&&o.every(function(h){return h!==0}),c=u<1;return l&&s>0&&(f||c)},n}(Cn),zy=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};

in vec4 v_PickingResult;
in vec4 v_Color;
in vec4 v_StrokeColor;
in vec4 v_StylePacked1;
in vec4 v_StylePacked2;
#ifdef USE_UV
  in vec2 v_Uv;
#endif
#ifdef USE_MAP
  uniform sampler2D u_Map;
#endif

in vec4 v_Dash;
// in vec2 v_Normal;

out vec4 outputColor;

void main() {
  vec4 u_Color = v_Color;
vec4 u_StrokeColor = v_StrokeColor;
float u_Opacity = v_StylePacked1.x;
float u_FillOpacity = v_StylePacked1.y;
float u_StrokeOpacity = v_StylePacked1.z;
float u_StrokeWidth = v_StylePacked1.w;
float u_Visible = v_StylePacked2.x;
vec3 u_PickingColor = v_PickingResult.xyz;

if (u_Visible < 0.5) {
    discard;
}
  #ifdef USE_MAP
  #ifdef USE_PATTERN
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #else
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #endif
#endif

  if (u_IsPicking > 0.5) {
    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {
      discard;
    }
    outputColor = vec4(u_PickingColor, 1.0);
  } else {
    outputColor = u_StrokeColor;
    #ifdef USE_MAP
        outputColor = u_Color;
    #endif

    // float blur = 1. - smoothstep(0.98, 1., length(v_Normal));
    float u_dash_offset = v_Dash.y;
    float u_dash_array = v_Dash.z;
    float u_dash_ratio = v_Dash.w;
    outputColor.a = outputColor.a
      // * blur
      * u_Opacity * u_StrokeOpacity
      * ceil(mod(v_Dash.x + u_dash_offset, u_dash_array) - (u_dash_array * u_dash_ratio));
  }
}`,Gy=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};

layout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;
layout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;
layout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;
layout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;
layout(location = COLOR) in vec4 a_Color;
layout(location = STROKE_COLOR) in vec4 a_StrokeColor;
layout(location = PACKED_STYLE1) in vec4 a_StylePacked1;
layout(location = PACKED_STYLE2) in vec4 a_StylePacked2;
layout(location = PICKING_COLOR) in vec4 a_PickingColor;

out vec4 v_PickingResult;
out vec4 v_Color;
out vec4 v_StrokeColor;
out vec4 v_StylePacked1;
out vec4 v_StylePacked2;

#define COLOR_SCALE 1. / 255.
void setPickingColor(vec3 pickingColor) {
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}
vec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {
  return pm * vm * mm * pos;
}

layout(location = POSITION) in vec3 a_Position;
layout(location = POINTA) in vec3 a_PointA;
layout(location = POINTB) in vec3 a_PointB;
layout(location = CAP) in float a_Cap;
#ifdef USE_UV
  layout(location = UV) in vec2 a_Uv;
  out vec2 v_Uv;
#endif
layout(location = DASH) in vec4 a_Dash;

out vec4 v_Dash;
// out vec2 v_Normal;

void main() {
  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
vec4 u_StrokeColor = a_StrokeColor;
float u_Opacity = a_StylePacked1.x;
float u_FillOpacity = a_StylePacked1.y;
float u_StrokeOpacity = a_StylePacked1.z;
float u_StrokeWidth = a_StylePacked1.w;
float u_ZIndex = a_PickingColor.w;
vec2 u_Anchor = a_StylePacked2.yz;
float u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;

setPickingColor(a_PickingColor.xyz);

v_Color = a_Color;
v_StrokeColor = a_StrokeColor;
v_StylePacked1 = a_StylePacked1;
v_StylePacked2 = a_StylePacked2;

#ifdef CLIPSPACE_NEAR_ZERO
    gl_Position.z = gl_Position.z * 0.5 + 0.5;
#endif
  #ifdef USE_UV
  v_Uv = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
    v_Uv.y = 1.0 - v_Uv.y;
  #endif
#endif

  float strokeWidth;
  if (u_IsPicking > 0.5) {
    strokeWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;
  } else {
    strokeWidth = u_StrokeWidth;
  }

  float isBillboard = a_Dash.w;
  if (isBillboard < 0.5) {
    vec2 xBasis = a_PointB.xy - a_PointA.xy;
    vec2 yBasis = normalize(vec2(-xBasis.y, xBasis.x));

    vec2 point = a_PointA.xy + xBasis * a_Position.x + yBasis * strokeWidth * a_Position.y;
    point = point - u_Anchor.xy * abs(xBasis);

    // round & square
    if (a_Cap > 1.0) {
      point += sign(a_Position.x - 0.5) * normalize(xBasis) * vec2(strokeWidth / 2.0);
    }

    gl_Position = project(vec4(point, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);
  } else {
    // clip space
    vec4 clip0 = project(vec4(a_PointA, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);
    vec4 clip1 = project(vec4(a_PointB, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);
    // screen space
    vec2 screen0 = u_Viewport * (0.5 * clip0.xy / clip0.w + 0.5);
    vec2 screen1 = u_Viewport * (0.5 * clip1.xy / clip1.w + 0.5);
    vec2 xBasis = normalize(screen1 - screen0);
    vec2 yBasis = vec2(-xBasis.y, xBasis.x);
    vec2 pt0 = screen0 + strokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);
    vec2 pt1 = screen1 + strokeWidth * (a_Position.x * xBasis + a_Position.y * yBasis);
    vec2 pt = mix(pt0, pt1, a_Position.z);
    vec4 clip = mix(clip0, clip1, a_Position.z);
    gl_Position = vec4(clip.w * (2.0 * pt / u_Viewport - 1.0), clip.z, clip.w);
  }

  v_Dash = vec4(a_Position.x, a_Dash.xyz);
}`,Ky=[0,-.5,0,0,0,1,-.5,1,1,0,1,.5,1,1,1,0,.5,0,0,1],qr;(function(e){e[e.POINT=5]="POINT",e[e.CAP=6]="CAP",e[e.DASH=7]="DASH"})(qr||(qr={}));var jt;(function(e){e[e.POSITION=9]="POSITION",e[e.UV=11]="UV",e[e.POINTA=10]="POINTA",e[e.POINTB=12]="POINTB",e[e.CAP=13]="CAP",e[e.DASH=14]="DASH"})(jt||(jt={}));var _f={butt:1,round:2,square:3},Ih=function(e){$e(n,e);function n(){return e.apply(this,arguments)||this}var i=n.prototype;return i.shouldMerge=function(r,a){var o=e.prototype.shouldMerge.call(this,r,a);return!!o},i.createMaterial=function(r){this.material.vertexShader=Gy,this.material.fragmentShader=zy,this.material.defines=Me({},this.material.defines,Jn(jt))},i.createGeometry=function(r){var a=this;e.prototype.createGeometry.call(this,r);var o=[],s=[],u=[],l=[],f=0;r.forEach(function(c){var h,p;if(c.nodeName===H.LINE)h=c.parsedStyle,p=c.getTotalLength();else if(c.nodeName===H.POLYLINE){var g=c.parsedStyle,_=g.points.points,E=g.defX,y=g.defY,R=g.lineCap,A=g.lineDash,M=g.lineDashOffset,x=g.markerStart,P=g.markerEnd,C=g.markerStartOffset,O=g.markerEndOffset;h={x1:_[0][0],y1:_[0][1],x2:_[_.length-1][0],y2:_[_.length-1][1],z1:0,z2:0,defX:E,defY:y,lineCap:R,lineDash:A,lineDashOffset:M,isBillboard:!0,markerStart:x,markerEnd:P,markerStartOffset:C,markerEndOffset:O},p=c.getTotalLength()}else if(c.nodeName===H.PATH){var D=c.parsedStyle,F=D.path.absolutePath,k=D.defX,d=D.defY,v=D.lineCap,m=D.lineDash,S=D.lineDashOffset,T=D.markerStart,N=D.markerEnd,B=D.markerStartOffset,w=D.markerEndOffset;h={x1:F[0][1],y1:F[0][2],x2:F[1][1],y2:F[1][2],z1:0,z2:0,defX:k,defY:d,lineCap:v,lineDash:m,lineDashOffset:S,isBillboard:!1,markerStart:T,markerEnd:N,markerStartOffset:B,markerEndOffset:w},p=c.getTotalLength()}var U=h,V=U.x1,K=U.y1,z=U.x2,le=U.y2,Se=U.z1,Ae=U.z2,ge=U.defX,ye=U.defY,ve=U.lineCap,ie=U.isBillboard,we=a.calcOffset(h),Pt=we.startOffsetX,Je=we.startOffsetY,Tt=we.endOffsetX,ce=we.endOffsetY,he=a.calcDash(h,p),Oe=he.dashOffset,ne=he.dashSegmentPercent,rt=he.dashRatioInEachSegment;s.push(_f[ve]),u.push(Oe,ne,rt,ie?1:0),o.push(V-ge+Pt,K-ye+Je,Se,z-ge+Tt,le-ye+ce,Ae),l.push(0+f,2+f,1+f,0+f,3+f,2+f),f+=4}),this.geometry.setIndexBuffer(new Uint32Array(l)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:Ne.POSITION,byteStride:4*5,frequency:be.PerInstance,attributes:[{format:G.F32_RGB,bufferByteOffset:4*0,location:jt.POSITION,divisor:0},{format:G.F32_RG,bufferByteOffset:4*3,location:jt.UV,divisor:0}],data:new Float32Array(Ky)}),this.geometry.setVertexBuffer({bufferIndex:qr.POINT,byteStride:4*(3+3),frequency:be.PerInstance,attributes:[{format:G.F32_RGB,bufferByteOffset:4*0,location:jt.POINTA,divisor:1},{format:G.F32_RGB,bufferByteOffset:4*3,location:jt.POINTB,divisor:1}],data:new Float32Array(o)}),this.geometry.setVertexBuffer({bufferIndex:qr.CAP,byteStride:4*1,frequency:be.PerInstance,attributes:[{format:G.F32_R,bufferByteOffset:4*0,location:jt.CAP,divisor:1}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:qr.DASH,byteStride:4*4,frequency:be.PerInstance,attributes:[{format:G.F32_RGBA,bufferByteOffset:4*0,location:jt.DASH,divisor:1}],data:new Float32Array(u)})},i.updateAttribute=function(r,a,o,s){var u=this;if(e.prototype.updateAttribute.call(this,r,a,o,s),this.updateBatchedAttribute(r,a,o,s),o==="x1"||o==="y1"||o==="x2"||o==="y2"||o==="z1"||o==="z2"||o==="markerStartOffset"||o==="markerEndOffset"||o==="markerStart"||o==="markerEnd"||o==="points"||o==="path"){var l=[];r.forEach(function(h){var p;if(h.nodeName===H.LINE)p=h.parsedStyle;else if(h.nodeName===H.POLYLINE&&h.renderable.proxyNodeName===H.LINE){var g=h.parsedStyle,_=g.points.points,E=g.defX,y=g.defY,R=g.lineCap,A=g.markerStart,M=g.markerEnd,x=g.markerStartOffset,P=g.markerEndOffset;p={x1:_[0][0],y1:_[0][1],x2:_[_.length-1][0],y2:_[_.length-1][1],z1:0,z2:0,defX:E,defY:y,lineCap:R,isBillboard:!0,markerStart:A,markerEnd:M,markerStartOffset:x,markerEndOffset:P}}else if(h.nodeName===H.PATH&&h.renderable.proxyNodeName===H.LINE){var C=h.parsedStyle,O=C.path.absolutePath,D=C.defX,F=C.defY,k=C.lineCap,d=C.markerStart,v=C.markerEnd,m=C.markerStartOffset,S=C.markerEndOffset;p={x1:O[0][1],y1:O[0][2],x2:O[1][1],y2:O[1][2],z1:0,z2:0,defX:D,defY:F,lineCap:k,isBillboard:!0,markerStart:d,markerEnd:v,markerStartOffset:m,markerEndOffset:S}}var T=p,N=T.x1,B=T.y1,w=T.x2,U=T.y2,V=T.z1,K=T.z2,z=T.defX,le=T.defY,Se=u.calcOffset(p),Ae=Se.startOffsetX,ge=Se.startOffsetY,ye=Se.endOffsetX,ve=Se.endOffsetY;l.push(N-z+Ae,B-le+ge,V,w-z+ye,U-le+ve,K)}),this.geometry.updateVertexBuffer(qr.POINT,jt.POINTA,a,new Uint8Array(new Float32Array(l).buffer))}else if(o==="lineDashOffset"||o==="lineDash"||o==="isBillboard"){var f=[];r.forEach(function(h){var p=h.getTotalLength(),g=u.calcDash(h.parsedStyle,p),_=g.dashOffset,E=g.dashSegmentPercent,y=g.dashRatioInEachSegment;f.push(_,E,y,h.parsedStyle.isBillboard?1:0)}),this.geometry.updateVertexBuffer(qr.DASH,jt.DASH,a,new Uint8Array(new Float32Array(f).buffer))}else if(o==="lineCap"){var c=[];r.forEach(function(h){var p=h.parsedStyle.lineCap;c.push(_f[p])}),this.geometry.updateVertexBuffer(qr.CAP,jt.CAP,a,new Uint8Array(new Float32Array(c).buffer))}},i.calcOffset=function(r){var a=r.x1,o=r.y1,s=r.x2,u=r.y2,l=r.markerStart,f=r.markerEnd,c=r.markerStartOffset,h=r.markerEndOffset,p=0,g=0,_=0,E=0,y=0,R,A;return l&&Pe(l)&&c&&(R=s-a,A=u-o,y=Math.atan2(A,R),p=Math.cos(y)*(c||0),g=Math.sin(y)*(c||0)),f&&Pe(f)&&h&&(R=a-s,A=o-u,y=Math.atan2(A,R),_=Math.cos(y)*(h||0),E=Math.sin(y)*(h||0)),{startOffsetX:p,startOffsetY:g,endOffsetX:_,endOffsetY:E}},i.calcDash=function(r,a){var o=r.lineDash,s=r.lineDashOffset,u=0,l=1,f=0;if(o&&o.length){u=(s||0)/a;var c=o.reduce(function(h,p){return h+p},0);c===0?(l=1,f=0):(l=c/a,f=o[1]/c)}return{dashOffset:u,dashSegmentPercent:l,dashRatioInEachSegment:f}},n}(Cn),$y=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_ObjectParams {
  mat4 u_ModelMatrix;
  vec4 u_FillColor;
  vec4 u_StrokeColor;
  float u_StrokeWidth;
  float u_Opacity;
  float u_FillOpacity;
  float u_StrokeOpacity;
  float u_Expand;
  float u_MiterLimit;
  float u_ScaleMode;
  float u_Alignment;
  vec3 u_PickingColor;
  float u_Dash;
  float u_Gap;
  float u_DashOffset;
  float u_Visible;
  float u_ZIndex;
  float u_IncreasedLineWidthForHitTesting;
};

in vec4 v_Distance;
in vec4 v_Arc;
in float v_Type;
in float v_Travel;

out vec4 outputColor;

#define COLOR_SCALE 1. / 255.

void main(){
  if (u_Visible < 0.5) {
    discard;
  }

  float alpha = 1.0;
  float lineWidth = v_Distance.w;
  if (v_Type < 0.5) {
    float left = max(v_Distance.x - 0.5, -v_Distance.w);
    float right = min(v_Distance.x + 0.5, v_Distance.w);
    float near = v_Distance.y - 0.5;
    float far = min(v_Distance.y + 0.5, 0.0);
    float top = v_Distance.z - 0.5;
    float bottom = min(v_Distance.z + 0.5, 0.0);
    alpha = max(right - left, 0.0) * max(bottom - top, 0.0) * max(far - near, 0.0);
  } else if (v_Type < 1.5) {
    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);
    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);
    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);
    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);
    alpha = a2 * b2 - a1 * b1;
  } else if (v_Type < 2.5) {
    alpha *= max(min(v_Distance.x + 0.5, 1.0), 0.0);
    alpha *= max(min(v_Distance.y + 0.5, 1.0), 0.0);
    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);
  } else if (v_Type < 3.5) {
    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);
    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);
    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);
    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);
    float alpha_miter = a2 * b2 - a1 * b1;
    float alpha_plane = max(min(v_Distance.z + 0.5, 1.0), 0.0);
    float d = length(v_Arc.xy);
    float circle_hor = max(min(v_Arc.w, d + 0.5) - max(-v_Arc.w, d - 0.5), 0.0);
    float circle_vert = min(v_Arc.w * 2.0, 1.0);
    float alpha_circle = circle_hor * circle_vert;
    alpha = min(alpha_miter, max(alpha_circle, alpha_plane));
  } else {
    float a1 = clamp(v_Distance.x + 0.5 - lineWidth, 0.0, 1.0);
    float a2 = clamp(v_Distance.x + 0.5 + lineWidth, 0.0, 1.0);
    float b1 = clamp(v_Distance.y + 0.5 - lineWidth, 0.0, 1.0);
    float b2 = clamp(v_Distance.y + 0.5 + lineWidth, 0.0, 1.0);
    alpha = a2 * b2 - a1 * b1;
    alpha *= max(min(v_Distance.z + 0.5, 1.0), 0.0);
  }

  if (u_Dash + u_Gap > 1.0) {
    float scalingFactor = sqrt(u_ModelMatrix[0][0] * u_ModelMatrix[0][0] + u_ModelMatrix[0][1] * u_ModelMatrix[0][1] + u_ModelMatrix[0][2] * u_ModelMatrix[0][2]);
    float travel = mod(v_Travel + u_Gap * scalingFactor * 0.5 + u_DashOffset, u_Dash * scalingFactor + u_Gap * scalingFactor) - (u_Gap * scalingFactor * 0.5);
    float left = max(travel - 0.5, -0.5);
    float right = min(travel + 0.5, u_Gap * scalingFactor + 0.5);
    alpha *= max(0.0, right - left);
  }

  if (u_IsPicking > 0.5) {
    vec3 pickingColor = COLOR_SCALE * u_PickingColor;
    if (pickingColor.x == 0.0 && pickingColor.y == 0.0 && pickingColor.z == 0.0) {
      discard;
    }
    outputColor = vec4(pickingColor, 1.0);
  } else {
    outputColor = u_StrokeColor;
    outputColor.a *= alpha * u_Opacity * u_StrokeOpacity;
  }
}`,qy=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_ObjectParams {
  mat4 u_ModelMatrix;
  vec4 u_FillColor;
  vec4 u_StrokeColor;
  float u_StrokeWidth;
  float u_Opacity;
  float u_FillOpacity;
  float u_StrokeOpacity;
  float u_Expand;
  float u_MiterLimit;
  float u_ScaleMode;
  float u_Alignment;
  vec3 u_PickingColor;
  float u_Dash;
  float u_Gap;
  float u_DashOffset;
  float u_Visible;
  float u_ZIndex;
  float u_IncreasedLineWidthForHitTesting;
};

layout(location = PREV) in vec2 a_Prev;
layout(location = POINT1) in vec2 a_Point1;
layout(location = POINT2) in vec2 a_Point2;
layout(location = NEXT) in vec2 a_Next;
layout(location = VERTEX_JOINT) in float a_VertexJoint;
layout(location = VERTEX_NUM) in float a_VertexNum;
layout(location = TRAVEL) in float a_Travel;

const float FILL = 1.0;
const float BEVEL = 4.0;
const float MITER = 8.0;
const float ROUND = 12.0;
const float JOINT_CAP_BUTT = 16.0;
const float JOINT_CAP_SQUARE = 18.0;
const float JOINT_CAP_ROUND = 20.0;
const float FILL_EXPAND = 24.0;
const float CAP_BUTT = 1.0;
const float CAP_SQUARE = 2.0;
const float CAP_ROUND = 3.0;
const float CAP_BUTT2 = 4.0;

out vec4 v_Distance;
out vec4 v_Arc;
out float v_Type;
out float v_Travel;

vec2 doBisect(
  vec2 norm, float len, vec2 norm2, float len2, float dy, float inner
) {
  vec2 bisect = (norm + norm2) / 2.0;
  bisect /= dot(norm, bisect);
  vec2 shift = dy * bisect;
  if (inner > 0.5) {
    if (len < len2) {
      if (abs(dy * (bisect.x * norm.y - bisect.y * norm.x)) > len) {
        return dy * norm;
      }
    } else {
      if (abs(dy * (bisect.x * norm2.y - bisect.y * norm2.x)) > len2) {
        return dy * norm;
      }
    }
  }
  return dy * bisect;
}

void main() {
  vec2 pointA = (u_ModelMatrix * vec4(a_Point1, 0., 1.0)).xy;
  vec2 pointB = (u_ModelMatrix * vec4(a_Point2, 0., 1.0)).xy;

  vec2 xBasis = pointB - pointA;
  float len = length(xBasis);
  vec2 forward = xBasis / len;
  vec2 norm = vec2(forward.y, -forward.x);

  float type = a_VertexJoint;

  float lineWidth;
  if (u_IsPicking > 0.5) {
    lineWidth = u_IncreasedLineWidthForHitTesting + u_StrokeWidth;
  } else {
    lineWidth = u_StrokeWidth;
  }

  if (u_ScaleMode > 2.5) {
      lineWidth *= length(u_ModelMatrix * vec4(1.0, 0.0, 0.0, 0.0));
  } else if (u_ScaleMode > 1.5) {
      lineWidth *= length(u_ModelMatrix * vec4(0.0, 1.0, 0.0, 0.0));
  } else if (u_ScaleMode > 0.5) {
      vec2 avgDiag = (u_ModelMatrix * vec4(1.0, 1.0, 0.0, 0.0)).xy;
      lineWidth *= sqrt(dot(avgDiag, avgDiag) * 0.5);
  }
  float capType = floor(type / 32.0);
  type -= capType * 32.0;
  v_Arc = vec4(0.0);
  lineWidth *= 0.5;
  float lineAlignment = 2.0 * u_Alignment - 1.0;

  vec2 pos;

  if (capType == CAP_ROUND) {
      if (a_VertexNum < 3.5) {
      gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
      return;
      }
      type = JOINT_CAP_ROUND;
      capType = 0.0;
  }

  if (type >= BEVEL) {
      float dy = lineWidth + u_Expand;
      float inner = 0.0;
      if (a_VertexNum >= 1.5) {
      dy = -dy;
      inner = 1.0;
      }

      vec2 base, next, xBasis2, bisect;
      float flag = 0.0;
      float sign2 = 1.0;
      if (a_VertexNum < 0.5 || a_VertexNum > 2.5 && a_VertexNum < 3.5) {
      next = (u_ModelMatrix * vec4(a_Prev, 0.0, 1.0)).xy;
      base = pointA;
      flag = type - floor(type / 2.0) * 2.0;
      sign2 = -1.0;

      } else {
      next = (u_ModelMatrix * vec4(a_Next, 0.0, 1.0)).xy;
      base = pointB;
      if (type >= MITER && type < MITER + 3.5) {
          flag = step(MITER + 1.5, type);
          // check miter limit here?
      }
      }
      xBasis2 = next - base;
      float len2 = length(xBasis2);
      vec2 norm2 = vec2(xBasis2.y, -xBasis2.x) / len2;
      float D = norm.x * norm2.y - norm.y * norm2.x;
      if (D < 0.0) {
      inner = 1.0 - inner;
      }
      norm2 *= sign2;

      if (abs(lineAlignment) > 0.01) {
      float shift = lineWidth * lineAlignment;
      pointA += norm * shift;
      pointB += norm * shift;
      if (abs(D) < 0.01) {
          base += norm * shift;
      } else {
          base += doBisect(norm, len, norm2, len2, shift, 0.0);
      }
      }

      float collinear = step(0.0, dot(norm, norm2));
      v_Type = 0.0;
      float dy2 = -1000.0;
      float dy3 = -1000.0;
      if (abs(D) < 0.01 && collinear < 0.5) {
      if (type >= ROUND && type < ROUND + 1.5) {
          type = JOINT_CAP_ROUND;
      }
      //TODO: BUTT here too
      }

      if (a_VertexNum < 3.5) {
      if (abs(D) < 0.01) {
          pos = dy * norm;
      } else {
          if (flag < 0.5 && inner < 0.5) {
          pos = dy * norm;
          } else {
          pos = doBisect(norm, len, norm2, len2, dy, inner);
          }
      }
      if (capType >= CAP_BUTT && capType < CAP_ROUND) {
          float extra = step(CAP_SQUARE, capType) * lineWidth;
          vec2 back = -forward;
          if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {
          pos += back * (u_Expand + extra);
          dy2 = u_Expand;
          } else {
          dy2 = dot(pos + base - pointA, back) - extra;
          }
      }
      if (type >= JOINT_CAP_BUTT && type < JOINT_CAP_SQUARE + 0.5) {
          float extra = step(JOINT_CAP_SQUARE, type) * lineWidth;
          if (a_VertexNum < 0.5 || a_VertexNum > 2.5) {
          dy3 = dot(pos + base - pointB, forward) - extra;
          } else {
          pos += forward * (u_Expand + extra);
          dy3 = u_Expand;
          if (capType >= CAP_BUTT) {
              dy2 -= u_Expand + extra;
          }
          }
      }
      } else if (type >= JOINT_CAP_ROUND && type < JOINT_CAP_ROUND + 1.5) {
      if (inner > 0.5) {
          dy = -dy;
          inner = 0.0;
      }
      vec2 d2 = abs(dy) * forward;
      if (a_VertexNum < 4.5) {
          dy = -dy;
          pos = dy * norm;
      } else if (a_VertexNum < 5.5) {
          pos = dy * norm;
      } else if (a_VertexNum < 6.5) {
          pos = dy * norm + d2;
          v_Arc.x = abs(dy);
      } else {
          dy = -dy;
          pos = dy * norm + d2;
          v_Arc.x = abs(dy);
      }
      dy2 = 0.0;
      v_Arc.y = dy;
      v_Arc.z = 0.0;
      v_Arc.w = lineWidth;
      v_Type = 3.0;
      } else if (abs(D) < 0.01) {
      pos = dy * norm;
      } else {
      if (type >= ROUND && type < ROUND + 1.5) {
          if (inner > 0.5) {
          dy = -dy;
          inner = 0.0;
          }
          if (a_VertexNum < 4.5) {
          pos = doBisect(norm, len, norm2, len2, -dy, 1.0);
          } else if (a_VertexNum < 5.5) {
          pos = dy * norm;
          } else if (a_VertexNum > 7.5) {
          pos = dy * norm2;
          } else {
          pos = doBisect(norm, len, norm2, len2, dy, 0.0);
          float d2 = abs(dy);
          if (length(pos) > abs(dy) * 1.5) {
              if (a_VertexNum < 6.5) {
              pos.x = dy * norm.x - d2 * norm.y;
              pos.y = dy * norm.y + d2 * norm.x;
              } else {
              pos.x = dy * norm2.x + d2 * norm2.y;
              pos.y = dy * norm2.y - d2 * norm2.x;
              }
          }
          }
          vec2 norm3 = normalize(norm + norm2);
          float sign = step(0.0, dy) * 2.0 - 1.0;
          v_Arc.x = sign * dot(pos, norm3);
          v_Arc.y = pos.x * norm3.y - pos.y * norm3.x;
          v_Arc.z = dot(norm, norm3) * lineWidth;
          v_Arc.w = lineWidth;
          dy = -sign * dot(pos, norm);
          dy2 = -sign * dot(pos, norm2);
          dy3 = v_Arc.z - v_Arc.x;
          v_Type = 3.0;
      } else {
          float hit = 0.0;
          if (type >= BEVEL && type < BEVEL + 1.5) {
          if (dot(norm, norm2) > 0.0) {
              type = MITER;
          }
          }
          if (type >= MITER && type < MITER + 3.5) {
          if (inner > 0.5) {
              dy = -dy;
              inner = 0.0;
          }
          float sign = step(0.0, dy) * 2.0 - 1.0;
          pos = doBisect(norm, len, norm2, len2, dy, 0.0);
          if (length(pos) > abs(dy) * u_MiterLimit) {
              type = BEVEL;
          } else {
              if (a_VertexNum < 4.5) {
              dy = -dy;
              pos = doBisect(norm, len, norm2, len2, dy, 1.0);
              } else if (a_VertexNum < 5.5) {
              pos = dy * norm;
              } else if (a_VertexNum > 6.5) {
              pos = dy * norm2;
              }
              v_Type = 1.0;
              dy = -sign * dot(pos, norm);
              dy2 = -sign * dot(pos, norm2);
              hit = 1.0;
          }
          }
          if (type >= BEVEL && type < BEVEL + 1.5) {
          if (inner > 0.5) {
              dy = -dy;
              inner = 0.0;
          }
          float d2 = abs(dy);
          vec2 pos3 = vec2(dy * norm.x - d2 * norm.y, dy * norm.y + d2 * norm.x);
          vec2 pos4 = vec2(dy * norm2.x + d2 * norm2.y, dy * norm2.y - d2 * norm2.x);
          if (a_VertexNum < 4.5) {
              pos = doBisect(norm, len, norm2, len2, -dy, 1.0);
          } else if (a_VertexNum < 5.5) {
              pos = dy * norm;
          } else if (a_VertexNum > 7.5) {
              pos = dy * norm2;
          } else {
              if (a_VertexNum < 6.5) {
              pos = pos3;
              } else {
              pos = pos4;
              }
          }
          vec2 norm3 = normalize(norm + norm2);
          float sign = step(0.0, dy) * 2.0 - 1.0;
          dy = -sign * dot(pos, norm);
          dy2 = -sign * dot(pos, norm2);
          dy3 = (-sign * dot(pos, norm3)) + lineWidth;
          v_Type = 4.0;
          hit = 1.0;
          }
          if (hit < 0.5) {
          gl_Position = vec4(0.0, 0.0, 0.0, 1.0);
          return;
          }
      }
      }
      pos += base;
      v_Distance = vec4(dy, dy2, dy3, lineWidth) * u_DevicePixelRatio;
      v_Arc = v_Arc * u_DevicePixelRatio;
      v_Travel = a_Travel + dot(pos - pointA, vec2(-norm.y, norm.x));
  }

  gl_Position = u_ProjectionMatrix * u_ViewMatrix * vec4(pos, u_ZIndex, 1.0);
}`;function or(e,n,i,t){var r=e-i,a=n-t;return Math.sqrt(r*r+a*a)}function ba(e,n){return Math.abs(e-n)<.001}function Eu(e,n){var i=Math.min.apply(Math,e),t=Math.min.apply(Math,n),r=Math.max.apply(Math,e),a=Math.max.apply(Math,n);return{x:i,y:t,width:r-i,height:a-t}}function Dh(e){return(e+Math.PI*2)%(Math.PI*2)}var vn={box:function(n,i,t,r){return Eu([n,t],[i,r])},length:function(n,i,t,r){return or(n,i,t,r)},pointAt:function(n,i,t,r,a){return{x:(1-a)*n+a*t,y:(1-a)*i+a*r}},pointDistance:function(n,i,t,r,a,o){var s=(t-n)*(a-n)+(r-i)*(o-i);if(s<0)return or(n,i,a,o);var u=(t-n)*(t-n)+(r-i)*(r-i);return s>u?or(t,r,a,o):this.pointToLine(n,i,t,r,a,o)},pointToLine:function(n,i,t,r,a,o){var s=[t-n,r-i];if(uc(s,[0,0]))return Math.sqrt((a-n)*(a-n)+(o-i)*(o-i));var u=[-s[1],s[0]];oc(u,u);var l=[a-n,o-i];return Math.abs(sc(l,u))},tangentAngle:function(n,i,t,r){return Math.atan2(r-i,t-n)}},Zy=1e-4;function bh(e,n,i,t,r,a){var o=-1,s=1/0,u=[i,t],l=20;a&&a>200&&(l=a/10);for(var f=1/l,c=f/10,h=0;h<=l;h++){var p=h*f,g=[r.apply(void 0,e.concat([p])),r.apply(void 0,n.concat([p]))],_=or(u[0],u[1],g[0],g[1]);_<s&&(o=p,s=_)}if(o===0)return{x:e[0],y:n[0]};if(o===1){var E=e.length;return{x:e[E-1],y:n[E-1]}}s=1/0;for(var y=0;y<32&&!(c<Zy);y++){var R=o-c,A=o+c,M=[r.apply(void 0,e.concat([R])),r.apply(void 0,n.concat([R]))],x=or(u[0],u[1],M[0],M[1]);if(R>=0&&x<s)o=R,s=x;else{var P=[r.apply(void 0,e.concat([A])),r.apply(void 0,n.concat([A]))],C=or(u[0],u[1],P[0],P[1]);A<=1&&C<s?(o=A,s=C):c*=.5}}return{x:r.apply(void 0,e.concat([o])),y:r.apply(void 0,n.concat([o]))}}function Qy(e,n){for(var i=0,t=e.length,r=0;r<t;r++){var a=e[r],o=n[r],s=e[(r+1)%t],u=n[(r+1)%t];i+=or(a,o,s,u)}return i/2}function Zr(e,n,i,t){var r=1-t;return r*r*e+2*t*r*n+t*t*i}function Ef(e,n,i){var t=e+i-2*n;if(ba(t,0))return[.5];var r=(e-n)/t;return r<=1&&r>=0?[r]:[]}function yf(e,n,i,t){return 2*(1-t)*(n-e)+2*t*(i-n)}function wh(e,n,i,t,r,a,o){var s=Zr(e,i,r,o),u=Zr(n,t,a,o),l=vn.pointAt(e,n,i,t,o),f=vn.pointAt(i,t,r,a,o);return[[e,n,l.x,l.y,s,u],[s,u,f.x,f.y,r,a]]}function Us(e,n,i,t,r,a,o){if(o===0)return(or(e,n,i,t)+or(i,t,r,a)+or(e,n,r,a))/2;var s=wh(e,n,i,t,r,a,.5),u=s[0],l=s[1];return u.push(o-1),l.push(o-1),Us.apply(void 0,u)+Us.apply(void 0,l)}var Jy={box:function(n,i,t,r,a,o){var s=Ef(n,t,a)[0],u=Ef(i,r,o)[0],l=[n,a],f=[i,o];return s!==void 0&&l.push(Zr(n,t,a,s)),u!==void 0&&f.push(Zr(i,r,o,u)),Eu(l,f)},length:function(n,i,t,r,a,o){return Us(n,i,t,r,a,o,3)},nearestPoint:function(n,i,t,r,a,o,s,u){return bh([n,t,a],[i,r,o],s,u,Zr)},pointDistance:function(n,i,t,r,a,o,s,u){var l=this.nearestPoint(n,i,t,r,a,o,s,u);return or(l.x,l.y,s,u)},interpolationAt:Zr,pointAt:function(n,i,t,r,a,o,s){return{x:Zr(n,t,a,s),y:Zr(i,r,o,s)}},divide:function(n,i,t,r,a,o,s){return wh(n,i,t,r,a,o,s)},tangentAngle:function(n,i,t,r,a,o,s){var u=yf(n,t,a,s),l=yf(i,r,o,s),f=Math.atan2(l,u);return Dh(f)}};function Qr(e,n,i,t,r){var a=1-r;return a*a*a*e+3*n*r*a*a+3*i*r*r*a+t*r*r*r}function Tf(e,n,i,t,r){var a=1-r;return 3*(a*a*(n-e)+2*a*r*(i-n)+r*r*(t-i))}function $o(e,n,i,t){var r=-3*e+9*n-9*i+3*t,a=6*e-12*n+6*i,o=3*n-3*e,s=[],u,l,f;if(ba(r,0))ba(a,0)||(u=-o/a,u>=0&&u<=1&&s.push(u));else{var c=a*a-4*r*o;ba(c,0)?s.push(-a/(2*r)):c>0&&(f=Math.sqrt(c),u=(-a+f)/(2*r),l=(-a-f)/(2*r),u>=0&&u<=1&&s.push(u),l>=0&&l<=1&&s.push(l))}return s}function Bh(e,n,i,t,r,a,o,s,u){var l=Qr(e,i,r,o,u),f=Qr(n,t,a,s,u),c=vn.pointAt(e,n,i,t,u),h=vn.pointAt(i,t,r,a,u),p=vn.pointAt(r,a,o,s,u),g=vn.pointAt(c.x,c.y,h.x,h.y,u),_=vn.pointAt(h.x,h.y,p.x,p.y,u);return[[e,n,c.x,c.y,g.x,g.y,l,f],[l,f,_.x,_.y,p.x,p.y,o,s]]}function ks(e,n,i,t,r,a,o,s,u){if(u===0)return Qy([e,i,r,o],[n,t,a,s]);var l=Bh(e,n,i,t,r,a,o,s,.5),f=[].concat(l[0],[u-1]),c=[].concat(l[1],[u-1]);return ks.apply(void 0,f)+ks.apply(void 0,c)}var jy={extrema:$o,box:function(n,i,t,r,a,o,s,u){for(var l=[n,s],f=[i,u],c=$o(n,t,a,s),h=$o(i,r,o,u),p=0;p<c.length;p++)l.push(Qr(n,t,a,s,c[p]));for(var g=0;g<h.length;g++)f.push(Qr(i,r,o,u,h[g]));return Eu(l,f)},length:function(n,i,t,r,a,o,s,u){return ks(n,i,t,r,a,o,s,u,3)},nearestPoint:function(n,i,t,r,a,o,s,u,l,f,c){return bh([n,t,a,s],[i,r,o,u],l,f,Qr,c)},pointDistance:function(n,i,t,r,a,o,s,u,l,f,c){var h=this.nearestPoint(n,i,t,r,a,o,s,u,l,f,c);return or(h.x,h.y,l,f)},interpolationAt:Qr,pointAt:function(n,i,t,r,a,o,s,u,l){return{x:Qr(n,t,a,s,l),y:Qr(i,r,o,u,l)}},divide:function(n,i,t,r,a,o,s,u,l){return Bh(n,i,t,r,a,o,s,u,l)},tangentAngle:function(n,i,t,r,a,o,s,u,l){var f=Tf(n,t,a,s,l),c=Tf(i,r,o,u,l);return Dh(Math.atan2(c,f))}},Fh=10,Uh=8,kh=100;function eT(e,n,i,t,r){for(var a=r[r.length-2],o=r[r.length-1],s=Jy.length(a,o,e,n,i,t),u=dt(s/Fh,Uh,kh),l=0,f=0,c=1;c<=u;++c){var h=c/u;l=a+(e-a)*h,f=o+(n-o)*h,r.push(l+(e+(i-e)*h-l)*h,f+(n+(t-n)*h-f)*h)}}function Rf(e,n,i,t,r,a,o){var s=o[o.length-2],u=o[o.length-1];o.length-=2;var l=jy.length(s,u,e,n,i,t,r,a),f=dt(l/Fh,Uh,kh),c=0,h=0,p=0,g=0,_=0;o.push(s,u);for(var E=1,y=0;E<=f;++E)y=E/f,c=1-y,h=c*c,p=h*c,g=y*y,_=g*y,o.push(p*s+3*h*y*e+3*c*g*i+_*r,p*u+3*h*y*n+3*c*g*t+_*a)}var Pi=1e20,tT=function(){function e(i){this.buffer=void 0,this.radius=void 0,this.cutoff=void 0,this.size=void 0,this.f=void 0,this.z=void 0,this.v=void 0,this.gridOuter=void 0,this.gridInner=void 0,this.ctx=void 0;var t=i.fontSize,r=t===void 0?24:t,a=i.buffer,o=a===void 0?3:a,s=i.radius,u=s===void 0?8:s,l=i.cutoff,f=l===void 0?.25:l,c=i.fontFamily,h=c===void 0?"sans-serif":c,p=i.fontWeight,g=p===void 0?"normal":p,_=i.fontStyle,E=_===void 0?"normal":_,y=i.canvas;this.buffer=o,this.cutoff=f,this.radius=u;var R=this.size=r+o*4,A=X.offscreenCanvas.getOrCreateCanvas(y);A.width=R,A.height=R;var M=X.offscreenCanvas.getOrCreateContext(y);this.ctx=M,M.font=E+" "+g+" "+r+"px "+h,M.textBaseline="alphabetic",M.textAlign="left",M.fillStyle="black",this.gridOuter=new Float64Array(R*R),this.gridInner=new Float64Array(R*R),this.f=new Float64Array(R),this.z=new Float64Array(R+1),this.v=new Uint16Array(R)}var n=e.prototype;return n.draw=function(t){var r=this.ctx.measureText(t),a=r.width,o=r.actualBoundingBoxAscent,s=r.actualBoundingBoxDescent,u=r.actualBoundingBoxLeft,l=r.actualBoundingBoxRight,f=Math.ceil(o),c=0,h=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(l-u))),p=Math.min(this.size-this.buffer,f+Math.ceil(s)),g=h+2*this.buffer,_=p+2*this.buffer,E=Math.max(g*_,0),y=new Uint8ClampedArray(E),R={data:y,width:g,height:_,glyphWidth:h,glyphHeight:p,glyphTop:f,glyphLeft:c,glyphAdvance:a};if(h===0||p===0)return R;var A=this.ctx,M=this.buffer,x=this.gridInner,P=this.gridOuter;A.clearRect(M,M,h,p),A.fillText(t,M,M+f);var C=A.getImageData(M,M,h,p);P.fill(Pi,0,E),x.fill(0,0,E);for(var O=0;O<p;O++)for(var D=0;D<h;D++){var F=C.data[4*(O*h+D)+3]/255;if(F!==0){var k=(O+M)*g+D+M;if(F===1)P[k]=0,x[k]=Pi;else{var d=.5-F;P[k]=d>0?d*d:0,x[k]=d<0?d*d:0}}}Sf(P,0,0,g,_,g,this.f,this.v,this.z),Sf(x,M,M,h,p,g,this.f,this.v,this.z);for(var v=0;v<E;v++){var m=Math.sqrt(P[v])-Math.sqrt(x[v]);y[v]=Math.round(255-255*(m/this.radius+this.cutoff))}return R},e}();function Sf(e,n,i,t,r,a,o,s,u){for(var l=n;l<n+t;l++)Af(e,i*a+l,a,r,o,s,u);for(var f=i;f<i+r;f++)Af(e,f*a+n,1,t,o,s,u)}function Af(e,n,i,t,r,a,o){a[0]=0,o[0]=-Pi,o[1]=Pi,r[0]=e[n];for(var s=1,u=0,l=0;s<t;s++){r[s]=e[n+s*i];var f=s*s;do{var c=a[u];l=(r[s]-r[c]+f-c*c)/(s-c)/2}while(l<=o[u]&&--u>-1);u++,a[u]=s,o[u]=l,o[u+1]=Pi}for(var h=0,p=0;h<t;h++){for(;o[p+1]<h;)p++;var g=a[p],_=h-g;e[n+h*i]=r[g]+_*_}}var gt;(function(e){e[e.NONE=0]="NONE",e[e.FILL=1]="FILL",e[e.JOINT_BEVEL=4]="JOINT_BEVEL",e[e.JOINT_MITER=8]="JOINT_MITER",e[e.JOINT_ROUND=12]="JOINT_ROUND",e[e.JOINT_CAP_BUTT=16]="JOINT_CAP_BUTT",e[e.JOINT_CAP_SQUARE=18]="JOINT_CAP_SQUARE",e[e.JOINT_CAP_ROUND=20]="JOINT_CAP_ROUND",e[e.FILL_EXPAND=24]="FILL_EXPAND",e[e.CAP_BUTT=32]="CAP_BUTT",e[e.CAP_SQUARE=64]="CAP_SQUARE",e[e.CAP_ROUND=96]="CAP_ROUND",e[e.CAP_BUTT2=128]="CAP_BUTT2"})(gt||(gt={}));var dn=2,rT=3,xi;(function(e){e[e.PACKED=0]="PACKED",e[e.VERTEX_NUM=1]="VERTEX_NUM",e[e.TRAVEL=2]="TRAVEL"})(xi||(xi={}));var _r;(function(e){e[e.PREV=0]="PREV",e[e.POINT1=1]="POINT1",e[e.POINT2=2]="POINT2",e[e.NEXT=3]="NEXT",e[e.VERTEX_JOINT=4]="VERTEX_JOINT",e[e.VERTEX_NUM=5]="VERTEX_NUM",e[e.TRAVEL=6]="TRAVEL"})(_r||(_r={}));var ue;(function(e){e.MODEL_MATRIX="u_ModelMatrix",e.FILL_COLOR="u_FillColor",e.STROKE_COLOR="u_StrokeColor",e.STROKE_WIDTH="u_StrokeWidth",e.INCREASED_LINE_WIDTH_FOR_HIT_TESTING="u_IncreasedLineWidthForHitTesting",e.OPACITY="u_Opacity",e.FILL_OPACITY="u_FillOpacity",e.STROKE_OPACITY="u_StrokeOpacity",e.EXPAND="u_Expand",e.MITER_LIMIT="u_MiterLimit",e.SCALE_MODE="u_ScaleMode",e.ALIGNMENT="u_Alignment",e.PICKING_COLOR="u_PickingColor",e.DASH="u_Dash",e.GAP="u_Gap",e.DASH_OFFSET="u_DashOffset",e.VISIBLE="u_Visible",e.Z_INDEX="u_ZIndex"})(ue||(ue={}));var yu=function(e){$e(n,e);function n(){return e.apply(this,arguments)||this}var i=n.prototype;return i.shouldMerge=function(r,a){return!1},i.updateAttribute=function(r,a,o,s){var u=this;e.prototype.updateAttribute.call(this,r,a,o,s),r.forEach(function(l){var f=l.parsedStyle,c=f.stroke,h=f.opacity,p=f.fillOpacity,g=f.strokeOpacity,_=f.lineWidth,E=f.increasedLineWidthForHitTesting,y=f.anchor,R=f.lineDash,A=f.lineDashOffset,M=f.visibility;if(o==="lineJoin"||o==="lineCap"||o==="markerStart"||o==="markerEnd"||o==="markerStartOffset"||o==="markerEndOffset"||l.nodeName===H.CIRCLE&&o==="r"||l.nodeName===H.ELLIPSE&&(o==="rx"||o==="ry")||l.nodeName===H.RECT&&(o==="width"||o==="height"||o==="radius")||l.nodeName===H.LINE&&(o==="x1"||o==="y1"||o==="x2"||o==="y2")||l.nodeName===H.POLYLINE&&o==="points"||l.nodeName===H.POLYGON&&o==="points"||l.nodeName===H.PATH&&o==="path")u.material.geometryDirty=!0,u.material.programDirty=!0;else if(o==="stroke"){var x,P=[0,0,0,0];je(c)&&(P=[Number(c.r)/255,Number(c.g)/255,Number(c.b)/255,Number(c.alpha)]),u.material.setUniforms((x={},x[ue.STROKE_COLOR]=P,x))}else if(o==="opacity"){var C;u.material.setUniforms((C={},C[ue.OPACITY]=h,C))}else if(o==="fillOpacity"){var O;u.material.setUniforms((O={},O[ue.FILL_OPACITY]=p,O))}else if(o==="strokeOpacity"){var D;u.material.setUniforms((D={},D[ue.STROKE_OPACITY]=g,D))}else if(o==="lineWidth"){var F;u.material.setUniforms((F={},F[ue.STROKE_WIDTH]=_,F))}else if(o==="increasedLineWidthForHitTesting"){var k;u.material.setUniforms((k={},k[ue.INCREASED_LINE_WIDTH_FOR_HIT_TESTING]=E||0,k))}else if(o==="anchor"||o==="modelMatrix"){var d,v=0,m=0,S=l.getGeometryBounds();if(S){var T=S.halfExtents;v=-T[0]*y[0]*2,m=-T[1]*y[1]*2}var N=Te();yn(N,l.getWorldTransform(),Gn(N,me(v,m,0))),u.material.setUniforms((d={},d[ue.MODEL_MATRIX]=N,d))}else if(o==="visibility"){var B;u.material.setUniforms((B={},B[ue.VISIBLE]=M==="visible"?1:0,B))}else if(o==="lineDash"){var w;u.material.setUniforms((w={},w[ue.DASH]=R[0]||0,w[ue.GAP]=R[1]||0,w))}else if(o==="lineDashOffset"){var U;u.material.setUniforms((U={},U[ue.DASH_OFFSET]=A||0,U))}else if(o==="pointerEvents"){var V,K,z=s&&l.isInteractive()&&((V=l.renderable3D)===null||V===void 0?void 0:V.encodedPickingColor)||[0,0,0];u.material.setUniforms((K={},K[ue.PICKING_COLOR]=z,K))}})},i.changeRenderOrder=function(r,a){if(this.material){var o;this.material.setUniforms((o={},o[ue.Z_INDEX]=a*rn,o))}},i.createMaterial=function(r){var a,o;this.material.vertexShader=qy,this.material.fragmentShader=$y,this.material.defines=Me({},this.material.defines,Jn(_r));var s=r[0],u=s.parsedStyle,l=u.fill,f=u.stroke,c=u.opacity,h=u.fillOpacity,p=u.strokeOpacity,g=u.lineWidth,_=u.increasedLineWidthForHitTesting,E=u.anchor,y=u.lineDash,R=u.lineDashOffset,A=u.visibility,M=[0,0,0,0];je(l)&&(M=[Number(l.r)/255,Number(l.g)/255,Number(l.b)/255,Number(l.alpha)]);var x=[0,0,0,0];je(f)&&(x=[Number(f.r)/255,Number(f.g)/255,Number(f.b)/255,Number(f.alpha)]);var P=s.isInteractive()&&((a=s.renderable3D)===null||a===void 0?void 0:a.encodedPickingColor)||[0,0,0],C=0,O=0,D=s.getGeometryBounds();if(D){var F=D.halfExtents;C=-F[0]*E[0]*2,O=-F[1]*E[1]*2}var k=Te();yn(k,s.getWorldTransform(),Gn(k,me(C,O,0))),this.material.setUniforms((o={},o[ue.MODEL_MATRIX]=k,o[ue.FILL_COLOR]=M,o[ue.STROKE_COLOR]=x,o[ue.STROKE_WIDTH]=g,o[ue.INCREASED_LINE_WIDTH_FOR_HIT_TESTING]=_||0,o[ue.OPACITY]=c,o[ue.FILL_OPACITY]=h,o[ue.STROKE_OPACITY]=p,o[ue.EXPAND]=1,o[ue.MITER_LIMIT]=5,o[ue.SCALE_MODE]=1,o[ue.ALIGNMENT]=.5,o[ue.PICKING_COLOR]=P,o[ue.DASH]=y&&y[0]||0,o[ue.GAP]=y&&y[1]||0,o[ue.DASH_OFFSET]=R||0,o[ue.VISIBLE]=A==="visible"?1:0,o[ue.Z_INDEX]=s.sortable.renderOrder*rn,o)),this.material.cullMode=hr.None},i.createGeometry=function(r){var a=r[0],o=Lh(a),s=o.pointsBuffer,u=o.travelBuffer,l=o.instancedCount;this.geometry.setVertexBuffer({bufferIndex:xi.PACKED,byteStride:4*(3+3+3+3),frequency:be.PerInstance,attributes:[{format:G.F32_RG,bufferByteOffset:4*0,byteStride:4*3,location:_r.PREV,divisor:1},{format:G.F32_RG,bufferByteOffset:4*3,byteStride:4*3,location:_r.POINT1,divisor:1},{format:G.F32_R,bufferByteOffset:4*5,byteStride:4*3,location:_r.VERTEX_JOINT,divisor:1},{format:G.F32_RG,bufferByteOffset:4*6,byteStride:4*3,location:_r.POINT2,divisor:1},{format:G.F32_RG,bufferByteOffset:4*9,byteStride:4*3,location:_r.NEXT,divisor:1}],data:new Float32Array(s)}),this.geometry.setVertexBuffer({bufferIndex:xi.VERTEX_NUM,byteStride:4*1,frequency:be.PerInstance,attributes:[{format:G.F32_R,bufferByteOffset:4*0,byteStride:4*1,location:_r.VERTEX_NUM,divisor:0}],data:new Float32Array([0,1,2,3,4,5,6,7,8])}),this.geometry.setVertexBuffer({bufferIndex:xi.TRAVEL,byteStride:4*1,frequency:be.PerInstance,attributes:[{format:G.F32_R,bufferByteOffset:4*0,byteStride:4*1,location:_r.TRAVEL,divisor:1}],data:new Float32Array(u)}),this.geometry.vertexCount=15,this.geometry.instancedCount=l,this.geometry.setIndexBuffer(new Uint32Array([0,2,1,0,3,2,4,6,5,4,7,6,4,7,8]))},n}(Cn);function Lh(e,n){n===void 0&&(n=!1);var i=e.parsedStyle,t=i.lineCap,r=i.lineJoin,a=e.parsedStyle,o=a.defX,s=a.defY,u=e.parsedStyle,l=u.markerStart,f=u.markerEnd,c=u.markerStartOffset,h=u.markerEndOffset,p=[],g=[];if(e.nodeName===H.POLYLINE||e.nodeName===H.POLYGON){var _=e.parsedStyle.points.points,E=_.length,y=0,R=0,A=0,M=0,x=0,P,C;if(l&&Pe(l)&&c&&(P=_[1][0]-_[0][0],C=_[1][1]-_[0][1],x=Math.atan2(C,P),y=Math.cos(x)*(c||0),R=Math.sin(x)*(c||0)),f&&Pe(f)&&h&&(P=_[E-2][0]-_[E-1][0],C=_[E-2][1]-_[E-1][1],x=Math.atan2(C,P),A=Math.cos(x)*(h||0),M=Math.sin(x)*(h||0)),p[0]=_.reduce(function(ce,he,Oe){var ne=0,rt=0;return Oe===0?(ne=y,rt=R):Oe===E-1&&(ne=A,rt=M),ce.push(he[0]-o+ne,he[1]-s+rt),ce},[]),e.nodeName===H.POLYGON){if(n)return g=bi(p[0],[],2),{pointsBuffer:p[0],travelBuffer:[],triangles:g,instancedCount:Math.round(p[0].length/dn)};var O;p[0].push(p[0][0],p[0][1]),(O=p[0]).push.apply(O,Pf(p[0][0],p[0][1],p[0][2],p[0][3]))}}else if(e.nodeName===H.PATH||e.nodeName===H.CIRCLE||e.nodeName===H.ELLIPSE||e.nodeName===H.RECT){var D;if(e.nodeName!==H.PATH){if(D=Wa(N0(e,Xi(Te())),e),o=D.rect.x,s=D.rect.y,e.nodeName===H.RECT){var F=e.parsedStyle,k=F.width,d=F.height;k<0&&(o+=D.rect.width),d<0&&(s+=D.rect.height)}}else D=e.parsedStyle.path;var v=D,m=v.absolutePath,S=v.segments,T=0,N=0,B=0,w=0,U=0,V,K;if(l&&Pe(l)&&c){var z=l.parentNode.getStartTangent(),le=z[0],Se=z[1];V=le[0]-Se[0],K=le[1]-Se[1],U=Math.atan2(K,V),T=Math.cos(U)*(c||0),N=Math.sin(U)*(c||0)}if(f&&Pe(f)&&h){var Ae=f.parentNode.getEndTangent(),ge=Ae[0],ye=Ae[1];V=ge[0]-ye[0],K=ge[1]-ye[1],U=Math.atan2(K,V),B=Math.cos(U)*(h||0),w=Math.sin(U)*(h||0)}var ve=-1,ie=-1;if(m.forEach(function(ce,he){var Oe=ce[0],ne=ce.slice(1),rt=m[he+1],ke=he===0&&(T!==0||N!==0),Ge=(he===m.length-1||rt&&(rt[0]==="M"||rt[0]==="Z"))&&B!==0&&w!==0;if(Oe==="M")ie++,p[ie]=[],ve=p[ie].length,ke?p[ie].push(ne[0]-o+T,ne[1]-s+N,ne[0]-o,ne[1]-s):p[ie].push(ne[0]-o,ne[1]-s);else if(Oe==="L")Ge?p[ie].push(ne[0]-o+B,ne[1]-s+w):p[ie].push(ne[0]-o,ne[1]-s);else if(Oe==="Q")eT(ne[0]-o,ne[1]-s,ne[2]-o,ne[3]-s,p[ie]),Ge&&p[ie].push(ne[2]-o+B,ne[3]-s+w);else if(Oe==="A"){for(var Kt=S[he].prePoint,ur=Kt[0],ai=Kt[1],lr=ou(ur,ai,ne[0],ne[1],ne[2],ne[3],ne[4],ne[5],ne[6],void 0),$t=0;$t<lr.length;$t+=6)Rf(lr[$t]-o,lr[$t+1]-s,lr[$t+2]-o,lr[$t+3]-s,lr[$t+4]-o,lr[$t+5]-s,p[ie]);Ge&&p[ie].push(ne[5]-o+B,ne[6]-s+w)}else if(Oe==="C")Rf(ne[0]-o,ne[1]-s,ne[2]-o,ne[3]-s,ne[4]-o,ne[5]-s,p[ie]),Ge&&p[ie].push(ne[4]-o+B,ne[5]-s+w);else if(Oe==="Z"&&(e.nodeName===H.PATH||e.nodeName===H.RECT)){var ln,oi=1e-4;(Math.abs(p[ie][p[ie].length-2]-p[ie][ve])>oi||Math.abs(p[ie][p[ie].length-1]-p[ie][ve+1])>oi)&&p[ie].push(p[ie][ve],p[ie][ve+1]),(ln=p[ie]).push.apply(ln,Pf(p[ie][ve],p[ie][ve+1],p[ie][ve+2],p[ie][ve+3]))}}),n){var we=p.reduce(function(ce,he){return ce.push.apply(ce,he),ce},[]);return g=bi(we,[],2),{pointsBuffer:we,travelBuffer:[],triangles:g,instancedCount:Math.round(we.length/dn)}}}var Pt=nT(r),Je=iT(t),Tt=Je;return Je===gt.CAP_ROUND&&(Tt=gt.JOINT_CAP_ROUND),Je===gt.CAP_BUTT&&(Tt=gt.JOINT_CAP_BUTT),Je===gt.CAP_SQUARE&&(Tt=gt.JOINT_CAP_SQUARE),p.map(function(ce){for(var he=(Math.round(0/dn)+2)*rT,Oe=0,ne=[],rt=[],ke=0;ke<ce.length;ke+=dn)ke>1&&(Oe+=Math.sqrt(Math.pow(ce[ke]-ce[ke-2],2)+Math.pow(ce[ke+1]-ce[ke+1-2],2))),rt.push(Oe),ne[he++]=ce[ke],ne[he++]=ce[ke+1],ne[he]=Pt,ke==0&&Je!==gt.CAP_ROUND&&(ne[he]+=Je),ke+dn*2>=ce.length?ne[he]+=Tt-Pt:ke+dn>=ce.length&&(ne[he]=0),he++;ne[he++]=ce[ce.length-4],ne[he++]=ce[ce.length-3],ne[he++]=0,ne[0]=ce[0],ne[1]=ce[1],ne[2]=0,ne[3]=ce[2],ne[4]=ce[3],ne[5]=Je===gt.CAP_ROUND?Je:0;var Ge=Math.round(ce.length/dn);return{pointsBuffer:ne,travelBuffer:rt,triangles:g,instancedCount:Ge}}).reduce(function(ce,he){var Oe,ne;return(Oe=ce.pointsBuffer).push.apply(Oe,he.pointsBuffer),(ne=ce.travelBuffer).push.apply(ne,he.travelBuffer),ce.instancedCount+=he.instancedCount,ce},{pointsBuffer:[],travelBuffer:[],triangles:g,instancedCount:0})}function nT(e){var n;switch(e){case"bevel":n=gt.JOINT_BEVEL;break;case"round":n=gt.JOINT_ROUND;break;default:n=gt.JOINT_MITER;break}return n}function iT(e){var n;switch(e){case"square":n=gt.CAP_SQUARE;break;case"round":n=gt.CAP_ROUND;break;default:n=gt.CAP_BUTT;break}return n}function Pf(e,n,i,t){i===void 0&&(i=e),t===void 0&&(t=n);var r=[i-e,t-n],a=.01;return[e+r[0]*a,n+r[1]*a]}var aT=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_ObjectParams {
  mat4 u_ModelMatrix;
  vec4 u_FillColor;
  vec3 u_PickingColor;
  float u_Opacity;
  float u_FillOpacity;
  float u_Visible;
  float u_ZIndex;
};
#ifdef USE_UV
  in vec2 v_Uv;
#endif
#ifdef USE_MAP
  uniform sampler2D u_Map;
#endif

out vec4 outputColor;

#define COLOR_SCALE 1. / 255.

void main(){
  if (u_Visible < 0.5) {
    discard;
  }

  if (u_IsPicking > 0.5) {
    vec3 pickingColor = COLOR_SCALE * u_PickingColor;
    if (pickingColor.x == 0.0 && pickingColor.y == 0.0 && pickingColor.z == 0.0) {
      discard;
    }
    outputColor = vec4(pickingColor, 1.0);
  } else {

    vec4 u_Color = u_FillColor;

    #ifdef USE_MAP
  #ifdef USE_PATTERN
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #else
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #endif
#endif

    outputColor = u_Color;
    outputColor.a = outputColor.a * u_Opacity * u_FillOpacity;
  }
}`,oT=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_ObjectParams {
  mat4 u_ModelMatrix;
  vec4 u_FillColor;
  vec3 u_PickingColor;
  float u_Opacity;
  float u_FillOpacity;
  float u_Visible;
  float u_ZIndex;
};

layout(location = POSITION) in vec2 a_Position;
#ifdef USE_UV
  layout(location = UV) in vec2 a_Uv;
  out vec2 v_Uv;
#endif

void main() {
  #ifdef USE_UV
  v_Uv = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
    v_Uv.y = 1.0 - v_Uv.y;
  #endif
#endif

  gl_Position = u_ProjectionMatrix * u_ViewMatrix * u_ModelMatrix * vec4(a_Position, u_ZIndex, 1.0);
}`,sT=function(e){$e(n,e);function n(){return e.apply(this,arguments)||this}var i=n.prototype;return i.shouldMerge=function(r,a){return!1},i.createGeometry=function(r){var a=r[0],o=Lh(a,!0),s=o.triangles,u=o.pointsBuffer;this.geometry.setVertexBuffer({bufferIndex:Ne.POSITION,byteStride:4*2,frequency:be.PerVertex,attributes:[{format:G.F32_RG,bufferByteOffset:4*0,location:_e.POSITION}],data:new Float32Array(u)});var l=a.getGeometryBounds(),f=l.halfExtents,c=u.map(function(h,p){return h/f[p%2]/2});this.geometry.setVertexBuffer({bufferIndex:Ne.UV,byteStride:4*2,frequency:be.PerVertex,attributes:[{format:G.F32_RG,bufferByteOffset:4*0,location:_e.UV}],data:new Float32Array(c)}),this.geometry.vertexCount=s.length,this.geometry.setIndexBuffer(new Uint32Array(s))},i.createMaterial=function(r){var a,o;this.material.vertexShader=oT,this.material.fragmentShader=aT;var s=r[0],u=s.parsedStyle,l=u.fill,f=u.opacity,c=u.fillOpacity,h=u.anchor,p=u.visibility,g=[0,0,0,0];je(l)&&(g=[Number(l.r)/255,Number(l.g)/255,Number(l.b)/255,Number(l.alpha)]);var _=s.isInteractive()&&((a=s.renderable3D)===null||a===void 0?void 0:a.encodedPickingColor)||[0,0,0],E=0,y=0,R=s.getGeometryBounds();if(R){var A=R.halfExtents;E=-A[0]*h[0]*2,y=-A[1]*h[1]*2}var M=Te();yn(M,s.getWorldTransform(),Gn(M,me(E,y,0))),this.material.setUniforms((o={},o[ue.MODEL_MATRIX]=M,o[ue.FILL_COLOR]=g,o[ue.PICKING_COLOR]=_,o[ue.OPACITY]=f,o[ue.FILL_OPACITY]=c,o[ue.VISIBLE]=p==="visible"?1:0,o[ue.Z_INDEX]=s.sortable.renderOrder*rn,o))},i.updateAttribute=function(r,a,o,s){var u=this;e.prototype.updateAttribute.call(this,r,a,o,s),r.forEach(function(l){var f=l.parsedStyle,c=f.fill,h=f.opacity,p=f.fillOpacity,g=f.anchor,_=f.visibility;if(o==="lineJoin"||o==="lineCap"||o==="markerStart"||o==="markerEnd"||o==="markerStartOffset"||o==="markerEndOffset"||l.nodeName===H.RECT&&(o==="width"||o==="height"||o==="radius")||l.nodeName===H.LINE&&(o==="x1"||o==="y1"||o==="x2"||o==="y2")||l.nodeName===H.POLYLINE&&o==="points"||l.nodeName===H.POLYGON&&o==="points"||l.nodeName===H.PATH&&o==="path")u.material.geometryDirty=!0,u.material.programDirty=!0;else if(o==="fill")if(je(c)){var E,y=[Number(c.r)/255,Number(c.g)/255,Number(c.b)/255,Number(c.alpha)];u.material.setUniforms((E={},E[ue.FILL_COLOR]=y,E))}else{var R=u.textureMappings.findIndex(function(T){return T.name===Fs}),A=u.createFillGradientTextureMapping([u.instance]);R>=0&&u.textureMappings.splice(R,1,A),u.material.textureDirty=!0}else if(o==="opacity"){var M;u.material.setUniforms((M={},M[ue.OPACITY]=h,M))}else if(o==="fillOpacity"){var x;u.material.setUniforms((x={},x[ue.FILL_OPACITY]=p,x))}else if(o==="anchor"||o==="modelMatrix"){var P,C=0,O=0,D=l.getGeometryBounds();if(D){var F=D.halfExtents;C=-F[0]*g[0]*2,O=-F[1]*g[1]*2}var k=Te();yn(k,l.getWorldTransform(),Gn(k,me(C,O,0))),u.material.setUniforms((P={},P[ue.MODEL_MATRIX]=k,P))}else if(o==="visibility"){var d;u.material.setUniforms((d={},d[ue.VISIBLE]=_==="visible"?1:0,d))}else if(o==="pointerEvents"){var v,m,S=s&&l.isInteractive()&&((v=l.renderable3D)===null||v===void 0?void 0:v.encodedPickingColor)||[0,0,0];u.material.setUniforms((m={},m[ue.PICKING_COLOR]=S,m))}})},i.changeRenderOrder=function(r,a){if(this.material){var o;this.material.setUniforms((o={},o[ue.Z_INDEX]=a*rn,o))}},n}(Cn),uT=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};

in vec4 v_PickingResult;
in vec4 v_Color;
in vec4 v_StrokeColor;
in vec4 v_StylePacked1;
in vec4 v_StylePacked2;
#ifdef USE_UV
  in vec2 v_Uv;
#endif
#ifdef USE_MAP
  uniform sampler2D u_Map;
#endif

out vec4 outputColor;

void main() {
  vec4 u_Color = v_Color;
vec4 u_StrokeColor = v_StrokeColor;
float u_Opacity = v_StylePacked1.x;
float u_FillOpacity = v_StylePacked1.y;
float u_StrokeOpacity = v_StylePacked1.z;
float u_StrokeWidth = v_StylePacked1.w;
float u_Visible = v_StylePacked2.x;
vec3 u_PickingColor = v_PickingResult.xyz;

if (u_Visible < 0.5) {
    discard;
}
  #ifdef USE_MAP
  #ifdef USE_PATTERN
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #else
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #endif
#endif

  if (u_IsPicking > 0.5) {
    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {
      discard;
    }
    outputColor = vec4(u_PickingColor, 1.0);
  } else {
    outputColor = u_Color;
    outputColor.a = outputColor.a * u_Opacity;
  }
}`,lT=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;
layout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;
layout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;
layout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;
layout(location = COLOR) in vec4 a_Color;
layout(location = STROKE_COLOR) in vec4 a_StrokeColor;
layout(location = PACKED_STYLE1) in vec4 a_StylePacked1;
layout(location = PACKED_STYLE2) in vec4 a_StylePacked2;
layout(location = PICKING_COLOR) in vec4 a_PickingColor;

out vec4 v_PickingResult;
out vec4 v_Color;
out vec4 v_StrokeColor;
out vec4 v_StylePacked1;
out vec4 v_StylePacked2;

#define COLOR_SCALE 1. / 255.
void setPickingColor(vec3 pickingColor) {
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}
vec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {
  return pm * vm * mm * pos;
}

layout(location = POSITION) in vec4 a_Size;

#ifdef USE_UV
  layout(location = UV) in vec2 a_Uv;
  out vec2 v_Uv;
#endif

bool isPerspectiveMatrix(mat4 m) {
	return m[ 2 ][ 3 ] == - 1.0;
}

void main() {
  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
vec4 u_StrokeColor = a_StrokeColor;
float u_Opacity = a_StylePacked1.x;
float u_FillOpacity = a_StylePacked1.y;
float u_StrokeOpacity = a_StylePacked1.z;
float u_StrokeWidth = a_StylePacked1.w;
float u_ZIndex = a_PickingColor.w;
vec2 u_Anchor = a_StylePacked2.yz;
float u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;

setPickingColor(a_PickingColor.xyz);

v_Color = a_Color;
v_StrokeColor = a_StrokeColor;
v_StylePacked1 = a_StylePacked1;
v_StylePacked2 = a_StylePacked2;

#ifdef CLIPSPACE_NEAR_ZERO
    gl_Position.z = gl_Position.z * 0.5 + 0.5;
#endif

  vec2 offset = (a_Uv - u_Anchor.xy) * a_Size.xy;

  bool isPerspective = isPerspectiveMatrix(u_ProjectionMatrix);

  float isBillboard = a_Size.w;
  if (isBillboard < 0.5) {
    gl_Position = project(vec4(offset, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);
  } else {
    gl_Position = project(vec4(offset, a_Size.z, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);
  }

  #ifdef USE_UV
  v_Uv = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
    v_Uv.y = 1.0 - v_Uv.y;
  #endif
#endif

}`,fT=function(e){$e(n,e);function n(){return e.apply(this,arguments)||this}var i=n.prototype;return i.shouldMerge=function(r,a){var o=e.prototype.shouldMerge.call(this,r,a);return!(!o||this.instance.parsedStyle.img!==r.parsedStyle.img)},i.createMaterial=function(r){var a=r[0],o=a.parsedStyle.img;this.material.defines=Me({},this.material.defines),this.material.vertexShader=lT,this.material.fragmentShader=uT;var s=this.texturePool.getOrCreateTexture(this.context.device,o);this.material.setUniforms({u_Map:s})},i.createGeometry=function(r){e.prototype.createGeometry.call(this,r);var a=[],o=[],s=[];r.forEach(function(u,l){var f=u,c=l*4,h=f.parsedStyle,p=h.width,g=h.height,_=h.z,E=h.isBillboard;a.push(p,g,_,E?1:0),o.push(0,0,1,0,1,1,0,1),s.push(0+c,2+c,1+c,0+c,3+c,2+c)}),this.geometry.setIndexBuffer(new Uint32Array(s)),this.geometry.vertexCount=6,this.geometry.setVertexBuffer({bufferIndex:Ne.POSITION,byteStride:4*4,frequency:be.PerInstance,attributes:[{format:G.F32_RGBA,bufferByteOffset:4*0,location:_e.POSITION}],data:new Float32Array(a)}),this.geometry.setVertexBuffer({bufferIndex:Ne.UV,byteStride:4*2,frequency:be.PerVertex,attributes:[{format:G.F32_RG,bufferByteOffset:4*0,location:_e.UV}],data:new Float32Array(o)})},i.updateAttribute=function(r,a,o,s){if(e.prototype.updateAttribute.call(this,r,a,o,s),this.updateBatchedAttribute(r,a,o,s),o==="width"||o==="height"||o==="z"||o==="isBillboard"){var u=[];r.forEach(function(f){var c=f,h=c.parsedStyle,p=h.width,g=h.height,_=h.z,E=h.isBillboard;u.push(p,g,_,E?1:0)}),this.geometry.updateVertexBuffer(Ne.POSITION,_e.POSITION,a,new Uint8Array(new Float32Array(u).buffer))}else if(o==="img"){var l=this.texturePool.getOrCreateTexture(this.context.device,s);this.material.setUniforms({u_Map:l})}},n}(Cn),cT=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_ObjectParams {
  vec2 u_SDFMapSize;
  float u_FontSize;
  float u_GammaScale;
  float u_StrokeBlur;
  float u_HasStroke;
};

in vec4 v_PickingResult;
in vec4 v_Color;
in vec4 v_StrokeColor;
in vec4 v_StylePacked1;
in vec4 v_StylePacked2;

uniform sampler2D u_SDFMap;

#define SDF_PX 8.0

in vec2 v_UV;
in float v_GammaScale;

out vec4 outputColor;

void main() {
  vec4 u_Color = v_Color;
vec4 u_StrokeColor = v_StrokeColor;
float u_Opacity = v_StylePacked1.x;
float u_FillOpacity = v_StylePacked1.y;
float u_StrokeOpacity = v_StylePacked1.z;
float u_StrokeWidth = v_StylePacked1.w;
float u_Visible = v_StylePacked2.x;
vec3 u_PickingColor = v_PickingResult.xyz;

if (u_Visible < 0.5) {
    discard;
}

  float dist = texture(SAMPLER_2D(u_SDFMap), v_UV).a;

  float EDGE_GAMMA = 0.105 / u_DevicePixelRatio;
  float fontScale = u_FontSize / 24.0;
  highp float gamma = EDGE_GAMMA / (fontScale * u_GammaScale);
  lowp vec4 color = u_Color;
  lowp float buff = (256.0 - 64.0) / 256.0;
  float opacity = u_FillOpacity;
  if (u_HasStroke > 0.5 && u_StrokeWidth > 0.0) {
    color = u_StrokeColor;
    gamma = (u_StrokeBlur * 1.19 / SDF_PX + EDGE_GAMMA) / (fontScale * u_GammaScale);
    buff = (6.0 - u_StrokeWidth / fontScale / 2.0) / SDF_PX;
    opacity = u_StrokeOpacity;
  }

  highp float gamma_scaled = gamma * v_GammaScale;
  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  opacity *= alpha * u_Opacity;

  if (u_IsPicking > 0.5) {
    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {
      discard;
    }
    outputColor = vec4(u_PickingColor, 1.0);
  } else {

    if (opacity < 0.001) {
      discard;
    }

    outputColor = color;
    outputColor.a *= opacity;
  }
}`,hT=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_ObjectParams {
  vec2 u_SDFMapSize;
  float u_FontSize;
  float u_GammaScale;
  float u_StrokeBlur;
  float u_HasStroke;
};

layout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;
layout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;
layout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;
layout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;
layout(location = COLOR) in vec4 a_Color;
layout(location = STROKE_COLOR) in vec4 a_StrokeColor;
layout(location = PACKED_STYLE1) in vec4 a_StylePacked1;
layout(location = PACKED_STYLE2) in vec4 a_StylePacked2;
layout(location = PICKING_COLOR) in vec4 a_PickingColor;

out vec4 v_PickingResult;
out vec4 v_Color;
out vec4 v_StrokeColor;
out vec4 v_StylePacked1;
out vec4 v_StylePacked2;

#define COLOR_SCALE 1. / 255.
void setPickingColor(vec3 pickingColor) {
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}
vec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {
  return pm * vm * mm * pos;
}

layout(location = TEX) in vec2 a_Tex;
layout(location = OFFSET) in vec2 a_Offset;

out vec2 v_UV;
out float v_GammaScale;

void main() {
  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
vec4 u_StrokeColor = a_StrokeColor;
float u_Opacity = a_StylePacked1.x;
float u_FillOpacity = a_StylePacked1.y;
float u_StrokeOpacity = a_StylePacked1.z;
float u_StrokeWidth = a_StylePacked1.w;
float u_ZIndex = a_PickingColor.w;
vec2 u_Anchor = a_StylePacked2.yz;
float u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;

setPickingColor(a_PickingColor.xyz);

v_Color = a_Color;
v_StrokeColor = a_StrokeColor;
v_StylePacked1 = a_StylePacked1;
v_StylePacked2 = a_StylePacked2;

#ifdef CLIPSPACE_NEAR_ZERO
    gl_Position.z = gl_Position.z * 0.5 + 0.5;
#endif

  v_UV = a_Tex / u_SDFMapSize;

  float fontScale = u_FontSize / 24.;

  gl_Position = project(vec4(a_Offset * fontScale, u_ZIndex, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);
  v_GammaScale = gl_Position.w;
}`;function Wh(e,n,i,t){var r=n.width,a=n.height;if(!t)t=new Uint8Array(r*a*i);else if(t.length!==r*a*i)throw new RangeError("mismatched image size");return e.width=r,e.height=a,e.data=t,e}function dT(e,n,i){var t=n.width,r=n.height;if(!(t===e.width&&r===e.height)){var a=Wh({},{width:t,height:r},i);Hh(e,a,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,t),height:Math.min(e.height,r)},i),e.width=t,e.height=r,e.data=a.data}}function Hh(e,n,i,t,r,a){if(r.width===0||r.height===0)return n;if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>n.width||r.height>n.height||t.x>n.width-r.width||t.y>n.height-r.height)throw new RangeError("out of range destination coordinates for image copy");for(var o=e.data,s=n.data,u=0;u<r.height;u++)for(var l=((i.y+u)*e.width+i.x)*a,f=((t.y+u)*n.width+t.x)*a,c=0;c<r.width*a;c++)s[f+c]=o[l+c];return n}var Ls=function(){function e(i,t){this.width=void 0,this.height=void 0,this.data=void 0,Wh(this,i,1,t)}var n=e.prototype;return n.resize=function(t){dT(this,t,1)},n.clone=function(){return new e({width:this.width,height:this.height},new Uint8Array(this.data))},e.copy=function(t,r,a,o,s){Hh(t,r,a,o,s,1)},e}();function vT(e){for(var n=0,i=0,t=yr(e),r;!(r=t()).done;){var a=r.value;n+=a.w*a.h,i=Math.max(i,a.w)}e.sort(function(E,y){return y.h-E.h});for(var o=Math.max(Math.ceil(Math.sqrt(n/.95)),i),s=[{x:0,y:0,w:o,h:1/0}],u=0,l=0,f=yr(e),c;!(c=f()).done;)for(var h=c.value,p=s.length-1;p>=0;p--){var g=s[p];if(!(h.w>g.w||h.h>g.h)){if(h.x=g.x,h.y=g.y,l=Math.max(l,h.y+h.h),u=Math.max(u,h.x+h.w),h.w===g.w&&h.h===g.h){var _=s.pop();p<s.length&&(s[p]=_)}else h.h===g.h?(g.x+=h.w,g.w-=h.w):h.w===g.w?(g.y+=h.h,g.h-=h.h):(s.push({x:g.x+h.w,y:g.y,w:g.w-h.w,h:h.h}),g.y+=h.h,g.h-=h.h);break}}return{w:u,h:l,fill:n/(u*l)||0}}var xa=1,pT=function(n){this.image=void 0,this.positions=void 0;var i={},t=[];for(var r in n){var a=n[r],o=i[r]={};for(var s in a){var u=a[+s];if(!(!u||u.bitmap.width===0||u.bitmap.height===0)){var l={x:0,y:0,w:u.bitmap.width+2*xa,h:u.bitmap.height+2*xa};t.push(l),o[s]={rect:l,metrics:u.metrics}}}}var f=vT(t),c=f.w,h=f.h,p=new Ls({width:c||1,height:h||1});for(var g in n){var _=n[g];for(var E in _){var y=_[+E];if(!(!y||y.bitmap.width===0||y.bitmap.height===0)){var R=i[g][E].rect;Ls.copy(y.bitmap,p,{x:0,y:0},{x:R.x+xa,y:R.y+xa},y.bitmap)}}}this.image=p,this.positions=i},Tu=24,Ru=3,gT=Tu,mT=Ru,_T=8,ET=.25;function yT(){for(var e=[],n=32;n<128;n++)e.push(String.fromCharCode(n));return e}var TT=function(){function e(){this.sdfGeneratorCache={},this.textMetricsCache={},this.glyphAtlas=void 0,this.glyphMap={},this.glyphAtlasTexture=void 0}var n=e.prototype;return n.getMap=function(){return this.glyphMap},n.getAtlas=function(){return this.glyphAtlas},n.getAtlasTexture=function(){return this.glyphAtlasTexture},n.layout=function(t,r,a,o,s,u,l){var f=this,c=[],h=u,p=l,g=o==="right"||o==="end"?1:o==="left"||o==="start"?0:.5;return t.forEach(function(_){var E=c.length;Array.from(_).forEach(function(A){var M=f.glyphMap[r],x=A.charCodeAt(0),P=M&&M[x];P&&(c.push({glyph:x,x:h,y:p,scale:1,fontStack:r}),h+=P.metrics.advance+s)});for(var y=h-s,R=E;R<c.length;R++)c[R].x=c[R].x-g*y;h=0,p+=a}),c},n.generateAtlas=function(t,r,a,o,s,u,l){var f=this;r===void 0&&(r=""),s===void 0&&(s="");var c=[];this.glyphMap[r]||(c=yT());var h=Object.keys(this.glyphMap[r]||{});if(Array.from(new Set(u.split(""))).forEach(function(R){h.indexOf(R.charCodeAt(0).toString())===-1&&c.push(R)}),c.length){var p=c.map(function(R){return f.generateSDF(t,r,a,o,s,R)}).reduce(function(R,A){return R[A.id]=A,R},{});this.glyphMap[r]=Me({},this.glyphMap[r],p),this.glyphAtlas=new pT(this.glyphMap);var g=this.glyphAtlas.image,_=g.width,E=g.height,y=g.data;this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.glyphAtlasTexture=l.createTexture(Me({},dh(G.ALPHA,_,E,1),{pixelStore:{unpackFlipY:!1,unpackAlignment:1},immutable:!1})),this.glyphAtlasTexture.setImageData([y],0)}},n.generateSDF=function(t,r,a,o,s,u){r===void 0&&(r="");var l=u.charCodeAt(0),f=this.sdfGeneratorCache[r];f||(f=this.sdfGeneratorCache[r]=new tT({canvas:t,fontSize:gT,fontFamily:a,fontWeight:o,fontStyle:s,buffer:mT,radius:_T,cutoff:ET})),this.textMetricsCache[r]||(this.textMetricsCache[r]={}),this.textMetricsCache[r][u]||(this.textMetricsCache[r][u]=f.ctx.measureText(u).width);var c=f.draw(u),h=c.data,p=c.width,g=c.height,_=c.glyphWidth,E=c.glyphHeight,y=c.glyphLeft,R=c.glyphTop,A=c.glyphAdvance;return{id:l,bitmap:new Ls({width:p,height:g},h),metrics:{width:_,height:E,left:y,top:R-Tu+Ru,advance:A}}},e}();function RT(e,n){for(var i=[],t=0;t<e.length;t++){var r=e[t],a=n[r.fontStack],o=a&&a[r.glyph];if(o){var s=o.rect;if(s){var u=1,l=Ru+u,f=o.metrics.advance*r.scale/2,c=[0,0],h=[r.x+f,r.y],p=(o.metrics.left-l)*r.scale-f+h[0],g=(-o.metrics.top-l)*r.scale+h[1],_=p+s.w*r.scale,E=g+s.h*r.scale,y={x:p,y:g},R={x:_,y:g},A={x:p,y:E},M={x:_,y:E};i.push({tl:y,tr:R,bl:A,br:M,tex:s,glyphOffset:c})}}}return i}var eo;(function(e){e[e.INSTANCED=5]="INSTANCED",e[e.TEX=6]="TEX"})(eo||(eo={}));var Mi;(function(e){e[e.TEX=13]="TEX",e[e.OFFSET=14]="OFFSET"})(Mi||(Mi={}));var Fr;(function(e){e.SDF_MAP="u_SDFMap",e.SDF_MAP_SIZE="u_SDFMapSize",e.FONT_SIZE="u_FontSize",e.GAMMA_SCALE="u_GammaScale",e.STROKE_BLUR="u_StrokeBlur",e.HAS_STROKE="u_HasStroke"})(Fr||(Fr={}));var xf=function(e){$e(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.glyphManager=new TT,t}var i=n.prototype;return i.shouldMerge=function(r,a){var o=e.prototype.shouldMerge.call(this,r,a);if(!o||this.index!==a)return!1;var s=this.instance,u=["fontSize","fontFamily","fontWeight","textBaseline","letterSpacing"];return!(s.parsedStyle.metrics.font!==r.parsedStyle.metrics.font||u.some(function(l){return s.parsedStyle[l]!==r.parsedStyle[l]}))},i.createGeometry=function(r){var a=this,o=this.instance,s=o.parsedStyle,u=s.textBaseline,l=s.fontSize,f=s.letterSpacing,c=Tu/l,h=[],p=[],g=[],_=0;r.forEach(function(E){var y=E.parsedStyle,R=y.metrics,A=y.dx,M=y.dy,x=R.font,P=R.lines,C=R.height,O=R.lineHeight,D=A||0,F=M||0,k=0;u==="middle"?k=-C/2:u==="bottom"?k=-C:u==="top"||u==="hanging"?k=0:u==="alphabetic"?k=-C+O*.25:u==="ideographic"&&(k=-C);var d=a.glyphManager.getAtlas(),v=a.buildTextBuffers({object:E,lines:P,fontStack:x,lineHeight:c*O,offsetX:c*D,offsetY:c*(k+F),letterSpacing:c*f,glyphAtlas:d,indicesOffset:_}),m=v.indicesOffset,S=v.indexBuffer,T=v.charUVOffsetBuffer,N=v.charPackedBuffer;_=m,g.push.apply(g,N),p.push.apply(p,T),h.push.apply(h,S)}),this.geometry.vertexCount=h.length,this.geometry.setIndexBuffer(new Uint32Array(h)),this.geometry.setVertexBuffer({bufferIndex:eo.INSTANCED,byteStride:4*(4*4+4+4+4+4+4),frequency:be.PerVertex,attributes:[{format:G.F32_RGBA,bufferByteOffset:4*0,location:_e.MODEL_MATRIX0},{format:G.F32_RGBA,bufferByteOffset:4*4,location:_e.MODEL_MATRIX1},{format:G.F32_RGBA,bufferByteOffset:4*8,location:_e.MODEL_MATRIX2},{format:G.F32_RGBA,bufferByteOffset:4*12,location:_e.MODEL_MATRIX3},{format:G.F32_RGBA,bufferByteOffset:4*16,location:_e.COLOR},{format:G.F32_RGBA,bufferByteOffset:4*20,location:_e.STROKE_COLOR},{format:G.F32_RGBA,bufferByteOffset:4*24,location:_e.PACKED_STYLE1},{format:G.F32_RGBA,bufferByteOffset:4*28,location:_e.PACKED_STYLE2},{format:G.F32_RGBA,bufferByteOffset:4*32,location:_e.PICKING_COLOR}],data:new Float32Array(g)}),this.geometry.setVertexBuffer({bufferIndex:eo.TEX,byteStride:4*(2+2),frequency:be.PerVertex,attributes:[{format:G.F32_RG,bufferByteOffset:4*0,location:Mi.TEX},{format:G.F32_RG,bufferByteOffset:4*2,location:Mi.OFFSET}],data:new Float32Array(p)})},i.createMaterial=function(r){var a;this.material.vertexShader=hT,this.material.fragmentShader=cT,this.material.cullMode=hr.Back,this.material.defines=Me({},this.material.defines,Jn(Mi));var o=this.instance,s=o.parsedStyle,u=s.fontSize,l=s.fontFamily,f=l===void 0?"":l,c=s.fontWeight,h=c===void 0?"":c,p=s.fontStyle,g=s.metrics,_=g.font,E=r.map(function(P){return P.parsedStyle.text}).join("");this.glyphManager.generateAtlas(this.texturePool.context.config.offscreenCanvas,_,f,h.toString(),p,E,this.context.device);var y=this.glyphManager.getAtlasTexture(),R=this.glyphManager.getAtlas();this.context.device.setResourceName(y,"TextSDF Texture");var A=R.image,M=A.width,x=A.height;this.material.setUniforms((a={},a[Fr.SDF_MAP]=y,a[Fr.SDF_MAP_SIZE]=[M,x],a[Fr.FONT_SIZE]=u,a[Fr.GAMMA_SCALE]=1,a[Fr.STROKE_BLUR]=.2,a[Fr.HAS_STROKE]=this.index,a))},i.changeRenderOrder=function(r,a){this.material&&(this.material.programDirty=!0,this.material.geometryDirty=!0)},i.updateAttribute=function(r,a,o,s){o==="text"||o==="fontFamily"||o==="fontSize"||o==="fontWeight"||o==="fontStyle"||o==="fontVariant"||o==="textBaseline"||o==="letterSpacing"||o==="wordWrapWidth"||o==="lineHeight"||o==="wordWrap"||o==="textAlign"||o==="modelMatrix"||o==="visibility"||o==="dx"||o==="dy"?(this.material.programDirty=!0,this.material.geometryDirty=!0,this.material.textureDirty=!0):(o==="fill"||o==="fillOpacity"||o==="stroke"||o==="strokeOpacity"||o==="opacity"||o==="lineWidth"||o==="visibility"||o==="pointerEvents")&&(this.material.geometryDirty=!0)},i.buildTextBuffers=function(r){var a,o=r.object,s=r.lines,u=r.fontStack,l=r.lineHeight,f=r.letterSpacing,c=r.offsetX,h=r.offsetY,p=r.glyphAtlas,g=r.indicesOffset,_=o.parsedStyle,E=_.textAlign,y=_.fill,R=_.stroke,A=_.opacity,M=_.fillOpacity,x=_.strokeOpacity,P=_.lineWidth,C=_.visibility,O=[0,0,0,0];je(y)&&(O=[Number(y.r)/255,Number(y.g)/255,Number(y.b)/255,Number(y.alpha)]);var D=[0,0,0,0];je(R)&&(D=[Number(R.r)/255,Number(R.g)/255,Number(R.b)/255,Number(R.alpha)]);var F=o.isInteractive()&&((a=o.renderable3D)===null||a===void 0?void 0:a.encodedPickingColor)||[0,0,0],k=Ar(Te(),o.getWorldTransform()),d=[],v=[],m=[],S=g,T=this.glyphManager.layout(s,u,l,E,f,c,h),N=RT(T,p.positions);return N.forEach(function(B){var w=[];w.push.apply(w,k);var U=[].concat(w,O,D,[A,M,x,P,C==="visible"?1:0,0,0,0],F,[o.sortable.renderOrder*rn]);d.push.apply(d,U.concat(U,U,U)),v.push(B.tex.x,B.tex.y,B.tl.x,B.tl.y),v.push(B.tex.x+B.tex.w,B.tex.y,B.tr.x,B.tr.y),v.push(B.tex.x+B.tex.w,B.tex.y+B.tex.h,B.br.x,B.br.y),v.push(B.tex.x,B.tex.y+B.tex.h,B.bl.x,B.bl.y),m.push(0+S,2+S,1+S),m.push(2+S,0+S,3+S),S+=4}),{indexBuffer:m,charUVOffsetBuffer:v,charPackedBuffer:d,indicesOffset:S}},n}(Cn),ST=function(e){$e(n,e);function n(){return e.apply(this,arguments)||this}var i=n.prototype;return i.shouldMerge=function(r,a){var o=e.prototype.shouldMerge.call(this,r,a);return!(!o||this.instance.nodeName===H.MESH&&(this.instance.parsedStyle.material!==r.parsedStyle.material||this.instance.parsedStyle.geometry!==r.parsedStyle.geometry))},i.updateAttribute=function(r,a,o,s){e.prototype.updateAttribute.call(this,r,a,o,s),this.updateBatchedAttribute(r,a,o,s)},i.createMaterial=function(r){var a=this.instance.parsedStyle.material;this.material=a,this.observeMaterialChanged()},i.createGeometry=function(r){var a=this.instance.parsedStyle.geometry;this.geometry=a,e.prototype.createGeometry.call(this,r),this.geometry.build(r),this.observeGeometryChanged()},n}(Cn),AT=function(e){$e(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.meshes=[Nh,yu],t}var i=n.prototype;return i.shouldSubmitRenderInst=function(r,a){if(a===0){var o=r.parsedStyle.fill;if(o.isNone)return!1}return a===1?this.needDrawStrokeSeparately(r):!0},i.needDrawStrokeSeparately=function(r){var a=r.parsedStyle,o=a.fill,s=a.stroke,u=a.lineDash,l=a.lineWidth,f=a.strokeOpacity,c=o&&!o.isNone,h=s&&!s.isNone,p=u&&u.length&&u.every(function(g){return g!==0});return!c||h&&l>0&&(f<1||p)},n}(Mn),PT=function(e){$e(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.meshes=[sT,yu,Ih],t}var i=n.prototype;return i.shouldSubmitRenderInst=function(r,a){var o=r.parsedStyle,s=o.fill,u=o.stroke,l=o.opacity,f=o.strokeOpacity,c=o.lineDash,h=o.lineWidth,p=r.nodeName,g=u&&!u.isNone,_=c&&c.length&&c.every(function(y){return y!==0}),E=this.isLine(r);if(r.renderable.proxyNodeName=E?H.LINE:null,a===0&&(r.nodeName===H.POLYLINE||s.isNone))return!1;if(a===1){if(E||f===0||l===0||h===0||!g)return!1;if(p===H.CIRCLE||p===H.ELLIPSE)return _}return a===2?E:!0},i.isLine=function(r){if(r.nodeName===H.PATH){var a=r.parsedStyle.path.absolutePath;if(a.length===2&&a[0][0]==="M"&&a[1][0]==="L")return!0}else if(r.nodeName===H.POLYLINE){for(var o=r.parsedStyle.points.points,s=(o[1][0]-o[1][1])/(o[0][0]-o[0][1]),u=1;u<o.length-1;u++)if((o[u+1][0]-o[u+1][1])/(o[u][0]-o[u][1])!==s)return!1;return!0}return!1},n}(Mn),xT=function(e){$e(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.meshes=[fT],t}var i=n.prototype;return i.shouldSubmitRenderInst=function(r,a){return!0},n}(Mn),MT=function(e){$e(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.meshes=[xf,xf],t}var i=n.prototype;return i.shouldSubmitRenderInst=function(r,a){var o=r.parsedStyle,s=o.stroke,u=o.lineWidth,l=!!(s&&u);return!(!l&&a===0)},i.beforeUploadUBO=function(r,a,o){var s;a.material.setUniforms((s={},s[Fr.HAS_STROKE]=1-a.index,s))},n}(Mn),CT=function(e){$e(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.meshes=[Ih],t}var i=n.prototype;return i.shouldSubmitRenderInst=function(r,a){return!0},n}(Mn),OT=function(e){$e(n,e);function n(){for(var i,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r))||this,i.meshes=[ST],i}return n}(Mn),NT=function(e){$e(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.meshes=[Nh,yu],t}var i=n.prototype;return i.shouldSubmitRenderInst=function(r,a){if(a===0){var o=r.parsedStyle.fill;if(o.isNone)return!1}return a===1?this.needDrawStrokeSeparately(r):!0},i.needDrawStrokeSeparately=function(r){var a=r.parsedStyle,o=a.fill,s=a.stroke,u=a.lineDash,l=a.lineWidth,f=a.strokeOpacity,c=o&&!o.isNone,h=s&&!s.isNone,p=u&&u.length&&u.every(function(g){return g!==0});return!c||h&&l>0&&(f<1||p)},n}(Mn),IT=1,DT=function(){function e(i,t,r,a){this.renderHelper=void 0,this.rendererFactory=void 0,this.texturePool=void 0,this.lightPool=void 0,this.context=void 0,this.meshes=[],this.pendingUpdatePatches={},this.stencilRefCache={},this.renderHelper=i,this.rendererFactory=t,this.texturePool=r,this.lightPool=a}var n=e.prototype;return n.render=function(t,r){var a=this;r===void 0&&(r=!1),r||this.updatePendingPatches(),this.meshes.forEach(function(o){o.init(a.context);var s=o.objects;o.clipPathTarget&&(s=[o.clipPath]);var u=a.renderHelper.renderInstManager.newRenderInst();u.setAllowSkippingIfPipelineNotReady(!1),o.applyRenderInst(u,s),a.renderHelper.renderInstManager.submitRenderInst(u,t),r||o.objects.forEach(function(l){l.renderable.dirty=!1})})},n.attach=function(t){this.context=t},n.add=function(t){var r=this,a=t.renderable3D;if(a&&!a.meshes.length){var o=this.rendererFactory[t.nodeName];o&&o.meshes.forEach(function(s,u){a.meshes[u]=void 0;var l=o.shouldSubmitRenderInst(t,u);if(l){var f=r.meshes.find(function(c){return s===c.constructor&&c.index===u&&c.shouldMerge(t,u)});f||(f=new s(r.renderHelper,r.texturePool,r.lightPool),f.renderer=o,f.index=u,r.meshes.push(f)),f&&(f.objects.push(t),a.meshes[u]=f,f.geometryDirty=!0)}})}},n.remove=function(t){var r=this,a=t.renderable3D;a&&(a.meshes.forEach(function(o){if(o){var s=o.objects.indexOf(t);s>-1&&(o.objects.splice(s,1),o.geometryDirty=!0),o.objects.length===0&&r.meshes.splice(r.meshes.indexOf(o),1)}}),a.meshes=[])},n.updateAttribute=function(t,r,a,o){var s=this;o===void 0&&(o=!1);var u=t.renderable3D,l=this.rendererFactory[t.nodeName];l&&l.meshes.forEach(function(f,c){var h=l.shouldSubmitRenderInst(t,c),p=u.meshes.find(function(E){return E&&E.index===c&&E.constructor===f});if(h!==!!p&&(p&&(p.objects.splice(p.objects.indexOf(t),1),p.geometryDirty=!0,p.objects.length===0&&s.meshes.splice(s.meshes.indexOf(p),1),u.meshes[u.meshes.indexOf(p)]=void 0),h&&(p=s.meshes.find(function(E){return f===E.constructor&&E.index===c&&E.shouldMerge(t,c)}),p||(p=new f(s.renderHelper,s.texturePool,s.lightPool),p.renderer=l,p.index=c,p.init(s.context),s.meshes.push(p)),p&&(p.objects.push(t),u.meshes[c]=p))),h&&p&&p.inited&&!p.geometryDirty){var g=p.objects.indexOf(t);if(o)t.parsedStyle[r]=a,p.updateAttribute([t],g,r,a);else{var _=p.id+r;s.pendingUpdatePatches[_]||(s.pendingUpdatePatches[_]={instance:p,objectIndices:[],name:r,value:a}),s.pendingUpdatePatches[_].objectIndices.indexOf(g)===-1&&s.pendingUpdatePatches[_].objectIndices.push(g)}}})},n.changeRenderOrder=function(t,r){var a=t.renderable3D;a&&a.meshes.length&&a.meshes.forEach(function(o){if(o&&o.inited&&!o.geometryDirty){var s=o.renderer.shouldSubmitRenderInst(t,o.index);s&&o.inited&&o.changeRenderOrder(t,r)}})},n.getStencilRef=function(t){return this.stencilRefCache[t.entity]||(this.stencilRefCache[t.entity]=IT++),this.stencilRefCache[t.entity]},n.updatePendingPatches=function(){var t=this;Object.keys(this.pendingUpdatePatches).forEach(function(r){var a=t.pendingUpdatePatches[r],o=a.instance,s=a.objectIndices,u=a.name,l=a.value;s.sort(function(c,h){return c-h});var f=[];s.forEach(function(c){var h=f[f.length-1];!h||c!==h[h.length-1]+1?f.push([c]):h.push(c)}),f.forEach(function(c){o.updateAttribute(o.objects.slice(c[0],c[0]+c.length),c[0],u,l)})}),this.pendingUpdatePatches={}},e}(),bT=function(){function e(i){this.context=void 0,this.textureCache={},this.context=i}var n=e.prototype;return n.getOrCreateTexture=function(t,r,a,o){var s=this,u=typeof r=="string"?r:r.src||"",l;if(!u||!this.textureCache[u])if(l=t.createTexture(Me({pixelFormat:G.U8_RGBA_NORM,width:1,height:1,depth:1,numLevels:1,dimension:et.n2D,usage:sn.Sampled,pixelStore:{unpackFlipY:!1},immutable:!1},a)),u&&(this.textureCache[u]=l),!vt(r))l.setImageData(r),l.emit(Yn.LOADED),this.context.renderingService.dirtify();else{var f=this.context.config.createImage,c;f?c=f(r):ei&&(c=new window.Image),c&&(c.onload=function(){s.textureCache[u].setImageData(c),s.textureCache[u].emit(Yn.LOADED),s.context.renderingService.dirtify(),o&&o(s.textureCache[u])},c.onerror=function(){},c.crossOrigin="Anonymous",c.src=r)}else l=this.textureCache[u],l.emit(Yn.LOADED);return l},n.getOrCreateCanvas=function(){return X.offscreenCanvas.getOrCreateCanvas(this.context.config.offscreenCanvas)},n.getOrCreateGradient=function(t){var r=t.instance,a=t.gradients,o=r.getGeometryBounds(),s=o.halfExtents,u=s[0]*2||1,l=s[1]*2||1,f=this.context.config.offscreenCanvas,c=X.offscreenCanvas.getOrCreateCanvas(f),h=X.offscreenCanvas.getOrCreateContext(f);c.width=u,c.height=l;var p=this.context.imagePool;a.forEach(function(g){var _=p.getOrCreateGradient(Me({type:g.type},g.value,{width:u,height:l}),h);h.fillStyle=_,h.fillRect(0,0,u,l)})},n.getOrCreatePattern=function(t,r,a){var o=t.image,s=t.repetition,u=t.transform,l=r.getGeometryBounds(),f=l.halfExtents,c=f[0]*2||1,h=f[1]*2||1,p=this.context.config.offscreenCanvas,g=X.offscreenCanvas.getOrCreateCanvas(p),_=X.offscreenCanvas.getOrCreateContext(p);g.width=c,g.height=h;var E;vt(o)?E=this.context.imagePool.getImageSync(o,a):E=o;var y=E&&_.createPattern(E,s);if(u){var R=so(Ii(u));y.setTransform({a:R[0],b:R[1],c:R[4],d:R[5],e:R[12],f:R[13]})}_.fillStyle=y,_.fillRect(0,0,c,h)},n.destroy=function(){for(var t in this.textureCache)this.textureCache[t].destroy();this.textureCache={}},e}(),wT=`#define GLSLIFY 1
layout(location = 0) in vec2 a_Position;

out vec2 v_TexCoord;

void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`,BT=`#define GLSLIFY 1
uniform sampler2D u_Texture;
in vec2 v_TexCoord;

out vec4 outputColor;

void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`,FT=function(e){$e(n,e);function n(){for(var i,t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];return i=e.call.apply(e,[this].concat(r))||this,i.vert=wT,i.frag=BT,i.features={},i}return n}(Rh);Ga(1,function(){return new Ds});var UT=function(e){$e(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.name="device-renderer",t}var i=n.prototype;return i.init=function(r){var a;r.geometryUpdaterFactory[H.MESH]=new hE;var o=new Iy,s=new lE,u=new bT(this.context),l=new dE,f=new AT,c=new PT,h=(a={},a[H.CIRCLE]=f,a[H.ELLIPSE]=f,a[H.POLYLINE]=c,a[H.PATH]=c,a[H.POLYGON]=c,a[H.RECT]=new NT,a[H.IMAGE]=new xT,a[H.LINE]=new CT,a[H.TEXT]=new MT,a[H.MESH]=new OT,a[H.GROUP]=void 0,a[H.HTML]=void 0,a),p=new DT(o,h,u,s),g=new xh(o,s,u,p);this.addRenderingPlugin(g),this.addRenderingPlugin(new Mh(o,g,l,p))},i.destroy=function(r){delete r.geometryUpdaterFactory[H.MESH]},i.getRenderGraphPlugin=function(){return this.plugins[0]},i.getDevice=function(){return this.getRenderGraphPlugin().getDevice()},i.loadTexture=function(r,a,o){return this.getRenderGraphPlugin().loadTexture(r,a,o)},i.toDataURL=function(r){return this.getRenderGraphPlugin().toDataURL(r)},n}(un);function Ws(){Ws=function(){return e};var e={},n=Object.prototype,i=n.hasOwnProperty,t=Object.defineProperty||function(d,v,m){d[v]=m.value},r=typeof Symbol=="function"?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(d,v,m){return Object.defineProperty(d,v,{value:m,enumerable:!0,configurable:!0,writable:!0}),d[v]}try{u({},"")}catch{u=function(v,m,S){return v[m]=S}}function l(d,v,m,S){var T=v&&v.prototype instanceof h?v:h,N=Object.create(T.prototype),B=new D(S||[]);return t(N,"_invoke",{value:x(d,m,B)}),N}function f(d,v,m){try{return{type:"normal",arg:d.call(v,m)}}catch(S){return{type:"throw",arg:S}}}e.wrap=l;var c={};function h(){}function p(){}function g(){}var _={};u(_,a,function(){return this});var E=Object.getPrototypeOf,y=E&&E(E(F([])));y&&y!==n&&i.call(y,a)&&(_=y);var R=g.prototype=h.prototype=Object.create(_);function A(d){["next","throw","return"].forEach(function(v){u(d,v,function(m){return this._invoke(v,m)})})}function M(d,v){function m(T,N,B,w){var U=f(d[T],d,N);if(U.type!=="throw"){var V=U.arg,K=V.value;return K&&typeof K=="object"&&i.call(K,"__await")?v.resolve(K.__await).then(function(z){m("next",z,B,w)},function(z){m("throw",z,B,w)}):v.resolve(K).then(function(z){V.value=z,B(V)},function(z){return m("throw",z,B,w)})}w(U.arg)}var S;t(this,"_invoke",{value:function(T,N){function B(){return new v(function(w,U){m(T,N,w,U)})}return S=S?S.then(B,B):B()}})}function x(d,v,m){var S="suspendedStart";return function(T,N){if(S==="executing")throw new Error("Generator is already running");if(S==="completed"){if(T==="throw")throw N;return k()}for(m.method=T,m.arg=N;;){var B=m.delegate;if(B){var w=P(B,m);if(w){if(w===c)continue;return w}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(S==="suspendedStart")throw S="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);S="executing";var U=f(d,v,m);if(U.type==="normal"){if(S=m.done?"completed":"suspendedYield",U.arg===c)continue;return{value:U.arg,done:m.done}}U.type==="throw"&&(S="completed",m.method="throw",m.arg=U.arg)}}}function P(d,v){var m=v.method,S=d.iterator[m];if(S===void 0)return v.delegate=null,m==="throw"&&d.iterator.return&&(v.method="return",v.arg=void 0,P(d,v),v.method==="throw")||m!=="return"&&(v.method="throw",v.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var T=f(S,d.iterator,v.arg);if(T.type==="throw")return v.method="throw",v.arg=T.arg,v.delegate=null,c;var N=T.arg;return N?N.done?(v[d.resultName]=N.value,v.next=d.nextLoc,v.method!=="return"&&(v.method="next",v.arg=void 0),v.delegate=null,c):N:(v.method="throw",v.arg=new TypeError("iterator result is not an object"),v.delegate=null,c)}function C(d){var v={tryLoc:d[0]};1 in d&&(v.catchLoc=d[1]),2 in d&&(v.finallyLoc=d[2],v.afterLoc=d[3]),this.tryEntries.push(v)}function O(d){var v=d.completion||{};v.type="normal",delete v.arg,d.completion=v}function D(d){this.tryEntries=[{tryLoc:"root"}],d.forEach(C,this),this.reset(!0)}function F(d){if(d){var v=d[a];if(v)return v.call(d);if(typeof d.next=="function")return d;if(!isNaN(d.length)){var m=-1,S=function T(){for(;++m<d.length;)if(i.call(d,m))return T.value=d[m],T.done=!1,T;return T.value=void 0,T.done=!0,T};return S.next=S}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=g,t(R,"constructor",{value:g,configurable:!0}),t(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(d){var v=typeof d=="function"&&d.constructor;return!!v&&(v===p||(v.displayName||v.name)==="GeneratorFunction")},e.mark=function(d){return Object.setPrototypeOf?Object.setPrototypeOf(d,g):(d.__proto__=g,u(d,s,"GeneratorFunction")),d.prototype=Object.create(R),d},e.awrap=function(d){return{__await:d}},A(M.prototype),u(M.prototype,o,function(){return this}),e.AsyncIterator=M,e.async=function(d,v,m,S,T){T===void 0&&(T=Promise);var N=new M(l(d,v,m,S),T);return e.isGeneratorFunction(v)?N:N.next().then(function(B){return B.done?B.value:N.next()})},A(R),u(R,s,"Generator"),u(R,a,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),e.keys=function(d){var v=Object(d),m=[];for(var S in v)m.push(S);return m.reverse(),function T(){for(;m.length;){var N=m.pop();if(N in v)return T.value=N,T.done=!1,T}return T.done=!0,T}},e.values=F,D.prototype={constructor:D,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!d)for(var v in this)v.charAt(0)==="t"&&i.call(this,v)&&!isNaN(+v.slice(1))&&(this[v]=void 0)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var v=this;function m(U,V){return N.type="throw",N.arg=d,v.next=U,V&&(v.method="next",v.arg=void 0),!!V}for(var S=this.tryEntries.length-1;S>=0;--S){var T=this.tryEntries[S],N=T.completion;if(T.tryLoc==="root")return m("end");if(T.tryLoc<=this.prev){var B=i.call(T,"catchLoc"),w=i.call(T,"finallyLoc");if(B&&w){if(this.prev<T.catchLoc)return m(T.catchLoc,!0);if(this.prev<T.finallyLoc)return m(T.finallyLoc)}else if(B){if(this.prev<T.catchLoc)return m(T.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return m(T.finallyLoc)}}}},abrupt:function(d,v){for(var m=this.tryEntries.length-1;m>=0;--m){var S=this.tryEntries[m];if(S.tryLoc<=this.prev&&i.call(S,"finallyLoc")&&this.prev<S.finallyLoc){var T=S;break}}T&&(d==="break"||d==="continue")&&T.tryLoc<=v&&v<=T.finallyLoc&&(T=null);var N=T?T.completion:{};return N.type=d,N.arg=v,T?(this.method="next",this.next=T.finallyLoc,c):this.complete(N)},complete:function(d,v){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&v&&(this.next=v),c},finish:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.finallyLoc===d)return this.complete(m.completion,m.afterLoc),O(m),c}},catch:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.tryLoc===d){var S=m.completion;if(S.type==="throw"){var T=S.arg;O(m)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(d,v,m){return this.delegate={iterator:F(d),resultName:v,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},e}function Mf(e,n,i,t,r,a,o){try{var s=e[a](o),u=s.value}catch(l){i(l);return}s.done?n(u):Promise.resolve(u).then(t,r)}function kT(e){return function(){var n=this,i=arguments;return new Promise(function(t,r){var a=e.apply(n,i);function o(u){Mf(a,t,r,o,s,"next",u)}function s(u){Mf(a,t,r,o,s,"throw",u)}o(void 0)})}}function LT(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,Hs(e,n)}function Hs(e,n){return Hs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Hs(e,n)}var Xh=function(){function e(){this.context=void 0}var n=e.prototype;return n.apply=function(t,r){var a=this,o=t.renderingService,s=t.renderingContext,u=t.config;this.context=t;var l=s.root.ownerDocument.defaultView,f=function(D){o.hooks.pointerMove.call(D)},c=function(D){o.hooks.pointerUp.call(D)},h=function(D){o.hooks.pointerDown.call(D)},p=function(D){o.hooks.pointerOver.call(D)},g=function(D){o.hooks.pointerOut.call(D)},_=function(D){o.hooks.pointerCancel.call(D)},E=function(D){o.hooks.pointerWheel.call(D)},y=function(D){o.hooks.click.call(D)},R=function(D){r.globalThis.document.addEventListener("pointermove",f,!0),D.addEventListener("pointerdown",h,!0),D.addEventListener("pointerleave",g,!0),D.addEventListener("pointerover",p,!0),r.globalThis.addEventListener("pointerup",c,!0)},A=function(D){D.addEventListener("touchstart",h,!0),D.addEventListener("touchend",c,!0),D.addEventListener("touchmove",f,!0),D.addEventListener("touchcancel",_,!0)},M=function(D){r.globalThis.document.addEventListener("mousemove",f,!0),D.addEventListener("mousedown",h,!0),D.addEventListener("mouseout",g,!0),D.addEventListener("mouseover",p,!0),r.globalThis.addEventListener("mouseup",c,!0)},x=function(D){r.globalThis.document.removeEventListener("pointermove",f,!0),D.removeEventListener("pointerdown",h,!0),D.removeEventListener("pointerleave",g,!0),D.removeEventListener("pointerover",p,!0),r.globalThis.removeEventListener("pointerup",c,!0)},P=function(D){D.removeEventListener("touchstart",h,!0),D.removeEventListener("touchend",c,!0),D.removeEventListener("touchmove",f,!0),D.removeEventListener("touchcancel",_,!0)},C=function(D){r.globalThis.document.removeEventListener("mousemove",f,!0),D.removeEventListener("mousedown",h,!0),D.removeEventListener("mouseout",g,!0),D.removeEventListener("mouseover",p,!0),r.globalThis.removeEventListener("mouseup",c,!0)};o.hooks.init.tapPromise(e.tag,kT(Ws().mark(function O(){var D;return Ws().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:D=a.context.contextService.getDomElement(),r.globalThis.navigator.msPointerEnabled?(D.style.msContentZooming="none",D.style.msTouchAction="none"):l.supportsPointerEvents&&(D.style.touchAction="none"),l.supportsPointerEvents?R(D):M(D),l.supportsTouchEvents&&A(D),u.useNativeClickEvent&&D.addEventListener("click",y,!0),D.addEventListener("wheel",E,{passive:!0,capture:!0});case 6:case"end":return k.stop()}},O)}))),o.hooks.destroy.tap(e.tag,function(){var O=a.context.contextService.getDomElement();r.globalThis.navigator.msPointerEnabled?(O.style.msContentZooming="",O.style.msTouchAction=""):l.supportsPointerEvents&&(O.style.touchAction=""),l.supportsPointerEvents?x(O):C(O),l.supportsTouchEvents&&P(O),u.useNativeClickEvent&&O.removeEventListener("click",y,!0),O.removeEventListener("wheel",E,!0)})},e}();Xh.tag="DOMInteraction";var WT=function(e){LT(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.name="dom-interaction",t}var i=n.prototype;return i.init=function(){this.addRenderingPlugin(new Xh)},i.destroy=function(){this.removeAllRenderingPlugins()},n}(un);function Xs(){Xs=function(){return e};var e={},n=Object.prototype,i=n.hasOwnProperty,t=Object.defineProperty||function(d,v,m){d[v]=m.value},r=typeof Symbol=="function"?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(d,v,m){return Object.defineProperty(d,v,{value:m,enumerable:!0,configurable:!0,writable:!0}),d[v]}try{u({},"")}catch{u=function(v,m,S){return v[m]=S}}function l(d,v,m,S){var T=v&&v.prototype instanceof h?v:h,N=Object.create(T.prototype),B=new D(S||[]);return t(N,"_invoke",{value:x(d,m,B)}),N}function f(d,v,m){try{return{type:"normal",arg:d.call(v,m)}}catch(S){return{type:"throw",arg:S}}}e.wrap=l;var c={};function h(){}function p(){}function g(){}var _={};u(_,a,function(){return this});var E=Object.getPrototypeOf,y=E&&E(E(F([])));y&&y!==n&&i.call(y,a)&&(_=y);var R=g.prototype=h.prototype=Object.create(_);function A(d){["next","throw","return"].forEach(function(v){u(d,v,function(m){return this._invoke(v,m)})})}function M(d,v){function m(T,N,B,w){var U=f(d[T],d,N);if(U.type!=="throw"){var V=U.arg,K=V.value;return K&&typeof K=="object"&&i.call(K,"__await")?v.resolve(K.__await).then(function(z){m("next",z,B,w)},function(z){m("throw",z,B,w)}):v.resolve(K).then(function(z){V.value=z,B(V)},function(z){return m("throw",z,B,w)})}w(U.arg)}var S;t(this,"_invoke",{value:function(T,N){function B(){return new v(function(w,U){m(T,N,w,U)})}return S=S?S.then(B,B):B()}})}function x(d,v,m){var S="suspendedStart";return function(T,N){if(S==="executing")throw new Error("Generator is already running");if(S==="completed"){if(T==="throw")throw N;return k()}for(m.method=T,m.arg=N;;){var B=m.delegate;if(B){var w=P(B,m);if(w){if(w===c)continue;return w}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(S==="suspendedStart")throw S="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);S="executing";var U=f(d,v,m);if(U.type==="normal"){if(S=m.done?"completed":"suspendedYield",U.arg===c)continue;return{value:U.arg,done:m.done}}U.type==="throw"&&(S="completed",m.method="throw",m.arg=U.arg)}}}function P(d,v){var m=v.method,S=d.iterator[m];if(S===void 0)return v.delegate=null,m==="throw"&&d.iterator.return&&(v.method="return",v.arg=void 0,P(d,v),v.method==="throw")||m!=="return"&&(v.method="throw",v.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var T=f(S,d.iterator,v.arg);if(T.type==="throw")return v.method="throw",v.arg=T.arg,v.delegate=null,c;var N=T.arg;return N?N.done?(v[d.resultName]=N.value,v.next=d.nextLoc,v.method!=="return"&&(v.method="next",v.arg=void 0),v.delegate=null,c):N:(v.method="throw",v.arg=new TypeError("iterator result is not an object"),v.delegate=null,c)}function C(d){var v={tryLoc:d[0]};1 in d&&(v.catchLoc=d[1]),2 in d&&(v.finallyLoc=d[2],v.afterLoc=d[3]),this.tryEntries.push(v)}function O(d){var v=d.completion||{};v.type="normal",delete v.arg,d.completion=v}function D(d){this.tryEntries=[{tryLoc:"root"}],d.forEach(C,this),this.reset(!0)}function F(d){if(d){var v=d[a];if(v)return v.call(d);if(typeof d.next=="function")return d;if(!isNaN(d.length)){var m=-1,S=function T(){for(;++m<d.length;)if(i.call(d,m))return T.value=d[m],T.done=!1,T;return T.value=void 0,T.done=!0,T};return S.next=S}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=g,t(R,"constructor",{value:g,configurable:!0}),t(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(d){var v=typeof d=="function"&&d.constructor;return!!v&&(v===p||(v.displayName||v.name)==="GeneratorFunction")},e.mark=function(d){return Object.setPrototypeOf?Object.setPrototypeOf(d,g):(d.__proto__=g,u(d,s,"GeneratorFunction")),d.prototype=Object.create(R),d},e.awrap=function(d){return{__await:d}},A(M.prototype),u(M.prototype,o,function(){return this}),e.AsyncIterator=M,e.async=function(d,v,m,S,T){T===void 0&&(T=Promise);var N=new M(l(d,v,m,S),T);return e.isGeneratorFunction(v)?N:N.next().then(function(B){return B.done?B.value:N.next()})},A(R),u(R,s,"Generator"),u(R,a,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),e.keys=function(d){var v=Object(d),m=[];for(var S in v)m.push(S);return m.reverse(),function T(){for(;m.length;){var N=m.pop();if(N in v)return T.value=N,T.done=!1,T}return T.done=!0,T}},e.values=F,D.prototype={constructor:D,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!d)for(var v in this)v.charAt(0)==="t"&&i.call(this,v)&&!isNaN(+v.slice(1))&&(this[v]=void 0)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var v=this;function m(U,V){return N.type="throw",N.arg=d,v.next=U,V&&(v.method="next",v.arg=void 0),!!V}for(var S=this.tryEntries.length-1;S>=0;--S){var T=this.tryEntries[S],N=T.completion;if(T.tryLoc==="root")return m("end");if(T.tryLoc<=this.prev){var B=i.call(T,"catchLoc"),w=i.call(T,"finallyLoc");if(B&&w){if(this.prev<T.catchLoc)return m(T.catchLoc,!0);if(this.prev<T.finallyLoc)return m(T.finallyLoc)}else if(B){if(this.prev<T.catchLoc)return m(T.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return m(T.finallyLoc)}}}},abrupt:function(d,v){for(var m=this.tryEntries.length-1;m>=0;--m){var S=this.tryEntries[m];if(S.tryLoc<=this.prev&&i.call(S,"finallyLoc")&&this.prev<S.finallyLoc){var T=S;break}}T&&(d==="break"||d==="continue")&&T.tryLoc<=v&&v<=T.finallyLoc&&(T=null);var N=T?T.completion:{};return N.type=d,N.arg=v,T?(this.method="next",this.next=T.finallyLoc,c):this.complete(N)},complete:function(d,v){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&v&&(this.next=v),c},finish:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.finallyLoc===d)return this.complete(m.completion,m.afterLoc),O(m),c}},catch:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.tryLoc===d){var S=m.completion;if(S.type==="throw"){var T=S.arg;O(m)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(d,v,m){return this.delegate={iterator:F(d),resultName:v,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},e}function Cf(e,n,i,t,r,a,o){try{var s=e[a](o),u=s.value}catch(l){i(l);return}s.done?n(u):Promise.resolve(u).then(t,r)}function HT(e){return function(){var n=this,i=arguments;return new Promise(function(t,r){var a=e.apply(n,i);function o(u){Cf(a,t,r,o,s,"next",u)}function s(u){Cf(a,t,r,o,s,"throw",u)}o(void 0)})}}function XT(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,Vs(e,n)}function Vs(e,n){return Vs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Vs(e,n)}var VT="g-html-",YT="g-canvas-camera",Vh=function(){function e(){this.context=void 0,this.$camera=void 0}var n=e.prototype;return n.joinTransformMatrix=function(t){return"matrix("+[t[0],t[1],t[4],t[5],t[12],t[13]].join(",")+")"},n.apply=function(t){var r=this,a=t.camera,o=t.renderingContext,s=t.renderingService;this.context=t;var u=o.root.ownerDocument.defaultView,l=function(E,y){y.style.transform=r.joinTransformMatrix(E.getWorldTransform())},f=function(E){var y=E.target;if(y.nodeName===H.HTML){r.$camera||(r.$camera=r.createCamera(a));var R=r.getOrCreateEl(y);r.$camera.appendChild(R);var A=y.ownerDocument.documentElement.attributes;Object.keys(A).forEach(function(M){R.style[M]=A[M]}),Object.keys(y.attributes).forEach(function(M){r.updateAttribute(M,y)}),l(y,R),X.nativeHTMLMap.set(R,y)}},c=function(E){var y=E.target;if(y.nodeName===H.HTML&&r.$camera){var R=r.getOrCreateEl(y);R&&(R.remove(),X.nativeHTMLMap.delete(R))}},h=function(E){var y=E.target;if(y.nodeName===H.HTML){var R=E.attrName;r.updateAttribute(R,y)}},p=function(E){var y=E.target;if(y.nodeName===H.HTML){var R=r.getOrCreateEl(y);l(y,R)}},g=function(){if(r.$camera){var E=r.context.config,y=E.width,R=E.height;r.$camera.style.width=(y||0)+"px",r.$camera.style.height=(R||0)+"px"}};s.hooks.init.tapPromise(e.tag,HT(Xs().mark(function _(){return Xs().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:u.addEventListener(ar.RESIZE,g),u.addEventListener(fe.MOUNTED,f),u.addEventListener(fe.UNMOUNTED,c),u.addEventListener(fe.ATTR_MODIFIED,h),u.addEventListener(fe.BOUNDS_CHANGED,p);case 5:case"end":return y.stop()}},_)}))),s.hooks.endFrame.tap(e.tag,function(){r.$camera&&o.renderReasons.has(qn.CAMERA_CHANGED)&&(r.$camera.style.transform=r.joinTransformMatrix(a.getOrthoMatrix()))}),s.hooks.destroy.tap(e.tag,function(){r.$camera&&r.$camera.remove(),u.removeEventListener(ar.RESIZE,g),u.removeEventListener(fe.MOUNTED,f),u.removeEventListener(fe.UNMOUNTED,c),u.removeEventListener(fe.ATTR_MODIFIED,h),u.removeEventListener(fe.BOUNDS_CHANGED,p)})},n.getId=function(t){return t.id||VT+t.entity},n.createCamera=function(t){var r=this.context.config,a=r.document,o=r.width,s=r.height,u=this.context.contextService.getDomElement(),l=u.parentNode;if(l){var f=YT,c=l.querySelector("#"+f);if(!c){var h=(a||document).createElement("div");c=h,h.id=f,h.style.position="absolute",h.style.left=(u.offsetLeft||0)+"px",h.style.top=(u.offsetTop||0)+"px",h.style.transformOrigin="left top",h.style.transform=this.joinTransformMatrix(t.getOrthoMatrix()),h.style.overflow="hidden",h.style.pointerEvents="none",h.style.width=(o||0)+"px",h.style.height=(s||0)+"px",l.appendChild(h)}return c}return null},n.getOrCreateEl=function(t){var r=this.context.config.document,a=this.getId(t),o=this.$camera.querySelector("#"+a);return o||(o=(r||document).createElement("div"),t.parsedStyle.$el=o,o.id=a,t.name&&o.setAttribute("name",t.name),t.className&&(o.className=t.className),o.style.position="absolute",o.style.left="0px",o.style.top="0px",o.style["will-change"]="transform",o.style.transform=this.joinTransformMatrix(t.getWorldTransform())),o},n.updateAttribute=function(t,r){var a=this.getOrCreateEl(r);switch(t){case"innerHTML":var o=r.parsedStyle.innerHTML;vt(o)?a.innerHTML=o:(a.innerHTML="",a.appendChild(o));break;case"transformOrigin":var s=r.parsedStyle.transformOrigin;a.style["transform-origin"]=s[0].value+" "+s[1].value;break;case"width":if(X.enableCSSParsing){var u=r.computedStyleMap().get("width");a.style.width=u.toString()}else{var l=r.parsedStyle.width;a.style.width=Ut(l)?l+"px":l.toString()}break;case"height":if(X.enableCSSParsing){var f=r.computedStyleMap().get("height");a.style.height=f.toString()}else{var c=r.parsedStyle.height;a.style.height=Ut(c)?c+"px":c.toString()}break;case"zIndex":var h=r.parsedStyle.zIndex;a.style["z-index"]=""+h;break;case"visibility":var p=r.parsedStyle.visibility;a.style.visibility=p;break;case"pointerEvents":var g=r.parsedStyle.pointerEvents;a.style.pointerEvents=g;break;case"opacity":var _=r.parsedStyle.opacity;a.style.opacity=""+_;break;case"fill":var E=r.parsedStyle.fill,y="";je(E)?E.isNone?y="transparent":y=r.getAttribute("fill"):Array.isArray(E)?y=r.getAttribute("fill"):mn(E),a.style.background=y;break;case"stroke":var R=r.parsedStyle.stroke,A="";je(R)?R.isNone?A="transparent":A=r.getAttribute("stroke"):Array.isArray(R)?A=r.getAttribute("stroke"):mn(R),a.style["border-color"]=A,a.style["border-style"]="solid";break;case"lineWidth":var M=r.parsedStyle.lineWidth;a.style["border-width"]=(M||0)+"px";break;case"lineDash":a.style["border-style"]="dashed";break;case"filter":var x=r.style.filter;a.style.filter=x;break}},e}();Vh.tag="HTMLRendering";var zT=function(e){XT(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.name="html-renderer",t}var i=n.prototype;return i.init=function(){this.addRenderingPlugin(new Vh)},i.destroy=function(){this.removeAllRenderingPlugins()},n}(un);function Ys(){Ys=function(){return e};var e={},n=Object.prototype,i=n.hasOwnProperty,t=Object.defineProperty||function(d,v,m){d[v]=m.value},r=typeof Symbol=="function"?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(d,v,m){return Object.defineProperty(d,v,{value:m,enumerable:!0,configurable:!0,writable:!0}),d[v]}try{u({},"")}catch{u=function(v,m,S){return v[m]=S}}function l(d,v,m,S){var T=v&&v.prototype instanceof h?v:h,N=Object.create(T.prototype),B=new D(S||[]);return t(N,"_invoke",{value:x(d,m,B)}),N}function f(d,v,m){try{return{type:"normal",arg:d.call(v,m)}}catch(S){return{type:"throw",arg:S}}}e.wrap=l;var c={};function h(){}function p(){}function g(){}var _={};u(_,a,function(){return this});var E=Object.getPrototypeOf,y=E&&E(E(F([])));y&&y!==n&&i.call(y,a)&&(_=y);var R=g.prototype=h.prototype=Object.create(_);function A(d){["next","throw","return"].forEach(function(v){u(d,v,function(m){return this._invoke(v,m)})})}function M(d,v){function m(T,N,B,w){var U=f(d[T],d,N);if(U.type!=="throw"){var V=U.arg,K=V.value;return K&&typeof K=="object"&&i.call(K,"__await")?v.resolve(K.__await).then(function(z){m("next",z,B,w)},function(z){m("throw",z,B,w)}):v.resolve(K).then(function(z){V.value=z,B(V)},function(z){return m("throw",z,B,w)})}w(U.arg)}var S;t(this,"_invoke",{value:function(T,N){function B(){return new v(function(w,U){m(T,N,w,U)})}return S=S?S.then(B,B):B()}})}function x(d,v,m){var S="suspendedStart";return function(T,N){if(S==="executing")throw new Error("Generator is already running");if(S==="completed"){if(T==="throw")throw N;return k()}for(m.method=T,m.arg=N;;){var B=m.delegate;if(B){var w=P(B,m);if(w){if(w===c)continue;return w}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(S==="suspendedStart")throw S="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);S="executing";var U=f(d,v,m);if(U.type==="normal"){if(S=m.done?"completed":"suspendedYield",U.arg===c)continue;return{value:U.arg,done:m.done}}U.type==="throw"&&(S="completed",m.method="throw",m.arg=U.arg)}}}function P(d,v){var m=v.method,S=d.iterator[m];if(S===void 0)return v.delegate=null,m==="throw"&&d.iterator.return&&(v.method="return",v.arg=void 0,P(d,v),v.method==="throw")||m!=="return"&&(v.method="throw",v.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var T=f(S,d.iterator,v.arg);if(T.type==="throw")return v.method="throw",v.arg=T.arg,v.delegate=null,c;var N=T.arg;return N?N.done?(v[d.resultName]=N.value,v.next=d.nextLoc,v.method!=="return"&&(v.method="next",v.arg=void 0),v.delegate=null,c):N:(v.method="throw",v.arg=new TypeError("iterator result is not an object"),v.delegate=null,c)}function C(d){var v={tryLoc:d[0]};1 in d&&(v.catchLoc=d[1]),2 in d&&(v.finallyLoc=d[2],v.afterLoc=d[3]),this.tryEntries.push(v)}function O(d){var v=d.completion||{};v.type="normal",delete v.arg,d.completion=v}function D(d){this.tryEntries=[{tryLoc:"root"}],d.forEach(C,this),this.reset(!0)}function F(d){if(d){var v=d[a];if(v)return v.call(d);if(typeof d.next=="function")return d;if(!isNaN(d.length)){var m=-1,S=function T(){for(;++m<d.length;)if(i.call(d,m))return T.value=d[m],T.done=!1,T;return T.value=void 0,T.done=!0,T};return S.next=S}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=g,t(R,"constructor",{value:g,configurable:!0}),t(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(d){var v=typeof d=="function"&&d.constructor;return!!v&&(v===p||(v.displayName||v.name)==="GeneratorFunction")},e.mark=function(d){return Object.setPrototypeOf?Object.setPrototypeOf(d,g):(d.__proto__=g,u(d,s,"GeneratorFunction")),d.prototype=Object.create(R),d},e.awrap=function(d){return{__await:d}},A(M.prototype),u(M.prototype,o,function(){return this}),e.AsyncIterator=M,e.async=function(d,v,m,S,T){T===void 0&&(T=Promise);var N=new M(l(d,v,m,S),T);return e.isGeneratorFunction(v)?N:N.next().then(function(B){return B.done?B.value:N.next()})},A(R),u(R,s,"Generator"),u(R,a,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),e.keys=function(d){var v=Object(d),m=[];for(var S in v)m.push(S);return m.reverse(),function T(){for(;m.length;){var N=m.pop();if(N in v)return T.value=N,T.done=!1,T}return T.done=!0,T}},e.values=F,D.prototype={constructor:D,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!d)for(var v in this)v.charAt(0)==="t"&&i.call(this,v)&&!isNaN(+v.slice(1))&&(this[v]=void 0)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var v=this;function m(U,V){return N.type="throw",N.arg=d,v.next=U,V&&(v.method="next",v.arg=void 0),!!V}for(var S=this.tryEntries.length-1;S>=0;--S){var T=this.tryEntries[S],N=T.completion;if(T.tryLoc==="root")return m("end");if(T.tryLoc<=this.prev){var B=i.call(T,"catchLoc"),w=i.call(T,"finallyLoc");if(B&&w){if(this.prev<T.catchLoc)return m(T.catchLoc,!0);if(this.prev<T.finallyLoc)return m(T.finallyLoc)}else if(B){if(this.prev<T.catchLoc)return m(T.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return m(T.finallyLoc)}}}},abrupt:function(d,v){for(var m=this.tryEntries.length-1;m>=0;--m){var S=this.tryEntries[m];if(S.tryLoc<=this.prev&&i.call(S,"finallyLoc")&&this.prev<S.finallyLoc){var T=S;break}}T&&(d==="break"||d==="continue")&&T.tryLoc<=v&&v<=T.finallyLoc&&(T=null);var N=T?T.completion:{};return N.type=d,N.arg=v,T?(this.method="next",this.next=T.finallyLoc,c):this.complete(N)},complete:function(d,v){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&v&&(this.next=v),c},finish:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.finallyLoc===d)return this.complete(m.completion,m.afterLoc),O(m),c}},catch:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.tryLoc===d){var S=m.completion;if(S.type==="throw"){var T=S.arg;O(m)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(d,v,m){return this.delegate={iterator:F(d),resultName:v,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},e}function Of(e,n,i,t,r,a,o){try{var s=e[a](o),u=s.value}catch(l){i(l);return}s.done?n(u):Promise.resolve(u).then(t,r)}function GT(e){return function(){var n=this,i=arguments;return new Promise(function(t,r){var a=e.apply(n,i);function o(u){Of(a,t,r,o,s,"next",u)}function s(u){Of(a,t,r,o,s,"throw",u)}o(void 0)})}}function KT(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,zs(e,n)}function zs(e,n){return zs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},zs(e,n)}var Nf=typeof Float32Array<"u"?Float32Array:Array;Math.hypot||(Math.hypot=function(){for(var e=0,n=arguments.length;n--;)e+=arguments[n]*arguments[n];return Math.sqrt(e)});function $T(){var e=new Nf(16);return Nf!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function qT(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ZT(e,n,i){var t=i[0],r=i[1],a=i[2];return e[0]=n[0]*t,e[1]=n[1]*t,e[2]=n[2]*t,e[3]=n[3]*t,e[4]=n[4]*r,e[5]=n[5]*r,e[6]=n[6]*r,e[7]=n[7]*r,e[8]=n[8]*a,e[9]=n[9]*a,e[10]=n[10]*a,e[11]=n[11]*a,e[12]=n[12],e[13]=n[13],e[14]=n[14],e[15]=n[15],e}var QT=function(){function e(i){this.canvasConfig=void 0,this.imageCache={},this.gradientCache={},this.patternCache={},this.canvasConfig=i}var n=e.prototype;return n.getImageSync=function(t,r){return this.imageCache[t]?r&&r():this.getOrCreateImage(t).then(function(){r&&r()}),this.imageCache[t]},n.getOrCreateImage=function(t){var r=this;if(this.imageCache[t])return Promise.resolve(this.imageCache[t]);var a=this.canvasConfig.createImage;return new Promise(function(o,s){var u;a?u=a(t):ei&&(u=new window.Image),u&&(u.onload=function(){o(u)},u.onerror=function(l){s(l)},u.crossOrigin="Anonymous",u.src=t,r.imageCache[t]=u)})},n.getOrCreatePatternSync=function(t,r,a,o,s){var u=this.generatePatternKey(t);if(u&&this.patternCache[u])return this.patternCache[u];var l=t.image,f=t.repetition,c=t.transform,h,p=!1;vt(l)?h=this.getImageSync(l,s):a?(h=a,p=!0):h=l;var g=h&&r.createPattern(h,f);if(g){var _;c?_=so(Ii(c)):_=qT($T()),p&&ZT(_,_,[1/o,1/o,1]),g.setTransform({a:_[0],b:_[1],c:_[4],d:_[5],e:_[12],f:_[13]})}return u&&g&&(this.patternCache[u]=g),g},n.getOrCreateGradient=function(t,r){var a=this.generateGradientKey(t),o=t.type,s=t.steps,u=t.width,l=t.height,f=t.angle,c=t.cx,h=t.cy,p=t.size;if(this.gradientCache[a])return this.gradientCache[a];var g=null;if(o===en.LinearGradient){var _=E0(u,l,f),E=_.x1,y=_.y1,R=_.x2,A=_.y2;g=r.createLinearGradient(E,y,R,A)}else if(o===en.RadialGradient){var M=y0(u,l,c,h,p),x=M.x,P=M.y,C=M.r;g=r.createRadialGradient(x,P,0,x,P,C)}return g&&(s.forEach(function(O){var D=O.offset,F=O.color;if(D.unit===Q.kPercentage){var k;(k=g)===null||k===void 0||k.addColorStop(D.value/100,F.toString())}}),this.gradientCache[a]=g),this.gradientCache[a]},n.generateGradientKey=function(t){var r=t.type,a=t.width,o=t.height,s=t.steps,u=t.angle,l=t.cx,f=t.cy,c=t.size;return"gradient-"+r+"-"+((u==null?void 0:u.toString())||0)+"-"+((l==null?void 0:l.toString())||0)+"-"+((f==null?void 0:f.toString())||0)+"-"+((c==null?void 0:c.toString())||0)+"-"+a+"-"+o+"-"+s.map(function(h){var p=h.offset,g=h.color;return""+p+g}).join("-")},n.generatePatternKey=function(t){var r=t.image,a=t.repetition;if(vt(r))return"pattern-"+r+"-"+a;if(r.nodeName==="rect")return"pattern-"+r.entity+"-"+a},e}(),Yh=function(){function e(){}var n=e.prototype;return n.apply=function(t){var r=t.renderingService,a=t.renderingContext,o=t.imagePool,s=a.root.ownerDocument.defaultView,u=function(c){var h=c.target,p=h.nodeName,g=h.attributes;if(p===H.IMAGE){var _=g.img;vt(_)&&o.getImageSync(_,function(){h.renderable.dirty=!0,r.dirtify()})}},l=function(c){var h=c.target,p=c.attrName,g=c.newValue;h.nodeName===H.IMAGE&&p==="img"&&vt(g)&&o.getOrCreateImage(g).then(function(){h.renderable.dirty=!0,r.dirtify()})};r.hooks.init.tapPromise(e.tag,GT(Ys().mark(function f(){return Ys().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:s.addEventListener(fe.MOUNTED,u),s.addEventListener(fe.ATTR_MODIFIED,l);case 2:case"end":return h.stop()}},f)}))),r.hooks.destroy.tap(e.tag,function(){s.removeEventListener(fe.MOUNTED,u),s.removeEventListener(fe.ATTR_MODIFIED,l)})},e}();Yh.tag="LoadImage";var JT=function(e){KT(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.name="image-loader",t}var i=n.prototype;return i.init=function(){this.context.imagePool=new QT(this.context.config),this.addRenderingPlugin(new Yh)},i.destroy=function(){this.removeAllRenderingPlugins()},n}(un);function _n(){_n=function(){return e};var e={},n=Object.prototype,i=n.hasOwnProperty,t=Object.defineProperty||function(d,v,m){d[v]=m.value},r=typeof Symbol=="function"?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(d,v,m){return Object.defineProperty(d,v,{value:m,enumerable:!0,configurable:!0,writable:!0}),d[v]}try{u({},"")}catch{u=function(v,m,S){return v[m]=S}}function l(d,v,m,S){var T=v&&v.prototype instanceof h?v:h,N=Object.create(T.prototype),B=new D(S||[]);return t(N,"_invoke",{value:x(d,m,B)}),N}function f(d,v,m){try{return{type:"normal",arg:d.call(v,m)}}catch(S){return{type:"throw",arg:S}}}e.wrap=l;var c={};function h(){}function p(){}function g(){}var _={};u(_,a,function(){return this});var E=Object.getPrototypeOf,y=E&&E(E(F([])));y&&y!==n&&i.call(y,a)&&(_=y);var R=g.prototype=h.prototype=Object.create(_);function A(d){["next","throw","return"].forEach(function(v){u(d,v,function(m){return this._invoke(v,m)})})}function M(d,v){function m(T,N,B,w){var U=f(d[T],d,N);if(U.type!=="throw"){var V=U.arg,K=V.value;return K&&typeof K=="object"&&i.call(K,"__await")?v.resolve(K.__await).then(function(z){m("next",z,B,w)},function(z){m("throw",z,B,w)}):v.resolve(K).then(function(z){V.value=z,B(V)},function(z){return m("throw",z,B,w)})}w(U.arg)}var S;t(this,"_invoke",{value:function(T,N){function B(){return new v(function(w,U){m(T,N,w,U)})}return S=S?S.then(B,B):B()}})}function x(d,v,m){var S="suspendedStart";return function(T,N){if(S==="executing")throw new Error("Generator is already running");if(S==="completed"){if(T==="throw")throw N;return k()}for(m.method=T,m.arg=N;;){var B=m.delegate;if(B){var w=P(B,m);if(w){if(w===c)continue;return w}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(S==="suspendedStart")throw S="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);S="executing";var U=f(d,v,m);if(U.type==="normal"){if(S=m.done?"completed":"suspendedYield",U.arg===c)continue;return{value:U.arg,done:m.done}}U.type==="throw"&&(S="completed",m.method="throw",m.arg=U.arg)}}}function P(d,v){var m=v.method,S=d.iterator[m];if(S===void 0)return v.delegate=null,m==="throw"&&d.iterator.return&&(v.method="return",v.arg=void 0,P(d,v),v.method==="throw")||m!=="return"&&(v.method="throw",v.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var T=f(S,d.iterator,v.arg);if(T.type==="throw")return v.method="throw",v.arg=T.arg,v.delegate=null,c;var N=T.arg;return N?N.done?(v[d.resultName]=N.value,v.next=d.nextLoc,v.method!=="return"&&(v.method="next",v.arg=void 0),v.delegate=null,c):N:(v.method="throw",v.arg=new TypeError("iterator result is not an object"),v.delegate=null,c)}function C(d){var v={tryLoc:d[0]};1 in d&&(v.catchLoc=d[1]),2 in d&&(v.finallyLoc=d[2],v.afterLoc=d[3]),this.tryEntries.push(v)}function O(d){var v=d.completion||{};v.type="normal",delete v.arg,d.completion=v}function D(d){this.tryEntries=[{tryLoc:"root"}],d.forEach(C,this),this.reset(!0)}function F(d){if(d){var v=d[a];if(v)return v.call(d);if(typeof d.next=="function")return d;if(!isNaN(d.length)){var m=-1,S=function T(){for(;++m<d.length;)if(i.call(d,m))return T.value=d[m],T.done=!1,T;return T.value=void 0,T.done=!0,T};return S.next=S}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=g,t(R,"constructor",{value:g,configurable:!0}),t(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(d){var v=typeof d=="function"&&d.constructor;return!!v&&(v===p||(v.displayName||v.name)==="GeneratorFunction")},e.mark=function(d){return Object.setPrototypeOf?Object.setPrototypeOf(d,g):(d.__proto__=g,u(d,s,"GeneratorFunction")),d.prototype=Object.create(R),d},e.awrap=function(d){return{__await:d}},A(M.prototype),u(M.prototype,o,function(){return this}),e.AsyncIterator=M,e.async=function(d,v,m,S,T){T===void 0&&(T=Promise);var N=new M(l(d,v,m,S),T);return e.isGeneratorFunction(v)?N:N.next().then(function(B){return B.done?B.value:N.next()})},A(R),u(R,s,"Generator"),u(R,a,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),e.keys=function(d){var v=Object(d),m=[];for(var S in v)m.push(S);return m.reverse(),function T(){for(;m.length;){var N=m.pop();if(N in v)return T.value=N,T.done=!1,T}return T.done=!0,T}},e.values=F,D.prototype={constructor:D,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!d)for(var v in this)v.charAt(0)==="t"&&i.call(this,v)&&!isNaN(+v.slice(1))&&(this[v]=void 0)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var v=this;function m(U,V){return N.type="throw",N.arg=d,v.next=U,V&&(v.method="next",v.arg=void 0),!!V}for(var S=this.tryEntries.length-1;S>=0;--S){var T=this.tryEntries[S],N=T.completion;if(T.tryLoc==="root")return m("end");if(T.tryLoc<=this.prev){var B=i.call(T,"catchLoc"),w=i.call(T,"finallyLoc");if(B&&w){if(this.prev<T.catchLoc)return m(T.catchLoc,!0);if(this.prev<T.finallyLoc)return m(T.finallyLoc)}else if(B){if(this.prev<T.catchLoc)return m(T.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return m(T.finallyLoc)}}}},abrupt:function(d,v){for(var m=this.tryEntries.length-1;m>=0;--m){var S=this.tryEntries[m];if(S.tryLoc<=this.prev&&i.call(S,"finallyLoc")&&this.prev<S.finallyLoc){var T=S;break}}T&&(d==="break"||d==="continue")&&T.tryLoc<=v&&v<=T.finallyLoc&&(T=null);var N=T?T.completion:{};return N.type=d,N.arg=v,T?(this.method="next",this.next=T.finallyLoc,c):this.complete(N)},complete:function(d,v){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&v&&(this.next=v),c},finish:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.finallyLoc===d)return this.complete(m.completion,m.afterLoc),O(m),c}},catch:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.tryLoc===d){var S=m.completion;if(S.type==="throw"){var T=S.arg;O(m)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(d,v,m){return this.delegate={iterator:F(d),resultName:v,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},e}function If(e,n,i,t,r,a,o){try{var s=e[a](o),u=s.value}catch(l){i(l);return}s.done?n(u):Promise.resolve(u).then(t,r)}function Gs(e){return function(){var n=this,i=arguments;return new Promise(function(t,r){var a=e.apply(n,i);function o(u){If(a,t,r,o,s,"next",u)}function s(u){If(a,t,r,o,s,"throw",u)}o(void 0)})}}function to(){return to=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},to.apply(this,arguments)}function Lt(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,Ks(e,n)}function Ks(e,n){return Ks=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Ks(e,n)}function $s(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function jT(e,n){if(e){if(typeof e=="string")return Df(e,n);var i=Object.prototype.toString.call(e).slice(8,-1);if(i==="Object"&&e.constructor&&(i=e.constructor.name),i==="Map"||i==="Set")return Array.from(e);if(i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return Df(e,n)}}function Df(e,n){(n==null||n>e.length)&&(n=e.length);for(var i=0,t=new Array(n);i<n;i++)t[i]=e[i];return t}function e1(e,n){var i=typeof Symbol<"u"&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=jT(e))||n&&e&&typeof e.length=="number"){i&&(e=i);var t=0;return function(){return t>=e.length?{done:!0}:{done:!1,value:e[t++]}}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var sr=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device;return r=e.call(this)||this,r.id=void 0,r.name=void 0,r.device=void 0,r.id=a,r.device=o,r.device.resourceCreationTracker!==null&&r.device.resourceCreationTracker.trackResourceCreated($s(r)),r}var i=n.prototype;return i.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},n}(jn),t1=function(e){Lt(n,e);function n(i){var t,r=i.id,a=i.device,o=i.descriptor;t=e.call(this,{id:r,device:a})||this,t.type=Ze.Bindings,t.uniformBufferBindings=void 0,t.samplerBindings=void 0;var s=o.bindingLayout,u=o.uniformBufferBindings,l=o.samplerBindings;Z(u.length>=s.numUniformBuffers),Z(l.length>=s.numSamplers);for(var f=0;f<s.numUniformBuffers;f++)Z(u[f].wordCount>0);return t.uniformBufferBindings=o.uniformBufferBindings,t.samplerBindings=o.samplerBindings,t}return n}(sr);function J(e){return typeof WebGL2RenderingContext<"u"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function r1(e){var n=xn(e);switch(n){case $.BC1:case $.BC2:case $.BC3:case $.BC4_UNORM:case $.BC4_SNORM:case $.BC5_UNORM:case $.BC5_SNORM:return!0;default:return!1}}function zh(e){var n=ho(e);if(n&ee.Normalized)return!1;var i=xn(e);return i===$.S8||i===$.S16||i===$.S32||i===$.U8||i===$.U16||i===$.U32}function n1(e){switch(e){case Zn.Static:return L.STATIC_DRAW;case Zn.Dynamic:return L.DYNAMIC_DRAW}}function bf(e){if(e&ut.INDEX)return L.ELEMENT_ARRAY_BUFFER;if(e&ut.VERTEX)return L.ARRAY_BUFFER;if(e&ut.UNIFORM)return L.UNIFORM_BUFFER}function i1(e){switch(e){case Tr.Triangles:return L.TRIANGLES;case Tr.Points:return L.POINTS;case Tr.TriangleStrip:return L.TRIANGLE_STRIP;case Tr.Lines:return L.LINES;case Tr.LineStrip:return L.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function a1(e){switch(e){case $.U8:return L.UNSIGNED_BYTE;case $.U16:return L.UNSIGNED_SHORT;case $.U32:return L.UNSIGNED_INT;case $.S8:return L.BYTE;case $.S16:return L.SHORT;case $.S32:return L.INT;case $.F16:return L.HALF_FLOAT;case $.F32:return L.FLOAT;default:throw new Error("whoops")}}function o1(e){switch(e){case re.R:return 1;case re.RG:return 2;case re.RGB:return 3;case re.RGBA:return 4;default:return 1}}function s1(e){var n=xn(e),i=vh(e),t=ho(e),r=a1(n),a=o1(i),o=!!(t&ee.Normalized);return{size:a,type:r,normalized:o}}function u1(e){switch(e){case G.U8_R:return L.UNSIGNED_BYTE;case G.U16_R:return L.UNSIGNED_SHORT;case G.U32_R:return L.UNSIGNED_INT;default:throw new Error("whoops")}}function gi(e){switch(e){case Lr.Clamp:return L.CLAMP_TO_EDGE;case Lr.Repeat:return L.REPEAT;case Lr.Mirror:return L.MIRRORED_REPEAT;default:throw new Error("whoops")}}function Ma(e,n){if(n===bt.Linear&&e===_t.Bilinear)return L.LINEAR_MIPMAP_LINEAR;if(n===bt.Linear&&e===_t.Point)return L.NEAREST_MIPMAP_LINEAR;if(n===bt.Nearest&&e===_t.Bilinear)return L.LINEAR_MIPMAP_NEAREST;if(n===bt.Nearest&&e===_t.Point)return L.NEAREST_MIPMAP_NEAREST;if(n===bt.NoMip&&e===_t.Bilinear)return L.LINEAR;if(n===bt.NoMip&&e===_t.Point)return L.NEAREST;throw new Error("Unknown texture filter mode")}function Hi(e,n){n===void 0&&(n=0);var i=e;return i.gl_buffer_pages[n/i.pageByteSize|0]}function wn(e){var n=e;return n.gl_texture}function qs(e){var n=e;return n.gl_sampler}function mi(e,n){e.name=n,e.__SPECTOR_Metadata={name:n}}function wf(e,n){for(var i=[];;){var t=n.exec(e);if(!t)break;i.push(t)}return i}function Yr(e){return e.blendMode==on.Add&&e.blendSrcFactor==Ft.One&&e.blendDstFactor===Ft.Zero}function l1(e){switch(e){case Cs.OcclusionConservative:return L.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function f1(e){if(e===et.n2D)return L.TEXTURE_2D;if(e===et.n2DArray)return L.TEXTURE_2D_ARRAY;if(e===et.Cube)return L.TEXTURE_CUBE_MAP;if(e===et.n3D)return L.TEXTURE_3D;throw new Error("whoops")}function qo(e,n,i,t){return!(e%i!==0||n%t!==0)}var c1=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device,s=t.descriptor;r=e.call(this,{id:a,device:o})||this,r.type=Ze.Buffer,r.gl_buffer_pages=void 0,r.gl_target=void 0,r.usage=void 0,r.byteSize=void 0,r.pageByteSize=void 0;var u=s.viewOrSize,l=s.usage,f=s.hint,c=o.uniformBufferMaxPageByteSize,h=o.gl,p=l&ut.STORAGE;if(p)return $s(r)||$s(r);var g=l&ut.UNIFORM;g||(J(h)?h.bindVertexArray(null):o.OES_vertex_array_object.bindVertexArrayOES(null));var _=Ut(u)?u*4:u.byteLength*4;r.gl_buffer_pages=[];var E;if(g){Z(_%c===0);for(var y=_;y>0;)r.gl_buffer_pages.push(r.createBufferPage(Math.min(y,c),l,f)),y-=c;E=c}else r.gl_buffer_pages.push(r.createBufferPage(_,l,f)),E=_;return r.pageByteSize=E,r.byteSize=_,r.usage=l,r.gl_target=bf(l),g||(J(h)?h.bindVertexArray(r.device.currentBoundVAO):o.OES_vertex_array_object.bindVertexArrayOES(r.device.currentBoundVAO)),r}var i=n.prototype;return i.setSubData=function(r,a,o,s){o===void 0&&(o=0),s===void 0&&(s=a.byteLength-o);var u=this.device.gl,l=this.gl_target,f=this.byteSize,c=this.pageByteSize;if(!(r+s<=f))throw new Error("Assert fail: (dstByteOffset ["+r+"] + byteSize ["+s+"]) <= dstByteSize ["+f+"], gl_target "+l);for(var h=r+s,p=r,g=r%c;p<h;){var _=J(u)?u.COPY_WRITE_BUFFER:this.gl_target;u.bindBuffer(_,Hi(this,p)),J(u)?u.bufferSubData(_,g,a,o,Math.min(h-p,c)):u.bufferSubData(_,g,a),p+=c,g=0,o+=c,this.device.debugGroupStatisticsBufferUpload()}},i.destroy=function(){e.prototype.destroy.call(this);for(var r=0;r<this.gl_buffer_pages.length;r++)this.gl_buffer_pages[r].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[r])},i.createBufferPage=function(r,a,o){var s=this.device.gl,u=a&ut.UNIFORM;if(!J(s)&&u)return{ubo:!0};var l=this.device.ensureResourceExists(s.createBuffer()),f=bf(a),c=n1(o);return s.bindBuffer(f,l),s.bufferData(f,r,c),l},n}(sr),h1=function(e){Lt(n,e);function n(i){var t,r=i.id,a=i.device,o=i.descriptor;t=e.call(this,{id:r,device:a})||this,t.type=Ze.InputLayout,t.vertexAttributeDescriptors=void 0,t.vertexBufferDescriptors=void 0,t.indexBufferFormat=void 0;var s=o.vertexAttributeDescriptors,u=o.vertexBufferDescriptors,l=o.indexBufferFormat;return Z(l===G.U16_R||l===G.U32_R||l===null),t.vertexAttributeDescriptors=s,t.vertexBufferDescriptors=u,t.indexBufferFormat=l,t}return n}(sr),d1=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device,s=t.inputLayout,u=t.vertexBuffers,l=t.indexBufferBinding,f=t.program;r=e.call(this,{id:a,device:o})||this,r.type=Ze.InputState,r.vao=void 0,r.indexBufferByteOffset=void 0,r.indexBufferType=void 0,r.indexBufferCompByteSize=void 0,r.inputLayout=void 0,r.vertexBuffers=void 0;var c=r.device.gl,h=r.device.ensureResourceExists(J(c)?c.createVertexArray():o.OES_vertex_array_object.createVertexArrayOES());J(c)?c.bindVertexArray(h):o.OES_vertex_array_object.bindVertexArrayOES(h),o.currentBoundVAO=h;for(var p=0;p<s.vertexAttributeDescriptors.length;p++){var g,_=s.vertexAttributeDescriptors[p],E=_.format,y=_.divisor,R=y===void 0?1:y,A=_.byteStride,M=_.bufferByteOffset,x=_.bufferIndex,P=J(c)?_.location:(g=f.attributes[_.location])===null||g===void 0?void 0:g.location;if(!ae(P)){zh(E);var C=s1(E),O=C.size,D=C.type,F=C.normalized,k=u[x];if(k===null)continue;var d=Ue(s.vertexBufferDescriptors[x]),v=k.buffer;Z(!!(v.usage&ut.VERTEX)),c.bindBuffer(c.ARRAY_BUFFER,Hi(k.buffer));var m=k.byteOffset+M;c.vertexAttribPointer(P,O,D,F,A||d.byteStride,m),d.frequency===be.PerInstance&&(J(c)?c.vertexAttribDivisor(P,R):o.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(P,R)),c.enableVertexAttribArray(P)}}var S=null,T=null,N=null;if(l!==null){var B=l.buffer;Z(!!(B.usage&ut.INDEX)),c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,Hi(l.buffer)),S=u1(Ue(s.indexBufferFormat)),T=pE(s.indexBufferFormat),N=l.byteOffset}return J(c)?c.bindVertexArray(null):o.OES_vertex_array_object.bindVertexArrayOES(null),o.currentBoundVAO=null,r.vao=h,r.indexBufferByteOffset=N,r.indexBufferType=S,r.indexBufferCompByteSize=T,r.inputLayout=s,r.vertexBuffers=u,r}var i=n.prototype;return i.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(J(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},n}(sr),Zs=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device,s=t.descriptor,u=t.fake;r=e.call(this,{id:a,device:o})||this,r.type=Ze.Texture,r.gl_texture=void 0,r.gl_target=void 0,r.pixelFormat=void 0,r.width=void 0,r.height=void 0,r.depth=void 0,r.numLevels=void 0,r.immutable=void 0,r.pixelStore=void 0,r.mipmaps=void 0,r.formatKind=void 0,r.textureIndex=void 0;var l=r.device.gl,f,c,h=r.clampNumLevels(s);if(r.immutable=!!s.immutable,r.pixelStore=s.pixelStore,r.pixelFormat=s.pixelFormat,r.formatKind=gE(s.pixelFormat),r.width=s.width,r.height=s.height,r.depth=s.depth,r.mipmaps=h>=1,!u){c=r.device.ensureResourceExists(l.createTexture());var p=r.device.translateTextureType(s.pixelFormat),g=r.device.translateTextureInternalFormat(s.pixelFormat);if(r.device.setActiveTexture(l.TEXTURE0),r.device.currentTextures[0]=null,r.preprocessImage(),s.dimension===et.n2D){if(f=L.TEXTURE_2D,l.bindTexture(f,c),r.immutable)if(J(l))l.texStorage2D(f,h,g,s.width,s.height);else{var _=(g===L.DEPTH_COMPONENT||r.isNPOT(),0);l.texImage2D(f,_,g,s.width,s.height,0,g,p,null),r.mipmaps&&r.isNPOT()&&(r.mipmaps=!1,l.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.LINEAR),l.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,L.CLAMP_TO_EDGE),l.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,L.CLAMP_TO_EDGE))}Z(s.depth===1)}else if(s.dimension===et.n2DArray)f=L.TEXTURE_2D_ARRAY,l.bindTexture(f,c),J(l)&&l.texStorage3D(f,h,g,s.width,s.height,s.depth);else if(s.dimension===et.n3D)f=L.TEXTURE_3D,l.bindTexture(f,c),J(l)&&l.texStorage3D(f,h,g,s.width,s.height,s.depth);else if(s.dimension===et.Cube)f=L.TEXTURE_CUBE_MAP,l.bindTexture(f,c),J(l)&&l.texStorage2D(f,h,g,s.width,s.height),Z(s.depth===6);else throw new Error("whoops")}return r.gl_texture=c,r.gl_target=f,r.numLevels=h,r}var i=n.prototype;return i.setImageData=function(r,a){var o=this.device.gl,s=Array.isArray(r);this.device.setActiveTexture(o.TEXTURE0),this.device.currentTextures[0]=null;var u,l;s?(u=this.width,l=this.height):(u=r.width,l=r.height,this.width=u,this.height=l),o.bindTexture(this.gl_target,this.gl_texture);var f=this.device.translateTextureFormat(this.pixelFormat),c=this.device.translateTextureType(this.pixelFormat);this.preprocessImage(),this.immutable?o.texSubImage2D(this.gl_target,0,0,0,u,l,f,c,s?r[0]:r):J(o)?o.texImage2D(this.gl_target,0,f,u,l,0,f,c,s?r[0]:r):s?o.texImage2D(this.gl_target,0,f,u,l,0,f,c,r[0]):o.texImage2D(this.gl_target,0,f,f,c,r),this.mipmaps&&this.generateMipmap()},i.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(wn(this))},i.clampNumLevels=function(r){if(r.dimension===et.n2DArray&&r.depth>1){var a=xn(r.pixelFormat);if(a===$.BC1)for(var o=r.width,s=r.height,u=0;u<r.numLevels;u++){if(o<=2||s<=2)return u-1;o=Math.max(o/2|0,1),s=Math.max(s/2|0,1)}}return r.numLevels},i.preprocessImage=function(){var r=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&r.pixelStorei(L.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&r.pixelStorei(L.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&r.pixelStorei(L.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},i.generateMipmap=function(){var r=this.device.gl;return!J(r)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(r.bindTexture(this.gl_target,this.gl_texture),r.generateMipmap(this.gl_target),r.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.NEAREST_MIPMAP_LINEAR),r.bindTexture(this.gl_target,null)),this)},i.isNPOT=function(){var r=this.device.gl;return J(r)?!1:!za(this.width)||!za(this.height)},n}(sr),v1=`
layout(location = 0) in vec2 a_Position;

out vec2 v_TexCoord;

void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}
`,Nt;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(Nt||(Nt={}));var p1=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device,s=t.descriptor;r=e.call(this,{id:a,device:o})||this,r.type=Ze.Program,r.gl_program=void 0,r.gl_shader_vert=void 0,r.gl_shader_frag=void 0,r.compileState=void 0,r.descriptor=void 0,r.uniformSetters={},r.attributes=[];var u=r.device.gl;return r.descriptor=s,r.gl_program=r.device.ensureResourceExists(u.createProgram()),r.gl_shader_vert=null,r.gl_shader_frag=null,r.compileState=Nt.NeedsCompile,r.tryCompileProgram(),r}var i=n.prototype;return i.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},i.tryCompileProgram=function(){Z(this.compileState===Nt.NeedsCompile);var r=this.descriptor,a=this.device.gl;this.gl_shader_vert!==null&&a.deleteShader(this.gl_shader_vert),this.gl_shader_frag!==null&&a.deleteShader(this.gl_shader_frag),r.preprocessedCompute?(this.gl_shader_vert=this.compileShader(Li(this.device.queryVendorInfo(),"vert",v1),a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(r.preprocessedCompute,a.FRAGMENT_SHADER)):(this.gl_shader_vert=this.compileShader(r.preprocessedVert,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(r.preprocessedFrag,a.FRAGMENT_SHADER)),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Nt.Compiling,J(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram())},i.readAttributesFromLinkedProgram=function(){for(var r=this,a=this.device.gl,o=a.getProgramParameter(this.gl_program,a.ACTIVE_ATTRIBUTES),s=ny(this.descriptor.preprocessedVert),u=iy(this.descriptor.vert,s),l=function(){var h,p=a.getActiveAttrib(r.gl_program,f),g=p.name,_=p.type,E=p.size,y=a.getAttribLocation(r.gl_program,g),R=(h=u.find(function(A){return A.name===g}))===null||h===void 0?void 0:h.location;y>=0&&!ae(R)&&(r.attributes[R]={name:g,location:y,type:_,size:E})},f=0;f<o;f++)l()},i.readUniformLocationsFromLinkedProgram=function(){for(var r=this.device.gl,a=r.getProgramParameter(this.gl_program,r.ACTIVE_UNIFORMS),o=0;o<a;o++){var s=r.getActiveUniform(this.gl_program,o),u=QE(s.name),l=u.name,f=r.getUniformLocation(this.gl_program,l);if(this.uniformSetters[l]=df(r,f,s),s&&s.size>1)for(var c=0;c<s.size;c++)f=r.getUniformLocation(this.gl_program,l+"["+c+"]"),this.uniformSetters[l+"["+c+"]"]=df(r,f,s)}},i.compileShader=function(r,a){var o=this.device.gl,s=this.device.ensureResourceExists(o.createShader(a));return o.shaderSource(s,r),o.compileShader(s),s},i.setUniforms=function(r){r===void 0&&(r={});var a=this.device.gl;if(!J(a)){var o=!1;for(var s in r){o||(a.useProgram(this.gl_program),o=!0);var u=r[s],l=this.uniformSetters[s];if(l){var f=u;f instanceof Zs&&(f=f.textureIndex),l(f)}}}return this},n}(sr),g1=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device,s=t.descriptor;r=e.call(this,{id:a,device:o})||this,r.type=Ze.QueryPool,r.gl_query_type=void 0,r.gl_query=void 0;var u=r.device.gl;if(J(u)){var l=s.elemCount,f=s.type;r.gl_query=Ga(l,function(){return r.device.ensureResourceExists(u.createQuery())}),r.gl_query_type=l1(f)}return r}var i=n.prototype;return i.queryResultOcclusion=function(r){var a=this.device.gl;if(J(a)){var o=this.gl_query[r];return a.getQueryParameter(o,a.QUERY_RESULT_AVAILABLE)?!!a.getQueryParameter(o,a.QUERY_RESULT):null}return null},i.destroy=function(){e.prototype.destroy.call(this);var r=this.device.gl;if(J(r))for(var a=0;a<this.gl_query.length;a++)r.deleteQuery(this.gl_query[a])},n}(sr),m1=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device;return r=e.call(this,{id:a,device:o})||this,r.type=Ze.Readback,r.gl_pbo=null,r.gl_sync=null,r}var i=n.prototype;return i.clientWaitAsync=function(r,a,o){a===void 0&&(a=0),o===void 0&&(o=10);var s=this.device.gl;return new Promise(function(u,l){function f(){var c=s.clientWaitSync(r,a,0);if(c==s.WAIT_FAILED){l();return}if(c==s.TIMEOUT_EXPIRED){setTimeout(f,dt(o,0,s.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}u()}f()})},i.getBufferSubDataAsync=function(){var t=Gs(_n().mark(function a(o,s,u,l,f,c){var h;return _n().wrap(function(g){for(;;)switch(g.prev=g.next){case 0:if(f===void 0&&(f=0),c===void 0&&(c=l.byteLength||0),h=this.device.gl,!J(h)){g.next=12;break}return this.gl_sync=h.fenceSync(h.SYNC_GPU_COMMANDS_COMPLETE,0),h.flush(),g.next=8,this.clientWaitAsync(this.gl_sync,0,10);case 8:return h.bindBuffer(o,s),h.getBufferSubData(o,u,l,f,c),h.bindBuffer(o,null),g.abrupt("return",l);case 12:case"end":return g.stop()}},a,this)}));function r(a,o,s,u,l,f){return t.apply(this,arguments)}return r}(),i.readTexture=function(r,a,o,s,u,l,f,c){c===void 0&&(c=l.byteLength||0);var h=this.device.gl,p=r,g=this.device.translateTextureType(p.pixelFormat);return h.bindFramebuffer(L.FRAMEBUFFER,this.device.readbackFramebuffer),h.framebufferTexture2D(L.FRAMEBUFFER,L.COLOR_ATTACHMENT0,L.TEXTURE_2D,p.gl_texture,0),h.pixelStorei(h.PACK_ALIGNMENT,4),h.readPixels(a,o,s,u,h.RGBA,g,l),l},i.readBuffer=function(){var t=Gs(_n().mark(function a(o,s,u,l,f){var c;return _n().wrap(function(p){for(;;)switch(p.prev=p.next){case 0:if(c=this.device.gl,!J(c)){p.next=3;break}return p.abrupt("return",this.getBufferSubDataAsync(c.ARRAY_BUFFER,Hi(o,s),s,u,l,f));case 3:return p.abrupt("return",Promise.reject());case 4:case"end":return p.stop()}},a,this)}));function r(a,o,s,u,l){return t.apply(this,arguments)}return r}(),i.destroy=function(){e.prototype.destroy.call(this),J(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},n}(sr),_1=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device,s=t.descriptor;return r=e.call(this,{id:a,device:o})||this,r.type=Ze.RenderPipeline,r.bindingLayouts=void 0,r.program=void 0,r.drawMode=void 0,r.megaState=void 0,r.inputLayout=void 0,r.colorAttachmentFormats=void 0,r.depthStencilAttachmentFormat=void 0,r.sampleCount=void 0,r.bindingLayouts=r.createBindingLayouts(s.bindingLayouts),r.drawMode=i1(s.topology),r.program=s.program,r.inputLayout=s.inputLayout,r.megaState=s.megaStateDescriptor,r.colorAttachmentFormats=s.colorAttachmentFormats.slice(),r.depthStencilAttachmentFormat=s.depthStencilAttachmentFormat,r.sampleCount=s.sampleCount,r}var i=n.prototype;return i.createBindingLayouts=function(r){for(var a=0,o=0,s=[],u=0;u<r.length;u++){var l=r[u],f=l.numUniformBuffers,c=l.numSamplers,h=l.samplerEntries,p=[];h!==void 0&&Z(h.length===c);for(var g=0;g<c;g++){var _=h!==void 0?h[g]:xE,E=_.dimension,y=_.formatKind;p.push({gl_target:f1(E),formatKind:y})}s.push({firstUniformBuffer:a,numUniformBuffers:f,firstSampler:o,numSamplers:c,samplerEntries:p}),a+=f,o+=c}return{numUniformBuffers:a,numSamplers:o,bindingLayoutTables:s}},n}(sr),E1=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device,s=t.descriptor;r=e.call(this,{id:a,device:o})||this,r.type=Ze.RenderTarget,r.gl_renderbuffer=null,r.texture=null,r.pixelFormat=void 0,r.width=void 0,r.height=void 0,r.sampleCount=void 0;var u=r.device.gl,l=s.pixelFormat,f=s.width,c=s.height,h=s.texture,p=s.sampleCount;if(h)r.texture=h;else{r.gl_renderbuffer=r.device.ensureResourceExists(u.createRenderbuffer()),u.bindRenderbuffer(u.RENDERBUFFER,r.gl_renderbuffer);var g=r.device.translateTextureInternalFormat(l);J(u)?u.renderbufferStorageMultisample(L.RENDERBUFFER,p,g,f,c):u.renderbufferStorage(L.RENDERBUFFER,g,f,c)}return r.pixelFormat=l,r.width=f,r.height=c,r.sampleCount=p,r}var i=n.prototype;return i.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer)},n}(sr),y1=function(e){Lt(n,e);function n(i){var t,r=i.id,a=i.device,o=i.descriptor;return t=e.call(this,{id:r,device:a})||this,t.type=Ze.ComputePipeline,t.descriptor=void 0,t.descriptor=o,t}return n}(sr),T1=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}var n=e.prototype;return n.trackResourceCreated=function(t){this.creationStacks.set(t,new Error().stack),this.liveObjects.add(t)},n.trackResourceDestroyed=function(t){this.deletionStacks.has(t)&&console.warn("Object double freed:",t,`

Creation stack: `,this.creationStacks.get(t),`

Deletion stack: `,this.deletionStacks.get(t),`

This stack: `,new Error().stack),this.deletionStacks.set(t,new Error().stack),this.liveObjects.delete(t)},n.checkForLeaks=function(){for(var t=e1(this.liveObjects.values()),r;!(r=t()).done;){var a=r.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}},n.setResourceLeakCheck=function(t,r){r?this.liveObjects.add(t):this.liveObjects.delete(t)},e}(),R1=function(e){Lt(n,e);function n(t){var r,a=t.id,o=t.device,s=t.descriptor;r=e.call(this,{id:a,device:o})||this,r.type=Ze.Sampler,r.gl_sampler=void 0,r.descriptor=void 0;var u=r.device.gl;if(J(u)){var l,f,c=r.device.ensureResourceExists(u.createSampler());u.samplerParameteri(c,L.TEXTURE_WRAP_S,gi(s.wrapS)),u.samplerParameteri(c,L.TEXTURE_WRAP_T,gi(s.wrapT)),u.samplerParameteri(c,L.TEXTURE_WRAP_R,gi((l=s.wrapQ)!==null&&l!==void 0?l:s.wrapS)),u.samplerParameteri(c,L.TEXTURE_MIN_FILTER,Ma(s.minFilter,s.mipFilter)),u.samplerParameteri(c,L.TEXTURE_MAG_FILTER,Ma(s.magFilter,bt.NoMip)),s.minLOD!==void 0&&u.samplerParameterf(c,L.TEXTURE_MIN_LOD,s.minLOD),s.maxLOD!==void 0&&u.samplerParameterf(c,L.TEXTURE_MAX_LOD,s.maxLOD),s.compareMode!==void 0&&(u.samplerParameteri(c,u.TEXTURE_COMPARE_MODE,u.COMPARE_REF_TO_TEXTURE),u.samplerParameteri(c,u.TEXTURE_COMPARE_FUNC,s.compareMode));var h=(f=s.maxAnisotropy)!==null&&f!==void 0?f:1;h>1&&r.device.EXT_texture_filter_anisotropic!==null&&(Z(s.minFilter===_t.Bilinear&&s.magFilter===_t.Bilinear&&s.mipFilter===bt.Linear),u.samplerParameterf(c,r.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,h)),r.gl_sampler=c}else r.descriptor=s;return r}var i=n.prototype;return i.setTextureParameters=function(r,a,o){var s,u=this.device.gl,l=this.descriptor;this.isNPOT(a,o)?u.texParameteri(L.TEXTURE_2D,L.TEXTURE_MIN_FILTER,L.LINEAR):u.texParameteri(r,L.TEXTURE_MIN_FILTER,Ma(l.minFilter,l.mipFilter)),u.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_S,gi(l.wrapS)),u.texParameteri(L.TEXTURE_2D,L.TEXTURE_WRAP_T,gi(l.wrapT)),u.texParameteri(r,L.TEXTURE_MAG_FILTER,Ma(l.magFilter,bt.NoMip));var f=(s=l.maxAnisotropy)!==null&&s!==void 0?s:1;f>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Z(l.minFilter===_t.Bilinear&&l.magFilter===_t.Bilinear&&l.mipFilter===bt.Linear),u.texParameteri(r,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f))},i.destroy=function(){e.prototype.destroy.call(this),J(this.device.gl)&&this.device.gl.deleteSampler(qs(this))},i.isNPOT=function(r,a){return!za(r)||!za(a)},n}(sr),S1=function(){function e(){this.descriptor=void 0}var n=e.prototype;return n.dispatch=function(t,r,a){},n.finish=function(){},n.beginComputePass=function(t){},n.setPipeline=function(t){},n.setBindings=function(t,r){},n.setComputePassDescriptor=function(t){this.descriptor=t},e}(),Bf=65536,A1=function(){function e(i,t){this.shaderDebug=!1,this.contextAttributes=void 0,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_depth_texture=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorResolveTos=[],this.currentDepthStencilAttachment=void 0,this.currentDepthStencilResolveTo=null,this.currentSampleCount=-1,this.currentPipeline=void 0,this.currentInputState=void 0,this.currentMegaState=Gi(ri),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveColorReadFramebuffer=void 0,this.resolveColorDrawFramebuffer=void 0,this.resolveDepthStencilAttachmentsChanged=!1,this.resolveDepthStencilReadFramebuffer=void 0,this.resolveDepthStencilDrawFramebuffer=void 0,this.renderPassDrawFramebuffer=void 0,this.readbackFramebuffer=void 0,this.fallbackTexture2D=void 0,this.fallbackTexture2DDepth=void 0,this.fallbackTexture2DArray=void 0,this.fallbackTexture3D=void 0,this.fallbackTextureCube=void 0,this.platformString=void 0,this.glslVersion=void 0,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Va.LowerLeft,this.clipSpaceNearZ=Ya.NegativeOne,this.supportMRT=!1,this.inBlitRenderPass=!1,this.blitRenderPipeline=void 0,this.blitInputState=void 0,this.blitBindings=void 0,this.uniformBufferMaxPageByteSize=void 0,this.uniformBufferWordAlignment=void 0,this.uniformBufferMaxPageWordSize=void 0,this.supportedSampleCounts=[],this.maxVertexAttribs=void 0,this.occlusionQueriesRecommended=!1,this.gl=void 0,this.gl=i,this.contextAttributes=Ue(i.getContextAttributes()),J(i)?this.EXT_texture_norm16=i.getExtension("EXT_texture_norm16"):(this.OES_vertex_array_object=i.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=i.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=i.getExtension("OES_texture_float"),this.WEBGL_depth_texture=i.getExtension("WEBGL_depth_texture"),i.getExtension("EXT_frag_depth"),i.getExtension("OES_element_index_uint"),i.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=i.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=i.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=i.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=i.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=i.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=i.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=i.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=i.getExtension("KHR_parallel_shader_compile"),J(i)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new Zs({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depth:1,dimension:et.n2D,numLevels:1,usage:sn.RenderTarget,pixelFormat:this.contextAttributes.alpha===!1?G.U8_RGB_RT:G.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=wt.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(i.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(i.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(i.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(i.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(i.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(i.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(et.n2D,wt.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(et.n2D,wt.Depth),J(i),this.currentMegaState.depthCompare=an.Less,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=it.AllChannels,i.enable(i.DEPTH_TEST),i.enable(i.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new T1)}var n=e.prototype;return n.createFallbackTexture=function(t,r){var a=t===et.Cube?6:1,o=r===wt.Depth?G.D32F:G.U8_RGBA_NORM,s=this.createTexture({dimension:t,pixelFormat:o,usage:sn.Sampled,width:1,height:1,depth:a,numLevels:1,immutable:!0});return r===wt.Float&&s.setImageData([new Uint8Array(4*a)],0),wn(s)},n.getNextUniqueId=function(){return++this.resourceUniqueId},n.checkLimits=function(){var t=this.gl;if(this.maxVertexAttribs=t.getParameter(L.MAX_VERTEX_ATTRIBS),J(t)){this.uniformBufferMaxPageByteSize=Math.min(t.getParameter(L.MAX_UNIFORM_BLOCK_SIZE),Bf),this.uniformBufferWordAlignment=t.getParameter(t.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var r=t.getInternalformatParameter(t.RENDERBUFFER,t.DEPTH32F_STENCIL8,t.SAMPLES);this.supportedSampleCounts=r?[].concat(r):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=Bf;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(a,o){return a-o})},n.configureSwapChain=function(t,r,a){var o=this.scTexture;o.width=t,o.height=r,this.scPlatformFramebuffer=_h(a)},n.getDevice=function(){return this},n.getCanvas=function(){return this.gl.canvas},n.getOnscreenTexture=function(){return this.scTexture},n.present=function(){},n.translateTextureInternalFormat=function(t){switch(t){case G.ALPHA:return L.ALPHA;case G.F16_R:return L.R16F;case G.F16_RG:return L.RG16F;case G.F16_RGB:return L.RGB16F;case G.F16_RGBA:return L.RGBA16F;case G.F32_R:return L.R32F;case G.F32_RG:return L.RG32F;case G.F32_RGB:return L.RGB32F;case G.F32_RGBA:return L.RGBA32F;case G.U8_R_NORM:return L.R8;case G.U8_RG_NORM:return L.RG8;case G.U8_RGB_NORM:case G.U8_RGB_RT:return L.RGB8;case G.U8_RGB_SRGB:return L.SRGB8;case G.U8_RGBA_NORM:case G.U8_RGBA_RT:return J(this.gl)?L.RGBA8:L.RGBA;case G.U8_RGBA_SRGB:case G.U8_RGBA_RT_SRGB:return L.SRGB8_ALPHA8;case G.U16_R:return L.R16UI;case G.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case G.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case G.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case G.U32_R:return L.R32UI;case G.S8_RGBA_NORM:return L.RGBA8_SNORM;case G.S8_RG_NORM:return L.RG8_SNORM;case G.U16_RGBA_5551:return L.UNSIGNED_SHORT_5_5_5_1;case G.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case G.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case G.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case G.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case G.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case G.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case G.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case G.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case G.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case G.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case G.D32F_S8:return J(this.gl)?L.DEPTH32F_STENCIL8:L.DEPTH_STENCIL;case G.D24_S8:return J(this.gl)?L.DEPTH24_STENCIL8:L.DEPTH_STENCIL;case G.D32F:return J(this.gl)?L.DEPTH_COMPONENT32F:L.DEPTH_COMPONENT;case G.D24:return J(this.gl)?L.DEPTH_COMPONENT24:L.DEPTH_COMPONENT;default:throw new Error("whoops")}},n.translateTextureType=function(t){var r=xn(t);switch(r){case $.U8:return L.UNSIGNED_BYTE;case $.U16:return L.UNSIGNED_SHORT;case $.U32:return L.UNSIGNED_INT;case $.S8:return L.BYTE;case $.F16:return L.HALF_FLOAT;case $.F32:return L.FLOAT;case $.U16_PACKED_5551:return L.UNSIGNED_SHORT_5_5_5_1;case $.D32F:return J(this.gl)?L.FLOAT:L.UNSIGNED_INT;case $.D24:return J(this.gl)?L.UNSIGNED_INT_24_8:L.UNSIGNED_SHORT;case $.D24S8:return J(this.gl)?L.UNSIGNED_INT_24_8:L.UNSIGNED_INT_24_8_WEBGL;case $.D32FS8:return L.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},n.translateTextureFormat=function(t){if(r1(t))return this.translateTextureInternalFormat(t);switch(t){case G.D24_S8:case G.D32F_S8:return L.DEPTH_STENCIL;case G.D24:case G.D32F:return L.DEPTH_COMPONENT}var r=zh(t),a=vh(t);switch(a){case re.A:return L.ALPHA;case re.R:return r?L.RED_INTEGER:L.RED;case re.RG:return r?L.RG_INTEGER:L.RG;case re.RGB:return r?L.RGB_INTEGER:L.RGB;case re.RGBA:return L.RGBA}},n.setActiveTexture=function(t){this.currentActiveTexture!==t&&(this.gl.activeTexture(t),this.currentActiveTexture=t)},n.bindVAO=function(t){this.currentBoundVAO!==t&&(J(this.gl)?this.gl.bindVertexArray(t):this.OES_vertex_array_object.bindVertexArrayOES(t),this.currentBoundVAO=t)},n.programCompiled=function(t){Z(t.compileState!==Nt.NeedsCompile),t.compileState===Nt.Compiling&&(t.compileState=Nt.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(t))},n.useProgram=function(t){this.currentProgram!==t&&(this.programCompiled(t),this.gl.useProgram(t.gl_program),this.currentProgram=t)},n.ensureResourceExists=function(t){if(t===null){var r=this.gl.getError();throw new Error("Created resource is null; GL error encountered: "+r)}else return t},n.createBuffer=function(t){return new c1({id:this.getNextUniqueId(),device:this,descriptor:t})},n.createTexture=function(t){return new Zs({id:this.getNextUniqueId(),device:this,descriptor:t})},n.createSampler=function(t){return new R1({id:this.getNextUniqueId(),device:this,descriptor:t})},n.createRenderTarget=function(t){return new E1({id:this.getNextUniqueId(),device:this,descriptor:t})},n.createRenderTargetFromTexture=function(t){var r=t.pixelFormat,a=t.width,o=t.height,s=t.numLevels;return Z(s===1),this.createRenderTarget({pixelFormat:r,width:a,height:o,sampleCount:1,texture:t})},n.createProgram=function(t){return t.ensurePreprocessed(this.queryVendorInfo()),this.createProgramSimple(t)},n.createProgramSimple=function(t){return new p1({id:this.getNextUniqueId(),device:this,descriptor:t})},n.createBindings=function(t){return new t1({id:this.getNextUniqueId(),device:this,descriptor:t})},n.createInputLayout=function(t){return new h1({id:this.getNextUniqueId(),device:this,descriptor:t})},n.createInputState=function(t,r,a,o){var s=t;return new d1({id:this.getNextUniqueId(),device:this,inputLayout:s,vertexBuffers:r,indexBufferBinding:a,program:o})},n.createRenderPipeline=function(t){return new _1({id:this.getNextUniqueId(),device:this,descriptor:t})},n.createComputePass=function(t){return new S1},n.createComputePipeline=function(t){return new y1({id:this.getNextUniqueId(),device:this,descriptor:t})},n.createReadback=function(){return new m1({id:this.getNextUniqueId(),device:this})},n.createQueryPool=function(t,r){return new g1({id:this.getNextUniqueId(),device:this,descriptor:{type:t,elemCount:r}})},n.createRenderPass=function(t){Z(this.currentRenderPassDescriptor===null),this.currentRenderPassDescriptor=t;var r=t.colorAttachment,a=t.colorClearColor,o=t.colorResolveTo,s=t.depthStencilAttachment,u=t.depthClearValue,l=t.stencilClearValue,f=t.depthStencilResolveTo;this.setRenderPassParametersBegin(r.length);for(var c=0;c<r.length;c++)this.setRenderPassParametersColor(c,r[c],o[c]);this.setRenderPassParametersDepthStencil(s,f),this.validateCurrentAttachments();for(var h=0;h<r.length;h++){var p=a[h];p!=="load"&&this.setRenderPassParametersClearColor(h,p.r,p.g,p.b,p.a)}return this.setRenderPassParametersClearDepthStencil(u,l),this},n.submitPass=function(t){Z(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptor=null},n.copySubTexture2D=function(t,r,a,o,s,u){var l=this.gl,f=t,c=o;Z(c.numLevels===1),Z(f.numLevels===1),J(l)&&(f===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,c),l.blitFramebuffer(s,u,s+c.width,u+c.height,r,a,r+c.width,a+c.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null))},n.queryLimits=function(){return this},n.queryTextureFormatSupported=function(t,r,a){switch(t){case G.BC1_SRGB:case G.BC2_SRGB:case G.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?qo(r,a,4,4):!1;case G.BC1:case G.BC2:case G.BC3:return this.WEBGL_compressed_texture_s3tc!==null?qo(r,a,4,4):!1;case G.BC4_UNORM:case G.BC4_SNORM:case G.BC5_UNORM:case G.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?qo(r,a,4,4):!1;case G.U16_R_NORM:case G.U16_RG_NORM:case G.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case G.F32_R:case G.F32_RG:case G.F32_RGB:case G.F32_RGBA:return this.OES_texture_float_linear!==null;case G.F16_R:case G.F16_RG:case G.F16_RGB:case G.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},n.queryProgramReady=function(t){var r=this.gl;if(t.compileState===Nt.NeedsCompile)throw new Error("whoops");if(t.compileState===Nt.Compiling){var a;return this.KHR_parallel_shader_compile!==null?a=r.getProgramParameter(t.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):a=!0,a&&this.programCompiled(t),a}return t.compileState===Nt.NeedsBind||t.compileState===Nt.ReadyToUse},n.queryPlatformAvailable=function(){return this.gl.isContextLost()},n.queryVendorInfo=function(){return this},n.queryRenderPass=function(t){return this.currentRenderPassDescriptor},n.queryRenderTarget=function(t){var r=t;return r},n.setResourceName=function(t,r){if(t.name=r,t.type===Ze.Buffer)for(var a=t.gl_buffer_pages,o=0;o<a.length;o++)mi(a[o],r+" Page "+o);else if(t.type===Ze.Texture)mi(wn(t),r);else if(t.type===Ze.Sampler)mi(qs(t),r);else if(t.type===Ze.RenderTarget){var s=t.gl_renderbuffer;s!==null&&mi(s,r)}else t.type===Ze.InputState&&mi(t.vao,r)},n.setResourceLeakCheck=function(t,r){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(t,r)},n.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},n.pushDebugGroup=function(t){this.debugGroupStack.push(t)},n.popDebugGroup=function(){this.debugGroupStack.pop()},n.programPatched=function(t,r){Z(this.shaderDebug)},n.getBufferData=function(t,r,a){a===void 0&&(a=0);var o=this.gl;J(o)&&(o.bindBuffer(o.COPY_READ_BUFFER,Hi(t,a*4)),o.getBufferSubData(o.COPY_READ_BUFFER,a*4,r))},n.debugGroupStatisticsDrawCall=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].drawCallCount+=t},n.debugGroupStatisticsBufferUpload=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].bufferUploadCount+=t},n.debugGroupStatisticsTextureBind=function(t){t===void 0&&(t=1);for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].textureBindCount+=t},n.debugGroupStatisticsTriangles=function(t){for(var r=this.debugGroupStack.length-1;r>=0;r--)this.debugGroupStack[r].triangleCount+=t},n.reportShaderError=function(t,r){var a=this.gl,o=a.getShaderParameter(t,a.COMPILE_STATUS);if(!o){console.error(TE(r));var s=a.getExtension("WEBGL_debug_shaders");s&&console.error(s.getTranslatedShaderSource(t)),console.error(a.getShaderInfoLog(t))}return o},n.checkProgramCompilationForErrors=function(t){var r=this.gl,a=t.gl_program;if(!r.getProgramParameter(a,r.LINK_STATUS)){var o=t.descriptor;if(!this.reportShaderError(t.gl_shader_vert,o.preprocessedVert)||!this.reportShaderError(t.gl_shader_frag,o.preprocessedFrag))return;console.error(r.getProgramInfoLog(t.gl_program))}},n.bindFramebufferAttachment=function(t,r,a){var o=this.gl;a===null?o.framebufferRenderbuffer(t,r,o.RENDERBUFFER,null):a.type===Ze.RenderTarget?a.gl_renderbuffer!==null?o.framebufferRenderbuffer(t,r,o.RENDERBUFFER,a.gl_renderbuffer):a.texture!==null&&o.framebufferTexture2D(t,r,L.TEXTURE_2D,wn(a.texture),0):a.type===Ze.Texture&&o.framebufferTexture2D(t,r,L.TEXTURE_2D,wn(a),0)},n.bindFramebufferDepthStencilAttachment=function(t,r){var a=this.gl,o=r!==null?ho(r.pixelFormat):ee.Depth|ee.Stencil,s=!!(o&ee.Depth),u=!!(o&ee.Stencil);s&&u?this.bindFramebufferAttachment(t,a.DEPTH_STENCIL_ATTACHMENT,r):s?(this.bindFramebufferAttachment(t,a.DEPTH_ATTACHMENT,r),this.bindFramebufferAttachment(t,a.STENCIL_ATTACHMENT,null)):u&&(this.bindFramebufferAttachment(t,a.STENCIL_ATTACHMENT,r),this.bindFramebufferAttachment(t,a.DEPTH_ATTACHMENT,null))},n.validateCurrentAttachments=function(){for(var t=-1,r=-1,a=-1,o=0;o<this.currentColorAttachments.length;o++){var s=this.currentColorAttachments[o];s!==null&&(t===-1?(t=s.sampleCount,r=s.width,a=s.height):(Z(t===s.sampleCount),Z(r===s.width),Z(a===s.height)))}this.currentDepthStencilAttachment!==null&&(t===-1?(t=this.currentDepthStencilAttachment.sampleCount,r=this.currentDepthStencilAttachment.width,a=this.currentDepthStencilAttachment.height):(Z(t===this.currentDepthStencilAttachment.sampleCount),Z(r===this.currentDepthStencilAttachment.width),Z(a===this.currentDepthStencilAttachment.height))),this.currentSampleCount=t},n.setRenderPassParametersBegin=function(t){var r=this.gl;if(J(r)?r.bindFramebuffer(L.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||r.bindFramebuffer(L.FRAMEBUFFER,this.renderPassDrawFramebuffer),!this.inBlitRenderPass)for(var a=t;a<this.currentColorAttachments.length;a++){var o=J(r)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,s=J(r)?L.COLOR_ATTACHMENT0:L.COLOR_ATTACHMENT0_WEBGL;r.framebufferRenderbuffer(o,s+a,L.RENDERBUFFER,null),r.framebufferTexture2D(o,s+a,L.TEXTURE_2D,null,0)}this.currentColorAttachments.length=t},n.setRenderPassParametersColor=function(t,r,a){var o=this.gl;this.currentColorAttachments[t]!==r&&(this.currentColorAttachments[t]=r,(J(o)||t===0)&&this.bindFramebufferAttachment(J(o)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,(J(o)?L.COLOR_ATTACHMENT0:L.COLOR_ATTACHMENT0_WEBGL)+t,r),this.resolveColorAttachmentsChanged=!0),this.currentColorResolveTos[t]!==a&&(this.currentColorResolveTos[t]=a,a!==null&&(this.resolveColorAttachmentsChanged=!0))},n.setRenderPassParametersDepthStencil=function(t,r){var a=this.gl;this.currentDepthStencilAttachment!==t&&(this.currentDepthStencilAttachment=t,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(J(a)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==r&&(this.currentDepthStencilResolveTo=r,r!==null&&(this.resolveDepthStencilAttachmentsChanged=!0))},n.setRenderPassParametersClearColor=function(t,r,a,o,s){var u=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[t];l&&l.channelWriteMask!==it.AllChannels&&(this.OES_draw_buffers_indexed.colorMaskiOES(t,!0,!0,!0,!0),l.channelWriteMask=it.AllChannels)}else{var f=this.currentMegaState.attachmentsState[0];f&&f.channelWriteMask!==it.AllChannels&&(u.colorMask(!0,!0,!0,!0),f.channelWriteMask=it.AllChannels)}this.setScissorEnabled(!1),J(u)?u.clearBufferfv(u.COLOR,t,[r,a,o,s]):(u.clearColor(r,a,o,s),u.clear(u.COLOR_BUFFER_BIT))},n.setRenderPassParametersClearDepthStencil=function(t,r){var a=this.gl;t!=="load"&&(Z(this.currentDepthStencilAttachment!==null),this.currentMegaState.depthWrite||(a.depthMask(!0),this.currentMegaState.depthWrite=!0),J(a)?a.clearBufferfv(a.DEPTH,0,[t]):(a.clearDepth(t),a.clear(a.DEPTH_BUFFER_BIT))),r!=="load"&&(Z(this.currentDepthStencilAttachment!==null),this.currentMegaState.stencilWrite||(a.enable(a.STENCIL_TEST),a.stencilMask(255),this.currentMegaState.stencilWrite=!0),J(a)?a.clearBufferiv(a.STENCIL,0,[r]):(a.clearStencil(r),a.clear(a.STENCIL_BUFFER_BIT)))},n.setBindings=function(t,r,a){var o=this.gl;Z(t<this.currentPipeline.bindingLayouts.bindingLayoutTables.length);var s=this.currentPipeline.bindingLayouts.bindingLayoutTables[t],u=r.uniformBufferBindings,l=r.samplerBindings;Z(u.length>=s.numUniformBuffers),Z(l.length>=s.numSamplers),Z(a.length>=u.length);for(var f=0;f<u.length;f++){var c=u[f];if(c.wordCount!==0){var h=s.firstUniformBuffer+f,p=c.buffer,g=a[f],_=c.wordCount*4;if(p!==this.currentUniformBuffers[h]||g!==this.currentUniformBufferByteOffsets[h]||_!==this.currentUniformBufferByteSizes[h]){var E=g%p.pageByteSize,y=p.gl_buffer_pages[g/p.pageByteSize|0];Z(E+_<=p.pageByteSize),J(o)&&o.bindBufferRange(o.UNIFORM_BUFFER,h,y,E,_),this.currentUniformBuffers[h]=p,this.currentUniformBufferByteOffsets[h]=g,this.currentUniformBufferByteSizes[h]=_}}}for(var R=0;R<s.numSamplers;R++){var A=l[R],M=s.firstSampler+R,x=s.samplerEntries[R],P=A!==null&&A.sampler!==null?qs(A.sampler):null,C=A!==null&&A.texture!==null?wn(A.texture):null;if(this.currentSamplers[M]!==P&&(J(o)&&o.bindSampler(M,P),this.currentSamplers[M]=P),this.currentTextures[M]!==C){if(this.setActiveTexture(o.TEXTURE0+M),C!==null){A.texture.textureIndex=M;var O=Ue(A).texture,D=O.gl_target,F=O.width,k=O.height;if(o.bindTexture(D,C),!J(o)){var d;(d=A.sampler)===null||d===void 0||d.setTextureParameters(D,F,k)}this.debugGroupStatisticsTextureBind(),Z(x.gl_target===D)}else o.bindTexture(x.gl_target,this.getFallbackTexture(x));this.currentTextures[M]=C}}},n.setViewport=function(t,r,a,o){var s=this.gl;s.viewport(t,r,a,o)},n.setScissor=function(t,r,a,o){var s=this.gl;this.setScissorEnabled(!0),s.scissor(t,r,a,o)},n.applyAttachmentStateIndexed=function(t,r,a){var o=this.gl,s=this.OES_draw_buffers_indexed;r.channelWriteMask!==a.channelWriteMask&&(s.colorMaskiOES(t,!!(a.channelWriteMask&it.Red),!!(a.channelWriteMask&it.Green),!!(a.channelWriteMask&it.Blue),!!(a.channelWriteMask&it.Alpha)),r.channelWriteMask=a.channelWriteMask);var u=r.rgbBlendState.blendMode!==a.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==a.alphaBlendState.blendMode,l=r.rgbBlendState.blendSrcFactor!==a.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==a.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==a.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==a.alphaBlendState.blendDstFactor;(l||u)&&(Yr(r.rgbBlendState)&&Yr(r.alphaBlendState)?s.enableiOES(t,o.BLEND):Yr(a.rgbBlendState)&&Yr(a.alphaBlendState)&&s.disableiOES(t,o.BLEND)),u&&(s.blendEquationSeparateiOES(t,a.rgbBlendState.blendMode,a.alphaBlendState.blendMode),r.rgbBlendState.blendMode=a.rgbBlendState.blendMode,r.alphaBlendState.blendMode=a.alphaBlendState.blendMode),l&&(s.blendFuncSeparateiOES(t,a.rgbBlendState.blendSrcFactor,a.rgbBlendState.blendDstFactor,a.alphaBlendState.blendSrcFactor,a.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=a.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=a.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=a.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=a.alphaBlendState.blendDstFactor)},n.applyAttachmentState=function(t,r){var a=this.gl;t.channelWriteMask!==r.channelWriteMask&&(a.colorMask(!!(r.channelWriteMask&it.Red),!!(r.channelWriteMask&it.Green),!!(r.channelWriteMask&it.Blue),!!(r.channelWriteMask&it.Alpha)),t.channelWriteMask=r.channelWriteMask);var o=t.rgbBlendState.blendMode!==r.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==r.alphaBlendState.blendMode,s=t.rgbBlendState.blendSrcFactor!==r.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==r.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==r.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==r.alphaBlendState.blendDstFactor;(s||o)&&(Yr(t.rgbBlendState)&&Yr(t.alphaBlendState)?a.enable(a.BLEND):Yr(r.rgbBlendState)&&Yr(r.alphaBlendState)&&a.disable(a.BLEND)),o&&(a.blendEquationSeparate(r.rgbBlendState.blendMode,r.alphaBlendState.blendMode),t.rgbBlendState.blendMode=r.rgbBlendState.blendMode,t.alphaBlendState.blendMode=r.alphaBlendState.blendMode),s&&(a.blendFuncSeparate(r.rgbBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor,r.alphaBlendState.blendSrcFactor,r.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=r.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=r.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=r.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=r.alphaBlendState.blendDstFactor)},n.setMegaState=function(t){var r=this.gl,a=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var o=0;o<t.attachmentsState.length;o++)this.applyAttachmentStateIndexed(o,a.attachmentsState[0],t.attachmentsState[0]);else Z(t.attachmentsState.length===1),this.applyAttachmentState(a.attachmentsState[0],t.attachmentsState[0]);ph(a.blendConstant,t.blendConstant)||(r.blendColor(t.blendConstant.r,t.blendConstant.g,t.blendConstant.b,t.blendConstant.a),gh(a.blendConstant,t.blendConstant)),a.depthCompare!==t.depthCompare&&(r.depthFunc(t.depthCompare),a.depthCompare=t.depthCompare),a.depthWrite!==t.depthWrite&&(r.depthMask(t.depthWrite),a.depthWrite=t.depthWrite),a.stencilWrite!==t.stencilWrite&&(r.stencilMask(t.stencilWrite?255:0),a.stencilWrite=t.stencilWrite),a.stencilPassOp!==t.stencilPassOp&&(r.stencilOp(r.KEEP,r.KEEP,t.stencilPassOp),a.stencilPassOp=t.stencilPassOp),(a.stencilRef!==t.stencilRef||a.stencilCompare!==t.stencilCompare)&&(a.stencilCompare=t.stencilCompare,this.setStencilRef(t.stencilRef)),a.cullMode!==t.cullMode&&(a.cullMode===hr.None?r.enable(r.CULL_FACE):t.cullMode===hr.None&&r.disable(r.CULL_FACE),t.cullMode===hr.Back?r.cullFace(r.BACK):t.cullMode===hr.Front?r.cullFace(r.FRONT):t.cullMode===hr.FrontAndBack&&r.cullFace(r.FRONT_AND_BACK),a.cullMode=t.cullMode),a.frontFace!==t.frontFace&&(r.frontFace(t.frontFace),a.frontFace=t.frontFace),a.polygonOffset!==t.polygonOffset&&(t.polygonOffset?(r.polygonOffset(1,1),r.enable(r.POLYGON_OFFSET_FILL)):r.disable(r.POLYGON_OFFSET_FILL),a.polygonOffset=t.polygonOffset)},n.validatePipelineFormats=function(t){for(var r=0;r<this.currentColorAttachments.length;r++){var a=this.currentColorAttachments[r];a!==null&&Z(a.pixelFormat===t.colorAttachmentFormats[r])}this.currentDepthStencilAttachment!==null&&Z(this.currentDepthStencilAttachment.pixelFormat===t.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Z(this.currentSampleCount===t.sampleCount)},n.setPipeline=function(t){this.currentPipeline=t,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var r=this.currentPipeline.program;if(this.useProgram(r),r.compileState===Nt.NeedsBind){var a=this.gl,o=r.gl_program,s=r.descriptor,u=wf(s.preprocessedVert,/uniform (\w+) {([^]*?)}/g);if(J(a))for(var l=0;l<u.length;l++){var f=u[l],c=f[1],h=a.getUniformBlockIndex(o,c);h!==-1&&h!==4294967295&&a.uniformBlockBinding(o,h,l)}for(var p=wf(s.preprocessedVert,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),g=0;g<p.length;g++){var _=p[g],E=_[1],y=_[2],R=a.getUniformLocation(o,E);a.uniform1i(R,parseInt(y))}r.compileState=Nt.ReadyToUse}},n.setInputState=function(t){var r=t;this.currentInputState=r,this.currentInputState!==null?(Z(this.currentPipeline.inputLayout===this.currentInputState.inputLayout),this.bindVAO(this.currentInputState.vao)):(Z(this.currentPipeline.inputLayout===null),this.bindVAO(null))},n.setStencilRef=function(t){this.currentStencilRef!==t&&(this.currentStencilRef=t,this.applyStencil())},n.draw=function(t,r){var a=this.gl,o=this.currentPipeline;a.drawArrays(o.drawMode,r,t),this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3)},n.drawIndexed=function(t,r){var a=this.gl,o=this.currentPipeline,s=this.currentInputState,u=Ue(s.indexBufferByteOffset)+r*Ue(s.indexBufferCompByteSize);a.drawElements(o.drawMode,t,Ue(s.indexBufferType),u),this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3)},n.drawIndexedInstanced=function(t,r,a){var o=this.gl,s=this.currentPipeline,u=this.currentInputState,l=Ue(u.indexBufferByteOffset)+r*Ue(u.indexBufferCompByteSize),f=[s.drawMode,t,Ue(u.indexBufferType),l,a];if(J(o))o.drawElementsInstanced.apply(o,f);else{var c;(c=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(c,f)}this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(t/3*a)},n.beginOcclusionQuery=function(t){var r=this.gl;if(J(r)){var a=this.currentRenderPassDescriptor.occlusionQueryPool;r.beginQuery(a.gl_query_type,a.gl_query[t])}},n.endOcclusionQuery=function(t){var r=this.gl;if(J(r)){var a=this.currentRenderPassDescriptor.occlusionQueryPool;r.endQuery(a.gl_query_type)}},n.beginDebugGroup=function(t){},n.endDebugGroup=function(){},n.pipelineQueryReady=function(t){var r=t;return this.queryProgramReady(r.program)},n.pipelineForceReady=function(t){},n.endPass=function(){for(var t=this.gl,r=!1,a=0;a<this.currentColorAttachments.length;a++){var o=this.currentColorAttachments[a];if(o!==null){var s=this.currentColorResolveTos[a],u=!1;s!==null&&(Z(o.width===s.width&&o.height===s.height),Z(o.pixelFormat===s.pixelFormat),this.setScissorEnabled(!1),J(t)&&t.bindFramebuffer(t.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&J(t)&&this.bindFramebufferAttachment(t.READ_FRAMEBUFFER,t.COLOR_ATTACHMENT0,o),u=!0,s===this.scTexture?t.bindFramebuffer(J(t)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,this.scPlatformFramebuffer):(t.bindFramebuffer(J(t)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&t.framebufferTexture2D(J(t)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s.gl_texture,0)),J(t)?(t.blitFramebuffer(0,0,o.width,o.height,0,0,s.width,s.height,t.COLOR_BUFFER_BIT,t.LINEAR),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(o,s),r=!0),this.currentRenderPassDescriptor.colorStore[a]||(u||(t.bindFramebuffer(J(t)?L.READ_FRAMEBUFFER:L.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(J(t)?L.READ_FRAMEBUFFER:L.FRAMEBUFFER,t.COLOR_ATTACHMENT0,o)),J(t)&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.COLOR_ATTACHMENT0])),t.bindFramebuffer(J(t)?L.READ_FRAMEBUFFER:L.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var l=this.currentDepthStencilAttachment;if(l!==null){var f=this.currentDepthStencilResolveTo,c=!1;f!==null&&(Z(l.width===f.width&&l.height===f.height),this.setScissorEnabled(!1),t.bindFramebuffer(J(t)?L.READ_FRAMEBUFFER:L.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),t.bindFramebuffer(J(t)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(J(t)?L.READ_FRAMEBUFFER:L.FRAMEBUFFER,l),this.bindFramebufferDepthStencilAttachment(J(t)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,f)),c=!0,J(t)&&t.blitFramebuffer(0,0,l.width,l.height,0,0,f.width,f.height,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(J(t)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,null),r=!0),this.currentRenderPassDescriptor.depthStencilStore||(c||(t.bindFramebuffer(J(t)?L.READ_FRAMEBUFFER:L.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(J(t)?L.READ_FRAMEBUFFER:L.FRAMEBUFFER,l),c=!0),J(t)&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,[t.DEPTH_STENCIL_ATTACHMENT])),c&&t.bindFramebuffer(J(t)?L.READ_FRAMEBUFFER:L.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}r||t.bindFramebuffer(J(t)?L.DRAW_FRAMEBUFFER:L.FRAMEBUFFER,null)},n.setScissorEnabled=function(t){if(this.currentScissorEnabled!==t){var r=this.gl;t?r.enable(r.SCISSOR_TEST):r.disable(r.SCISSOR_TEST),this.currentScissorEnabled=t}},n.applyStencil=function(){this.currentStencilRef!==null&&this.gl.stencilFunc(this.currentMegaState.stencilCompare,this.currentStencilRef,255)},n.getFallbackTexture=function(t){var r=t.gl_target,a=t.formatKind;if(r===L.TEXTURE_2D)return a===wt.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(r===L.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(r===L.TEXTURE_3D)return this.fallbackTexture3D;if(r===L.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},n.submitBlitRenderPass=function(t,r){if(!this.blitRenderPipeline){var a=Bs(this,ut.VERTEX|ut.COPY_DST,new Float32Array([-4,-4,4,-4,0,4]).buffer),o=this.createInputLayout({vertexBufferDescriptors:[{byteStride:4*2,frequency:be.PerVertex}],vertexAttributeDescriptors:[{format:G.F32_RG,bufferIndex:0,bufferByteOffset:4*0,location:0}],indexBufferFormat:null}),s=[{numSamplers:1,numUniformBuffers:0}],u=this.createProgram(to({},Th(this,new FT),{ensurePreprocessed:function(){},associate:function(){}}));this.blitInputState=this.createInputState(o,[{buffer:a,byteOffset:0}],null,u),this.blitRenderPipeline=this.createRenderPipeline({topology:Tr.Triangles,sampleCount:1,program:u,bindingLayouts:s,colorAttachmentFormats:[G.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:o,megaStateDescriptor:this.currentMegaState}),this.blitBindings=this.createBindings({bindingLayout:s[0],samplerBindings:[{sampler:null,texture:t.texture,lateBinding:null}],uniformBufferBindings:[]}),u.setUniforms({u_Texture:t})}var l=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var f=this.createRenderPass({colorAttachment:[t],colorResolveTo:[r],colorClearColor:[ki],colorStore:[!0],depthStencilAttachment:null,depthStencilResolveTo:null,depthStencilStore:!0,depthClearValue:"load",stencilClearValue:"load",occlusionQueryPool:null}),c=this.getCanvas(),h=c.width,p=c.height;f.setPipeline(this.blitRenderPipeline),f.setBindings(0,this.blitBindings,[0]),f.setInputState(this.blitInputState),f.setViewport(0,0,h,p),this.gl.disable(this.gl.BLEND),f.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=l,this.inBlitRenderPass=!1},e}(),P1=function(){function e(i){this.pluginOptions=void 0,this.pluginOptions=i}var n=e.prototype;return n.createSwapChain=function(){var i=Gs(_n().mark(function r(a){var o,s,u;return _n().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return o={antialias:!1,preserveDrawingBuffer:!1,stencil:!0},s=this.pluginOptions.targets,s.includes("webgl2")&&(u=a.getContext("webgl2",o)||a.getContext("experimental-webgl2",o)),!u&&s.includes("webgl1")&&(u=a.getContext("webgl",o)||a.getContext("experimental-webgl",o)),f.abrupt("return",new A1(u,{shaderDebug:!0,trackResources:!0}));case 5:case"end":return f.stop()}},r,this)}));function t(r){return i.apply(this,arguments)}return t}(),e}(),x1=function(e){Lt(n,e);function n(t){var r;return r=e.call(this)||this,r.options=void 0,r.name="webgl-device",r.options=t,r}var i=n.prototype;return i.init=function(){this.context.deviceContribution=new P1(to({},this.options))},i.destroy=function(){delete this.context.deviceContribution},n}(un);function Ri(){Ri=function(){return e};var e={},n=Object.prototype,i=n.hasOwnProperty,t=Object.defineProperty||function(d,v,m){d[v]=m.value},r=typeof Symbol=="function"?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(d,v,m){return Object.defineProperty(d,v,{value:m,enumerable:!0,configurable:!0,writable:!0}),d[v]}try{u({},"")}catch{u=function(v,m,S){return v[m]=S}}function l(d,v,m,S){var T=v&&v.prototype instanceof h?v:h,N=Object.create(T.prototype),B=new D(S||[]);return t(N,"_invoke",{value:x(d,m,B)}),N}function f(d,v,m){try{return{type:"normal",arg:d.call(v,m)}}catch(S){return{type:"throw",arg:S}}}e.wrap=l;var c={};function h(){}function p(){}function g(){}var _={};u(_,a,function(){return this});var E=Object.getPrototypeOf,y=E&&E(E(F([])));y&&y!==n&&i.call(y,a)&&(_=y);var R=g.prototype=h.prototype=Object.create(_);function A(d){["next","throw","return"].forEach(function(v){u(d,v,function(m){return this._invoke(v,m)})})}function M(d,v){function m(T,N,B,w){var U=f(d[T],d,N);if(U.type!=="throw"){var V=U.arg,K=V.value;return K&&typeof K=="object"&&i.call(K,"__await")?v.resolve(K.__await).then(function(z){m("next",z,B,w)},function(z){m("throw",z,B,w)}):v.resolve(K).then(function(z){V.value=z,B(V)},function(z){return m("throw",z,B,w)})}w(U.arg)}var S;t(this,"_invoke",{value:function(T,N){function B(){return new v(function(w,U){m(T,N,w,U)})}return S=S?S.then(B,B):B()}})}function x(d,v,m){var S="suspendedStart";return function(T,N){if(S==="executing")throw new Error("Generator is already running");if(S==="completed"){if(T==="throw")throw N;return k()}for(m.method=T,m.arg=N;;){var B=m.delegate;if(B){var w=P(B,m);if(w){if(w===c)continue;return w}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(S==="suspendedStart")throw S="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);S="executing";var U=f(d,v,m);if(U.type==="normal"){if(S=m.done?"completed":"suspendedYield",U.arg===c)continue;return{value:U.arg,done:m.done}}U.type==="throw"&&(S="completed",m.method="throw",m.arg=U.arg)}}}function P(d,v){var m=v.method,S=d.iterator[m];if(S===void 0)return v.delegate=null,m==="throw"&&d.iterator.return&&(v.method="return",v.arg=void 0,P(d,v),v.method==="throw")||m!=="return"&&(v.method="throw",v.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var T=f(S,d.iterator,v.arg);if(T.type==="throw")return v.method="throw",v.arg=T.arg,v.delegate=null,c;var N=T.arg;return N?N.done?(v[d.resultName]=N.value,v.next=d.nextLoc,v.method!=="return"&&(v.method="next",v.arg=void 0),v.delegate=null,c):N:(v.method="throw",v.arg=new TypeError("iterator result is not an object"),v.delegate=null,c)}function C(d){var v={tryLoc:d[0]};1 in d&&(v.catchLoc=d[1]),2 in d&&(v.finallyLoc=d[2],v.afterLoc=d[3]),this.tryEntries.push(v)}function O(d){var v=d.completion||{};v.type="normal",delete v.arg,d.completion=v}function D(d){this.tryEntries=[{tryLoc:"root"}],d.forEach(C,this),this.reset(!0)}function F(d){if(d){var v=d[a];if(v)return v.call(d);if(typeof d.next=="function")return d;if(!isNaN(d.length)){var m=-1,S=function T(){for(;++m<d.length;)if(i.call(d,m))return T.value=d[m],T.done=!1,T;return T.value=void 0,T.done=!0,T};return S.next=S}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=g,t(R,"constructor",{value:g,configurable:!0}),t(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(d){var v=typeof d=="function"&&d.constructor;return!!v&&(v===p||(v.displayName||v.name)==="GeneratorFunction")},e.mark=function(d){return Object.setPrototypeOf?Object.setPrototypeOf(d,g):(d.__proto__=g,u(d,s,"GeneratorFunction")),d.prototype=Object.create(R),d},e.awrap=function(d){return{__await:d}},A(M.prototype),u(M.prototype,o,function(){return this}),e.AsyncIterator=M,e.async=function(d,v,m,S,T){T===void 0&&(T=Promise);var N=new M(l(d,v,m,S),T);return e.isGeneratorFunction(v)?N:N.next().then(function(B){return B.done?B.value:N.next()})},A(R),u(R,s,"Generator"),u(R,a,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),e.keys=function(d){var v=Object(d),m=[];for(var S in v)m.push(S);return m.reverse(),function T(){for(;m.length;){var N=m.pop();if(N in v)return T.value=N,T.done=!1,T}return T.done=!0,T}},e.values=F,D.prototype={constructor:D,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!d)for(var v in this)v.charAt(0)==="t"&&i.call(this,v)&&!isNaN(+v.slice(1))&&(this[v]=void 0)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var v=this;function m(U,V){return N.type="throw",N.arg=d,v.next=U,V&&(v.method="next",v.arg=void 0),!!V}for(var S=this.tryEntries.length-1;S>=0;--S){var T=this.tryEntries[S],N=T.completion;if(T.tryLoc==="root")return m("end");if(T.tryLoc<=this.prev){var B=i.call(T,"catchLoc"),w=i.call(T,"finallyLoc");if(B&&w){if(this.prev<T.catchLoc)return m(T.catchLoc,!0);if(this.prev<T.finallyLoc)return m(T.finallyLoc)}else if(B){if(this.prev<T.catchLoc)return m(T.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return m(T.finallyLoc)}}}},abrupt:function(d,v){for(var m=this.tryEntries.length-1;m>=0;--m){var S=this.tryEntries[m];if(S.tryLoc<=this.prev&&i.call(S,"finallyLoc")&&this.prev<S.finallyLoc){var T=S;break}}T&&(d==="break"||d==="continue")&&T.tryLoc<=v&&v<=T.finallyLoc&&(T=null);var N=T?T.completion:{};return N.type=d,N.arg=v,T?(this.method="next",this.next=T.finallyLoc,c):this.complete(N)},complete:function(d,v){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&v&&(this.next=v),c},finish:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.finallyLoc===d)return this.complete(m.completion,m.afterLoc),O(m),c}},catch:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.tryLoc===d){var S=m.completion;if(S.type==="throw"){var T=S.arg;O(m)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(d,v,m){return this.delegate={iterator:F(d),resultName:v,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},e}function Ff(e,n,i,t,r,a,o){try{var s=e[a](o),u=s.value}catch(l){i(l);return}s.done?n(u):Promise.resolve(u).then(t,r)}function Uf(e){return function(){var n=this,i=arguments;return new Promise(function(t,r){var a=e.apply(n,i);function o(u){Ff(a,t,r,o,s,"next",u)}function s(u){Ff(a,t,r,o,s,"throw",u)}o(void 0)})}}function Gh(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,Qs(e,n)}function Qs(e,n){return Qs=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Qs(e,n)}var M1=function(){function e(i){this.$container=void 0,this.$canvas=void 0,this.dpr=void 0,this.canvasConfig=void 0,this.deviceRendererPlugin=void 0,this.canvasConfig=i.config,this.deviceRendererPlugin=i.deviceRendererPlugin}var n=e.prototype;return n.init=function(){var i=Uf(Ri().mark(function r(){var a,o,s,u;return Ri().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:a=this.canvasConfig,o=a.container,s=a.canvas,s?(this.$canvas=s,o&&s.parentElement!==o&&o.appendChild(s),this.$container=s.parentElement,this.canvasConfig.container=this.$container):o&&(this.$container=vt(o)?document.getElementById(o):o,this.$container&&(u=document.createElement("canvas"),this.$container.appendChild(u),this.$container.style.position||(this.$container.style.position="relative"),this.$canvas=u)),this.resize(this.canvasConfig.width,this.canvasConfig.height);case 3:case"end":return f.stop()}},r,this)}));function t(){return i.apply(this,arguments)}return t}(),n.getDomElement=function(){return this.$canvas},n.getContext=function(){return this.deviceRendererPlugin.getDevice().gl},n.getBoundingClientRect=function(){if(this.$canvas.getBoundingClientRect)return this.$canvas.getBoundingClientRect()},n.destroy=function(){this.$container&&this.$canvas&&this.$canvas.parentNode&&this.$container.removeChild(this.$canvas)},n.resize=function(t,r){var a=this.canvasConfig.devicePixelRatio,o=a||ei&&window.devicePixelRatio||1;if(o=o>=1?Math.ceil(o):1,this.dpr=o,this.$canvas){var s=this.getDPR();this.$canvas.width=s*t,this.$canvas.height=s*r,t0(this.$canvas,t,r)}},n.getDPR=function(){return this.dpr},n.applyCursorStyle=function(t){this.$container&&this.$container.style&&(this.$container.style.cursor=t)},n.toDataURL=function(){var i=Uf(Ri().mark(function r(a){return Ri().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return a===void 0&&(a={}),s.abrupt("return",this.deviceRendererPlugin.toDataURL(a));case 2:case"end":return s.stop()}},r,this)}));function t(r){return i.apply(this,arguments)}return t}(),e}(),C1=function(e){Gh(n,e);function n(t){var r;return r=e.call(this)||this,r.rendererPlugin=void 0,r.name="webgl-context-register",r.rendererPlugin=t,r}var i=n.prototype;return i.init=function(){this.context.ContextService=M1,this.context.deviceRendererPlugin=this.rendererPlugin},i.destroy=function(){delete this.context.ContextService},n}(un),O1=function(e){Gh(n,e);function n(i){var t;t=e.call(this,i)||this;var r=new UT;return t.registerPlugin(new C1(r)),t.registerPlugin(new JT),t.registerPlugin(new x1(i!=null&&i.targets?{targets:i.targets}:{targets:["webgl2","webgl1"]})),t.registerPlugin(r),t.registerPlugin(new WT),t.registerPlugin(new zT),t}return n}(Vm);function kf(e,n){for(var i=0;i<n.length;i++){var t=n[i];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,b1(t.key),t)}}function Su(e,n,i){return n&&kf(e.prototype,n),i&&kf(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function Hr(){return Hr=Object.assign?Object.assign.bind():function(e){for(var n=1;n<arguments.length;n++){var i=arguments[n];for(var t in i)Object.prototype.hasOwnProperty.call(i,t)&&(e[t]=i[t])}return e},Hr.apply(this,arguments)}function ni(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,Js(e,n)}function Js(e,n){return Js=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},Js(e,n)}function N1(e,n){if(e==null)return{};var i={},t=Object.keys(e),r,a;for(a=0;a<t.length;a++)r=t[a],!(n.indexOf(r)>=0)&&(i[r]=e[r]);return i}function I1(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function D1(e,n){if(typeof e!="object"||e===null)return e;var i=e[Symbol.toPrimitive];if(i!==void 0){var t=i.call(e,n||"default");if(typeof t!="object")return t;throw new TypeError("@@toPrimitive must return a primitive value.")}return(n==="string"?String:Number)(e)}function b1(e){var n=D1(e,"string");return typeof n=="symbol"?n:String(n)}var w1=function(e){ni(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.flipYMatrix=Jf(Te(),me(1,-1,1)),t}var i=n.prototype;return i.applyMa4Position=function(r,a){for(var o=Jr(),s=0;s<a.byteLength/4;s+=3)o[0]=a[s],o[1]=a[s+1],o[2]=a[s+2],o[3]=1,gn(o,o,r),a[s]=o[0],a[s+1]=o[1],a[s+2]=o[2];this.updateVertexBuffer(Ne.POSITION,_e.POSITION,0,new Uint8Array(a.buffer))},i.applyMa4Normal=function(r,a){var o=Jr(),s=Ar(Te(),r);Rr(s,s),iu(s,s);for(var u=0;u<a.byteLength/4;u+=3)o[0]=a[u],o[1]=a[u+1],o[2]=a[u+2],o[3]=1,gn(o,o,s),a[u]=o[0],a[u+1]=o[1],a[u+2]=o[2];this.updateVertexBuffer(Ne.NORMAL,_e.NORMAL,0,new Uint8Array(a.buffer))},i.rebuildPosition=function(){var r=this.createTopology(),a=r.positions,o=Float32Array.from(a);this.applyMa4Position(this.flipYMatrix,o),this.dirty=!0},i.applyMat4=function(r){this.applyMa4Position(r,this.vertices[Ne.POSITION]),this.applyMa4Normal(r,this.vertices[Ne.NORMAL])},i.computeBoundingBox=function(){return new ct},i.build=function(){var r=this.createTopology(),a=r.indices,o=r.positions,s=r.normals,u=r.uvs;this.setIndexBuffer(new Uint32Array(a)),this.vertexCount=a.length,this.setVertexBuffer({bufferIndex:Ne.POSITION,byteStride:4*3,frequency:be.PerVertex,attributes:[{format:G.F32_RGB,bufferByteOffset:4*0,location:_e.POSITION}],data:Float32Array.from(o)}),this.setVertexBuffer({bufferIndex:Ne.NORMAL,byteStride:4*3,frequency:be.PerVertex,attributes:[{format:G.F32_RGB,bufferByteOffset:4*0,location:_e.NORMAL}],data:Float32Array.from(s)}),this.setVertexBuffer({bufferIndex:Ne.UV,byteStride:4*2,frequency:be.PerVertex,attributes:[{format:G.F32_RG,bufferByteOffset:4*0,location:_e.UV}],data:Float32Array.from(u)}),this.applyMat4(this.flipYMatrix),this.dirty=!0},n}(Ch),B1=function(e){ni(n,e);function n(t,r){return r===void 0&&(r={}),e.call(this,t,Hr({radius:.5,latitudeBands:16,longitudeBands:16},r))||this}var i=n.prototype;return i.createTopology=function(){var r,a,o,s,u,l,f,c,h,p,g,_,E,y,R,A=this.props,M=A.radius,x=M===void 0?.5:M,P=A.latitudeBands,C=P===void 0?16:P,O=A.longitudeBands,D=O===void 0?16:O,F=[],k=[],d=[],v=[];for(a=0;a<=C;a++)for(o=a*Math.PI/C,s=Math.sin(o),u=Math.cos(o),r=0;r<=D;r++)l=r*2*Math.PI/D-Math.PI/2,f=Math.sin(l),c=Math.cos(l),g=c*s,_=u,E=f*s,y=1-r/D,R=1-a/C,F.push(g*x,_*x,E*x),k.push(g,_,E),d.push(y,1-R);for(a=0;a<C;++a)for(r=0;r<D;++r)h=a*(D+1)+r,p=h+D+1,v.push(h+1,p,h),v.push(h+1,p+1,p);return{indices:v,positions:F,normals:k,uvs:d,uv1s:d}},Su(n,[{key:"radius",get:function(){return this.props.radius},set:function(r){this.props.radius!==r&&(this.props.radius=r,this.build())}},{key:"latitudeBands",get:function(){return this.props.latitudeBands},set:function(r){this.props.latitudeBands!==r&&(this.props.latitudeBands=r,this.build())}},{key:"longitudeBands",get:function(){return this.props.longitudeBands},set:function(r){this.props.longitudeBands!==r&&(this.props.longitudeBands=r,this.build())}}]),n}(w1),F1=["style"],U1=function(e){ni(n,e);function n(t){var r,a=t===void 0?{}:t,o=a.style,s=N1(a,F1);return r=e.call(this,Hr({style:Hr({direction:me(0,-1,0)},o)},s))||this,r.define="NUM_DIR_LIGHTS",r.order=10,r}var i=n.prototype;return i.getUniformWordCount=function(){return 4+4},i.uploadUBO=function(r,a){var o=this.parsedStyle,s=o.fill,u=o.direction,l=o.intensity;if(je(s)){var f=[Number(s.r)/255,Number(s.g)/255,Number(s.b)/255];r.push({name:"directionalLights["+a+"].direction",value:u}),r.push({name:"directionalLights["+a+"].intensity",value:l}),r.push({name:"directionalLights["+a+"].color",value:f})}},n}(Za),k1=`#define GLSLIFY 1
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_MaterialParams {
  #ifdef USE_WIREFRAME
    vec3 u_WireframeLineColor;
    float u_WireframeLineWidth;
  #endif

  #ifdef USE_FOG
    vec4 u_FogInfos;
    vec3 u_FogColor;
  #endif

  vec4 u_Placeholder;
};

layout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;
layout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;
layout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;
layout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;
layout(location = COLOR) in vec4 a_Color;
layout(location = STROKE_COLOR) in vec4 a_StrokeColor;
layout(location = PACKED_STYLE1) in vec4 a_StylePacked1;
layout(location = PACKED_STYLE2) in vec4 a_StylePacked2;
layout(location = PICKING_COLOR) in vec4 a_PickingColor;

out vec4 v_PickingResult;
out vec4 v_Color;
out vec4 v_StrokeColor;
out vec4 v_StylePacked1;
out vec4 v_StylePacked2;

#define COLOR_SCALE 1. / 255.
void setPickingColor(vec3 pickingColor) {
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}
vec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {
  return pm * vm * mm * pos;
}

layout(location = POSITION) in vec3 a_Position;

#ifdef USE_UV
  layout(location = UV) in vec2 a_Uv;
  out vec2 v_Uv;
#endif

#ifdef USE_WIREFRAME
  layout(location = BARYCENTRIC) in vec3 a_Barycentric;
  out vec3 v_Barycentric;
#endif

void main() {
  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
vec4 u_StrokeColor = a_StrokeColor;
float u_Opacity = a_StylePacked1.x;
float u_FillOpacity = a_StylePacked1.y;
float u_StrokeOpacity = a_StylePacked1.z;
float u_StrokeWidth = a_StylePacked1.w;
float u_ZIndex = a_PickingColor.w;
vec2 u_Anchor = a_StylePacked2.yz;
float u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;

setPickingColor(a_PickingColor.xyz);

v_Color = a_Color;
v_StrokeColor = a_StrokeColor;
v_StylePacked1 = a_StylePacked1;
v_StylePacked2 = a_StylePacked2;

#ifdef CLIPSPACE_NEAR_ZERO
    gl_Position.z = gl_Position.z * 0.5 + 0.5;
#endif

  gl_Position = project(vec4(a_Position, 1.0), u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);

  #ifdef USE_UV
  v_Uv = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
    v_Uv.y = 1.0 - v_Uv.y;
  #endif
#endif

  #ifdef USE_WIREFRAME
  v_Barycentric = a_Barycentric;
#endif

}`,L1=`#define GLSLIFY 1
#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6

#ifndef saturate
  #define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )

float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }

// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.
// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand( const in vec2 uv ) {
  const highp float a = 12.9898, b = 78.233, c = 43758.5453;
  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );

  return fract( sin( sn ) * c );
}

mat3 transposeMat3(mat3 inMatrix) {
  vec3 i0 = inMatrix[0];
  vec3 i1 = inMatrix[1];
  vec3 i2 = inMatrix[2];

  mat3 outMatrix = mat3(
    vec3(i0.x, i1.x, i2.x),
    vec3(i0.y, i1.y, i2.y),
    vec3(i0.z, i1.z, i2.z)
    );

  return outMatrix;
}

// https://github.com/glslify/glsl-inverse/blob/master/index.glsl
mat3 inverseMat3(mat3 inMatrix) {
  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];
  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];
  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];

  float b01 = a22 * a11 - a12 * a21;
  float b11 = -a22 * a10 + a12 * a20;
  float b21 = a21 * a10 - a11 * a20;

  float det = a00 * b01 + a01 * b11 + a02 * b21;

  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
}

struct DirectionalLight {
  vec3 direction;
  float intensity;
  vec3 color;
};

struct IncidentLight {
  vec3 color;
  vec3 direction;
  bool visible;
};

struct ReflectedLight {
  vec3 directDiffuse;
  vec3 directSpecular;
  vec3 indirectDiffuse;
  vec3 indirectSpecular;
};

struct GeometricContext {
  vec3 position;
  vec3 normal;
  vec3 viewDir;
};
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_MaterialParams {
  #ifdef USE_WIREFRAME
    vec3 u_WireframeLineColor;
    float u_WireframeLineWidth;
  #endif

  #ifdef USE_FOG
    vec4 u_FogInfos;
    vec3 u_FogColor;
  #endif

  vec4 u_Placeholder;
};

in vec4 v_PickingResult;
in vec4 v_Color;
in vec4 v_StrokeColor;
in vec4 v_StylePacked1;
in vec4 v_StylePacked2;
#ifdef USE_UV
  in vec2 v_Uv;
#endif
#ifdef USE_MAP
  uniform sampler2D u_Map;
#endif
#ifdef USE_WIREFRAME
  in vec3 v_Barycentric;

  float edgeFactor() {
    vec3 d = fwidth(v_Barycentric);
    vec3 a3 = smoothstep(vec3(0.0), d * u_WireframeLineWidth, v_Barycentric);
    return min(min(a3.x, a3.y), a3.z);
  }
#endif

#ifdef USE_FOG
  #define FOGMODE_NONE 0.
  #define FOGMODE_EXP 1.
  #define FOGMODE_EXP2 2.
  #define FOGMODE_LINEAR 3.

  // in float v_FogDepth;

  float dBlendModeFogFactor = 1.0;

  vec3 addFog(vec3 color) {
    float depth = gl_FragCoord.z / gl_FragCoord.w;
    // float depth = v_FogDepth;
    float fogFactor;
    float fogStart = u_FogInfos.y;
    float fogEnd = u_FogInfos.z;
    float fogDensity = u_FogInfos.w;

    if (u_FogInfos.x == FOGMODE_NONE) {
      fogFactor = 1.0;
    } else if (u_FogInfos.x == FOGMODE_EXP) {
      fogFactor = exp(-depth * fogDensity);
    } else if (u_FogInfos.x == FOGMODE_EXP2) {
      fogFactor = exp(-depth * depth * fogDensity * fogDensity);
    } else if (u_FogInfos.x == FOGMODE_LINEAR) {
      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);
    }

    fogFactor = clamp(fogFactor, 0.0, 1.0);
    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);
  }
#endif

out vec4 outputColor;

void main() {
  vec4 u_Color = v_Color;
vec4 u_StrokeColor = v_StrokeColor;
float u_Opacity = v_StylePacked1.x;
float u_FillOpacity = v_StylePacked1.y;
float u_StrokeOpacity = v_StylePacked1.z;
float u_StrokeWidth = v_StylePacked1.w;
float u_Visible = v_StylePacked2.x;
vec3 u_PickingColor = v_PickingResult.xyz;

if (u_Visible < 0.5) {
    discard;
}
  #ifdef USE_MAP
  #ifdef USE_PATTERN
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #else
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #endif
#endif

  if (u_IsPicking > 0.5) {
    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {
      discard;
    }
    outputColor = vec4(u_PickingColor, 1.0);
  } else {
    outputColor = u_Color;
    outputColor.a = outputColor.a * u_Opacity;
    vec4 diffuseColor = outputColor;

    ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
    reflectedLight.indirectDiffuse += vec3( 1.0 );
    reflectedLight.indirectDiffuse *= outputColor.rgb;

    vec3 outgoingLight = reflectedLight.indirectDiffuse;
    
    outputColor = vec4(outgoingLight, diffuseColor.a);

    #ifdef USE_WIREFRAME
  vec3 color = mix(outputColor.xyz, u_WireframeLineColor, (1.0 - edgeFactor()));
  outputColor.xyz = color;
#endif
    #ifdef USE_FOG
  outputColor.rgb = addFog(outputColor.rgb);
#endif
  }
}`,ro;(function(e){e.MAP="u_Map",e.PLACE_HOLDER="u_Placeholder"})(ro||(ro={}));var W1=function(e){ni(n,e);function n(i,t){var r,a;a=e.call(this,i,Hr({vertexShader:k1,fragmentShader:L1,cullMode:hr.Back},t))||this,a.defines=Hr({},a.defines,{USE_UV:!0,USE_MAP:!1,USE_WIREFRAME:!1,USE_FOG:!1,USE_LIGHT:!1});var o=t||{},s=o.map,u=o.wireframe;return s&&(a.map=s),a.wireframe=u,a.setUniforms((r={},r[ro.PLACE_HOLDER]=[0,0,0,0],r)),a}return Su(n,[{key:"map",get:function(){return this.props.map},set:function(t){var r;this.props.map!==t&&(this.props.map=t,this.programDirty=!0),this.setUniforms((r={},r[ro.MAP]=t,r))}},{key:"aoMap",get:function(){return this.props.aoMap},set:function(t){this.props.aoMap=t}}]),n}(Oh),H1=`#define GLSLIFY 1
#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6

#ifndef saturate
  #define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )

float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }

// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.
// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand( const in vec2 uv ) {
  const highp float a = 12.9898, b = 78.233, c = 43758.5453;
  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );

  return fract( sin( sn ) * c );
}

mat3 transposeMat3(mat3 inMatrix) {
  vec3 i0 = inMatrix[0];
  vec3 i1 = inMatrix[1];
  vec3 i2 = inMatrix[2];

  mat3 outMatrix = mat3(
    vec3(i0.x, i1.x, i2.x),
    vec3(i0.y, i1.y, i2.y),
    vec3(i0.z, i1.z, i2.z)
    );

  return outMatrix;
}

// https://github.com/glslify/glsl-inverse/blob/master/index.glsl
mat3 inverseMat3(mat3 inMatrix) {
  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];
  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];
  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];

  float b01 = a22 * a11 - a12 * a21;
  float b11 = -a22 * a10 + a12 * a20;
  float b21 = a21 * a10 - a11 * a20;

  float det = a00 * b01 + a01 * b11 + a02 * b21;

  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
}

struct DirectionalLight {
  vec3 direction;
  float intensity;
  vec3 color;
};

struct IncidentLight {
  vec3 color;
  vec3 direction;
  bool visible;
};

struct ReflectedLight {
  vec3 directDiffuse;
  vec3 directSpecular;
  vec3 indirectDiffuse;
  vec3 indirectSpecular;
};

struct GeometricContext {
  vec3 position;
  vec3 normal;
  vec3 viewDir;
};
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_MaterialParams {
  #ifdef USE_WIREFRAME
    vec3 u_WireframeLineColor;
    float u_WireframeLineWidth;
  #endif

  #ifdef USE_FOG
    vec4 u_FogInfos;
    vec3 u_FogColor;
  #endif

  vec3 u_Emissive;
  float u_Shininess;
  vec3 u_Specular;

  #ifdef USE_LIGHT
    #ifdef USE_BUMPMAP
      float u_BumpScale;
    #endif

    #ifdef NUM_AMBIENT_LIGHTS
      vec3 u_AmbientLightColor;
    #endif

    #ifdef NUM_DIR_LIGHTS
      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
    #endif
  #endif
};
#ifdef USE_LIGHT
  void getDirectionalLightInfo(
    const in DirectionalLight directionalLight, 
    const in GeometricContext geometry,
    out IncidentLight light
  ) {
    light.color = directionalLight.color * directionalLight.intensity;
    light.direction = normalize(directionalLight.direction);
    light.visible = true;
  }
#endif

in vec4 v_PickingResult;
in vec4 v_Color;
in vec4 v_StrokeColor;
in vec4 v_StylePacked1;
in vec4 v_StylePacked2;
#ifdef USE_UV
  in vec2 v_Uv;
#endif
#ifdef USE_MAP
  uniform sampler2D u_Map;
#endif
#if defined(USE_BUMPMAP) && defined(USE_LIGHT)
  uniform sampler2D u_BumpMap;

  // Bump Mapping Unparametrized Surfaces on the GPU by Morten S. Mikkelsen
  // http://api.unrealengine.com/attachments/Engine/Rendering/LightingAndShadows/BumpMappingWithoutTangentSpace/mm_sfgrad_bump.pdf

  // Evaluate the derivative of the height w.r.t. screen-space using forward differencing (listing 2)

  vec2 dHdxy_fwd() {
    vec2 dSTdx = dFdx( v_Uv );
    vec2 dSTdy = dFdy( v_Uv );

    float Hll = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv ).x;
    float dBx = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdx ).x - Hll;
    float dBy = u_BumpScale * texture(SAMPLER_2D(u_BumpMap), v_Uv + dSTdy ).x - Hll;

    return vec2( dBx, dBy );
  }

  vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {

    // Workaround for Adreno 3XX dFd*( vec3 ) bug. See #9988

    vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
    vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
    vec3 vN = surf_norm;		// normalized

    vec3 R1 = cross( vSigmaY, vN );
    vec3 R2 = cross( vN, vSigmaX );

    float fDet = dot( vSigmaX, R1 ) * faceDirection;

    vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
    return normalize( abs( fDet ) * surf_norm - vGrad );
  }
#endif
#ifdef USE_SPECULARMAP
  uniform sampler2D u_SpecularMap;
#endif
vec3 BRDF_Lambert(const in vec3 diffuseColor) {
  return RECIPROCAL_PI * diffuseColor;
}

vec3 F_Schlick(
  const in vec3 f0,
  const in float f90,
  const in float dotVH
) {
  // Original approximation by Christophe Schlick '94
  // float fresnel = pow( 1.0 - dotVH, 5.0 );

  // Optimized variant (presented by Epic at SIGGRAPH '13)
  // https://cdn2.unrealengine.com/Resources/files/2013SiggraphPresentationsNotes-26915738.pdf
  float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
  return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}

float G_BlinnPhong_Implicit( /* const in float dotNL, const in float dotNV */ ) {
  // geometry term is (n dot l)(n dot v) / 4(n dot l)(n dot v)
  return 0.25;
}

float D_BlinnPhong(
  const in float shininess,
  const in float dotNH
) {
  return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}

vec3 BRDF_BlinnPhong(
  const in vec3 lightDir,
  const in vec3 viewDir,
  const in vec3 normal,
  const in vec3 specularColor,
  const in float shininess
) {
  vec3 halfDir = normalize( lightDir + viewDir );

  float dotNH = saturate( dot( normal, halfDir ) );
  float dotVH = saturate( dot( viewDir, halfDir ) );

  vec3 F = F_Schlick( specularColor, 1.0, dotVH );

  float G = G_BlinnPhong_Implicit( /* dotNL, dotNV */ );

  float D = D_BlinnPhong( shininess, dotNH );

  return F * ( G * D );
}

#ifdef USE_WIREFRAME
  in vec3 v_Barycentric;

  float edgeFactor() {
    vec3 d = fwidth(v_Barycentric);
    vec3 a3 = smoothstep(vec3(0.0), d * u_WireframeLineWidth, v_Barycentric);
    return min(min(a3.x, a3.y), a3.z);
  }
#endif

#ifdef USE_FOG
  #define FOGMODE_NONE 0.
  #define FOGMODE_EXP 1.
  #define FOGMODE_EXP2 2.
  #define FOGMODE_LINEAR 3.

  // in float v_FogDepth;

  float dBlendModeFogFactor = 1.0;

  vec3 addFog(vec3 color) {
    float depth = gl_FragCoord.z / gl_FragCoord.w;
    // float depth = v_FogDepth;
    float fogFactor;
    float fogStart = u_FogInfos.y;
    float fogEnd = u_FogInfos.z;
    float fogDensity = u_FogInfos.w;

    if (u_FogInfos.x == FOGMODE_NONE) {
      fogFactor = 1.0;
    } else if (u_FogInfos.x == FOGMODE_EXP) {
      fogFactor = exp(-depth * fogDensity);
    } else if (u_FogInfos.x == FOGMODE_EXP2) {
      fogFactor = exp(-depth * depth * fogDensity * fogDensity);
    } else if (u_FogInfos.x == FOGMODE_LINEAR) {
      fogFactor = (fogEnd - depth) / (fogEnd - fogStart);
    }

    fogFactor = clamp(fogFactor, 0.0, 1.0);
    return mix(u_FogColor * dBlendModeFogFactor, color, fogFactor);
  }
#endif

struct BlinnPhongMaterial {
  vec3 diffuseColor;
  vec3 specularColor;
  float specularShininess;
  float specularStrength;
};

void RE_Direct_BlinnPhong(
  const in IncidentLight directLight,
  const in GeometricContext geometry,
  const in BlinnPhongMaterial material,
  inout ReflectedLight reflectedLight
) {
  float dotNL = saturate(dot(geometry.normal, directLight.direction));
  vec3 irradiance = dotNL * directLight.color;

  reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );

  reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;
}

void RE_IndirectDiffuse_BlinnPhong(
  const in vec3 irradiance,
  const in GeometricContext geometry,
  const in BlinnPhongMaterial material,
  inout ReflectedLight reflectedLight
) {
  reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}

vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}

#define RE_Direct           RE_Direct_BlinnPhong
#define RE_IndirectDiffuse  RE_IndirectDiffuse_BlinnPhong

in vec3 v_ViewPosition;
in vec3 v_Normal;

out vec4 outputColor;

void main() {
  vec4 u_Color = v_Color;
vec4 u_StrokeColor = v_StrokeColor;
float u_Opacity = v_StylePacked1.x;
float u_FillOpacity = v_StylePacked1.y;
float u_StrokeOpacity = v_StylePacked1.z;
float u_StrokeWidth = v_StylePacked1.w;
float u_Visible = v_StylePacked2.x;
vec3 u_PickingColor = v_PickingResult.xyz;

if (u_Visible < 0.5) {
    discard;
}

  // diffusemap
  #ifdef USE_MAP
  #ifdef USE_PATTERN
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #else
    vec4 texelColor = texture(SAMPLER_2D(u_Map), v_Uv);
    u_Color = texelColor;
  #endif
#endif
  // specularmap
  float specularStrength = 1.0;

#ifdef USE_SPECULARMAP
  vec4 texelSpecular = texture(SAMPLER_2D(u_SpecularMap), v_Uv);
  specularStrength = texelSpecular.r;
#endif
  // bumpmap & normalmap
  float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
vec3 normal = normalize(v_Normal);
#ifdef USE_DOUBLESIDE
  normal = normal * faceDirection;
#endif

// #ifdef USE_TANGENT
//   vec3 tangent = normalize( vTangent );
//   vec3 bitangent = normalize( vBitangent );

//   #ifdef DOUBLE_SIDED
//     tangent = tangent * faceDirection;
//     bitangent = bitangent * faceDirection;
//   #endif

// #if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )

// mat3 vTBN = mat3( tangent, bitangent, normal );

// #endif
// #endif
  #ifdef OBJECTSPACE_NORMALMAP
  // normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0; // overrides both flatShading and attribute normals

  // #ifdef FLIP_SIDED
  //   normal = - normal;
  // #endif

  // #ifdef DOUBLE_SIDED
  //   normal = normal * faceDirection;
  // #endif

  // normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
  // vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
  // mapN.xy *= normalScale;

  // #ifdef USE_TANGENT
  //   normal = normalize( vTBN * mapN );
  // #else
  //   normal = perturbNormal2Arb( - v_ViewPosition, normal, mapN, faceDirection );
  // #endif

#elif defined(USE_BUMPMAP) && defined(USE_LIGHT)
  normal = perturbNormalArb( - v_ViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif

  if (u_IsPicking > 0.5) {
    if (u_PickingColor.x == 0.0 && u_PickingColor.y == 0.0 && u_PickingColor.z == 0.0) {
      discard;
    }
    outputColor = vec4(u_PickingColor, 1.0);
  } else {
    outputColor = u_Color;
    outputColor.a = outputColor.a * u_Opacity;

    vec4 diffuseColor = outputColor;
    ReflectedLight reflectedLight = ReflectedLight(vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ));
    vec3 totalEmissiveRadiance = u_Emissive;

    // calculate lighting accumulation
    BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = u_Specular;
material.specularShininess = u_Shininess;
material.specularStrength = specularStrength;
    GeometricContext geometry;
geometry.position = - v_ViewPosition;
geometry.normal = normal;
geometry.viewDir = u_IsOrtho == 1.0 ? vec3(0, 0, 1) : normalize(v_ViewPosition);

IncidentLight directLight;
#if defined( NUM_DIR_LIGHTS ) && ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
  DirectionalLight directionalLight;
  #if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
    DirectionalLightShadow directionalLightShadow;
  #endif

  #pragma unroll_loop_start
  for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {

    directionalLight = directionalLights[ i ];

    getDirectionalLightInfo( directionalLight, geometry, directLight );

    #if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
      directionalLightShadow = directionalLightShadows[ i ];
      directLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
    #endif

    RE_Direct( directLight, geometry, material, reflectedLight );
  }
  #pragma unroll_loop_end

#endif

#if defined( RE_IndirectDiffuse )
  vec3 iblIrradiance = vec3(0.0);
  vec3 ambient = vec3(0.0);
  #ifdef NUM_AMBIENT_LIGHTS
    ambient = u_AmbientLightColor;
  #endif
  vec3 irradiance = getAmbientLightIrradiance(ambient);

  // irradiance += getLightProbeIrradiance( lightProbe, geometry.normal );
  // #if ( NUM_HEMI_LIGHTS > 0 )
  //   #pragma unroll_loop_start
  //   for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
  //     irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );
  //   }
  //   #pragma unroll_loop_end
  // #endif
#endif

#if defined( RE_IndirectSpecular )
  vec3 radiance = vec3( 0.0 );
  vec3 clearcoatRadiance = vec3( 0.0 );
#endif

    #if defined( RE_IndirectDiffuse )
  RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif

#if defined( RE_IndirectSpecular )
  RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif

    vec3 outgoingLight = reflectedLight.directDiffuse +
      reflectedLight.indirectDiffuse + 
      reflectedLight.directSpecular + 
      reflectedLight.indirectSpecular + 
      totalEmissiveRadiance;

    outputColor = vec4(outgoingLight, diffuseColor.a);

    #ifdef USE_WIREFRAME
  vec3 color = mix(outputColor.xyz, u_WireframeLineColor, (1.0 - edgeFactor()));
  outputColor.xyz = color;
#endif
    #ifdef USE_FOG
  outputColor.rgb = addFog(outputColor.rgb);
#endif
  }
}`,X1=`#define GLSLIFY 1
#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6

#ifndef saturate
  #define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )

float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }

// expects values in the range of [0,1]x[0,1], returns values in the [0,1] range.
// do not collapse into a single function per: http://byteblacksmith.com/improvements-to-the-canonical-one-liner-glsl-rand-for-opengl-es-2-0/
highp float rand( const in vec2 uv ) {
  const highp float a = 12.9898, b = 78.233, c = 43758.5453;
  highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );

  return fract( sin( sn ) * c );
}

mat3 transposeMat3(mat3 inMatrix) {
  vec3 i0 = inMatrix[0];
  vec3 i1 = inMatrix[1];
  vec3 i2 = inMatrix[2];

  mat3 outMatrix = mat3(
    vec3(i0.x, i1.x, i2.x),
    vec3(i0.y, i1.y, i2.y),
    vec3(i0.z, i1.z, i2.z)
    );

  return outMatrix;
}

// https://github.com/glslify/glsl-inverse/blob/master/index.glsl
mat3 inverseMat3(mat3 inMatrix) {
  float a00 = inMatrix[0][0], a01 = inMatrix[0][1], a02 = inMatrix[0][2];
  float a10 = inMatrix[1][0], a11 = inMatrix[1][1], a12 = inMatrix[1][2];
  float a20 = inMatrix[2][0], a21 = inMatrix[2][1], a22 = inMatrix[2][2];

  float b01 = a22 * a11 - a12 * a21;
  float b11 = -a22 * a10 + a12 * a20;
  float b21 = a21 * a10 - a11 * a20;

  float det = a00 * b01 + a01 * b11 + a02 * b21;

  return mat3(b01, (-a22 * a01 + a02 * a21), (a12 * a01 - a02 * a11),
          b11, (a22 * a00 - a02 * a20), (-a12 * a00 + a02 * a10),
          b21, (-a21 * a00 + a01 * a20), (a11 * a00 - a01 * a10)) / det;
}

struct DirectionalLight {
  vec3 direction;
  float intensity;
  vec3 color;
};

struct IncidentLight {
  vec3 color;
  vec3 direction;
  bool visible;
};

struct ReflectedLight {
  vec3 directDiffuse;
  vec3 directSpecular;
  vec3 indirectDiffuse;
  vec3 indirectSpecular;
};

struct GeometricContext {
  vec3 position;
  vec3 normal;
  vec3 viewDir;
};
layout(std140) uniform ub_SceneParams {
  mat4 u_ProjectionMatrix;
  mat4 u_ViewMatrix;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_Viewport;
  float u_IsOrtho;
  float u_IsPicking;
};
layout(std140) uniform ub_MaterialParams {
  #ifdef USE_WIREFRAME
    vec3 u_WireframeLineColor;
    float u_WireframeLineWidth;
  #endif

  #ifdef USE_FOG
    vec4 u_FogInfos;
    vec3 u_FogColor;
  #endif

  vec3 u_Emissive;
  float u_Shininess;
  vec3 u_Specular;

  #ifdef USE_LIGHT
    #ifdef USE_BUMPMAP
      float u_BumpScale;
    #endif

    #ifdef NUM_AMBIENT_LIGHTS
      vec3 u_AmbientLightColor;
    #endif

    #ifdef NUM_DIR_LIGHTS
      DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
    #endif
  #endif
};
#ifdef USE_LIGHT
  void getDirectionalLightInfo(
    const in DirectionalLight directionalLight, 
    const in GeometricContext geometry,
    out IncidentLight light
  ) {
    light.color = directionalLight.color * directionalLight.intensity;
    light.direction = normalize(directionalLight.direction);
    light.visible = true;
  }
#endif

layout(location = MODEL_MATRIX0) in vec4 a_ModelMatrix0;
layout(location = MODEL_MATRIX1) in vec4 a_ModelMatrix1;
layout(location = MODEL_MATRIX2) in vec4 a_ModelMatrix2;
layout(location = MODEL_MATRIX3) in vec4 a_ModelMatrix3;
layout(location = COLOR) in vec4 a_Color;
layout(location = STROKE_COLOR) in vec4 a_StrokeColor;
layout(location = PACKED_STYLE1) in vec4 a_StylePacked1;
layout(location = PACKED_STYLE2) in vec4 a_StylePacked2;
layout(location = PICKING_COLOR) in vec4 a_PickingColor;

out vec4 v_PickingResult;
out vec4 v_Color;
out vec4 v_StrokeColor;
out vec4 v_StylePacked1;
out vec4 v_StylePacked2;

#define COLOR_SCALE 1. / 255.
void setPickingColor(vec3 pickingColor) {
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}
vec4 project(vec4 pos, mat4 pm, mat4 vm, mat4 mm) {
  return pm * vm * mm * pos;
}

layout(location = POSITION) in vec3 a_Position;
layout(location = NORMAL) in vec3 a_Normal;

#ifdef USE_UV
  layout(location = UV) in vec2 a_Uv;
  out vec2 v_Uv;
#endif

#ifdef USE_WIREFRAME
  layout(location = BARYCENTRIC) in vec3 a_Barycentric;
  out vec3 v_Barycentric;
#endif

out vec3 v_ViewPosition;
out vec3 v_Normal;

void main() {
  mat4 u_ModelMatrix = mat4(a_ModelMatrix0, a_ModelMatrix1, a_ModelMatrix2, a_ModelMatrix3);
vec4 u_StrokeColor = a_StrokeColor;
float u_Opacity = a_StylePacked1.x;
float u_FillOpacity = a_StylePacked1.y;
float u_StrokeOpacity = a_StylePacked1.z;
float u_StrokeWidth = a_StylePacked1.w;
float u_ZIndex = a_PickingColor.w;
vec2 u_Anchor = a_StylePacked2.yz;
float u_IncreasedLineWidthForHitTesting = a_StylePacked2.w;

setPickingColor(a_PickingColor.xyz);

v_Color = a_Color;
v_StrokeColor = a_StrokeColor;
v_StylePacked1 = a_StylePacked1;
v_StylePacked2 = a_StylePacked2;

#ifdef CLIPSPACE_NEAR_ZERO
    gl_Position.z = gl_Position.z * 0.5 + 0.5;
#endif

  vec4 position = vec4(a_Position, 1.0);

  gl_Position = project(position, u_ProjectionMatrix, u_ViewMatrix, u_ModelMatrix);

  vec4 mvPosition = u_ViewMatrix * u_ModelMatrix * position;
  v_ViewPosition = - mvPosition.xyz;

  // v_ViewPosition = vec3(mvPosition) / mvPosition.w;

  mat3 normalWorld = mat3(transposeMat3(inverseMat3(mat3(u_ViewMatrix * u_ModelMatrix))));
  v_Normal = normalize(normalWorld * a_Normal);

  #ifdef USE_UV
  v_Uv = a_Uv;
  #ifdef VIEWPORT_ORIGIN_TL
    v_Uv.y = 1.0 - v_Uv.y;
  #endif
#endif

  #ifdef USE_WIREFRAME
  v_Barycentric = a_Barycentric;
#endif

}`,er;(function(e){e.EMISSIVE="u_Emissive",e.SHININESS="u_Shininess",e.SPECULAR="u_Specular",e.BUMP_SCALE="u_BumpScale",e.SPECULAR_MAP="u_SpecularMap",e.BUMP_MAP="u_BumpMap"})(er||(er={}));var V1=function(e){ni(n,e);function n(i,t){var r,a;a=e.call(this,i,Hr({vertexShader:X1,fragmentShader:H1,emissive:"black",shininess:30,specular:"#111111",bumpScale:1,doubleSide:!1},t))||this;var o=I1(a),s=o.specularMap,u=o.bumpMap,l=o.doubleSide,f=o.emissive,c=o.shininess,h=o.specular,p=ir(f),g=ir(h);return a.setUniforms((r={u_Placeholder:null},r[er.EMISSIVE]=[Number(p.r)/255,Number(p.g)/255,Number(p.b)/255],r[er.SHININESS]=c,r[er.SPECULAR]=[Number(g.r)/255,Number(g.g)/255,Number(g.b)/255],r)),s&&(a.specularMap=s),u&&(a.bumpMap=u),a.doubleSide=l,a.defines=Hr({},a.defines),a}return Su(n,[{key:"emissive",get:function(){return this.props.emissive},set:function(t){var r;this.props.emissive=t;var a=ir(t);this.setUniforms((r={},r[er.EMISSIVE]=[Number(a.r)/255,Number(a.g)/255,Number(a.b)/255],r))}},{key:"shininess",get:function(){return this.props.shininess},set:function(t){var r;this.props.shininess=t,this.setUniforms((r={},r[er.SHININESS]=t,r))}},{key:"specular",get:function(){return this.props.specular},set:function(t){var r;this.props.specular=t;var a=ir(t);this.setUniforms((r={},r[er.SPECULAR]=[Number(a.r)/255,Number(a.g)/255,Number(a.b)/255],r))}},{key:"specularMap",get:function(){return this.props.specularMap},set:function(t){var r;this.props.map!==t&&(this.props.specularMap=t,this.programDirty=!0),this.defines.USE_SPECULARMAP=!!t,this.setUniforms((r={},r[er.SPECULAR_MAP]=t,r))}},{key:"bumpMap",get:function(){return this.props.bumpMap},set:function(t){var r;this.props.map!==t&&(this.props.bumpMap=t,this.programDirty=!0),this.defines.USE_BUMPMAP=!!t,this.setUniforms((r={},r[er.BUMP_MAP]=t,r[er.BUMP_SCALE]=this.bumpScale,r))}},{key:"bumpScale",get:function(){return this.props.bumpScale},set:function(t){var r;this.props.bumpScale=t,this.setUniforms((r={},r[er.BUMP_SCALE]=t,r))}},{key:"doubleSide",get:function(){return this.props.doubleSide},set:function(t){this.props.doubleSide=t,this.defines.USE_DOUBLESIDE=t}}]),n}(W1),Lf;(function(e){e.MAP="u_Map",e.PLACE_HOLDER="u_Placeholder",e.SIZE="u_Size"})(Lf||(Lf={}));var Y1=function(e){ni(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.name="3d",t}var i=n.prototype;return i.init=function(){},i.destroy=function(){},n}(un),js={},z1={get exports(){return js},set exports(e){js=e}};/*! Hammer.JS - v2.0.7 - 2016-04-22
 * http://hammerjs.github.io/
 *
 * Copyright (c) 2016 Jorik Tangelder;
 * Licensed under the MIT license */(function(e){(function(n,i,t,r){var a=["","webkit","Moz","MS","ms","o"],o=i.createElement("div"),s="function",u=Math.round,l=Math.abs,f=Date.now;function c(I,b,W){return setTimeout(A(I,W),b)}function h(I,b,W){return Array.isArray(I)?(p(I,W[b],W),!0):!1}function p(I,b,W){var Y;if(I)if(I.forEach)I.forEach(b,W);else if(I.length!==r)for(Y=0;Y<I.length;)b.call(W,I[Y],Y,I),Y++;else for(Y in I)I.hasOwnProperty(Y)&&b.call(W,I[Y],Y,I)}function g(I,b,W){var Y="DEPRECATED METHOD: "+b+`
`+W+` AT 
`;return function(){var q=new Error("get-stack-trace"),te=q&&q.stack?q.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",Ee=n.console&&(n.console.warn||n.console.log);return Ee&&Ee.call(n.console,Y,te),I.apply(this,arguments)}}var _;typeof Object.assign!="function"?_=function(b){if(b===r||b===null)throw new TypeError("Cannot convert undefined or null to object");for(var W=Object(b),Y=1;Y<arguments.length;Y++){var q=arguments[Y];if(q!==r&&q!==null)for(var te in q)q.hasOwnProperty(te)&&(W[te]=q[te])}return W}:_=Object.assign;var E=g(function(b,W,Y){for(var q=Object.keys(W),te=0;te<q.length;)(!Y||Y&&b[q[te]]===r)&&(b[q[te]]=W[q[te]]),te++;return b},"extend","Use `assign`."),y=g(function(b,W){return E(b,W,!0)},"merge","Use `assign`.");function R(I,b,W){var Y=b.prototype,q;q=I.prototype=Object.create(Y),q.constructor=I,q._super=Y,W&&_(q,W)}function A(I,b){return function(){return I.apply(b,arguments)}}function M(I,b){return typeof I==s?I.apply(b&&b[0]||r,b):I}function x(I,b){return I===r?b:I}function P(I,b,W){p(F(b),function(Y){I.addEventListener(Y,W,!1)})}function C(I,b,W){p(F(b),function(Y){I.removeEventListener(Y,W,!1)})}function O(I,b){for(;I;){if(I==b)return!0;I=I.parentNode}return!1}function D(I,b){return I.indexOf(b)>-1}function F(I){return I.trim().split(/\s+/g)}function k(I,b,W){if(I.indexOf&&!W)return I.indexOf(b);for(var Y=0;Y<I.length;){if(W&&I[Y][W]==b||!W&&I[Y]===b)return Y;Y++}return-1}function d(I){return Array.prototype.slice.call(I,0)}function v(I,b,W){for(var Y=[],q=[],te=0;te<I.length;){var Ee=b?I[te][b]:I[te];k(q,Ee)<0&&Y.push(I[te]),q[te]=Ee,te++}return W&&(b?Y=Y.sort(function(lt,Rt){return lt[b]>Rt[b]}):Y=Y.sort()),Y}function m(I,b){for(var W,Y,q=b[0].toUpperCase()+b.slice(1),te=0;te<a.length;){if(W=a[te],Y=W?W+q:b,Y in I)return Y;te++}return r}var S=1;function T(){return S++}function N(I){var b=I.ownerDocument||I;return b.defaultView||b.parentWindow||n}var B=/mobile|tablet|ip(ad|hone|od)|android/i,w="ontouchstart"in n,U=m(n,"PointerEvent")!==r,V=w&&B.test(navigator.userAgent),K="touch",z="pen",le="mouse",Se="kinect",Ae=25,ge=1,ye=2,ve=4,ie=8,we=1,Pt=2,Je=4,Tt=8,ce=16,he=Pt|Je,Oe=Tt|ce,ne=he|Oe,rt=["x","y"],ke=["clientX","clientY"];function Ge(I,b){var W=this;this.manager=I,this.callback=b,this.element=I.element,this.target=I.options.inputTarget,this.domHandler=function(Y){M(I.options.enable,[I])&&W.handler(Y)},this.init()}Ge.prototype={handler:function(){},init:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(N(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&C(this.element,this.evEl,this.domHandler),this.evTarget&&C(this.target,this.evTarget,this.domHandler),this.evWin&&C(N(this.element),this.evWin,this.domHandler)}};function Kt(I){var b,W=I.options.inputClass;return W?b=W:U?b=go:V?b=qi:w?b=mo:b=$i,new b(I,ur)}function ur(I,b,W){var Y=W.pointers.length,q=W.changedPointers.length,te=b&ge&&Y-q===0,Ee=b&(ve|ie)&&Y-q===0;W.isFirst=!!te,W.isFinal=!!Ee,te&&(I.session={}),W.eventType=b,ai(I,W),I.emit("hammer.input",W),I.recognize(W),I.session.prevInput=W}function ai(I,b){var W=I.session,Y=b.pointers,q=Y.length;W.firstInput||(W.firstInput=ln(b)),q>1&&!W.firstMultiple?W.firstMultiple=ln(b):q===1&&(W.firstMultiple=!1);var te=W.firstInput,Ee=W.firstMultiple,nt=Ee?Ee.center:te.center,lt=b.center=oi(Y);b.timeStamp=f(),b.deltaTime=b.timeStamp-te.timeStamp,b.angle=po(nt,lt),b.distance=Ki(nt,lt),lr(W,b),b.offsetDirection=Mu(b.deltaX,b.deltaY);var Rt=xu(b.deltaTime,b.deltaX,b.deltaY);b.overallVelocityX=Rt.x,b.overallVelocityY=Rt.y,b.overallVelocity=l(Rt.x)>l(Rt.y)?Rt.x:Rt.y,b.scale=Ee?cd(Ee.pointers,Y):1,b.rotation=Ee?fd(Ee.pointers,Y):0,b.maxPointers=W.prevInput?b.pointers.length>W.prevInput.maxPointers?b.pointers.length:W.prevInput.maxPointers:b.pointers.length,$t(W,b);var gr=I.element;O(b.srcEvent.target,gr)&&(gr=b.srcEvent.target),b.target=gr}function lr(I,b){var W=b.center,Y=I.offsetDelta||{},q=I.prevDelta||{},te=I.prevInput||{};(b.eventType===ge||te.eventType===ve)&&(q=I.prevDelta={x:te.deltaX||0,y:te.deltaY||0},Y=I.offsetDelta={x:W.x,y:W.y}),b.deltaX=q.x+(W.x-Y.x),b.deltaY=q.y+(W.y-Y.y)}function $t(I,b){var W=I.lastInterval||b,Y=b.timeStamp-W.timeStamp,q,te,Ee,nt;if(b.eventType!=ie&&(Y>Ae||W.velocity===r)){var lt=b.deltaX-W.deltaX,Rt=b.deltaY-W.deltaY,gr=xu(Y,lt,Rt);te=gr.x,Ee=gr.y,q=l(gr.x)>l(gr.y)?gr.x:gr.y,nt=Mu(lt,Rt),I.lastInterval=b}else q=W.velocity,te=W.velocityX,Ee=W.velocityY,nt=W.direction;b.velocity=q,b.velocityX=te,b.velocityY=Ee,b.direction=nt}function ln(I){for(var b=[],W=0;W<I.pointers.length;)b[W]={clientX:u(I.pointers[W].clientX),clientY:u(I.pointers[W].clientY)},W++;return{timeStamp:f(),pointers:b,center:oi(b),deltaX:I.deltaX,deltaY:I.deltaY}}function oi(I){var b=I.length;if(b===1)return{x:u(I[0].clientX),y:u(I[0].clientY)};for(var W=0,Y=0,q=0;q<b;)W+=I[q].clientX,Y+=I[q].clientY,q++;return{x:u(W/b),y:u(Y/b)}}function xu(I,b,W){return{x:b/I||0,y:W/I||0}}function Mu(I,b){return I===b?we:l(I)>=l(b)?I<0?Pt:Je:b<0?Tt:ce}function Ki(I,b,W){W||(W=rt);var Y=b[W[0]]-I[W[0]],q=b[W[1]]-I[W[1]];return Math.sqrt(Y*Y+q*q)}function po(I,b,W){W||(W=rt);var Y=b[W[0]]-I[W[0]],q=b[W[1]]-I[W[1]];return Math.atan2(q,Y)*180/Math.PI}function fd(I,b){return po(b[1],b[0],ke)+po(I[1],I[0],ke)}function cd(I,b){return Ki(b[0],b[1],ke)/Ki(I[0],I[1],ke)}var hd={mousedown:ge,mousemove:ye,mouseup:ve},dd="mousedown",vd="mousemove mouseup";function $i(){this.evEl=dd,this.evWin=vd,this.pressed=!1,Ge.apply(this,arguments)}R($i,Ge,{handler:function(b){var W=hd[b.type];W&ge&&b.button===0&&(this.pressed=!0),W&ye&&b.which!==1&&(W=ve),this.pressed&&(W&ve&&(this.pressed=!1),this.callback(this.manager,W,{pointers:[b],changedPointers:[b],pointerType:le,srcEvent:b}))}});var pd={pointerdown:ge,pointermove:ye,pointerup:ve,pointercancel:ie,pointerout:ie},gd={2:K,3:z,4:le,5:Se},Cu="pointerdown",Ou="pointermove pointerup pointercancel";n.MSPointerEvent&&!n.PointerEvent&&(Cu="MSPointerDown",Ou="MSPointerMove MSPointerUp MSPointerCancel");function go(){this.evEl=Cu,this.evWin=Ou,Ge.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}R(go,Ge,{handler:function(b){var W=this.store,Y=!1,q=b.type.toLowerCase().replace("ms",""),te=pd[q],Ee=gd[b.pointerType]||b.pointerType,nt=Ee==K,lt=k(W,b.pointerId,"pointerId");te&ge&&(b.button===0||nt)?lt<0&&(W.push(b),lt=W.length-1):te&(ve|ie)&&(Y=!0),!(lt<0)&&(W[lt]=b,this.callback(this.manager,te,{pointers:W,changedPointers:[b],pointerType:Ee,srcEvent:b}),Y&&W.splice(lt,1))}});var md={touchstart:ge,touchmove:ye,touchend:ve,touchcancel:ie},_d="touchstart",Ed="touchstart touchmove touchend touchcancel";function Nu(){this.evTarget=_d,this.evWin=Ed,this.started=!1,Ge.apply(this,arguments)}R(Nu,Ge,{handler:function(b){var W=md[b.type];if(W===ge&&(this.started=!0),!!this.started){var Y=yd.call(this,b,W);W&(ve|ie)&&Y[0].length-Y[1].length===0&&(this.started=!1),this.callback(this.manager,W,{pointers:Y[0],changedPointers:Y[1],pointerType:K,srcEvent:b})}}});function yd(I,b){var W=d(I.touches),Y=d(I.changedTouches);return b&(ve|ie)&&(W=v(W.concat(Y),"identifier",!0)),[W,Y]}var Td={touchstart:ge,touchmove:ye,touchend:ve,touchcancel:ie},Rd="touchstart touchmove touchend touchcancel";function qi(){this.evTarget=Rd,this.targetIds={},Ge.apply(this,arguments)}R(qi,Ge,{handler:function(b){var W=Td[b.type],Y=Sd.call(this,b,W);Y&&this.callback(this.manager,W,{pointers:Y[0],changedPointers:Y[1],pointerType:K,srcEvent:b})}});function Sd(I,b){var W=d(I.touches),Y=this.targetIds;if(b&(ge|ye)&&W.length===1)return Y[W[0].identifier]=!0,[W,W];var q,te,Ee=d(I.changedTouches),nt=[],lt=this.target;if(te=W.filter(function(Rt){return O(Rt.target,lt)}),b===ge)for(q=0;q<te.length;)Y[te[q].identifier]=!0,q++;for(q=0;q<Ee.length;)Y[Ee[q].identifier]&&nt.push(Ee[q]),b&(ve|ie)&&delete Y[Ee[q].identifier],q++;if(nt.length)return[v(te.concat(nt),"identifier",!0),nt]}var Ad=2500,Iu=25;function mo(){Ge.apply(this,arguments);var I=A(this.handler,this);this.touch=new qi(this.manager,I),this.mouse=new $i(this.manager,I),this.primaryTouch=null,this.lastTouches=[]}R(mo,Ge,{handler:function(b,W,Y){var q=Y.pointerType==K,te=Y.pointerType==le;if(!(te&&Y.sourceCapabilities&&Y.sourceCapabilities.firesTouchEvents)){if(q)Pd.call(this,W,Y);else if(te&&xd.call(this,Y))return;this.callback(b,W,Y)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function Pd(I,b){I&ge?(this.primaryTouch=b.changedPointers[0].identifier,Du.call(this,b)):I&(ve|ie)&&Du.call(this,b)}function Du(I){var b=I.changedPointers[0];if(b.identifier===this.primaryTouch){var W={x:b.clientX,y:b.clientY};this.lastTouches.push(W);var Y=this.lastTouches,q=function(){var te=Y.indexOf(W);te>-1&&Y.splice(te,1)};setTimeout(q,Ad)}}function xd(I){for(var b=I.srcEvent.clientX,W=I.srcEvent.clientY,Y=0;Y<this.lastTouches.length;Y++){var q=this.lastTouches[Y],te=Math.abs(b-q.x),Ee=Math.abs(W-q.y);if(te<=Iu&&Ee<=Iu)return!0}return!1}var bu=m(o.style,"touchAction"),wu=bu!==r,Bu="compute",Fu="auto",_o="manipulation",fn="none",si="pan-x",ui="pan-y",Zi=Cd();function Eo(I,b){this.manager=I,this.set(b)}Eo.prototype={set:function(I){I==Bu&&(I=this.compute()),wu&&this.manager.element.style&&Zi[I]&&(this.manager.element.style[bu]=I),this.actions=I.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var I=[];return p(this.manager.recognizers,function(b){M(b.options.enable,[b])&&(I=I.concat(b.getTouchAction()))}),Md(I.join(" "))},preventDefaults:function(I){var b=I.srcEvent,W=I.offsetDirection;if(this.manager.session.prevented){b.preventDefault();return}var Y=this.actions,q=D(Y,fn)&&!Zi[fn],te=D(Y,ui)&&!Zi[ui],Ee=D(Y,si)&&!Zi[si];if(q){var nt=I.pointers.length===1,lt=I.distance<2,Rt=I.deltaTime<250;if(nt&&lt&&Rt)return}if(!(Ee&&te)&&(q||te&&W&he||Ee&&W&Oe))return this.preventSrc(b)},preventSrc:function(I){this.manager.session.prevented=!0,I.preventDefault()}};function Md(I){if(D(I,fn))return fn;var b=D(I,si),W=D(I,ui);return b&&W?fn:b||W?b?si:ui:D(I,_o)?_o:Fu}function Cd(){if(!wu)return!1;var I={},b=n.CSS&&n.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(W){I[W]=b?n.CSS.supports("touch-action",W):!0}),I}var Qi=1,qt=2,On=4,Xr=8,Cr=Xr,li=16,pr=32;function Or(I){this.options=_({},this.defaults,I||{}),this.id=T(),this.manager=null,this.options.enable=x(this.options.enable,!0),this.state=Qi,this.simultaneous={},this.requireFail=[]}Or.prototype={defaults:{},set:function(I){return _(this.options,I),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(I){if(h(I,"recognizeWith",this))return this;var b=this.simultaneous;return I=Ji(I,this),b[I.id]||(b[I.id]=I,I.recognizeWith(this)),this},dropRecognizeWith:function(I){return h(I,"dropRecognizeWith",this)?this:(I=Ji(I,this),delete this.simultaneous[I.id],this)},requireFailure:function(I){if(h(I,"requireFailure",this))return this;var b=this.requireFail;return I=Ji(I,this),k(b,I)===-1&&(b.push(I),I.requireFailure(this)),this},dropRequireFailure:function(I){if(h(I,"dropRequireFailure",this))return this;I=Ji(I,this);var b=k(this.requireFail,I);return b>-1&&this.requireFail.splice(b,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(I){return!!this.simultaneous[I.id]},emit:function(I){var b=this,W=this.state;function Y(q){b.manager.emit(q,I)}W<Xr&&Y(b.options.event+Uu(W)),Y(b.options.event),I.additionalEvent&&Y(I.additionalEvent),W>=Xr&&Y(b.options.event+Uu(W))},tryEmit:function(I){if(this.canEmit())return this.emit(I);this.state=pr},canEmit:function(){for(var I=0;I<this.requireFail.length;){if(!(this.requireFail[I].state&(pr|Qi)))return!1;I++}return!0},recognize:function(I){var b=_({},I);if(!M(this.options.enable,[this,b])){this.reset(),this.state=pr;return}this.state&(Cr|li|pr)&&(this.state=Qi),this.state=this.process(b),this.state&(qt|On|Xr|li)&&this.tryEmit(b)},process:function(I){},getTouchAction:function(){},reset:function(){}};function Uu(I){return I&li?"cancel":I&Xr?"end":I&On?"move":I&qt?"start":""}function ku(I){return I==ce?"down":I==Tt?"up":I==Pt?"left":I==Je?"right":""}function Ji(I,b){var W=b.manager;return W?W.get(I):I}function fr(){Or.apply(this,arguments)}R(fr,Or,{defaults:{pointers:1},attrTest:function(I){var b=this.options.pointers;return b===0||I.pointers.length===b},process:function(I){var b=this.state,W=I.eventType,Y=b&(qt|On),q=this.attrTest(I);return Y&&(W&ie||!q)?b|li:Y||q?W&ve?b|Xr:b&qt?b|On:qt:pr}});function ji(){fr.apply(this,arguments),this.pX=null,this.pY=null}R(ji,fr,{defaults:{event:"pan",threshold:10,pointers:1,direction:ne},getTouchAction:function(){var I=this.options.direction,b=[];return I&he&&b.push(ui),I&Oe&&b.push(si),b},directionTest:function(I){var b=this.options,W=!0,Y=I.distance,q=I.direction,te=I.deltaX,Ee=I.deltaY;return q&b.direction||(b.direction&he?(q=te===0?we:te<0?Pt:Je,W=te!=this.pX,Y=Math.abs(I.deltaX)):(q=Ee===0?we:Ee<0?Tt:ce,W=Ee!=this.pY,Y=Math.abs(I.deltaY))),I.direction=q,W&&Y>b.threshold&&q&b.direction},attrTest:function(I){return fr.prototype.attrTest.call(this,I)&&(this.state&qt||!(this.state&qt)&&this.directionTest(I))},emit:function(I){this.pX=I.deltaX,this.pY=I.deltaY;var b=ku(I.direction);b&&(I.additionalEvent=this.options.event+b),this._super.emit.call(this,I)}});function yo(){fr.apply(this,arguments)}R(yo,fr,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[fn]},attrTest:function(I){return this._super.attrTest.call(this,I)&&(Math.abs(I.scale-1)>this.options.threshold||this.state&qt)},emit:function(I){if(I.scale!==1){var b=I.scale<1?"in":"out";I.additionalEvent=this.options.event+b}this._super.emit.call(this,I)}});function To(){Or.apply(this,arguments),this._timer=null,this._input=null}R(To,Or,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Fu]},process:function(I){var b=this.options,W=I.pointers.length===b.pointers,Y=I.distance<b.threshold,q=I.deltaTime>b.time;if(this._input=I,!Y||!W||I.eventType&(ve|ie)&&!q)this.reset();else if(I.eventType&ge)this.reset(),this._timer=c(function(){this.state=Cr,this.tryEmit()},b.time,this);else if(I.eventType&ve)return Cr;return pr},reset:function(){clearTimeout(this._timer)},emit:function(I){this.state===Cr&&(I&&I.eventType&ve?this.manager.emit(this.options.event+"up",I):(this._input.timeStamp=f(),this.manager.emit(this.options.event,this._input)))}});function Ro(){fr.apply(this,arguments)}R(Ro,fr,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[fn]},attrTest:function(I){return this._super.attrTest.call(this,I)&&(Math.abs(I.rotation)>this.options.threshold||this.state&qt)}});function So(){fr.apply(this,arguments)}R(So,fr,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:he|Oe,pointers:1},getTouchAction:function(){return ji.prototype.getTouchAction.call(this)},attrTest:function(I){var b=this.options.direction,W;return b&(he|Oe)?W=I.overallVelocity:b&he?W=I.overallVelocityX:b&Oe&&(W=I.overallVelocityY),this._super.attrTest.call(this,I)&&b&I.offsetDirection&&I.distance>this.options.threshold&&I.maxPointers==this.options.pointers&&l(W)>this.options.velocity&&I.eventType&ve},emit:function(I){var b=ku(I.offsetDirection);b&&this.manager.emit(this.options.event+b,I),this.manager.emit(this.options.event,I)}});function ea(){Or.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}R(ea,Or,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[_o]},process:function(I){var b=this.options,W=I.pointers.length===b.pointers,Y=I.distance<b.threshold,q=I.deltaTime<b.time;if(this.reset(),I.eventType&ge&&this.count===0)return this.failTimeout();if(Y&&q&&W){if(I.eventType!=ve)return this.failTimeout();var te=this.pTime?I.timeStamp-this.pTime<b.interval:!0,Ee=!this.pCenter||Ki(this.pCenter,I.center)<b.posThreshold;this.pTime=I.timeStamp,this.pCenter=I.center,!Ee||!te?this.count=1:this.count+=1,this._input=I;var nt=this.count%b.taps;if(nt===0)return this.hasRequireFailures()?(this._timer=c(function(){this.state=Cr,this.tryEmit()},b.interval,this),qt):Cr}return pr},failTimeout:function(){return this._timer=c(function(){this.state=pr},this.options.interval,this),pr},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Cr&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Nr(I,b){return b=b||{},b.recognizers=x(b.recognizers,Nr.defaults.preset),new Ao(I,b)}Nr.VERSION="2.0.7",Nr.defaults={domEvents:!1,touchAction:Bu,enable:!0,inputTarget:null,inputClass:null,preset:[[Ro,{enable:!1}],[yo,{enable:!1},["rotate"]],[So,{direction:he}],[ji,{direction:he},["swipe"]],[ea],[ea,{event:"doubletap",taps:2},["tap"]],[To]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Od=1,Lu=2;function Ao(I,b){this.options=_({},Nr.defaults,b||{}),this.options.inputTarget=this.options.inputTarget||I,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=I,this.input=Kt(this),this.touchAction=new Eo(this,this.options.touchAction),Wu(this,!0),p(this.options.recognizers,function(W){var Y=this.add(new W[0](W[1]));W[2]&&Y.recognizeWith(W[2]),W[3]&&Y.requireFailure(W[3])},this)}Ao.prototype={set:function(I){return _(this.options,I),I.touchAction&&this.touchAction.update(),I.inputTarget&&(this.input.destroy(),this.input.target=I.inputTarget,this.input.init()),this},stop:function(I){this.session.stopped=I?Lu:Od},recognize:function(I){var b=this.session;if(!b.stopped){this.touchAction.preventDefaults(I);var W,Y=this.recognizers,q=b.curRecognizer;(!q||q&&q.state&Cr)&&(q=b.curRecognizer=null);for(var te=0;te<Y.length;)W=Y[te],b.stopped!==Lu&&(!q||W==q||W.canRecognizeWith(q))?W.recognize(I):W.reset(),!q&&W.state&(qt|On|Xr)&&(q=b.curRecognizer=W),te++}},get:function(I){if(I instanceof Or)return I;for(var b=this.recognizers,W=0;W<b.length;W++)if(b[W].options.event==I)return b[W];return null},add:function(I){if(h(I,"add",this))return this;var b=this.get(I.options.event);return b&&this.remove(b),this.recognizers.push(I),I.manager=this,this.touchAction.update(),I},remove:function(I){if(h(I,"remove",this))return this;if(I=this.get(I),I){var b=this.recognizers,W=k(b,I);W!==-1&&(b.splice(W,1),this.touchAction.update())}return this},on:function(I,b){if(I!==r&&b!==r){var W=this.handlers;return p(F(I),function(Y){W[Y]=W[Y]||[],W[Y].push(b)}),this}},off:function(I,b){if(I!==r){var W=this.handlers;return p(F(I),function(Y){b?W[Y]&&W[Y].splice(k(W[Y],b),1):delete W[Y]}),this}},emit:function(I,b){this.options.domEvents&&Nd(I,b);var W=this.handlers[I]&&this.handlers[I].slice();if(!(!W||!W.length)){b.type=I,b.preventDefault=function(){b.srcEvent.preventDefault()};for(var Y=0;Y<W.length;)W[Y](b),Y++}},destroy:function(){this.element&&Wu(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Wu(I,b){var W=I.element;if(W.style){var Y;p(I.options.cssProps,function(q,te){Y=m(W.style,te),b?(I.oldCssProps[Y]=W.style[Y],W.style[Y]=q):W.style[Y]=I.oldCssProps[Y]||""}),b||(I.oldCssProps={})}}function Nd(I,b){var W=i.createEvent("Event");W.initEvent(I,!0,!0),W.gesture=b,b.target.dispatchEvent(W)}_(Nr,{INPUT_START:ge,INPUT_MOVE:ye,INPUT_END:ve,INPUT_CANCEL:ie,STATE_POSSIBLE:Qi,STATE_BEGAN:qt,STATE_CHANGED:On,STATE_ENDED:Xr,STATE_RECOGNIZED:Cr,STATE_CANCELLED:li,STATE_FAILED:pr,DIRECTION_NONE:we,DIRECTION_LEFT:Pt,DIRECTION_RIGHT:Je,DIRECTION_UP:Tt,DIRECTION_DOWN:ce,DIRECTION_HORIZONTAL:he,DIRECTION_VERTICAL:Oe,DIRECTION_ALL:ne,Manager:Ao,Input:Ge,TouchAction:Eo,TouchInput:qi,MouseInput:$i,PointerEventInput:go,TouchMouseInput:mo,SingleTouchInput:Nu,Recognizer:Or,AttrRecognizer:fr,Tap:ea,Pan:ji,Swipe:So,Pinch:yo,Rotate:Ro,Press:To,on:P,off:C,each:p,merge:y,extend:E,assign:_,inherit:R,bindFn:A,prefixed:m});var Id=typeof n<"u"?n:typeof self<"u"?self:{};Id.Hammer=Nr,typeof r=="function"&&r.amd?r(function(){return Nr}):e.exports?e.exports=Nr:n[t]=Nr})(window,document,"Hammer")})(z1);const Wf=js;function eu(){eu=function(){return e};var e={},n=Object.prototype,i=n.hasOwnProperty,t=Object.defineProperty||function(d,v,m){d[v]=m.value},r=typeof Symbol=="function"?Symbol:{},a=r.iterator||"@@iterator",o=r.asyncIterator||"@@asyncIterator",s=r.toStringTag||"@@toStringTag";function u(d,v,m){return Object.defineProperty(d,v,{value:m,enumerable:!0,configurable:!0,writable:!0}),d[v]}try{u({},"")}catch{u=function(v,m,S){return v[m]=S}}function l(d,v,m,S){var T=v&&v.prototype instanceof h?v:h,N=Object.create(T.prototype),B=new D(S||[]);return t(N,"_invoke",{value:x(d,m,B)}),N}function f(d,v,m){try{return{type:"normal",arg:d.call(v,m)}}catch(S){return{type:"throw",arg:S}}}e.wrap=l;var c={};function h(){}function p(){}function g(){}var _={};u(_,a,function(){return this});var E=Object.getPrototypeOf,y=E&&E(E(F([])));y&&y!==n&&i.call(y,a)&&(_=y);var R=g.prototype=h.prototype=Object.create(_);function A(d){["next","throw","return"].forEach(function(v){u(d,v,function(m){return this._invoke(v,m)})})}function M(d,v){function m(T,N,B,w){var U=f(d[T],d,N);if(U.type!=="throw"){var V=U.arg,K=V.value;return K&&typeof K=="object"&&i.call(K,"__await")?v.resolve(K.__await).then(function(z){m("next",z,B,w)},function(z){m("throw",z,B,w)}):v.resolve(K).then(function(z){V.value=z,B(V)},function(z){return m("throw",z,B,w)})}w(U.arg)}var S;t(this,"_invoke",{value:function(T,N){function B(){return new v(function(w,U){m(T,N,w,U)})}return S=S?S.then(B,B):B()}})}function x(d,v,m){var S="suspendedStart";return function(T,N){if(S==="executing")throw new Error("Generator is already running");if(S==="completed"){if(T==="throw")throw N;return k()}for(m.method=T,m.arg=N;;){var B=m.delegate;if(B){var w=P(B,m);if(w){if(w===c)continue;return w}}if(m.method==="next")m.sent=m._sent=m.arg;else if(m.method==="throw"){if(S==="suspendedStart")throw S="completed",m.arg;m.dispatchException(m.arg)}else m.method==="return"&&m.abrupt("return",m.arg);S="executing";var U=f(d,v,m);if(U.type==="normal"){if(S=m.done?"completed":"suspendedYield",U.arg===c)continue;return{value:U.arg,done:m.done}}U.type==="throw"&&(S="completed",m.method="throw",m.arg=U.arg)}}}function P(d,v){var m=v.method,S=d.iterator[m];if(S===void 0)return v.delegate=null,m==="throw"&&d.iterator.return&&(v.method="return",v.arg=void 0,P(d,v),v.method==="throw")||m!=="return"&&(v.method="throw",v.arg=new TypeError("The iterator does not provide a '"+m+"' method")),c;var T=f(S,d.iterator,v.arg);if(T.type==="throw")return v.method="throw",v.arg=T.arg,v.delegate=null,c;var N=T.arg;return N?N.done?(v[d.resultName]=N.value,v.next=d.nextLoc,v.method!=="return"&&(v.method="next",v.arg=void 0),v.delegate=null,c):N:(v.method="throw",v.arg=new TypeError("iterator result is not an object"),v.delegate=null,c)}function C(d){var v={tryLoc:d[0]};1 in d&&(v.catchLoc=d[1]),2 in d&&(v.finallyLoc=d[2],v.afterLoc=d[3]),this.tryEntries.push(v)}function O(d){var v=d.completion||{};v.type="normal",delete v.arg,d.completion=v}function D(d){this.tryEntries=[{tryLoc:"root"}],d.forEach(C,this),this.reset(!0)}function F(d){if(d){var v=d[a];if(v)return v.call(d);if(typeof d.next=="function")return d;if(!isNaN(d.length)){var m=-1,S=function T(){for(;++m<d.length;)if(i.call(d,m))return T.value=d[m],T.done=!1,T;return T.value=void 0,T.done=!0,T};return S.next=S}}return{next:k}}function k(){return{value:void 0,done:!0}}return p.prototype=g,t(R,"constructor",{value:g,configurable:!0}),t(g,"constructor",{value:p,configurable:!0}),p.displayName=u(g,s,"GeneratorFunction"),e.isGeneratorFunction=function(d){var v=typeof d=="function"&&d.constructor;return!!v&&(v===p||(v.displayName||v.name)==="GeneratorFunction")},e.mark=function(d){return Object.setPrototypeOf?Object.setPrototypeOf(d,g):(d.__proto__=g,u(d,s,"GeneratorFunction")),d.prototype=Object.create(R),d},e.awrap=function(d){return{__await:d}},A(M.prototype),u(M.prototype,o,function(){return this}),e.AsyncIterator=M,e.async=function(d,v,m,S,T){T===void 0&&(T=Promise);var N=new M(l(d,v,m,S),T);return e.isGeneratorFunction(v)?N:N.next().then(function(B){return B.done?B.value:N.next()})},A(R),u(R,s,"Generator"),u(R,a,function(){return this}),u(R,"toString",function(){return"[object Generator]"}),e.keys=function(d){var v=Object(d),m=[];for(var S in v)m.push(S);return m.reverse(),function T(){for(;m.length;){var N=m.pop();if(N in v)return T.value=N,T.done=!1,T}return T.done=!0,T}},e.values=F,D.prototype={constructor:D,reset:function(d){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(O),!d)for(var v in this)v.charAt(0)==="t"&&i.call(this,v)&&!isNaN(+v.slice(1))&&(this[v]=void 0)},stop:function(){this.done=!0;var d=this.tryEntries[0].completion;if(d.type==="throw")throw d.arg;return this.rval},dispatchException:function(d){if(this.done)throw d;var v=this;function m(U,V){return N.type="throw",N.arg=d,v.next=U,V&&(v.method="next",v.arg=void 0),!!V}for(var S=this.tryEntries.length-1;S>=0;--S){var T=this.tryEntries[S],N=T.completion;if(T.tryLoc==="root")return m("end");if(T.tryLoc<=this.prev){var B=i.call(T,"catchLoc"),w=i.call(T,"finallyLoc");if(B&&w){if(this.prev<T.catchLoc)return m(T.catchLoc,!0);if(this.prev<T.finallyLoc)return m(T.finallyLoc)}else if(B){if(this.prev<T.catchLoc)return m(T.catchLoc,!0)}else{if(!w)throw new Error("try statement without catch or finally");if(this.prev<T.finallyLoc)return m(T.finallyLoc)}}}},abrupt:function(d,v){for(var m=this.tryEntries.length-1;m>=0;--m){var S=this.tryEntries[m];if(S.tryLoc<=this.prev&&i.call(S,"finallyLoc")&&this.prev<S.finallyLoc){var T=S;break}}T&&(d==="break"||d==="continue")&&T.tryLoc<=v&&v<=T.finallyLoc&&(T=null);var N=T?T.completion:{};return N.type=d,N.arg=v,T?(this.method="next",this.next=T.finallyLoc,c):this.complete(N)},complete:function(d,v){if(d.type==="throw")throw d.arg;return d.type==="break"||d.type==="continue"?this.next=d.arg:d.type==="return"?(this.rval=this.arg=d.arg,this.method="return",this.next="end"):d.type==="normal"&&v&&(this.next=v),c},finish:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.finallyLoc===d)return this.complete(m.completion,m.afterLoc),O(m),c}},catch:function(d){for(var v=this.tryEntries.length-1;v>=0;--v){var m=this.tryEntries[v];if(m.tryLoc===d){var S=m.completion;if(S.type==="throw"){var T=S.arg;O(m)}return T}}throw new Error("illegal catch attempt")},delegateYield:function(d,v,m){return this.delegate={iterator:F(d),resultName:v,nextLoc:m},this.method==="next"&&(this.arg=void 0),c}},e}function Hf(e,n,i,t,r,a,o){try{var s=e[a](o),u=s.value}catch(l){i(l);return}s.done?n(u):Promise.resolve(u).then(t,r)}function G1(e){return function(){var n=this,i=arguments;return new Promise(function(t,r){var a=e.apply(n,i);function o(u){Hf(a,t,r,o,s,"next",u)}function s(u){Hf(a,t,r,o,s,"throw",u)}o(void 0)})}}function K1(e,n){e.prototype=Object.create(n.prototype),e.prototype.constructor=e,tu(e,n)}function tu(e,n){return tu=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},tu(e,n)}var _i=10,$1=X.globalThis.navigator.platform.toUpperCase().indexOf("MAC")>=0,Kh=function(){function e(){var i=this;this.camera=void 0,this.canvasConfig=void 0,this.hammertime=void 0,this.isMoving=!1,this.lastX=-1,this.lastY=-1,this.ctrlKey=void 0,this.shiftKey=void 0,this.altKey=void 0,this.onPanstart=function(t){i.lastX=t.center.x,i.lastY=t.center.y,i.isMoving=!0},this.onPanmove=function(t){if(i.ctrlKey=t.srcEvent.ctrlKey,$1&&t.srcEvent.metaKey&&(i.ctrlKey=!0),i.altKey=t.srcEvent.altKey,i.shiftKey=t.srcEvent.shiftKey,i.isMoving){var r=t.center.x-i.lastX,a=t.center.y-i.lastY;i.lastX=t.center.x,i.lastY=t.center.y,i.ctrlKey&&!i.shiftKey?i.dolly(a):i.shiftKey&&!i.ctrlKey?i.pan(r,a):i.ctrlKey&&i.shiftKey?i.roll(a):i.rotate(r,a)}},this.onPanend=function(t){i.isMoving=!1},this.onPinch=function(t){var r=(1-t.scale)*10;i.dolly(r)},this.onMousewheel=function(t){i.dolly(t.deltaY)}}var n=e.prototype;return n.apply=function(t){var r=this,a=t.config,o=t.camera,s=t.renderingService,u=t.renderingContext;this.canvasConfig=a,this.camera=o,s.hooks.init.tapPromise(e.tag,G1(eu().mark(function l(){var f;return eu().wrap(function(h){for(;;)switch(h.prev=h.next){case 0:f=u.root.ownerDocument.defaultView,r.hammertime=new Wf(f),r.hammertime.get("pan").set({direction:Wf.DIRECTION_ALL}),r.hammertime.get("pinch").set({enable:!0}),r.hammertime.on("panstart",r.onPanstart),r.hammertime.on("panmove",r.onPanmove),r.hammertime.on("panend",r.onPanend),r.hammertime.on("pinch",r.onPinch),f.addEventListener("wheel",r.onMousewheel);case 9:case"end":return h.stop()}},l)}))),s.hooks.destroy.tap(e.tag,function(){r.hammertime.off("panstart",r.onPanstart),r.hammertime.off("panmove",r.onPanmove),r.hammertime.off("panend",r.onPanend),r.hammertime.off("pinch",r.onPinch);var l=u.root;l.removeEventListener("wheel",r.onMousewheel)})},n.dolly=function(t){this.camera.dolly(t)},n.pan=function(t,r){var a=this.canvasConfig,o=a.width,s=a.height,u=Math.max(o,s),l=1/u,f=1/u,c=t*l*_i/2,h=-r*f*_i/2;this.camera.pan(c,h)},n.roll=function(t){var r=this.canvasConfig.width;this.camera.rotate(0,0,-20/r*t*_i)},n.rotate=function(t,r){var a=this.canvasConfig,o=a.width,s=a.height,u=20/s,l=20/o,f=_i,c=_i;t*t>2*r*r?c*=.5:r*r>2*t*t&&(f*=.5);var h=t*u*f,p=r*l*c;this.camera.rotate(h,-p,0)},e}();Kh.tag="Control";var q1=function(e){K1(n,e);function n(){for(var t,r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return t=e.call.apply(e,[this].concat(a))||this,t.name="control",t}var i=n.prototype;return i.init=function(){this.addRenderingPlugin(new Kh)},i.destroy=function(){this.removeAllRenderingPlugins()},n}(un);function Z1(e,n,i,t,r){e.document.documentElement.removeChildren();const a=new U1({style:{fill:"white",direction:[-1,0,1]}});e.appendChild(a);const o=new B1(n,{radius:10,latitudeBands:32,longitudeBands:32}),s=new V1(n,{shininess:30});for(let u=0;u<t.length;u+=6){const l=new Vc({style:{x1:t[u],y1:t[u+1],z1:t[u+2],x2:t[u+3],y2:t[u+4],z2:t[u+5],lineWidth:1,stroke:"grey",isBillboard:!0}});e.appendChild(l)}for(let u=0;u<i.length;u+=3){const l=new cE({style:{fill:"red",opacity:1,geometry:o,material:s,cursor:"pointer"}});l.setPosition(i[u],i[u+1],i[u+2]),e.appendChild(l)}}function ii(e){const n=[],i=[],t={};return e.nodes.forEach(({id:r,data:{x:a,y:o,z:s}})=>{t[r]={x:a,y:o,z:s},n.push(a,o,s)}),e.edges.forEach(({source:r,target:a})=>{const o=t[r].x,s=t[r].y,u=t[r].z,l=t[a].x,f=t[a].y,c=t[a].z;i.push(o,s,u,l,f,c)}),{nodes:n,edges:i}}const $h=100,qh=1,Zh=1;async function Q1(e,{iterations:n}){const t=await new Dd({dimensions:3,kr:Zh,kg:qh,ks:.1,maxIteration:n||$h,width:We,height:We,center:[We/2,We/2]}).execute(e);return ii(t)}async function Xf(e,{iterations:n,min_movement:i,distance_threshold_mode:t},r){const o=await new bd({threads:r,dimensions:3,maxIteration:n||$h,minMovement:i,distanceThresholdMode:t,height:We,width:We,center:[We/2,We/2],kg:qh,kr:Zh,ks:.1}).execute(e);return ii(o)}const Qh=100,Jh=10,jh=200,ed=200,td=1e3,rd=1e3,nd=.9,id=1,ad=.005,od=.02;async function J1(e,{iterations:n,min_movement:i,distance_threshold_mode:t}){const a=await new wd({dimensions:3,factor:id,gravity:Jh,linkDistance:jh,edgeStrength:ed,nodeStrength:td,coulombDisScale:ad,damping:nd,maxSpeed:rd,minMovement:i,interval:od,preventOverlap:!0,distanceThresholdMode:t,maxIteration:n||Qh,width:We,height:We,center:[We/2,We/2,0]}).execute(e);return ii(a)}async function Vf(e,{iterations:n,min_movement:i,distance_threshold_mode:t},r){const o=await new Bd({threads:r,dimensions:3,maxIteration:n||Qh,minMovement:i,distanceThresholdMode:t,height:We,width:We,center:[We/2,We/2,0],factor:id,gravity:Jh,linkDistance:jh,edgeStrength:ed,nodeStrength:td,coulombDisScale:ad,damping:nd,maxSpeed:rd,interval:od}).execute(e);return ii(o)}const sd=5,ud=1,ld=5e3;async function j1(e,{iterations:n,min_movement:i,distance_threshold_mode:t}){const a=await new Fd({dimensions:3,height:We,width:We,center:[We/2,We/2,0],gravity:ud,speed:sd,maxIteration:n||ld}).execute(e);return ii(a)}async function Yf(e,{iterations:n,min_movement:i,distance_threshold_mode:t},r){const o=await new Ud({threads:r,dimensions:3,maxIteration:n||ld,minMovement:i,distanceThresholdMode:t,height:We,width:We,center:[We/2,We/2,0],gravity:ud,speed:sd}).execute(e);return ii(o)}const Au=[{name:pn.ANTV_LAYOUT},{name:pn.ANTV_LAYOUT_WASM_SINGLETHREAD},{name:pn.ANTV_LAYOUT_WASM_MULTITHREADS}],zf=document.getElementById("mask"),eR=document.getElementById("iterations"),tR=document.getElementById("min_movement"),rR=document.getElementById("distance_threshold_mode"),Zo=document.getElementById("dataset"),nR=document.getElementById("dataset-desc"),iR=document.getElementById("layout"),Ei=document.getElementById("run"),Pu=Au.map(({name:e})=>document.getElementById(e)),Gf=Pu.map(e=>{const n=new O1,i=new Y1,t=new q1;n.registerPlugin(i),n.registerPlugin(t);const r=new Qm({canvas:e,renderer:n});return r.getCamera().setPerspective(.1,5e3,45,1),[r,n]}),aR=Au.map((e,n)=>Pu[n].parentElement.querySelector("span")),oR=Au.map(({name:e},n)=>{const i=document.getElementById(e+"_checkbox");return i.onchange=()=>{Pu[n].parentElement.style.display=i.checked?"block":"none"},i}),sR=document.getElementById("scaling"),uR=async()=>{const e=await Hu(!1),n=await Hu(!0);return[e,n]},lR=async(e,n,i,t,r,a,o,s)=>{await e.ready;const l=n.getPlugin("device-renderer").getDevice(),f=performance.now(),{nodes:c,edges:h}=await t(r,a,o);i.innerHTML=`${(performance.now()-f).toFixed(2)}ms`,Z1(e,l,c,h)};(async()=>{Ei.innerHTML="Loading...",Ei.disabled=!0,console.time("Load datasets");const e=await kd(3);Zo.onchange=()=>{nR.innerHTML=e[Zo.value].desc},console.timeEnd("Load datasets"),console.time("Init WASM threads");const[n,i]=await uR();console.timeEnd("Init WASM threads"),Ei.innerHTML="Run layouts",Ei.disabled=!1;const t=[{name:pn.ANTV_LAYOUT,methods:{forceatlas2:Q1,force2:J1,fruchterman:j1}},{name:pn.ANTV_LAYOUT_WASM_SINGLETHREAD,methods:{forceatlas2:Xf,force2:Vf,fruchterman:Yf}},{name:pn.ANTV_LAYOUT_WASM_MULTITHREADS,methods:{forceatlas2:Xf,force2:Vf,fruchterman:Yf}}];Ei.onclick=async()=>{zf.style.display="flex";const r=e[Zo.value],a=iR.value;await Promise.all(t.map(async({name:o,methods:s},u)=>{s[a]&&oR[u].checked&&await lR(Gf[u][0],Gf[u][1],aR[u],s[a],r[o],{iterations:parseInt(eR.value),min_movement:parseFloat(tR.value),distance_threshold_mode:rR.value},o===pn.ANTV_LAYOUT_WASM_MULTITHREADS?i:n,Number(sR.value))})),zf.style.display="none"}})();
