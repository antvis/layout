<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,shrink-to-fit=no"
    />
    <title>Force 3D</title>
    <style>
      * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      html,
      body {
        height: 100%;
      }

      #container {
        width: 100%;
        height: 100%;
      }
    </style>
  </head>

  <body>
    <div id="container"></div>
    <script
      src="https://unpkg.com/@antv/g"
      type="application/javascript"
    ></script>
    <script
      src="https://unpkg.com/@antv/g-webgl"
      type="application/javascript"
    ></script>
    <script
      src="https://unpkg.com/@antv/g-plugin-3d"
      type="application/javascript"
    ></script>
    <script
      src="https://unpkg.com/@antv/g-plugin-control"
      type="application/javascript"
    ></script>
    <script
      src="https://unpkg.com/@antv/graphlib@2.0.0"
      type="application/javascript"
    ></script>
    <script
      src="../packages/layout/dist/index.min.js"
      type="application/javascript"
    ></script>
    <script>
      const { Graph } = window.GraphLib;
      const { ForceLayout } = window.Layout;

      const data = {
        nodes: [
          {
            id: "Argentina",
            data: {
              name: "Argentina",
            },
          },
          {
            id: "Australia",
            data: {
              name: "Australia",
            },
          },
          {
            id: "Belgium",
            data: {
              name: "Belgium",
            },
          },
          {
            id: "Brazil",
            data: {
              name: "Brazil",
            },
          },
          {
            id: "Colombia",
            data: {
              name: "Colombia",
            },
          },
          {
            id: "Costa Rica",
            data: {
              name: "Costa Rica",
            },
          },
          {
            id: "Croatia",
            data: {
              name: "Croatia",
            },
          },
          {
            id: "Denmark",
            data: {
              name: "Denmark",
            },
          },
          {
            id: "Egypt",
            data: {
              name: "Egypt",
            },
          },
          {
            id: "England",
            data: {
              name: "England",
            },
          },
          {
            id: "France",
            data: {
              name: "France",
            },
          },
          {
            id: "Germany",
            data: {
              name: "Germany",
            },
          },
          {
            id: "Iceland",
            data: {
              name: "Iceland",
            },
          },
          {
            id: "IR Iran",
            data: {
              name: "IR Iran",
            },
          },
          {
            id: "Japan",
            data: {
              name: "Japan",
            },
          },
          {
            id: "Korea Republic",
            data: {
              name: "Korea Republic",
            },
          },
          {
            id: "Mexico",
            data: {
              name: "Mexico",
            },
          },
          {
            id: "Morocco",
            data: {
              name: "Morocco",
            },
          },
          {
            id: "Nigeria",
            data: {
              name: "Nigeria",
            },
          },
          {
            id: "Panama",
            data: {
              name: "Panama",
            },
          },
          {
            id: "Peru",
            data: {
              name: "Peru",
            },
          },
          {
            id: "Poland",
            data: {
              name: "Poland",
            },
          },
          {
            id: "Portugal",
            data: {
              name: "Portugal",
            },
          },
          {
            id: "Russia",
            data: {
              name: "Russia",
            },
          },
          {
            id: "Saudi Arabia",
            data: {
              name: "Saudi Arabia",
            },
          },
          {
            id: "Senegal",
            data: {
              name: "Senegal",
            },
          },
          {
            id: "Serbia",
            data: {
              name: "Serbia",
            },
          },
          {
            id: "Spain",
            data: {
              name: "Spain",
            },
          },
          {
            id: "Sweden",
            data: {
              name: "Sweden",
            },
          },
          {
            id: "Switzerland",
            data: {
              name: "Switzerland",
            },
          },
          {
            id: "Tunisia",
            data: {
              name: "Tunisia",
            },
          },
          {
            id: "Uruguay",
            data: {
              name: "Uruguay",
            },
          },
        ],
        edges: [
          {
            id: "0",
            target: "Russia",
            source: "Saudi Arabia",
            data: {
              target_score: 5,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "1",
            target: "Uruguay",
            source: "Egypt",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "2",
            target: "Russia",
            source: "Egypt",
            data: {
              target_score: 3,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "3",
            target: "Uruguay",
            source: "Saudi Arabia",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "4",
            target: "Uruguay",
            source: "Russia",
            data: {
              target_score: 3,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "5",
            target: "Saudi Arabia",
            source: "Egypt",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "6",
            target: "IR Iran",
            source: "Morocco",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "7",
            target: "Portugal",
            source: "Spain",
            data: {
              target_score: 3,
              source_score: 3,
              directed: false,
            },
          },
          {
            id: "8",
            target: "Portugal",
            source: "Morocco",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "9",
            target: "Spain",
            source: "IR Iran",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "10",
            target: "IR Iran",
            source: "Portugal",
            data: {
              target_score: 1,
              source_score: 1,
              directed: false,
            },
          },
          {
            id: "11",
            target: "Spain",
            source: "Morocco",
            data: {
              target_score: 2,
              source_score: 2,
              directed: false,
            },
          },
          {
            id: "12",
            target: "France",
            source: "Australia",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "13",
            target: "Denmark",
            source: "Peru",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "14",
            target: "Denmark",
            source: "Australia",
            data: {
              target_score: 1,
              source_score: 1,
              directed: false,
            },
          },
          {
            id: "15",
            target: "France",
            source: "Peru",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "16",
            target: "Denmark",
            source: "France",
            data: {
              target_score: 0,
              source_score: 0,
              directed: false,
            },
          },
          {
            id: "17",
            target: "Peru",
            source: "Australia",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "18",
            target: "Argentina",
            source: "Iceland",
            data: {
              target_score: 1,
              source_score: 1,
            },
          },
          {
            id: "19",
            target: "Croatia",
            source: "Nigeria",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "20",
            target: "Croatia",
            source: "Argentina",
            data: {
              target_score: 3,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "21",
            target: "Nigeria",
            source: "Iceland",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "22",
            target: "Argentina",
            source: "Nigeria",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "23",
            target: "Croatia",
            source: "Iceland",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "24",
            target: "Serbia",
            source: "Costa Rica",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "25",
            target: "Brazil",
            source: "Switzerland",
            data: {
              target_score: 1,
              source_score: 1,
              directed: false,
            },
          },
          {
            id: "26",
            target: "Brazil",
            source: "Costa Rica",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "27",
            target: "Switzerland",
            source: "Serbia",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "28",
            target: "Brazil",
            source: "Serbia",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "29",
            target: "Switzerland",
            source: "Costa Rica",
            data: {
              target_score: 2,
              source_score: 2,
              directed: false,
            },
          },
          {
            id: "30",
            target: "Mexico",
            source: "Germany",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "31",
            target: "Sweden",
            source: "Korea Republic",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "32",
            target: "Mexico",
            source: "Korea Republic",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "33",
            target: "Germany",
            source: "Sweden",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "34",
            target: "Korea Republic",
            source: "Germany",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "35",
            target: "Sweden",
            source: "Mexico",
            data: {
              target_score: 3,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "36",
            target: "Belgium",
            source: "Panama",
            data: {
              target_score: 3,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "37",
            target: "England",
            source: "Tunisia",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "38",
            target: "Belgium",
            source: "Tunisia",
            data: {
              target_score: 5,
              source_score: 2,
              directed: true,
            },
          },
          {
            id: "39",
            target: "England",
            source: "Panama",
            data: {
              target_score: 6,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "40",
            target: "Belgium",
            source: "England",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "41",
            target: "Tunisia",
            source: "Panama",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "42",
            target: "Japan",
            source: "Colombia",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "43",
            target: "Senegal",
            source: "Poland",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "44",
            target: "Japan",
            source: "Senegal",
            data: {
              target_score: 2,
              source_score: 2,
              directed: false,
            },
          },
          {
            id: "45",
            target: "Colombia",
            source: "Poland",
            data: {
              target_score: 3,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "46",
            target: "Poland",
            source: "Japan",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "47",
            target: "Colombia",
            source: "Senegal",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "48",
            target: "Uruguay",
            source: "Portugal",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "49",
            target: "France",
            source: "Argentina",
            data: {
              target_score: 4,
              source_score: 3,
              directed: true,
            },
          },
          {
            id: "50",
            target: "Russia",
            source: "Spain",
            data: {
              target_score: 5,
              source_score: 4,
              directed: true,
            },
          },
          {
            id: "51",
            target: "Croatia",
            source: "Denmark",
            data: {
              target_score: 4,
              source_score: 3,
              directed: true,
            },
          },
          {
            id: "52",
            target: "Brazil",
            source: "Mexico",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "53",
            target: "Belgium",
            source: "Japan",
            data: {
              target_score: 3,
              source_score: 2,
              directed: true,
            },
          },
          {
            id: "54",
            target: "Sweden",
            source: "Switzerland",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "55",
            target: "England",
            source: "Colombia",
            data: {
              target_score: 4,
              source_score: 3,
              directed: true,
            },
          },
          {
            id: "56",
            target: "France",
            source: "Uruguay",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "57",
            target: "Belgium",
            source: "Brazil",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "58",
            target: "Croatia",
            source: "Russia",
            data: {
              target_score: 6,
              source_score: 5,
              directed: true,
            },
          },
          {
            id: "59",
            target: "England",
            source: "Sweden",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "60",
            target: "France",
            source: "Belgium",
            data: {
              target_score: 1,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "61",
            target: "Croatia",
            source: "England",
            data: {
              target_score: 2,
              source_score: 1,
              directed: true,
            },
          },
          {
            id: "62",
            target: "Belgium",
            source: "England",
            data: {
              target_score: 2,
              source_score: 0,
              directed: true,
            },
          },
          {
            id: "63",
            target: "France",
            source: "Croatia",
            data: {
              target_score: 4,
              source_score: 2,
              directed: true,
            },
          },
        ],
      };

      const { Line, Canvas } = window.G;
      // create a renderer
      const webglRenderer = new window.G.WebGL.Renderer();
      const { MeshPhongMaterial, SphereGeometry, DirectionalLight, Mesh, Plugin } = window.G['3D'];
      const { Plugin: PluginControl } = window.G.Control;

      const plugin = new Plugin();
      const pluginControl = new PluginControl();
      webglRenderer.registerPlugin(plugin);
      webglRenderer.registerPlugin(pluginControl);

      // create a canvas
      const canvas = new Canvas({
        container: "container",
        width: 500,
        height: 500,
        renderer: webglRenderer,
      });
      
      // adjust camera's position
      const camera = canvas.getCamera();
      camera.setPerspective(0.1, 2000, 45, 500 / 500);
      
      // add a directional light into scene
      const light = new DirectionalLight({
        style: {
          fill: 'white',
          direction: [-1, 0, 1],
        },
      });
      canvas.appendChild(light);

      const graph = new Graph({
        nodes: data.nodes,
        edges: data.edges.map((edge, i) => ({ id: i, ...edge })),
      });

      const force = new ForceLayout();

      (async () => {
        await canvas.ready;

        // use GPU device
        const plugin = webglRenderer.getPlugin('device-renderer');
        const device = plugin.getDevice();

        // create a sphere geometry
        const sphereGeometry = new SphereGeometry(device, {
          radius: 10,
          latitudeBands: 32,
          longitudeBands: 32,
        });
        // create a material with Phong lighting model
        const material = new MeshPhongMaterial(device, {
          shininess: 30,
        });

        const createNodesEdges = (positions) => {
        positions.edges.forEach(({ source, target }, i) => {
          const sourceNode = positions.nodes.find(({ id }) => id === source);
          const targetNode = positions.nodes.find(({ id }) => id === target);
          const line = new Line({
            style: {
              x1: sourceNode.data.x,
              y1: sourceNode.data.y,
              z1: sourceNode.data.z,
              x2: targetNode.data.x,
              y2: targetNode.data.y,
              z2: targetNode.data.z,
              lineWidth: 1,
              stroke: "grey",
              isBillboard: true,
            },
          });
          canvas.appendChild(line);
        });

        positions.nodes.forEach((node, i) => {
          // create a mesh
          const sphere = new Mesh({
            style: {
              // x: node.data.x,
              // y: node.data.y,
              // z: node.data.z,
              fill: 'red',
              opacity: 1,
              geometry: sphereGeometry,
              material,
              cursor: 'pointer',
            },
          });
          sphere.setPosition(node.data.x, node.data.y, node.data.z);

          // console.log(node.x, node.y, node.z);
          canvas.appendChild(sphere);
        });
      };

        const positions = await force.execute(graph, {
          dimensions: 3,
          center: [250, 250, 0], // The center of the graph by default
        });
        createNodesEdges(positions);

        console.log(positions);
      })();
    </script>
  </body>
</html>
